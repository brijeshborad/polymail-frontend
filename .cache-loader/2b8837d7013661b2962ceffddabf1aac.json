{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/components/ThreadList/components/AdvancedSearchPopover/AdvancedSearchPopover.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/components/ThreadList/components/AdvancedSearchPopover/AdvancedSearchPopover.tsx","mtime":1675280254113},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCBQb3BvdmVyIGZyb20gJ0BzcmMvY29tcG9uZW50cy9Qb3BvdmVyL1BvcG92ZXInOwppbXBvcnQgRGVmYXVsdFNlYXJjaCBmcm9tICcuL2NvbXBvbmVudHMvRGVmYXVsdFNlYXJjaCc7CmltcG9ydCBDb250YWN0c1NlYXJjaCBmcm9tICcuL2NvbXBvbmVudHMvQ29udGFjdHNTZWFyY2gvQ29udGFjdHNTZWFyY2gnOwppbXBvcnQgQm94U2VhcmNoIGZyb20gJy4vY29tcG9uZW50cy9Cb3hTZWFyY2gvQm94U2VhcmNoJzsKaW1wb3J0IE1vZGlmaWVyU2VhcmNoIGZyb20gJy4vY29tcG9uZW50cy9Nb2RpZmllclNlYXJjaC9Nb2RpZmllclNlYXJjaCc7CmltcG9ydCBEYXRlU2VhcmNoLCB7IERBVEVfRk9STUFUIH0gZnJvbSAnLi9jb21wb25lbnRzL0RhdGVTZWFyY2gvRGF0ZVNlYXJjaCc7CmltcG9ydCBUZXh0U2VhcmNoIGZyb20gJy4vY29tcG9uZW50cy9UZXh0U2VhcmNoL1RleHRTZWFyY2gnOwppbXBvcnQgeyBnZXREZWZhdWx0T3B0aW9ucyB9IGZyb20gJ0BzcmMvbGliL3NlYXJjaCc7CmltcG9ydCB7IHZhbHVlcywgc3VtLCBmaWx0ZXIsIGRlYm91bmNlLCBmb3JFYWNoLCBzb3J0QnkgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgJy4vQWR2YW5jZWRTZWFyY2hQb3BvdmVyLnNjc3MnOwppbXBvcnQgeyBkYXRlVHlwZWFoZWFkT3B0aW9ucyB9IGZyb20gJ0BzcmMvbGliL2RhdGV0aW1lJzsKdmFyIFNlYXJjaE1vZGlmaWVyOwooZnVuY3Rpb24gKFNlYXJjaE1vZGlmaWVyKSB7CiAgICBTZWFyY2hNb2RpZmllclsiQ29udGFjdCJdID0gImNvbnRhY3QiOwogICAgU2VhcmNoTW9kaWZpZXJbIlRleHQiXSA9ICJ0ZXh0IjsKICAgIFNlYXJjaE1vZGlmaWVyWyJCb3giXSA9ICJib3giOwogICAgU2VhcmNoTW9kaWZpZXJbIklzIl0gPSAiaXMiOwogICAgU2VhcmNoTW9kaWZpZXJbIkhhcyJdID0gImhhcyI7CiAgICBTZWFyY2hNb2RpZmllclsiQmVmb3JlIl0gPSAiYmVmb3JlIjsKICAgIFNlYXJjaE1vZGlmaWVyWyJBZnRlciJdID0gImFmdGVyIjsKfSkoU2VhcmNoTW9kaWZpZXIgfHwgKFNlYXJjaE1vZGlmaWVyID0ge30pKTsKZXhwb3J0IHZhciBDb21wb25lbnRUeXBlOwooZnVuY3Rpb24gKENvbXBvbmVudFR5cGUpIHsKICAgIENvbXBvbmVudFR5cGVbIkRlZmF1bHQiXSA9ICJkZWZhdWx0IjsKICAgIENvbXBvbmVudFR5cGVbIlRleHQiXSA9ICJ0ZXh0IjsKICAgIENvbXBvbmVudFR5cGVbIkNvbnRhY3QiXSA9ICJjb250YWN0IjsKICAgIENvbXBvbmVudFR5cGVbIk1vZGlmaWVyIl0gPSAibW9kaWZpZXIiOwogICAgQ29tcG9uZW50VHlwZVsiQm94Il0gPSAiYm94IjsKICAgIENvbXBvbmVudFR5cGVbIkRhdGUiXSA9ICJkYXRlIjsKfSkoQ29tcG9uZW50VHlwZSB8fCAoQ29tcG9uZW50VHlwZSA9IHt9KSk7CnZhciBERUZBVUxUX09QVElPTlMgPSB7CiAgICBtb2RpZmllcnM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGhlYWRpbmc6ICdpbjonLAogICAgICAgICAgICBsaXN0OiAnaW5ib3gsIGFyY2hpdmUsIHRyYXNoLCBsaXN0cycsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgIGhlYWRpbmc6ICdpczonLAogICAgICAgICAgICBsaXN0OiAndW5yZWFkLCByZXBsaWVkLCBzdGFycmVkLCBvcGVuZWQsIHVub3BlbmVkJywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaGVhZGluZzogJ2hhczonLAogICAgICAgICAgICBsaXN0OiAncmVtaW5kZXIsIGF0dGFjaG1lbnQnLAogICAgICAgIH0sCiAgICBdLAogICAgY29udGFjdHM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGhlYWRpbmc6ICd3aXRoOicsCiAgICAgICAgICAgIGxpc3Q6ICdjb250YWN0JywKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgaGVhZGluZzogJ2Zyb206JywKICAgICAgICAgICAgbGlzdDogJ2NvbnRhY3QnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBoZWFkaW5nOiAndG86JywKICAgICAgICAgICAgbGlzdDogJ2NvbnRhY3QnLAogICAgICAgIH0sCiAgICBdLAogICAgZGF0ZXM6IFsKICAgICAgICB7CiAgICAgICAgICAgIGhlYWRpbmc6ICdiZWZvcmU6JywKICAgICAgICAgICAgbGlzdDogJ2RhdGUnLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICBoZWFkaW5nOiAnYWZ0ZXI6JywKICAgICAgICAgICAgbGlzdDogJ2RhdGUnLAogICAgICAgIH0sCiAgICBdLAp9Owp2YXIgUkVHRVggPSAnKFteOl0rJHwoInxcJykuKygifFwnKT8kKSc7CnZhciBBZHZhbmNlZFNlYXJjaFBvcG92ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoQWR2YW5jZWRTZWFyY2hQb3BvdmVyLCBfc3VwZXIpOwogICAgZnVuY3Rpb24gQWR2YW5jZWRTZWFyY2hQb3BvdmVyKHByb3BzKSB7CiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKICAgICAgICBfdGhpcy5zaG93ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5oaWRlRGVib3VuY2UuY2FuY2VsKCk7CiAgICAgICAgICAgIF90aGlzLnNob3dEZWJvdW5jZSgpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2hvd0RlYm91bmNlLmNhbmNlbCgpOwogICAgICAgICAgICBfdGhpcy5oaWRlRGVib3VuY2UoKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVJlZiA9IGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgX3RoaXMucG9wb3ZlciA9IHJlZjsKICAgICAgICB9OwogICAgICAgIF90aGlzLnVwZGF0ZU9wdGlvbnMgPSBmdW5jdGlvbiAocHJvcHMpIHsKICAgICAgICAgICAgdmFyIHF1ZXJ5UGFyYW1zID0gX3RoaXMuZ2V0UXVlcnlQYXJhbXMocHJvcHMucXVlcnksIHByb3BzLmxpc3RzKTsKICAgICAgICAgICAgLy8gVE9ETyhTSElOKTogSGFuZGxlIHdoZW4gbW91c2UgaGFzIGV4aXRlZCBvcHRpb25zCiAgICAgICAgICAgIHZhciBuZXdPcHRpb25zID0gX3RoaXMuZ2V0T3B0aW9ucyhxdWVyeVBhcmFtcyk7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zOiBxdWVyeVBhcmFtcywKICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6ICghX3RoaXMuc3RhdGUubW91c2VJblBvcG92ZXIgJiYgX3RoaXMuc3RhdGUub3B0aW9ucyAhPT0gbmV3T3B0aW9ucykKICAgICAgICAgICAgICAgICAgICA/IDAKICAgICAgICAgICAgICAgICAgICA6IF90aGlzLnN0YXRlLnNlbGVjdGVkSW5kZXgsCiAgICAgICAgICAgICAgICBvcHRpb25zOiBuZXdPcHRpb25zLAogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIC8vIGdldFF1ZXJ5UGFyYW0gYWx3YXlzIHJldHVybnMgYSBsb3dlcmNhc2VkIHZlcnNpb24gb2YgcGFyYW1zCiAgICAgICAgX3RoaXMuZ2V0UXVlcnlQYXJhbSA9IGZ1bmN0aW9uIChxdWVyeSwga2V5d29yZHMpIHsKICAgICAgICAgICAgdmFyIHF1ZXJ5TG93ZXJDYXNlZCA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIHZhciBrZXl3b3Jkc0xvd2VyQ2FzZWQgPSBrZXl3b3Jkcy5tYXAoZnVuY3Rpb24gKGspIHsgcmV0dXJuIGsudG9Mb3dlckNhc2UoKTsgfSk7CiAgICAgICAgICAgIHZhciBrZXl3b3JkID0ga2V5d29yZHNMb3dlckNhc2VkLmZpbHRlcihmdW5jdGlvbiAoaykgewogICAgICAgICAgICAgICAgLy8gTkVFRCBUTyBmaXggYWxsIE1BVENIKCBldmVyeWVod2VyZSkKICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeUxvd2VyQ2FzZWQubWF0Y2gobmV3IFJlZ0V4cChrICsgUkVHRVgsICdnJykpOwogICAgICAgICAgICB9KVswXTsKICAgICAgICAgICAgaWYgKGtleXdvcmQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBxdWVyeUxvd2VyQ2FzZWQubWF0Y2gobmV3IFJlZ0V4cChSRUdFWCwgJ2cnKSlbMF0uc3BsaXQoLyd8Ii8pLmpvaW4oJycpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChxdWVyeUxvd2VyQ2FzZWQubWF0Y2gobmV3IFJlZ0V4cCgiKCIgKyBrZXl3b3Jkc0xvd2VyQ2FzZWQuam9pbignfCcpICsgIikkIiwgJ2dpJykpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9OwogICAgICAgIF90aGlzLmdldFF1ZXJ5UGFyYW1zID0gZnVuY3Rpb24gKHF1ZXJ5LCBsaXN0cykgewogICAgICAgICAgICB2YXIgc2VhcmNoTW9kaWZpZXJUb1ByZWZpeE1hcHBpbmcgPSBbCiAgICAgICAgICAgICAgICB7IG1vZGlmaWVyOiBTZWFyY2hNb2RpZmllci5Db250YWN0LCBwcmVmaXhlczogWyd3aXRoOicsICdmcm9tOicsICd0bzonXSB9LAogICAgICAgICAgICAgICAgeyBtb2RpZmllcjogU2VhcmNoTW9kaWZpZXIuQm94LCBwcmVmaXhlczogWydpbjonXSB9LAogICAgICAgICAgICAgICAgeyBtb2RpZmllcjogU2VhcmNoTW9kaWZpZXIuSXMsIHByZWZpeGVzOiBbJ2lzOiddIH0sCiAgICAgICAgICAgICAgICB7IG1vZGlmaWVyOiBTZWFyY2hNb2RpZmllci5IYXMsIHByZWZpeGVzOiBbJ2hhczonXSB9LAogICAgICAgICAgICAgICAgeyBtb2RpZmllcjogU2VhcmNoTW9kaWZpZXIuQmVmb3JlLCBwcmVmaXhlczogWydiZWZvcmU6J10gfSwKICAgICAgICAgICAgICAgIHsgbW9kaWZpZXI6IFNlYXJjaE1vZGlmaWVyLkFmdGVyLCBwcmVmaXhlczogWydhZnRlcjonXSB9LAogICAgICAgICAgICBdOwogICAgICAgICAgICB2YXIgcXVlcnlQYXJhbXMgPSB7fTsKICAgICAgICAgICAgc2VhcmNoTW9kaWZpZXJUb1ByZWZpeE1hcHBpbmcuZm9yRWFjaChmdW5jdGlvbiAobWFwcGluZykgewogICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5UGFyYW1zW21hcHBpbmcubW9kaWZpZXJdID0gX3RoaXMuZ2V0UXVlcnlQYXJhbShxdWVyeSwgbWFwcGluZy5wcmVmaXhlcyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBmb3JFYWNoKHF1ZXJ5UGFyYW1zLCBmdW5jdGlvbiAocGFyYW0sIG1vZGlmaWVyKSB7CiAgICAgICAgICAgICAgICBpZiAocGFyYW0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBpbmRleE9mU3BhY2UgPSBwYXJhbS5zZWFyY2goL1xzL2cpOwogICAgICAgICAgICAgICAgICAgIHZhciBwb3NzaWJsZU9wdGlvbnMgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHZvaWQgMDsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVnZXggPSB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RpZmllcikgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNlYXJjaE1vZGlmaWVyLkNvbnRhY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleCA9IG5ldyBSZWdFeHAoIl5cXFMrQFxcUytcXC5cXFMrIiwgJ2dpJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW0ubWF0Y2gocmVnZXgpICYmIGluZGV4T2ZTcGFjZSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVBhcmFtc1tTZWFyY2hNb2RpZmllci5Db250YWN0XSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVBhcmFtc1tTZWFyY2hNb2RpZmllci5UZXh0XSA9IHBhcmFtLnNsaWNlKGluZGV4T2ZTcGFjZSArIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgU2VhcmNoTW9kaWZpZXIuQm94OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zc2libGVPcHRpb25zID0gKGdldERlZmF1bHRPcHRpb25zKENvbXBvbmVudFR5cGUuQm94KSB8fCBbXSkuY29uY2F0KGxpc3RzLm1hcChmdW5jdGlvbiAobCkgeyByZXR1cm4gbC5uYW1lOyB9KSkubWFwKGZ1bmN0aW9uIChvKSB7IHJldHVybiBvLnRyaW0oKS50b0xvd2VyQ2FzZSgpOyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IHBhcmFtLnNwbGl0KC9ccy9nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNlYXJjaE1vZGlmaWVyLklzOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFNlYXJjaE1vZGlmaWVyLkhhczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlT3B0aW9ucyA9IGdldERlZmF1bHRPcHRpb25zKENvbXBvbmVudFR5cGUuTW9kaWZpZXIsIFNlYXJjaE1vZGlmaWVyLklzID09PSBtb2RpZmllcikgfHwgW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMgPSBwYXJhbS5zcGxpdCgvXHMvZyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBTZWFyY2hNb2RpZmllci5CZWZvcmU6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgU2VhcmNoTW9kaWZpZXIuQWZ0ZXI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleCA9IG5ldyBSZWdFeHAoIl5cXGR7NH0vXFxkezJ9L1xcZHsyfSIsICdnaScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZ2V4ICYmIHBhcmFtICE9PSAnJyAmJiBwYXJhbS5tYXRjaChyZWdleCkgJiYgaW5kZXhPZlNwYWNlICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVBhcmFtc1ttb2RpZmllcl0gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zW1NlYXJjaE1vZGlmaWVyLlRleHRdID0gcGFyYW0uc2xpY2UoaW5kZXhPZlNwYWNlICsgMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBvc3NpYmxlT3B0aW9ucyAmJiBwYXJhbXMgJiYgcG9zc2libGVPcHRpb25zLmxlbmd0aCAmJiBwYXJhbXMubGVuZ3RoICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlT3B0aW9ucy5pbmRleE9mKHBhcmFtc1swXS50cmltKCkudG9Mb3dlckNhc2UoKSkgIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zW21vZGlmaWVyXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlQYXJhbXNbU2VhcmNoTW9kaWZpZXIuVGV4dF0gPSBwYXJhbXMuc2xpY2UoMSkuam9pbignICcpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChxdWVyeVBhcmFtc1tTZWFyY2hNb2RpZmllci5UZXh0XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBxdWVyeVBhcmFtc1tTZWFyY2hNb2RpZmllci5UZXh0XSA9IHF1ZXJ5ID8gcXVlcnkgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5UGFyYW1zOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuZ2V0UXVlcnlQYXJhbUZvckNvbXBvbmVudCA9IGZ1bmN0aW9uIChwYXJhbXMsIHF1ZXJ5UGFyYW1zKSB7CiAgICAgICAgICAgIGlmICghcXVlcnlQYXJhbXMpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgIHZhciBwOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGFyYW1zLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICBwID0gcGFyYW1zW2ldOwogICAgICAgICAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zW3BdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcXVlcnlQYXJhbXNbcF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9OwogICAgICAgIF90aGlzLmdldE9wdGlvbnNGb3JDb21wb25lbnQgPSBmdW5jdGlvbiAoY29tcG9uZW50LCBxdWVyeSwgcXVlcnlQYXJhbXMpIHsKICAgICAgICAgICAgaWYgKHF1ZXJ5ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3dpdGNoIChjb21wb25lbnQpIHsKICAgICAgICAgICAgICAgIGNhc2UgQ29tcG9uZW50VHlwZS5UZXh0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBbcXVlcnldLmNvbmNhdCgoZ2V0RGVmYXVsdE9wdGlvbnMoY29tcG9uZW50KSB8fCBbXSkKICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAobSkgeyByZXR1cm4gbS5zbGljZSgwLCBtLmxlbmd0aCAtIDEpLm1hdGNoKHF1ZXJ5KTsgfSkpOwogICAgICAgICAgICAgICAgY2FzZSBDb21wb25lbnRUeXBlLkNvbnRhY3Q6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnByb3BzLnR5cGVhaGVhZENvbnRhY3RzLnNsaWNlKDAsIDUpOwogICAgICAgICAgICAgICAgY2FzZSBDb21wb25lbnRUeXBlLk1vZGlmaWVyOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAoZ2V0RGVmYXVsdE9wdGlvbnMoY29tcG9uZW50LCBxdWVyeVBhcmFtc1tTZWFyY2hNb2RpZmllci5Jc10gIT09IHVuZGVmaW5lZCkgfHwgW10pCiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0ubWF0Y2gocXVlcnkpOyB9KTsKICAgICAgICAgICAgICAgIGNhc2UgQ29tcG9uZW50VHlwZS5Cb3g6CiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSAoZ2V0RGVmYXVsdE9wdGlvbnMoY29tcG9uZW50KSB8fCBbXSkKICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYikgeyByZXR1cm4gYi50b0xvd2VyQ2FzZSgpLm1hdGNoKHF1ZXJ5KTsgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgLmNvbmNhdChzb3J0QnkoX3RoaXMucHJvcHMubGlzdHMuZmlsdGVyKGZ1bmN0aW9uIChsKSB7IHJldHVybiBsLm5hbWUudG9Mb3dlckNhc2UoKS5tYXRjaChxdWVyeSk7IH0pLCBmdW5jdGlvbiAobCkgeyByZXR1cm4gbC5uYW1lLnRvTG93ZXJDYXNlKCk7IH0pKQogICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoMCwgNSk7CiAgICAgICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuRGF0ZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZVR5cGVhaGVhZE9wdGlvbnMocXVlcnkpLnNsaWNlKDAsIDUpOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvLyByZXR1cm5zIG9wdGlvbnMgZm9yIGFsbCBjb21wb25lbnRzCiAgICAgICAgX3RoaXMuZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChxdWVyeVBhcmFtcykgewogICAgICAgICAgICB2YXIgY29tcG9uZW50VG9RdWVyeVBhcmFtTWFwcGluZyA9IFsKICAgICAgICAgICAgICAgIHsgY29tcG9uZW50OiBDb21wb25lbnRUeXBlLlRleHQsIHBhcmFtczogWyd0ZXh0J10gfSwKICAgICAgICAgICAgICAgIHsgY29tcG9uZW50OiBDb21wb25lbnRUeXBlLkNvbnRhY3QsIHBhcmFtczogWydjb250YWN0JywgJ3RleHQnXSB9LAogICAgICAgICAgICAgICAgeyBjb21wb25lbnQ6IENvbXBvbmVudFR5cGUuQm94LCBwYXJhbXM6IFsnYm94J10gfSwKICAgICAgICAgICAgICAgIHsgY29tcG9uZW50OiBDb21wb25lbnRUeXBlLk1vZGlmaWVyLCBwYXJhbXM6IFsnaXMnLCAnaGFzJ10gfSwKICAgICAgICAgICAgICAgIHsgY29tcG9uZW50OiBDb21wb25lbnRUeXBlLkRhdGUsIHBhcmFtczogWydiZWZvcmUnLCAnYWZ0ZXInXSB9LAogICAgICAgICAgICBdOwogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB2YXIgY29tcG9uZW50OwogICAgICAgICAgICB2YXIgc2VhcmNoOwogICAgICAgICAgICBjb21wb25lbnRUb1F1ZXJ5UGFyYW1NYXBwaW5nLmZvckVhY2goZnVuY3Rpb24gKG1hcHBpbmcpIHsKICAgICAgICAgICAgICAgIGNvbXBvbmVudCA9IG1hcHBpbmcuY29tcG9uZW50OwogICAgICAgICAgICAgICAgc2VhcmNoID0gX3RoaXMuZ2V0UXVlcnlQYXJhbUZvckNvbXBvbmVudChtYXBwaW5nLnBhcmFtcywgcXVlcnlQYXJhbXMpOwogICAgICAgICAgICAgICAgb3B0aW9uc1tjb21wb25lbnRdID0gX3RoaXMuZ2V0T3B0aW9uc0ZvckNvbXBvbmVudChjb21wb25lbnQsIHNlYXJjaCwgcXVlcnlQYXJhbXMpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5zZWFyY2ggPSBmdW5jdGlvbiAodHlwZSwgc2VsZWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBxdWVyeVBhcmFtcyA9IF90aGlzLnN0YXRlLnF1ZXJ5UGFyYW1zOwogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgcXVlcnkgPSBfYS5xdWVyeSwgb25TZWFyY2ggPSBfYS5vblNlYXJjaDsKICAgICAgICAgICAgaWYgKCFxdWVyeVBhcmFtcykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBuZXdRdWVyeTsKICAgICAgICAgICAgdmFyIHRvUmVwbGFjZTsKICAgICAgICAgICAgdmFyIHJlcGxhY2VXaXRoOwogICAgICAgICAgICB2YXIgaGFuZGxlZCA9IGZhbHNlOwogICAgICAgICAgICB2YXIgY29tcGxldGVTZWFyY2ggPSBmYWxzZTsKICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuQ29udGFjdDoKICAgICAgICAgICAgICAgICAgICBpZiAocXVlcnlQYXJhbXNbU2VhcmNoTW9kaWZpZXIuQ29udGFjdF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0b1JlcGxhY2UgPSBxdWVyeVBhcmFtc1tTZWFyY2hNb2RpZmllci5Db250YWN0XTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVdpdGggPSBzZWxlY3Rpb24uZW1haWw7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlU2VhcmNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvUmVwbGFjZSA9IHF1ZXJ5UGFyYW1zW1NlYXJjaE1vZGlmaWVyLlRleHRdOwogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlV2l0aCA9ICJ3aXRoOiIgKyBzZWxlY3Rpb24uZW1haWw7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlU2VhcmNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuQm94OgogICAgICAgICAgICAgICAgICAgIHRvUmVwbGFjZSA9IHF1ZXJ5UGFyYW1zW1NlYXJjaE1vZGlmaWVyLkJveF07CiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVdpdGggPSB0eXBlb2Ygc2VsZWN0aW9uID09PSAnc3RyaW5nJyA/IHNlbGVjdGlvbiA6IHNlbGVjdGlvbi5uYW1lOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlV2l0aC5pbmRleE9mKCcgJykgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VXaXRoID0gIlwiIiArIHJlcGxhY2VXaXRoICsgIlwiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVTZWFyY2ggPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDb21wb25lbnRUeXBlLk1vZGlmaWVyOgogICAgICAgICAgICAgICAgICAgIHRvUmVwbGFjZSA9IHF1ZXJ5UGFyYW1zW1NlYXJjaE1vZGlmaWVyLklzXSAhPT0gdW5kZWZpbmVkID8KICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlQYXJhbXNbU2VhcmNoTW9kaWZpZXIuSXNdIDogcXVlcnlQYXJhbXNbU2VhcmNoTW9kaWZpZXIuSGFzXTsKICAgICAgICAgICAgICAgICAgICByZXBsYWNlV2l0aCA9IHNlbGVjdGlvbjsKICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZVNlYXJjaCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIENvbXBvbmVudFR5cGUuRGF0ZToKICAgICAgICAgICAgICAgICAgICB0b1JlcGxhY2UgPSBxdWVyeVBhcmFtc1tTZWFyY2hNb2RpZmllci5BZnRlcl0gIT09IHVuZGVmaW5lZCA/CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zW1NlYXJjaE1vZGlmaWVyLkFmdGVyXSA6IHF1ZXJ5UGFyYW1zW1NlYXJjaE1vZGlmaWVyLkJlZm9yZV07CiAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVdpdGggPSBzZWxlY3Rpb24ubW9tZW50ID8gc2VsZWN0aW9uLm1vbWVudC5mb3JtYXQoREFURV9GT1JNQVQpIDogdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlU2VhcmNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQ29tcG9uZW50VHlwZS5UZXh0OgogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3Rpb24gPT09IHF1ZXJ5UGFyYW1zW1NlYXJjaE1vZGlmaWVyLlRleHRdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9uU2VhcmNoKHF1ZXJ5LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0b1JlcGxhY2UgPSBxdWVyeVBhcmFtc1tTZWFyY2hNb2RpZmllci5UZXh0XTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZVdpdGggPSBzZWxlY3Rpb247CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlU2VhcmNoID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBDb21wb25lbnRUeXBlLkRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24uaGVhZGluZykgewogICAgICAgICAgICAgICAgICAgICAgICBvblNlYXJjaChzZWxlY3Rpb24uaGVhZGluZy5zZWFyY2goL1xzL2cpID4gLTEgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlwiIiArIHNlbGVjdGlvbi5oZWFkaW5nICsgIlwiIiA6IHNlbGVjdGlvbi5oZWFkaW5nLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRvUmVwbGFjZSAmJiByZXBsYWNlV2l0aCAmJiAhaGFuZGxlZCkgewogICAgICAgICAgICAgICAgbmV3UXVlcnkgPSBxdWVyeS5yZXBsYWNlKG5ldyBSZWdFeHAodG9SZXBsYWNlICsgIiQiLCAnZ2knKSwgcmVwbGFjZVdpdGgpOwogICAgICAgICAgICAgICAgb25TZWFyY2gobmV3UXVlcnksIGNvbXBsZXRlU2VhcmNoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0b1JlcGxhY2UgPT09ICcnICYmIHJlcGxhY2VXaXRoICYmICFoYW5kbGVkKSB7CiAgICAgICAgICAgICAgICBuZXdRdWVyeSA9IHF1ZXJ5ICsgcmVwbGFjZVdpdGg7CiAgICAgICAgICAgICAgICBvblNlYXJjaChuZXdRdWVyeSwgY29tcGxldGVTZWFyY2gpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVTZWxlY3QgPSBmdW5jdGlvbiAoaW5kZXgsIG9wdGlvbikgewogICAgICAgICAgICBpZiAoaW5kZXggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgX3RoaXMuZW50ZXIoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChvcHRpb24pIHsKICAgICAgICAgICAgICAgIF90aGlzLnNlYXJjaChvcHRpb24uY29tcG9uZW50LCBvcHRpb24ub3B0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuZ2V0U3VtT2ZBbGxPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuIHN1bShmaWx0ZXIodmFsdWVzKG9wdGlvbnMpLCBmdW5jdGlvbiAobykgeyByZXR1cm4gISFvICYmICEhby5sZW5ndGg7IH0pLm1hcChmdW5jdGlvbiAobykgeyByZXR1cm4gby5sZW5ndGg7IH0pKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmdldFNlbGVjdGVkQ29tcG9uZW50SW5kZXggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBxdWVyeSA9IF90aGlzLnByb3BzLnF1ZXJ5OwogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5zdGF0ZSwgc2VsZWN0ZWRJbmRleCA9IF9hLnNlbGVjdGVkSW5kZXgsIG9wdGlvbnMgPSBfYS5vcHRpb25zOwogICAgICAgICAgICBpZiAoIXF1ZXJ5KSB7CiAgICAgICAgICAgICAgICByZXR1cm4geyBjb21wb25lbnQ6IENvbXBvbmVudFR5cGUuRGVmYXVsdCwgcmVsYXRpdmVJbmRleDogc2VsZWN0ZWRJbmRleCB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBpbmRleCA9IHNlbGVjdGVkSW5kZXggJSBfdGhpcy5nZXRTdW1PZkFsbE9wdGlvbnMob3B0aW9ucyk7CiAgICAgICAgICAgIHZhciB0b3RhbE9wdGlvbnMgPSAwOwogICAgICAgICAgICB2YXIgaTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IF90aGlzLmNvbXBvbmVudE9yZGVyLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9uc1tfdGhpcy5jb21wb25lbnRPcmRlcltpXV0pIHsKICAgICAgICAgICAgICAgICAgICB0b3RhbE9wdGlvbnMgKz0gb3B0aW9uc1tfdGhpcy5jb21wb25lbnRPcmRlcltpXV0ubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGlmICh0b3RhbE9wdGlvbnMgPiBpbmRleCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50OiBfdGhpcy5jb21wb25lbnRPcmRlcltpXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlSW5kZXg6IGluZGV4IC0gKHRvdGFsT3B0aW9ucyAtIG9wdGlvbnNbX3RoaXMuY29tcG9uZW50T3JkZXJbaV1dLmxlbmd0aCksCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5kb3duQXJyb3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBxdWVyeSA9IF90aGlzLnByb3BzLnF1ZXJ5OwogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5zdGF0ZSwgc2VsZWN0ZWRJbmRleCA9IF9hLnNlbGVjdGVkSW5kZXgsIG9wdGlvbnMgPSBfYS5vcHRpb25zOwogICAgICAgICAgICBpZiAoIXF1ZXJ5KSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogTWF0aC5taW4oc2VsZWN0ZWRJbmRleCArIDEsIDcpLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHN1bU9wdGlvbnMgPSBfdGhpcy5nZXRTdW1PZkFsbE9wdGlvbnMob3B0aW9ucyk7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IE1hdGgubWluKHNlbGVjdGVkSW5kZXggKyAxLCBzdW1PcHRpb25zID8gc3VtT3B0aW9ucyAtIDEgOiAwKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy51cEFycm93ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZWN0ZWRJbmRleCA9IF90aGlzLnN0YXRlLnNlbGVjdGVkSW5kZXg7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgc2VsZWN0ZWRJbmRleDogTWF0aC5tYXgoc2VsZWN0ZWRJbmRleCAtIDEsIDApIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuZW50ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBxdWVyeSA9IF90aGlzLnByb3BzLnF1ZXJ5OwogICAgICAgICAgICB2YXIgc2VsZWN0ZWRPcHRpb24gPSBfdGhpcy5nZXRTZWxlY3RlZENvbXBvbmVudEluZGV4KCk7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZENvbXBvbmVudCA9IHNlbGVjdGVkT3B0aW9uICYmIHNlbGVjdGVkT3B0aW9uLmNvbXBvbmVudDsKICAgICAgICAgICAgdmFyIHNlbGVjdGVkSW5kZXggPSBzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi5yZWxhdGl2ZUluZGV4OwogICAgICAgICAgICBpZiAoIXF1ZXJ5ICYmIHNlbGVjdGVkSW5kZXggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdmFyIHRvdGFsXzEgPSAwOwogICAgICAgICAgICAgICAgZm9yRWFjaChERUZBVUxUX09QVElPTlMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7CiAgICAgICAgICAgICAgICAgICAgdG90YWxfMSArPSB2YWx1ZS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsXzEgPiBzZWxlY3RlZEluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlYXJjaChDb21wb25lbnRUeXBlLkRlZmF1bHQsIHZhbHVlW3NlbGVjdGVkSW5kZXggLSAodG90YWxfMSAtIHZhbHVlLmxlbmd0aCldKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZENvbXBvbmVudCAmJiBzZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gX3RoaXMuc3RhdGUub3B0aW9uc1tzZWxlY3RlZENvbXBvbmVudF07CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIF90aGlzLnNlYXJjaChzZWxlY3RlZENvbXBvbmVudCwgb3B0aW9uc1tzZWxlY3RlZEluZGV4XSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAocXVlcnkpIHsKICAgICAgICAgICAgICAgIF90aGlzLnNlYXJjaChudWxsLCBxdWVyeSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZU1vdXNlTGVhdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgbW91c2VJblBvcG92ZXI6IGZhbHNlIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlTW91c2VFbnRlciA9IGZ1bmN0aW9uIChjb21wb25lbnQsIHJlbGF0aXZlSW5kZXgpIHsKICAgICAgICAgICAgdmFyIHN1bU9mT3B0aW9ucyA9IDA7CiAgICAgICAgICAgIC8vIFNwZWNpYWwgSGFuZGxpbmcgZm9yIGRlZmF1bHQgY2FzZQogICAgICAgICAgICBpZiAoY29tcG9uZW50ID09PSBDb21wb25lbnRUeXBlLkRlZmF1bHQpIHsKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgc2VsZWN0ZWRJbmRleDogcmVsYXRpdmVJbmRleCwgbW91c2VJblBvcG92ZXI6IHRydWUgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBfdGhpcy5jb21wb25lbnRPcmRlci5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudCA9PT0gX3RoaXMuY29tcG9uZW50T3JkZXJbaV0pIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGVkSW5kZXg6IHN1bU9mT3B0aW9ucyArIHJlbGF0aXZlSW5kZXgsIG1vdXNlSW5Qb3BvdmVyOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoX3RoaXMuc3RhdGUub3B0aW9uc1tfdGhpcy5jb21wb25lbnRPcmRlcltpXV0pIHsKICAgICAgICAgICAgICAgICAgICBzdW1PZk9wdGlvbnMgKz0gX3RoaXMuc3RhdGUub3B0aW9uc1tfdGhpcy5jb21wb25lbnRPcmRlcltpXV0ubGVuZ3RoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5kZWJvdW5jZWQgPSBkZWJvdW5jZShfdGhpcy51cGRhdGVPcHRpb25zLCAxMDApOwogICAgICAgIF90aGlzLmNvbXBvbmVudE9yZGVyID0gWwogICAgICAgICAgICBDb21wb25lbnRUeXBlLlRleHQsCiAgICAgICAgICAgIENvbXBvbmVudFR5cGUuQ29udGFjdCwKICAgICAgICAgICAgQ29tcG9uZW50VHlwZS5Nb2RpZmllciwKICAgICAgICAgICAgQ29tcG9uZW50VHlwZS5Cb3gsCiAgICAgICAgICAgIENvbXBvbmVudFR5cGUuRGF0ZSwKICAgICAgICBdOwogICAgICAgIHZhciBxdWVyeVBhcmFtcyA9IF90aGlzLmdldFF1ZXJ5UGFyYW1zKHByb3BzLnF1ZXJ5LCBwcm9wcy5saXN0cyk7CiAgICAgICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgICAgICAgIG1vdXNlSW5Qb3BvdmVyOiBmYWxzZSwKICAgICAgICAgICAgcXVlcnlQYXJhbXM6IHF1ZXJ5UGFyYW1zLAogICAgICAgICAgICBvcHRpb25zOiB7fSwKICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogMCwKICAgICAgICB9OwogICAgICAgIHJldHVybiBfdGhpczsKICAgIH0KICAgIEFkdmFuY2VkU2VhcmNoUG9wb3Zlci5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5zaG93RGVib3VuY2UgPSBkZWJvdW5jZSh0aGlzLnBvcG92ZXIuc2hvdywgMTAwKTsKICAgICAgICB0aGlzLmhpZGVEZWJvdW5jZSA9IGRlYm91bmNlKHRoaXMucG9wb3Zlci5oaWRlLCAxMDApOwogICAgICAgIGlmICh0aGlzLnN0YXRlLnF1ZXJ5UGFyYW1zKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgb3B0aW9uczogdGhpcy5nZXRPcHRpb25zKHRoaXMuc3RhdGUucXVlcnlQYXJhbXMpLAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwogICAgQWR2YW5jZWRTZWFyY2hQb3BvdmVyLnByb3RvdHlwZS5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIChuZXh0UHJvcHMpIHsKICAgICAgICBpZiAobmV4dFByb3BzLnF1ZXJ5ICYmIG5leHRQcm9wcy5xdWVyeSAhPT0gdGhpcy5wcm9wcy5xdWVyeSkgewogICAgICAgICAgICB0aGlzLnNob3coKTsKICAgICAgICAgICAgdmFyIHF1ZXJ5UGFyYW1zID0gdGhpcy5nZXRRdWVyeVBhcmFtcyhuZXh0UHJvcHMucXVlcnksIG5leHRQcm9wcy5saXN0cyk7CiAgICAgICAgICAgIHZhciBzZWFyY2ggPSB0aGlzLmdldFF1ZXJ5UGFyYW1Gb3JDb21wb25lbnQoWydjb250YWN0JywgJ3RleHQnXSwgcXVlcnlQYXJhbXMpOwogICAgICAgICAgICBpZiAoc2VhcmNoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIG5leHRQcm9wcy5jbGVhckNvbnRhY3RUeXBlYWhlYWQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG5leHRQcm9wcy5zZWFyY2hDb250YWN0VHlwZWFoZWFkKHNlYXJjaCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG5leHRQcm9wcy5xdWVyeSAhPT0gdGhpcy5wcm9wcy5xdWVyeSB8fAogICAgICAgICAgICBuZXh0UHJvcHMudHlwZWFoZWFkQ29udGFjdHMgIT09IHRoaXMucHJvcHMudHlwZWFoZWFkQ29udGFjdHMgfHwKICAgICAgICAgICAgdGhpcy5wcm9wcy5saXN0cyAhPT0gbmV4dFByb3BzLmxpc3RzKSB7CiAgICAgICAgICAgIHRoaXMuZGVib3VuY2VkKG5leHRQcm9wcyk7CiAgICAgICAgfQogICAgfTsKICAgIEFkdmFuY2VkU2VhcmNoUG9wb3Zlci5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5kZWJvdW5jZWQuY2FuY2VsKCk7CiAgICAgICAgdGhpcy5zaG93RGVib3VuY2UuY2FuY2VsKCk7CiAgICAgICAgdGhpcy5oaWRlRGVib3VuY2UuY2FuY2VsKCk7CiAgICB9OwogICAgQWR2YW5jZWRTZWFyY2hQb3BvdmVyLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy5wcm9wcy5xdWVyeTsKICAgICAgICB2YXIgX2EgPSB0aGlzLnN0YXRlLCBxdWVyeVBhcmFtcyA9IF9hLnF1ZXJ5UGFyYW1zLCBvcHRpb25zID0gX2Eub3B0aW9uczsKICAgICAgICB2YXIgc2VsZWN0ZWRPcHRpb24gPSB0aGlzLmdldFNlbGVjdGVkQ29tcG9uZW50SW5kZXgoKTsKICAgICAgICB2YXIgc2VsZWN0ZWRDb21wb25lbnQgPSBzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi5jb21wb25lbnQ7CiAgICAgICAgdmFyIHNlbGVjdGVkSW5kZXggPSBzZWxlY3RlZE9wdGlvbiAmJiBzZWxlY3RlZE9wdGlvbi5yZWxhdGl2ZUluZGV4OwogICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChQb3BvdmVyLCB7IGNsYXNzTmFtZTogImFkdmFuY2VkLXNlYXJjaC1wb3BvdmVyIiwgcmVmOiB0aGlzLmhhbmRsZVJlZiwgb25Nb3VzZUxlYXZlOiB0aGlzLmhhbmRsZU1vdXNlTGVhdmUsIGF1dG9Gb2N1c09mZjogdHJ1ZSwgYWxsb3dDbGlja1Byb3BhZ2F0aW9uOiB0cnVlIH0sCiAgICAgICAgICAgIG9wdGlvbnNbQ29tcG9uZW50VHlwZS5UZXh0XSAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFRleHRTZWFyY2gsIHsgb3B0aW9uczogb3B0aW9uc1tDb21wb25lbnRUeXBlLlRleHRdLCBvblNlbGVjdDogdGhpcy5oYW5kbGVTZWxlY3QsIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXI6IHRoaXMuaGFuZGxlTW91c2VFbnRlciwgc2VsZWN0ZWRJbmRleDogc2VsZWN0ZWRDb21wb25lbnQgPT09IENvbXBvbmVudFR5cGUuVGV4dCA/CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleCA6IHVuZGVmaW5lZCB9KSwKICAgICAgICAgICAgb3B0aW9uc1tDb21wb25lbnRUeXBlLkNvbnRhY3RdICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29udGFjdHNTZWFyY2gsIHsgb3B0aW9uczogb3B0aW9uc1tDb21wb25lbnRUeXBlLkNvbnRhY3RdLCBzaG93TW9kaWZpZXI6IHF1ZXJ5UGFyYW1zLmNvbnRhY3QgPT09IHVuZGVmaW5lZCwgb25TZWxlY3Q6IHRoaXMuaGFuZGxlU2VsZWN0LCBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyOiB0aGlzLmhhbmRsZU1vdXNlRW50ZXIsIHNlbGVjdGVkSW5kZXg6IHNlbGVjdGVkQ29tcG9uZW50ID09PSBDb21wb25lbnRUeXBlLkNvbnRhY3QgPwogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXggOiB1bmRlZmluZWQgfSksCiAgICAgICAgICAgIG9wdGlvbnNbQ29tcG9uZW50VHlwZS5Nb2RpZmllcl0gJiYgUmVhY3QuY3JlYXRlRWxlbWVudChNb2RpZmllclNlYXJjaCwgeyBzaG93SXNPcHRpb25zOiBxdWVyeVBhcmFtcy5pcyAhPT0gdW5kZWZpbmVkLCBvblNlbGVjdDogdGhpcy5oYW5kbGVTZWxlY3QsIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXI6IHRoaXMuaGFuZGxlTW91c2VFbnRlciwgb3B0aW9uczogb3B0aW9uc1tDb21wb25lbnRUeXBlLk1vZGlmaWVyXSwgc2VsZWN0ZWRJbmRleDogc2VsZWN0ZWRDb21wb25lbnQgPT09IENvbXBvbmVudFR5cGUuTW9kaWZpZXIgPwogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXggOiB1bmRlZmluZWQgfSksCiAgICAgICAgICAgIG9wdGlvbnNbQ29tcG9uZW50VHlwZS5Cb3hdICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQm94U2VhcmNoLCB7IG9wdGlvbnM6IG9wdGlvbnNbQ29tcG9uZW50VHlwZS5Cb3hdLCBvblNlbGVjdDogdGhpcy5oYW5kbGVTZWxlY3QsIG9uU3VnZ2VzdGlvbk1vdXNlRW50ZXI6IHRoaXMuaGFuZGxlTW91c2VFbnRlciwgc2VsZWN0ZWRJbmRleDogc2VsZWN0ZWRDb21wb25lbnQgPT09IENvbXBvbmVudFR5cGUuQm94ID8KICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4IDogdW5kZWZpbmVkIH0pLAogICAgICAgICAgICBvcHRpb25zW0NvbXBvbmVudFR5cGUuRGF0ZV0gJiYgUmVhY3QuY3JlYXRlRWxlbWVudChEYXRlU2VhcmNoLCB7IG9uU2VsZWN0OiB0aGlzLmhhbmRsZVNlbGVjdCwgb3B0aW9uczogb3B0aW9uc1tDb21wb25lbnRUeXBlLkRhdGVdLCBvblN1Z2dlc3Rpb25Nb3VzZUVudGVyOiB0aGlzLmhhbmRsZU1vdXNlRW50ZXIsIHNlbGVjdGVkSW5kZXg6IHNlbGVjdGVkQ29tcG9uZW50ID09PSBDb21wb25lbnRUeXBlLkRhdGUgPwogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXggOiB1bmRlZmluZWQsIHF1ZXJ5OiBxdWVyeVBhcmFtcyAmJiAocXVlcnlQYXJhbXNbU2VhcmNoTW9kaWZpZXIuQmVmb3JlXQogICAgICAgICAgICAgICAgICAgIHx8IHF1ZXJ5UGFyYW1zW1NlYXJjaE1vZGlmaWVyLkFmdGVyXSkgfSksCiAgICAgICAgICAgICFxdWVyeSAmJiAhdGhpcy5nZXRTdW1PZkFsbE9wdGlvbnMob3B0aW9ucykgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChEZWZhdWx0U2VhcmNoLCB7IG9uU2VsZWN0OiB0aGlzLmhhbmRsZVNlbGVjdCwgb25TdWdnZXN0aW9uTW91c2VFbnRlcjogdGhpcy5oYW5kbGVNb3VzZUVudGVyLCBzZWxlY3RlZEluZGV4OiBzZWxlY3RlZENvbXBvbmVudCA9PT0gQ29tcG9uZW50VHlwZS5EZWZhdWx0ID8KICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4IDogdW5kZWZpbmVkLCBvcHRpb25zOiBERUZBVUxUX09QVElPTlMgfSkpKTsKICAgIH07CiAgICByZXR1cm4gQWR2YW5jZWRTZWFyY2hQb3BvdmVyOwp9KFJlYWN0LlB1cmVDb21wb25lbnQpKTsKZXhwb3J0IGRlZmF1bHQgQWR2YW5jZWRTZWFyY2hQb3BvdmVyOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/components/ThreadList/components/AdvancedSearchPopover/AdvancedSearchPopover.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/components/ThreadList/components/AdvancedSearchPopover/AdvancedSearchPopover.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport Popover from '@src/components/Popover/Popover';\nimport DefaultSearch from './components/DefaultSearch';\nimport ContactsSearch from './components/ContactsSearch/ContactsSearch';\nimport BoxSearch from './components/BoxSearch/BoxSearch';\nimport ModifierSearch from './components/ModifierSearch/ModifierSearch';\nimport DateSearch, { DATE_FORMAT } from './components/DateSearch/DateSearch';\nimport TextSearch from './components/TextSearch/TextSearch';\nimport { List, Contact, ThreadBox, MailboxType } from '@src/types';\nimport { getDefaultOptions } from '@src/lib/search';\nimport { values, sum, filter, debounce, forEach, sortBy } from 'lodash';\n\nimport './AdvancedSearchPopover.scss';\nimport { dateTypeaheadOptions } from '@src/lib/datetime';\nimport { Moment } from 'moment';\n\nexport interface Props {\n  query: string;\n  onSearch: (query: string, complete: boolean) => void;\n}\n\nexport interface StateProps {\n  lists: List[];\n  typeaheadContacts: Contact[];\n}\n\nexport interface DispatchProps {\n  searchContactTypeahead: (query: string) => void;\n  clearContactTypeahead: () => void;\n}\n\ninterface State {\n  queryParams?: { [key in SearchModifier]: string | undefined };\n  selectedIndex: number;\n  options: { [ key: string ]: any[] | undefined };\n  mouseInPopover: boolean;\n}\n\nenum SearchModifier {\n  Contact = 'contact',\n  Text = 'text',\n  Box = 'box',\n  Is = 'is',\n  Has = 'has',\n  Before = 'before',\n  After = 'after',\n}\n\nexport const enum ComponentType {\n  Default = 'default',\n  Text = 'text',\n  Contact = 'contact',\n  Modifier = 'modifier',\n  Box = 'box',\n  Date = 'date',\n}\n\nconst DEFAULT_OPTIONS = {\n  modifiers: [\n    {\n      heading: 'in:',\n      list: 'inbox, archive, trash, lists',\n    },\n    {\n      heading: 'is:',\n      list: 'unread, replied, starred, opened, unopened',\n    },\n    {\n      heading: 'has:',\n      list: 'reminder, attachment',\n    },\n  ],\n  contacts: [\n    {\n      heading: 'with:',\n      list: 'contact',\n    },\n    {\n      heading: 'from:',\n      list: 'contact',\n    },\n    {\n      heading: 'to:',\n      list: 'contact',\n    },\n  ],\n  dates: [\n    {\n      heading: 'before:',\n      list: 'date',\n    },\n    {\n      heading: 'after:',\n      list: 'date',\n    },\n  ],\n};\nconst REGEX = '([^:]+$|(\"|\\').+(\"|\\')?$)';\n\nclass AdvancedSearchPopover extends React.PureComponent<Props & StateProps & DispatchProps, State> {\n  private popover: Popover;\n  private debounced: any;\n  private componentOrder: ComponentType[];\n  private showDebounce: any;\n  private hideDebounce: any;\n\n  constructor(props: Props & StateProps & DispatchProps) {\n    super();\n\n    this.debounced = debounce(this.updateOptions, 100);\n\n    this.componentOrder = [\n      ComponentType.Text,\n      ComponentType.Contact,\n      ComponentType.Modifier,\n      ComponentType.Box,\n      ComponentType.Date,\n    ];\n\n    const queryParams = this.getQueryParams(props.query, props.lists);\n    this.state = {\n      mouseInPopover: false,\n      queryParams,\n      options: {},\n      selectedIndex: 0,\n    };\n  }\n\n  show = () => {\n    this.hideDebounce.cancel();\n    this.showDebounce();\n  }\n\n  hide = () => {\n    this.showDebounce.cancel();\n    this.hideDebounce();\n  }\n\n  handleRef = (ref: Popover) => {\n    this.popover = ref;\n  }\n\n  updateOptions = (props: Props & StateProps & DispatchProps) => {\n    const queryParams = this.getQueryParams(props.query, props.lists);\n\n    // TODO(SHIN): Handle when mouse has exited options\n    const newOptions = this.getOptions(queryParams);\n    this.setState({\n      queryParams,\n      selectedIndex: (!this.state.mouseInPopover && this.state.options !== newOptions)\n          ? 0\n          : this.state.selectedIndex,\n      options: newOptions,\n    });\n  }\n\n  componentDidMount() {\n    this.showDebounce = debounce(this.popover.show, 100);\n    this.hideDebounce = debounce(this.popover.hide, 100);\n\n    if (this.state.queryParams) {\n      this.setState({\n        options: this.getOptions(this.state.queryParams),\n      });\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props & StateProps & DispatchProps) {\n    if (nextProps.query && nextProps.query !== this.props.query) {\n      this.show();\n      const queryParams = this.getQueryParams(nextProps.query, nextProps.lists);\n      const search = this.getQueryParamForComponent(['contact', 'text'], queryParams);\n\n      if (search === undefined) {\n        nextProps.clearContactTypeahead();\n      } else {\n        nextProps.searchContactTypeahead(search);\n      }\n    }\n\n    if (nextProps.query !== this.props.query ||\n      nextProps.typeaheadContacts !== this.props.typeaheadContacts ||\n      this.props.lists !== nextProps.lists) {\n      this.debounced(nextProps);\n    }\n  }\n\n  componentWillUnmount() {\n    this.debounced.cancel();\n    this.showDebounce.cancel();\n    this.hideDebounce.cancel();\n  }\n\n  // getQueryParam always returns a lowercased version of params\n  getQueryParam = (query: string, keywords: string[]) => {\n    const queryLowerCased = query.toLowerCase();\n    const keywordsLowerCased = keywords.map(k => k.toLowerCase());\n    const keyword = keywordsLowerCased.filter((k) => {\n      // NEED TO fix all MATCH( everyehwere)\n      return queryLowerCased.match(new RegExp(k + REGEX, 'g'));\n    })[0];\n\n    if (keyword) {\n      return queryLowerCased.match(new RegExp(REGEX, 'g'))![0].split(/'|\"/).join('');\n    }\n\n    if (queryLowerCased.match(new RegExp(`(${keywordsLowerCased.join('|')})$`, 'gi'))) {\n      return '';\n    }\n\n    return undefined;\n  }\n\n  getQueryParams = (query: string, lists: List[]) => {\n    const searchModifierToPrefixMapping = [\n      { modifier: SearchModifier.Contact, prefixes: ['with:', 'from:', 'to:'] },\n      { modifier: SearchModifier.Box, prefixes: ['in:'] },\n      { modifier: SearchModifier.Is, prefixes: ['is:'] },\n      { modifier: SearchModifier.Has, prefixes: ['has:'] },\n      { modifier: SearchModifier.Before, prefixes: ['before:'] },\n      { modifier: SearchModifier.After, prefixes: ['after:'] },\n    ];\n    const queryParams = {};\n\n    searchModifierToPrefixMapping.forEach(mapping =>\n      queryParams[mapping.modifier] = this.getQueryParam(query, mapping.prefixes),\n    );\n\n    forEach(queryParams, (param: string, modifier: SearchModifier) => {\n      if (param !== undefined) {\n        const indexOfSpace = param.search(/\\s/g);\n        let possibleOptions;\n        let params;\n        let regex;\n\n        switch (modifier) {\n          case SearchModifier.Contact:\n            regex = new RegExp(`^\\\\S+@\\\\S+\\\\.\\\\S+`, 'gi');\n\n            if (param.match(regex) && indexOfSpace !== -1) {\n              queryParams[SearchModifier.Contact] = undefined;\n              queryParams[SearchModifier.Text] = param.slice(indexOfSpace + 1);\n            }\n            break;\n          case SearchModifier.Box:\n            possibleOptions = (getDefaultOptions(ComponentType.Box) || []).concat(\n              lists.map(l => l.name),\n            ).map(o => o.trim().toLowerCase());\n            params = param.split(/\\s/g);\n            break;\n          case SearchModifier.Is:\n          case SearchModifier.Has:\n            possibleOptions = getDefaultOptions(\n              ComponentType.Modifier,\n              SearchModifier.Is === modifier,\n            ) || [];\n            params = param.split(/\\s/g);\n            break;\n          case SearchModifier.Before:\n          case SearchModifier.After:\n            regex = new RegExp(`^\\\\d{4}/\\\\d{2}/\\\\d{2}`, 'gi');\n            break;\n          default:\n            break;\n        }\n\n        if (regex && param !== '' && param.match(regex) && indexOfSpace !== -1) {\n          queryParams[modifier] = undefined;\n          queryParams[SearchModifier.Text] = param.slice(indexOfSpace + 1);\n        } else if (possibleOptions && params && possibleOptions.length && params.length &&\n          possibleOptions.indexOf(params[0].trim().toLowerCase()) !== -1) {\n          queryParams[modifier] = undefined;\n          queryParams[SearchModifier.Text] = params.slice(1).join(' ');\n        }\n      }\n    });\n\n    if (queryParams[SearchModifier.Text] === undefined) {\n      queryParams[SearchModifier.Text] = query ? query : undefined;\n    }\n\n    return queryParams as { [key in SearchModifier]: string | undefined };\n  }\n\n  getQueryParamForComponent = (\n    params: string[], queryParams: { [key in SearchModifier]: string | undefined },\n  ) => {\n    if (!queryParams) {\n      return undefined;\n    }\n\n    let i;\n    let p;\n    for (i = 0; i < params.length; i += 1) {\n      p = params[i];\n      if (queryParams[p] !== undefined) {\n        return queryParams[p];\n      }\n    }\n\n    return undefined;\n  }\n\n  getOptionsForComponent = (\n    component: ComponentType,\n    query: string | undefined,\n    queryParams: { [key in SearchModifier]: string | undefined },\n  ) => {\n    if (query === undefined) {\n      return undefined;\n    }\n\n    switch (component) {\n      case ComponentType.Text:\n        return [query].concat((getDefaultOptions(component) || [])\n            .filter(m => m.slice(0, m.length - 1).match(query)));\n      case ComponentType.Contact:\n        return this.props.typeaheadContacts.slice(0, 5);\n      case ComponentType.Modifier:\n        return (getDefaultOptions(component, queryParams[SearchModifier.Is] !== undefined) || [])\n          .filter(m => m.match(query));\n      case ComponentType.Box:\n        const options: Array<List|ThreadBox|MailboxType> = (getDefaultOptions(component) || [])\n          .filter(b => b.toLowerCase().match(query)) as Array<ThreadBox|MailboxType>;\n\n        return options\n          .concat(sortBy(\n            this.props.lists.filter(l => l.name.toLowerCase().match(query)),\n            l => l.name.toLowerCase(),\n          ))\n          .slice(0, 5);\n      case ComponentType.Date:\n        return dateTypeaheadOptions(query).slice(0, 5);\n      default:\n        return undefined;\n    }\n  }\n\n  // returns options for all components\n  getOptions = (queryParams: { [key in SearchModifier]: string | undefined }) => {\n    const componentToQueryParamMapping = [\n      { component: ComponentType.Text, params: ['text'] },\n      { component: ComponentType.Contact, params: ['contact', 'text'] },\n      { component: ComponentType.Box, params: ['box'] },\n      { component: ComponentType.Modifier, params: ['is', 'has'] },\n      { component: ComponentType.Date, params: ['before', 'after'] },\n    ];\n    const options = {};\n\n    let component;\n    let search;\n    componentToQueryParamMapping.forEach((mapping) => {\n      component = mapping.component;\n      search = this.getQueryParamForComponent(mapping.params, queryParams);\n      options[component] = this.getOptionsForComponent(component, search, queryParams);\n    });\n\n    return options;\n  }\n\n  search = (type: ComponentType | null, selection: any) => {\n    const { queryParams } = this.state;\n    const { query, onSearch } = this.props;\n\n    if (!queryParams) {\n      return;\n    }\n\n    let newQuery;\n    let toReplace;\n    let replaceWith;\n    let handled = false;\n    let completeSearch = false;\n    switch (type) {\n      case ComponentType.Contact:\n        if (queryParams[SearchModifier.Contact] !== undefined) {\n          toReplace = queryParams[SearchModifier.Contact];\n          replaceWith = selection.email;\n          completeSearch = true;\n        } else {\n          toReplace = queryParams[SearchModifier.Text];\n          replaceWith = `with:${selection.email}`;\n          completeSearch = true;\n        }\n        break;\n      case ComponentType.Box:\n        toReplace = queryParams[SearchModifier.Box];\n        replaceWith = typeof selection === 'string' ? selection : selection.name;\n        if (replaceWith.indexOf(' ') > 0) {\n          replaceWith = `\"${replaceWith}\"`;\n        }\n        completeSearch = true;\n        break;\n      case ComponentType.Modifier:\n        toReplace = queryParams[SearchModifier.Is] !== undefined ?\n          queryParams[SearchModifier.Is] : queryParams[SearchModifier.Has];\n        replaceWith = selection;\n        completeSearch = true;\n        break;\n      case ComponentType.Date:\n        toReplace = queryParams[SearchModifier.After] !== undefined ?\n          queryParams[SearchModifier.After] : queryParams[SearchModifier.Before];\n        replaceWith = selection.moment ? selection.moment.format(DATE_FORMAT) : undefined;\n        completeSearch = true;\n        break;\n      case ComponentType.Text:\n        if (selection === queryParams[SearchModifier.Text]) {\n          onSearch(query, true);\n          handled = true;\n        } else {\n          toReplace = queryParams[SearchModifier.Text];\n          replaceWith = selection;\n          completeSearch = false;\n        }\n        break;\n      case ComponentType.Default:\n        if (selection && selection.heading) {\n          onSearch(\n            selection.heading.search(/\\s/g) > -1 ?\n              `\"${selection.heading}\"` : selection.heading,\n            false,\n          );\n          handled = true;\n        }\n        break;\n      default:\n        break;\n    }\n\n    if (toReplace && replaceWith && !handled) {\n      newQuery = query.replace(new RegExp(`${toReplace}$`, 'gi'), replaceWith);\n      onSearch(newQuery, completeSearch);\n    } else if (toReplace === '' && replaceWith && !handled) {\n      newQuery = query + replaceWith;\n      onSearch(newQuery, completeSearch);\n    }\n  }\n\n  handleSelect = (index?: number, option?: { component: ComponentType, option: any }) => {\n    if (index !== undefined) {\n      this.enter();\n    } else if (option) {\n      this.search(option.component, option.option);\n    }\n  }\n\n  getSumOfAllOptions = (options: { [ key: string ]: any[] | undefined }) => {\n    return sum(filter(values(options), o => !!o && !!o.length).map(o => o!.length));\n  }\n\n  getSelectedComponentIndex = () => {\n    const { query } = this.props;\n    const { selectedIndex, options } = this.state;\n    if (!query) {\n      return { component: ComponentType.Default, relativeIndex: selectedIndex };\n    }\n\n    const index = selectedIndex % this.getSumOfAllOptions(options);\n    let totalOptions = 0;\n    let i;\n    for (i = 0; i < this.componentOrder.length; i += 1) {\n      if (options[this.componentOrder[i]]) {\n        totalOptions += options[this.componentOrder[i]]!.length;\n        if (totalOptions > index) {\n          return {\n            component: this.componentOrder[i],\n            relativeIndex: index - (totalOptions - options[this.componentOrder[i]]!.length),\n          };\n        }\n      }\n    }\n\n    return undefined;\n  }\n\n  downArrow = () => {\n    const { query } = this.props;\n    const { selectedIndex, options } = this.state;\n\n    if (!query) {\n      this.setState({\n        selectedIndex: Math.min(\n          selectedIndex + 1,\n          7,\n        ),\n      });\n      return;\n    }\n\n    const sumOptions = this.getSumOfAllOptions(options);\n    this.setState({\n      selectedIndex: Math.min(\n        selectedIndex + 1,\n        sumOptions ? sumOptions - 1 : 0,\n      ),\n    });\n  }\n\n  upArrow = () => {\n    const { selectedIndex } = this.state;\n    this.setState({ selectedIndex: Math.max(selectedIndex - 1, 0) });\n  }\n\n  enter = () => {\n    const { query } = this.props;\n    const selectedOption = this.getSelectedComponentIndex();\n    const selectedComponent = selectedOption && selectedOption.component;\n    const selectedIndex = selectedOption && selectedOption.relativeIndex;\n\n    if (!query && selectedIndex !== undefined) {\n      let total = 0;\n      forEach(DEFAULT_OPTIONS, (value, key) => {\n        total += value.length;\n        if (total > selectedIndex) {\n          this.search(ComponentType.Default, value[selectedIndex - (total - value.length)]);\n        }\n      });\n    } else if (selectedOption && selectedComponent && selectedIndex !== undefined) {\n      const options = this.state.options[selectedComponent];\n\n      if (options) {\n        this.search(selectedComponent, options[selectedIndex]);\n      }\n    } else if (query) {\n      this.search(null, query);\n    }\n  }\n\n  handleMouseLeave = () => {\n    this.setState({ mouseInPopover: false });\n  }\n\n  handleMouseEnter = (component: ComponentType, relativeIndex: number) => {\n    let sumOfOptions = 0;\n\n    // Special Handling for default case\n    if (component === ComponentType.Default) {\n      this.setState({ selectedIndex: relativeIndex, mouseInPopover: true });\n    }\n\n    let i;\n    for (i = 0; i < this.componentOrder.length; i += 1) {\n      if (component === this.componentOrder[i]) {\n        this.setState({ selectedIndex: sumOfOptions + relativeIndex, mouseInPopover: true });\n        break;\n      } else if (this.state.options[this.componentOrder[i]]) {\n        sumOfOptions += this.state.options[this.componentOrder[i]]!.length;\n      }\n    }\n  }\n\n  render() {\n    const { query } = this.props;\n    const { queryParams, options } = this.state;\n    const selectedOption = this.getSelectedComponentIndex();\n    const selectedComponent = selectedOption && selectedOption.component;\n    const selectedIndex = selectedOption && selectedOption.relativeIndex;\n\n    return (\n      <Popover\n        className=\"advanced-search-popover\"\n        ref={this.handleRef}\n        onMouseLeave={this.handleMouseLeave}\n        autoFocusOff\n        allowClickPropagation\n      >\n        {options[ComponentType.Text] && <TextSearch\n          options={options[ComponentType.Text] as string[]}\n          onSelect={this.handleSelect}\n          onSuggestionMouseEnter={this.handleMouseEnter}\n          selectedIndex={selectedComponent === ComponentType.Text ?\n            selectedIndex : undefined}\n        />}\n        {options[ComponentType.Contact] && <ContactsSearch\n          options={options[ComponentType.Contact] as Contact[]}\n          showModifier={queryParams!.contact === undefined}\n          onSelect={this.handleSelect}\n          onSuggestionMouseEnter={this.handleMouseEnter}\n          selectedIndex={selectedComponent === ComponentType.Contact ?\n            selectedIndex : undefined}\n        />}\n        {options[ComponentType.Modifier] && <ModifierSearch\n          showIsOptions={queryParams!.is !== undefined}\n          onSelect={this.handleSelect}\n          onSuggestionMouseEnter={this.handleMouseEnter}\n          options={options[ComponentType.Modifier] as string[]}\n          selectedIndex={selectedComponent === ComponentType.Modifier ?\n            selectedIndex : undefined}\n        />}\n        {options[ComponentType.Box] && <BoxSearch\n          options={options[ComponentType.Box] as Array<ThreadBox|List|MailboxType>}\n          onSelect={this.handleSelect}\n          onSuggestionMouseEnter={this.handleMouseEnter}\n          selectedIndex={selectedComponent === ComponentType.Box ?\n            selectedIndex : undefined}\n        />}\n        {options[ComponentType.Date] && <DateSearch\n          onSelect={this.handleSelect}\n          options={options[ComponentType.Date] as Array<{ title: string; moment: Moment; }>}\n          onSuggestionMouseEnter={this.handleMouseEnter}\n          selectedIndex={selectedComponent === ComponentType.Date ?\n            selectedIndex : undefined}\n          query={queryParams && (queryParams[SearchModifier.Before]\n            || queryParams[SearchModifier.After])}\n        />}\n        {!query && !this.getSumOfAllOptions(options) && <DefaultSearch\n          onSelect={this.handleSelect}\n          onSuggestionMouseEnter={this.handleMouseEnter}\n          selectedIndex={selectedComponent === ComponentType.Default ?\n            selectedIndex : undefined}\n          options={DEFAULT_OPTIONS}\n        />}\n      </Popover>\n    );\n  }\n}\n\nexport default AdvancedSearchPopover;\n"]}]}