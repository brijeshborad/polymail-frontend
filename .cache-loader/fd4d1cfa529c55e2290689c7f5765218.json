{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/ThreadDetail.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/ThreadDetail.tsx","mtime":1675280254036},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHsKICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7CiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkKICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgIH07CiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfTsKaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgZm9yRWFjaCwgbGFzdCwgZmluZEluZGV4LCBjb25jYXQgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgQ3VzdG9tTG9hZGVyIGZyb20gJ3JlYWN0LWxvYWRlcnMnOwppbXBvcnQgTG9hZGVyIGZyb20gJ0BzcmMvY29tcG9uZW50cy9Mb2FkZXIvTG9hZGVyJzsKaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7CmltcG9ydCB7IENvbW1hbmRDb250cm9sVHlwZSwgVGhyZWFkQm94LCBGaWx0ZXJCb3gsIENhbGVuZGFyRXZlbnRTdGF0dXMsIH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCB7IENlbGxUeXBlLCBTaGFyZWRUaHJlYWRBY3Rpdml0eVR5cGUsIH0gZnJvbSAnQHNyYy90eXBlcy9zaGFyZWRUaHJlYWRzJzsKaW1wb3J0IFRocmVhZERldGFpbEhlYWRlciBmcm9tICcuL2NvbXBvbmVudHMvVGhyZWFkRGV0YWlsSGVhZGVyJzsKaW1wb3J0IENvbGxhcHNlZENlbGwgZnJvbSAnLi9jb21wb25lbnRzL0NlbGwvQ29sbGFwc2VkQ2VsbCc7CmltcG9ydCBFeHBhbmRlZENlbGwgZnJvbSAnLi9jb21wb25lbnRzL0NlbGwvRXhwYW5kZWRDZWxsJzsKaW1wb3J0IENvbXBvc2VyIGZyb20gJy4vY29tcG9uZW50cy9Db21wb3Nlcic7CmltcG9ydCBVbmRvU2VuZFBvcHVwIGZyb20gJy4vY29tcG9uZW50cy9VbmRvU2VuZFBvcHVwJzsKaW1wb3J0ICcuL1RocmVhZERldGFpbC5zY3NzJzsKLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aAppbXBvcnQgQ2FsZW5kYXJJbnZpdGVCYXIgZnJvbSAnQHNyYy9jb21wb25lbnRzL1RocmVhZERldGFpbC9jb21wb25lbnRzL0NhbGVuZGFySW52aXRlQmFyJzsKaW1wb3J0IENvbW1lbnRDZWxsIGZyb20gJ0BzcmMvY29tcG9uZW50cy9DZWxscy9Db21tZW50Q2VsbCc7CmltcG9ydCBDbG9zZSBmcm9tICdAc3JjL2NvbXBvbmVudHMvSWNvbnMvQ2xvc2Uuc3ZnJzsKLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aAppbXBvcnQgU2hhcmVkVGhyZWFkRXJyb3JQYWdlIGZyb20gJ0BzcmMvcm91dGVzL1B1YmxpY1NoYXJlZFRocmVhZHMvY29tcG9uZW50cy9TaGFyZWRUaHJlYWRFcnJvclBhZ2UnOwppbXBvcnQgQXNhbmFUYXNrQ2VsbCBmcm9tICdAc3JjL2NvbXBvbmVudHMvQ2VsbHMvQXNhbmFUYXNrQ2VsbCc7CmltcG9ydCB7IGdldEZvbGxvd1VwUmVtaW5kZXJEaXNwbGF5U3RyaW5nIH0gZnJvbSAnQHNyYy9saWIvdGhyZWFkJzsKaW1wb3J0IEhvdmVyVGlwIGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL0hvdmVyVGlwJzsKaW1wb3J0IHsgUElOR19JTlRFUlZBTCB9IGZyb20gJ0BzcmMvZHVja3Mvc2hhcmVkVGhyZWFkcyc7CmltcG9ydCBUeXBpbmdDZWxsLCB7IFR5cGluZ1R5cGUgfSBmcm9tICdAc3JjL2NvbXBvbmVudHMvQ2VsbHMvVHlwaW5nQ2VsbC9UeXBpbmdDZWxsJzsKaW1wb3J0IFJlc2l6YWJsZSBmcm9tICdyZS1yZXNpemFibGUnOwppbXBvcnQgeyBob3RrZXlVcGRhdGUsIGhvdGtleVN1Z2dlc3QgfSBmcm9tICdAc3JjL2R1Y2tzL2hvdGtleXMnOwppbXBvcnQgeyBjaGVja05leHRIb3RrZXlDaGFuZ2UsIGdldEhvdGtleUJ5TmFtZSwgSG90a2V5QWN0aW9uIH0gZnJvbSAnQHNyYy9saWIvaG90a2V5cyc7CmltcG9ydCB7IGlzRHJhZnRTZW5kaW5nIH0gZnJvbSAnQHNyYy9saWIvZHJhZnQnOwppbXBvcnQgU2hhcmVkRHJhZnRDZWxsIGZyb20gJy4vY29tcG9uZW50cy9DZWxsL1NoYXJlZERyYWZ0Q2VsbCc7CmltcG9ydCBLZXlib2FyZFN5bWJvbCBmcm9tICcuLi9CYXNlL0tleWJvYXJkU3ltYm9sL0tleWJvYXJkU3ltYm9sJzsKdmFyIFRocmVhZERldGFpbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhUaHJlYWREZXRhaWwsIF9zdXBlcik7CiAgICBmdW5jdGlvbiBUaHJlYWREZXRhaWwocHJvcHMpIHsKICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpczsKICAgICAgICBfdGhpcy5yZWNvcmRWaWV3ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgc2VsZWN0ZWRTaGFyZWRUaHJlYWQgPSBfYS5zZWxlY3RlZFNoYXJlZFRocmVhZCwgY3JlYXRlU2hhcmVkVGhyZWFkQWN0aXZpdHkgPSBfYS5jcmVhdGVTaGFyZWRUaHJlYWRBY3Rpdml0eTsKICAgICAgICAgICAgaWYgKHNlbGVjdGVkU2hhcmVkVGhyZWFkICYmIHNlbGVjdGVkU2hhcmVkVGhyZWFkLmRhdGEgJiYgc2VsZWN0ZWRTaGFyZWRUaHJlYWQuZGF0YS5pZCkgewogICAgICAgICAgICAgICAgY3JlYXRlU2hhcmVkVGhyZWFkQWN0aXZpdHkoewogICAgICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFRocmVhZEFjdGl2aXR5VHlwZS5WaWV3LAogICAgICAgICAgICAgICAgICAgIHNoYXJlZFRocmVhZDogc2VsZWN0ZWRTaGFyZWRUaHJlYWQuZGF0YS5pZCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVIb3RrZXlBY3Rpb25zQ2hhbmdlID0gZnVuY3Rpb24gKG9sZEFjdGlvbnMsIG5ld0FjdGlvbnMpIHsKICAgICAgICAgICAgLy8gSGFuZGxlIENDIHRvZ2dsZQogICAgICAgICAgICBpZiAoY2hlY2tOZXh0SG90a2V5Q2hhbmdlKEhvdGtleUFjdGlvbi5Qb3BvdXRNZXNzYWdlLCBuZXdBY3Rpb25zLCBvbGRBY3Rpb25zKSkgewogICAgICAgICAgICAgICAgdmFyIHRocmVhZCA9IF90aGlzLnByb3BzLnRocmVhZDsKICAgICAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnN0YXRlLCBleHBhbmRlZEtleXNfMSA9IF9hLmV4cGFuZGVkS2V5cywgbGFzdEV4cGFuZGVkID0gX2EubGFzdEV4cGFuZGVkOwogICAgICAgICAgICAgICAgaWYgKCF0aHJlYWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgZXhwYW5kZWRNZXNzYWdlcyA9IHRocmVhZC5tZXNzYWdlcy5maWx0ZXIoZnVuY3Rpb24gKG0pIHsgcmV0dXJuICEhZXhwYW5kZWRLZXlzXzFbbS5pZF07IH0pOwogICAgICAgICAgICAgICAgdmFyIGxhc3RFeHBhbmRlZElkID0gbGFzdEV4cGFuZGVkIHx8CiAgICAgICAgICAgICAgICAgICAgKGV4cGFuZGVkTWVzc2FnZXMubGVuZ3RoICYmIGV4cGFuZGVkTWVzc2FnZXMuc2xpY2UoLTEpWzBdLmlkKSB8fCB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBpZiAobGFzdEV4cGFuZGVkSWQgJiYgdGhyZWFkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VMaW5rID0gIi9wb3BvdXQvdGhyZWFkcy8iICsgdGhyZWFkLmlkICsgIi9tZXNzYWdlcy8iICsgbGFzdEV4cGFuZGVkSWQ7CiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4obWVzc2FnZUxpbmssICdfYmxhbmsnLCAnaGVpZ2h0PTUwMCx3aWR0aD04MDAnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuZ2V0SGFzT3B0aW1pc3RpYyA9IGZ1bmN0aW9uICh0aHJlYWQpIHsKICAgICAgICAgICAgaWYgKCF0aHJlYWQgfHwgIXRocmVhZC5tZXNzYWdlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbGFzdE1lc3NhZ2UgPSBsYXN0KHRocmVhZC5tZXNzYWdlcyk7CiAgICAgICAgICAgIGlmIChsYXN0TWVzc2FnZSkgewogICAgICAgICAgICAgICAgcmV0dXJuICEhbGFzdE1lc3NhZ2Uub3B0aW1pc3RpYzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5nZXRDZWxscyA9IGZ1bmN0aW9uIChwcm9wcykgewogICAgICAgICAgICBpZiAocHJvcHMudGhyZWFkKSB7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZXMgPSBwcm9wcy50aHJlYWQubWVzc2FnZXMubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiAoewogICAgICAgICAgICAgICAgICAgIHR5cGU6IENlbGxUeXBlLk1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogbS5pbnRlcm5hbCwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBtLAogICAgICAgICAgICAgICAgfSk7IH0pOwogICAgICAgICAgICAgICAgdmFyIGNvbW1lbnRzID0gKHByb3BzLmNvbW1lbnRzIHx8IFtdKS5tYXAoZnVuY3Rpb24gKGMpIHsgcmV0dXJuICh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogQ2VsbFR5cGUuQ29tbWVudCwKICAgICAgICAgICAgICAgICAgICBkYXRlOiBjLmNyZWF0ZWQsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogYywKICAgICAgICAgICAgICAgIH0pOyB9KTsKICAgICAgICAgICAgICAgIHZhciB0YXNrcyA9IChwcm9wcy50YXNrcyB8fCBbXSkubWFwKGZ1bmN0aW9uICh0KSB7IHJldHVybiAoewogICAgICAgICAgICAgICAgICAgIHR5cGU6IENlbGxUeXBlLlRhc2ssCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogdC5jcmVhdGVkLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHQsCiAgICAgICAgICAgICAgICB9KTsgfSk7CiAgICAgICAgICAgICAgICB2YXIgcmVwbHlpbmcgPSAocHJvcHMucmVwbHlpbmcgfHwgW10pLm1hcChmdW5jdGlvbiAocikgeyByZXR1cm4gKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiBDZWxsVHlwZS5UeXBpbmcsCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogci50aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogciwKICAgICAgICAgICAgICAgIH0pOyB9KTsKICAgICAgICAgICAgICAgIHZhciBjb21tZW50aW5nID0gKHByb3BzLmNvbW1lbnRpbmcgfHwgW10pLm1hcChmdW5jdGlvbiAoYykgeyByZXR1cm4gKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiBDZWxsVHlwZS5UeXBpbmcsCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogYy50aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogYywKICAgICAgICAgICAgICAgIH0pOyB9KTsKICAgICAgICAgICAgICAgIHZhciBkcmFmdHMgPSAocHJvcHMuc2hhcmVkVGhyZWFkRHJhZnQgJiYgW3Byb3BzLnNoYXJlZFRocmVhZERyYWZ0XSB8fCBbXSkKICAgICAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChjKSB7IHJldHVybiAoewogICAgICAgICAgICAgICAgICAgIHR5cGU6IENlbGxUeXBlLkRyYWZ0LAogICAgICAgICAgICAgICAgICAgIGRhdGU6IGMudXBkYXRlZCwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBjLAogICAgICAgICAgICAgICAgfSk7IH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzLmNvbmNhdChjb21tZW50cykuY29uY2F0KHRhc2tzKS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGEuZGF0ZSA8IGIuZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChhLmRhdGUgPiBiLmRhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgICAgfSkuY29uY2F0KHJlcGx5aW5nKS5jb25jYXQoY29tbWVudGluZykuY29uY2F0KGRyYWZ0cyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH07CiAgICAgICAgX3RoaXMucmVuZGVyU2hhcmVkRHJhZnRDZWxsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoU2hhcmVkRHJhZnRDZWxsLCBudWxsKSk7CiAgICAgICAgfTsKICAgICAgICAvLyBHZXRzIERPTSBzY3JvbGwgb2Zmc2V0IGZvciBsYXN0IGNvbW1lbnQKICAgICAgICBfdGhpcy5nZXRMYXN0Q29tbWVudFNjcm9sbFBvc2l0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY29tbWVudHMgPSBfdGhpcy5wcm9wcy5jb21tZW50czsKICAgICAgICAgICAgaWYgKGNvbW1lbnRzICYmIGNvbW1lbnRzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgdmFyIGxhc3RDb21tZW50XzEgPSBsYXN0KGNvbW1lbnRzKTsKICAgICAgICAgICAgICAgIGlmIChsYXN0Q29tbWVudF8xICYmIF90aGlzLnJlZikgewogICAgICAgICAgICAgICAgICAgIHZhciBjZWxscyA9IF90aGlzLnJlZi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjb21tZW50LWNlbGwnKTsKICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IEFycmF5LmZyb20oY2VsbHMpCiAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5kYXRhc2V0LmNvbW1lbnQgPT09IGxhc3RDb21tZW50XzEuaWQ7IH0pWzBdOwogICAgICAgICAgICAgICAgICAgIGlmIChjZWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSBjZWxsLm9mZnNldFRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfTsKICAgICAgICAvLyBHZXRzIERPTSBzY3JvbGwgb2Zmc2V0IGZvciBsYXN0IGV4cGFuZGVkIG1lc3NhZ2UKICAgICAgICBfdGhpcy5nZXRMYXN0TWVzc2FnZVNjcm9sbFBvc2l0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdGhyZWFkID0gX3RoaXMucHJvcHMudGhyZWFkOwogICAgICAgICAgICBpZiAoIXRocmVhZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQWx3YXlzIHNob3cgbGFzdCBpZCBmb3Igbm93CiAgICAgICAgICAgIHZhciBsYXN0TWVzc2FnZSA9IGxhc3QodGhyZWFkLm1lc3NhZ2VzKTsKICAgICAgICAgICAgdmFyIGxhc3RJZCA9IGxhc3RNZXNzYWdlICYmIGxhc3RNZXNzYWdlLmlkIHx8ICcnOwogICAgICAgICAgICB2YXIgY2VsbHMgPSBfdGhpcy5yZWYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZXhwYW5kZWQtY2VsbCcpOwogICAgICAgICAgICB2YXIgY2VsbCA9IEFycmF5LmZyb20oY2VsbHMpCiAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gZWwuZGF0YXNldC5tZXNzYWdlID09PSBsYXN0SWQ7IH0pWzBdOwogICAgICAgICAgICBpZiAoY2VsbCkgewogICAgICAgICAgICAgICAgdmFyIHZhbCA9IGNlbGwub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9OwogICAgICAgIF90aGlzLnByb2Nlc3NDZWxsQ29sbGFwc2VTdGF0ZXMgPSBmdW5jdGlvbiAodGhyZWFkLCBmb3JjZUV4cGFuZCwgc2Nyb2xsVG8pIHsKICAgICAgICAgICAgdmFyIGV4cGFuZGVkS2V5cyA9IHt9OwogICAgICAgICAgICB0aHJlYWQubWVzc2FnZXMuZm9yRWFjaChmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICAgICAgZXhwYW5kZWRLZXlzW21lc3NhZ2UuaWRdID0gZm9yY2VFeHBhbmQgJiYgZm9yY2VFeHBhbmQuaW5kZXhPZihtZXNzYWdlLmlkKSA+IC0xID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gQWx3YXlzIHNob3cgbGFzdCBpZCBmb3Igbm93CiAgICAgICAgICAgIHZhciBsYXN0TWVzc2FnZSA9IGxhc3QodGhyZWFkLm1lc3NhZ2VzKTsKICAgICAgICAgICAgdmFyIGxhc3RJZCA9IGxhc3RNZXNzYWdlICYmIGxhc3RNZXNzYWdlLmlkIHx8ICcnOwogICAgICAgICAgICBleHBhbmRlZEtleXNbbGFzdElkXSA9IHRydWU7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZXhwYW5kZWRLZXlzOiBleHBhbmRlZEtleXMgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLnNjcm9sbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKF90aGlzLnRpbWVvdXQpIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoX3RoaXMudGltZW91dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfdGhpcy50aW1lb3V0ID0gZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBkcmFmdCA9IF90aGlzLnByb3BzLmRyYWZ0OwogICAgICAgICAgICAgICAgICAgIHZhciBkcmFmdE1lc3NhZ2VFeGlzdHMgPSBkcmFmdCAmJiAhIWRyYWZ0Lm1lc3NhZ2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnJlZiAmJiBzY3JvbGxUbykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbHMgPSBfdGhpcy5yZWYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZXhwYW5kZWQtY2VsbCcpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbHNBcnJheSA9IEFycmF5LmZyb20oY2VsbHMpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IGNlbGxzQXJyYXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGVsKSB7IHJldHVybiBzY3JvbGxUbyA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5kYXRhc2V0Lm1lc3NhZ2UgPT09IHNjcm9sbFRvIDogZWwuZGF0YXNldC5tZXNzYWdlID09PSBsYXN0SWQ7IH0pWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBCYWNrdXAgbWVjaGFuaXNtIGZvciBzY3JvbGx0byBsb2NhdGlvbiB3aWxsIHVzZSB0aGUgbGFzdCBtZXNzYWdlIGlmIG5vIG1hdGNoIGZvdW5kCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5PVEUoU0hJTik6IFJlZmVyZW5jZSB3aWxsIGJlIGxvc3QgdG8gZHJhZnQgbWVzc2FnZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBtZXNzYWdlIElEIGJlY29tZXMgb3V0IG9mIGRhdGUgKG9wdGltaXN0aWMpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2VsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbCA9IGNlbGxzQXJyYXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gZWwuZGF0YXNldC5tZXNzYWdlID09PSBsYXN0SWQ7IH0pWzBdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjZWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNjcm9sbGVkOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlXzEgPSBfdGhpcy5yZWYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndGhyZWFkLWRldGFpbC10YWJsZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlXzFbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29sbGFwc2VkQ2VsbEhlaWdodF8xID0gMjY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1lbnRTY3JvbGxQb3NpdGlvbiA9IF90aGlzLmdldExhc3RDb21tZW50U2Nyb2xsUG9zaXRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIGNvbGxhcHNlZENlbGxIZWlnaHRfMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZVNjcm9sbFBvc2l0aW9uID0gY2VsbC5vZmZzZXRUb3AgLSBjb2xsYXBzZWRDZWxsSGVpZ2h0XzE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IGRyYWZ0TWVzc2FnZUV4aXN0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IG1lc3NhZ2VTY3JvbGxQb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IE1hdGgubWF4KGNvbW1lbnRTY3JvbGxQb3NpdGlvbiwgbWVzc2FnZVNjcm9sbFBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOT1RFKFNIQUhBTik6IENhbGN1bGF0ZSB3aGV0aGVyIHdlIG5lZWQgdG8gaW50cm9kdWNlIGEgMzAwbXMgZGVsYXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3IgYSByYXJlIGltYWdlIGVkZ2UtY2FzZSB3aXRoIHNjcm9sbGluZy4gVGhpcyBlZGdlLWNhc2Ugb2NjdXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiBpbWFnZXMgd2l0aCBubyBoZWlnaHQgc2V0IGV4aXN0IGFib3ZlIGEgY29tbWVudCwgYXMgaXQgdGFrZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBhIGJpdCBvZiB0aW1lIGZvciBpbWFnZXMgdG8gbG9hZCwgd2hpY2ggd291bGQgcmVzdWx0IGluIGEganVtcCBvdGhlcndpc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGFpbnNJbWFnZXNOb0hlaWdodCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb21tZW50U2Nyb2xsUG9zaXRpb24gPiBtZXNzYWdlU2Nyb2xsUG9zaXRpb24gJiYgIWRyYWZ0TWVzc2FnZUV4aXN0cykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2VzID0gX3RoaXMucmVmLnF1ZXJ5U2VsZWN0b3JBbGwoJy5tZXNzYWdlLWNvbnRlbnQgaW1nOm5vdChbaGVpZ2h0XSknKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBwcmVmZXItZm9yLW9mCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW1hZ2VzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW1nID0gaW1hZ2VzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGltZy5zY3JvbGxIZWlnaHQgPT09IDAgJiYgIWltZy5oYXNBdHRyaWJ1dGUoJ2RhdGEtcG0tdHJhY2tpbmcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zSW1hZ2VzTm9IZWlnaHQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250YWluc0ltYWdlc05vSGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy50aW1lb3V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoX3RoaXMudGltZW91dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudGltZW91dCA9IGdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBwb3NpdGlvbiBtYXkgaGF2ZSBtb3ZlZCwgc28gcmVjYWxjdWxhdGUgYmFzZWQgb24gd2hlcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBsYXN0IGNvbW1lbnQgc2Nyb2xsIHBvc2l0aW9uIGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3UG9zaXRpb24gPSBfdGhpcy5nZXRMYXN0Q29tbWVudFNjcm9sbFBvc2l0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIGNvbGxhcHNlZENlbGxIZWlnaHRfMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWJsZV8xICYmIHRhYmxlXzFbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV8xWzBdLnNjcm9sbFRvKHsgdG9wOiBuZXdQb3NpdGlvbiwgYmVoYXZpb3I6ICdhdXRvJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgMzAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlXzFbMF0uc2Nyb2xsVG8oeyB0b3A6IHZhbCwgYmVoYXZpb3I6ICdhdXRvJyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvLyBIYW5kbGVzIHRocmVhZCByZWFkIG9uIGEgMC43IHNlY29uZCB0aW1lb3V0LgogICAgICAgIF90aGlzLmhhbmRsZVJlYWRTdGF0dXMgPSBmdW5jdGlvbiAodGhyZWFkKSB7CiAgICAgICAgICAgIHZhciBzdWJtaXRDb21taXRNZXRhID0gX3RoaXMucHJvcHMuc3VibWl0Q29tbWl0TWV0YTsKICAgICAgICAgICAgaWYgKCF0aHJlYWQucmVhZCkgewogICAgICAgICAgICAgICAgdmFyIHRocmVhZElkXzEgPSB0aHJlYWQuaWQ7CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMucmVhZFRpbWVvdXQpIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoX3RoaXMucmVhZFRpbWVvdXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX3RoaXMucmVhZFRpbWVvdXQgPSBnbG9iYWwuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRUaHJlYWQgPSBfdGhpcy5wcm9wcy50aHJlYWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRUaHJlYWQgJiYgIWN1cnJlbnRUaHJlYWQucmVhZCAmJiBjdXJyZW50VGhyZWFkLmlkID09PSB0aHJlYWRJZF8xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdENvbW1pdE1ldGEoeyBzaW5nbGVSZXNvdXJjZTogdGhyZWFkLmlkLCByZWFkOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgNzAwKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQ2VsbEV4cGFuZCA9IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgdmFyIF9hOwogICAgICAgICAgICB2YXIgb2xkVmFsdWUgPSBfdGhpcy5zdGF0ZS5leHBhbmRlZEtleXNba2V5XSB8fCBmYWxzZTsKICAgICAgICAgICAgdmFyIGV4cGFuZGVkS2V5cyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBfdGhpcy5zdGF0ZS5leHBhbmRlZEtleXMpLCAoX2EgPSB7fSwgX2Fba2V5XSA9ICFvbGRWYWx1ZSwgX2EpKTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBleHBhbmRlZEtleXM6IGV4cGFuZGVkS2V5cywgbGFzdEV4cGFuZGVkOiBrZXkgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVBY3Rpb25DbGljayA9IGZ1bmN0aW9uIChib3gpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIHRocmVhZCA9IF9hLnRocmVhZCwgc3VibWl0Q29tbWl0TWV0YSA9IF9hLnN1Ym1pdENvbW1pdE1ldGEsIGNvbW1hbmRDb250cm9sU2hvdyA9IF9hLmNvbW1hbmRDb250cm9sU2hvdywgb25UaHJlYWREZWxldGUgPSBfYS5vblRocmVhZERlbGV0ZSwgaGlkZUFjdGlvbnMgPSBfYS5oaWRlQWN0aW9ucywgZGlzcGF0Y2hBY3Rpb24gPSBfYS5kaXNwYXRjaEFjdGlvbiwgYmxvY2tGaWx0ZXIgPSBfYS5ibG9ja0ZpbHRlcjsKICAgICAgICAgICAgaWYgKGhpZGVBY3Rpb25zKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gSGFuZGxlIHNpbmdsZSBhY3Rpb25zCiAgICAgICAgICAgIHN3aXRjaCAoYm94KSB7CiAgICAgICAgICAgICAgICBjYXNlIFRocmVhZEJveC5MYXRlcjoKICAgICAgICAgICAgICAgICAgICBjb21tYW5kQ29udHJvbFNob3coQ29tbWFuZENvbnRyb2xUeXBlLlJlYWRMYXRlcik7CiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5U3VnZ2VzdChIb3RrZXlBY3Rpb24uUmVhZExhdGVyKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSBUaHJlYWRCb3guTGlzdDoKICAgICAgICAgICAgICAgICAgICBjb21tYW5kQ29udHJvbFNob3coQ29tbWFuZENvbnRyb2xUeXBlLkxhYmVsKTsKICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihob3RrZXlTdWdnZXN0KEhvdGtleUFjdGlvbi5MYWJlbCkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIGNhc2UgJ0Jsb2NrIFNlbmRlcic6IC8vIFJlcGxhY2VkIGJlaGF2aW9yIG9mIGJsb2NrcwogICAgICAgICAgICAgICAgICAgIGlmIChibG9ja0ZpbHRlcikgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihob3RrZXlVcGRhdGUoSG90a2V5QWN0aW9uLlVuYmxvY2tTZW5kZXIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKGhvdGtleVVwZGF0ZShIb3RrZXlBY3Rpb24uQmxvY2tTZW5kZXIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5U3VnZ2VzdChIb3RrZXlBY3Rpb24uQmxvY2tTZW5kZXIpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlICdNdXRlIENvbnZlcnNhdGlvbic6CiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5U3VnZ2VzdChIb3RrZXlBY3Rpb24uTXV0ZUNvbnZlcnNhdGlvbikpOwogICAgICAgICAgICAgICAgICAgIGlmICh0aHJlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0Q29tbWl0TWV0YSh7IHNpbmdsZVJlc291cmNlOiB0aHJlYWQuaWQsIG11dGVkOiAhdGhyZWFkLm11dGVkIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEhhbmRsZSBmbGFncwogICAgICAgICAgICBpZiAodGhyZWFkKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGJveCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgRmlsdGVyQm94LlVucmVhZDoKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5U3VnZ2VzdChIb3RrZXlBY3Rpb24uVG9nZ2xlVW5yZWFkKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdENvbW1pdE1ldGEoeyByZWFkOiAhdGhyZWFkLnJlYWQgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjYXNlIEZpbHRlckJveC5TdGFycmVkOgogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihob3RrZXlTdWdnZXN0KEhvdGtleUFjdGlvbi5Ub2dnbGVTdGFyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdENvbW1pdE1ldGEoeyBzdGFycmVkOiAhdGhyZWFkLnN0YXJyZWQgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRocmVhZEJveC5UcmFzaDoKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5U3VnZ2VzdChIb3RrZXlBY3Rpb24uVHJhc2gpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRocmVhZC5ib3ggPT09IFRocmVhZEJveC5UcmFzaCAmJiBvblRocmVhZERlbGV0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25UaHJlYWREZWxldGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFRocmVhZEJveC5BcmNoaXZlOgogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihob3RrZXlTdWdnZXN0KEhvdGtleUFjdGlvbi5BcmNoaXZlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gSGFuZGxlIGJveAogICAgICAgICAgICAgICAgdmFyIGNvbW1pdE1ldGEgPSB7IGJveDogYm94IH07CiAgICAgICAgICAgICAgICBzdWJtaXRDb21taXRNZXRhKGNvbW1pdE1ldGEpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJDZWxsID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgdGhyZWFkID0gX2EudGhyZWFkLCBib2RpZXMgPSBfYS5ib2RpZXMsIGhpZGVBY3Rpb25zID0gX2EuaGlkZUFjdGlvbnM7CiAgICAgICAgICAgIHZhciBjb2xsYXBzZWQgPSAhX3RoaXMuc3RhdGUuZXhwYW5kZWRLZXlzW2tleV07CiAgICAgICAgICAgIHZhciBFeHBhbmRlZENlbGxDb25uZWN0ID0gRXhwYW5kZWRDZWxsOwogICAgICAgICAgICB2YXIgQ29sbGFwc2VkQ2VsbENvbm5lY3QgPSBDb2xsYXBzZWRDZWxsOwogICAgICAgICAgICBpZiAodGhyZWFkKSB7CiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHRocmVhZC5tZXNzYWdlcy5maWx0ZXIoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0uaWQgPT09IGtleTsgfSlbMF07CiAgICAgICAgICAgICAgICB2YXIgYm9keSA9IGJvZGllcyAmJiBib2RpZXMuZmlsdGVyKGZ1bmN0aW9uIChiKSB7IHJldHVybiBiLmlkID09PSBrZXk7IH0pWzBdOwogICAgICAgICAgICAgICAgaWYgKGNvbGxhcHNlZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChDb2xsYXBzZWRDZWxsQ29ubmVjdCwgeyBpZDoga2V5LCBvblRvZ2dsZUV4cGFuZDogX3RoaXMuaGFuZGxlQ2VsbEV4cGFuZCwga2V5OiBrZXksIG1lc3NhZ2U6IG1lc3NhZ2UgfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KEV4cGFuZGVkQ2VsbENvbm5lY3QsIHsgb25Ub2dnbGVFeHBhbmQ6IF90aGlzLmhhbmRsZUNlbGxFeHBhbmQsIGtleToga2V5LCBtZXNzYWdlOiBtZXNzYWdlLCBtZXNzYWdlQm9keTogYm9keSwgdGhyZWFkSWQ6IHRocmVhZC5pZCwgaGlkZUFjdGlvbnM6IGhpZGVBY3Rpb25zIH0pKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgbnVsbCk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJDb21tZW50ID0gZnVuY3Rpb24gKGNlbGwpIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSBjZWxsLmRhdGE7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KENvbW1lbnRDZWxsLCB7IGNvbW1lbnQ6IGRhdGEsIGtleTogZGF0YS5pZCB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLnJlbmRlclRhc2sgPSBmdW5jdGlvbiAoY2VsbCkgewogICAgICAgICAgICB2YXIgZGF0YSA9IGNlbGwuZGF0YTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQXNhbmFUYXNrQ2VsbCwgeyB0YXNrOiBkYXRhLCBrZXk6IGRhdGEuaWQgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJUeXBpbmcgPSBmdW5jdGlvbiAoY2VsbCkgewogICAgICAgICAgICB2YXIgZGF0YSA9IGNlbGwuZGF0YTsKICAgICAgICAgICAgaWYgKCFkYXRhLnVzZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciB0eXBlOwogICAgICAgICAgICBzd2l0Y2ggKGRhdGEudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSBTaGFyZWRUaHJlYWRBY3Rpdml0eVR5cGUuQ29tbWVudDoKICAgICAgICAgICAgICAgICAgICB0eXBlID0gVHlwaW5nVHlwZS5Db21tZW50OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTaGFyZWRUaHJlYWRBY3Rpdml0eVR5cGUuUmVwbHk6CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IFR5cGluZ1R5cGUuUmVwbHk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChUeXBpbmdDZWxsLCB7IGtleTogdHlwZSArICItIiArIGRhdGEudXNlcklkLCB0eXBlOiB0eXBlLCB1c2VyOiB7CiAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiBkYXRhLnVzZXIuZmlyc3ROYW1lLCBwaG90b1VybDogZGF0YS51c2VyLnBob3RvVXJsLAogICAgICAgICAgICAgICAgfSB9KSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJOZXdEcmFmdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIHRocmVhZCA9IF9hLnRocmVhZCwgZHJhZnQgPSBfYS5kcmFmdCwgbWUgPSBfYS5tZSwgYWNjb3VudHMgPSBfYS5hY2NvdW50czsKICAgICAgICAgICAgaWYgKGRyYWZ0ICYmICEhZHJhZnQudGhyZWFkVjIgJiYgIXRocmVhZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRocmVhZC1kZXRhaWwiIH0sCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0aHJlYWQtZGV0YWlsLWZpbGxlciIgfSksCiAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVuZGVyQ29tcG9zZXIoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0aHJlYWQtZGV0YWlsIiwgdGFiSW5kZXg6IC0xIH0sIG1lICYmIGFjY291bnRzICYmCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENvbXBvc2VyLCB7IG1lOiBtZSwgYWNjb3VudHM6IGFjY291bnRzLCB0aHJlYWQ6IHRocmVhZCwgZHJhZnQ6IGRyYWZ0LCBzaG93RnVsbEhlaWdodDogdHJ1ZSB9KSkpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMucmVuZGVyT3B0aW9uRGVzYyA9IGZ1bmN0aW9uIChkZXNjKSB7CiAgICAgICAgICAgIHJldHVybiBkZXNjLnNwbGl0KCcrJykubWFwKGZ1bmN0aW9uIChjLCBpKSB7IHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChLZXlib2FyZFN5bWJvbCwgeyBrZXk6IGMgKyAiLSIgKyBpLCBjaGFyYWN0ZXI6IGMgfSkpOyB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLnJlbmRlckhvdGtleXNTZWN0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaG90a2V5cyA9IFsKICAgICAgICAgICAgICAgIEhvdGtleUFjdGlvbi5OZXdEcmFmdCwKICAgICAgICAgICAgICAgIEhvdGtleUFjdGlvbi5Ub2dnbGVDb21tYW5kQ29udHJvbCwKICAgICAgICAgICAgICAgIEhvdGtleUFjdGlvbi5OYXZpZ2F0aW9uQ2VudGVyLAogICAgICAgICAgICAgICAgSG90a2V5QWN0aW9uLktleWJvYXJkU2hvcnRjdXRHdWlkZSwKICAgICAgICAgICAgXTsKICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImhvdGtleXMtc2VjdGlvbiIgfSwgaG90a2V5cwogICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoaCkgeyByZXR1cm4gZ2V0SG90a2V5QnlOYW1lKGgpOyB9KQogICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoaCkgeyByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaG90a2V5LWNlbGwiLCBrZXk6ICJob3RrZXktaW5mby0iICsgKGggPT09IG51bGwgfHwgaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaC5uYW1lKSB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJob3RrZXktdGl0bGUiIH0sIGggPT09IG51bGwgfHwgaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaC5uYW1lKSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAic3BhY2VyIiB9KSwKICAgICAgICAgICAgICAgIChoID09PSBudWxsIHx8IGggPT09IHZvaWQgMCA/IHZvaWQgMCA6IGgudGV4dCkgJiYgKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaG90a2V5LXN5bWJvbCIgfSwgX3RoaXMucmVuZGVyT3B0aW9uRGVzYyhoLnRleHQpKSkpKTsgfSkpKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLnJlbmRlck5vU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGhyZWFkLWRldGFpbCIgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGhyZWFkLWRldGFpbC1uby10aHJlYWQiLCB0YWJJbmRleDogLTEgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImNvcHkiIH0sICJObyBDb252ZXJzYXRpb24gU2VsZWN0ZWQiKSwKICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZW5kZXJIb3RrZXlzU2VjdGlvbigpKSkpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMucmVuZGVySW5pdGlhbFN5bmNpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbiA9ICdGZWVsIGZyZWUgdG8gZG8gc29tZXRoaW5nIGVsc2UgaW4gdGhlIG1lYW50aW1lLCAnCiAgICAgICAgICAgICAgICArICd3ZVwnbGwgbGV0IHlvdSBrbm93IG9uY2UgeW91ciBpbmJveCBpcyByZWFkeSEnOwogICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGhyZWFkLWRldGFpbCIgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGhyZWFkLWRldGFpbC10YWJsZSIsIHRhYkluZGV4OiAtMSB9LAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaW5pdGlhbC1zeW5jIiB9LAogICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEN1c3RvbUxvYWRlciwgeyB0eXBlOiAibGluZS1zY2FsZS1wdWxzZS1vdXQtcmFwaWQiLCBpbm5lckNsYXNzTmFtZTogImN1c3RvbS1sb2FkZXItaW5uZXIiLCBhY3RpdmU6IHRydWUgfSksCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGl0bGUiIH0sICJDcmVhdGluZyB5b3VyIGluYm94Li4uIiksCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZGVzY3JpcHRpb24iIH0sIGRlc2NyaXB0aW9uKSkpKSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJUaHJlYWRMb2FkaW5nID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGhyZWFkLWRldGFpbCIgfSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0aHJlYWQtZGV0YWlsLXRhYmxlIGxvYWRpbmciLCB0YWJJbmRleDogLTEgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTG9hZGVyLCBudWxsKSkpKTsgfTsKICAgICAgICAvLyBTaG93IGxvYWRpbmcgaW5kaWNhdG9yIHdoZW4gdGhyZWFkIGV4aXN0cwogICAgICAgIF90aGlzLnJlbmRlckJvZGllc0xvYWRpbmcgPSBmdW5jdGlvbiAodGhyZWFkKSB7IHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0aHJlYWQtZGV0YWlsIiB9LAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRocmVhZERldGFpbEhlYWRlciwgeyBzdWJqZWN0OiB0aHJlYWQuc3ViamVjdCwgcGFydGljaXBhbnRzOiB0aHJlYWQucGFydGljaXBhbnRzLCBjb21tYW5kQ29udHJvbFNob3c6IF90aGlzLnByb3BzLmNvbW1hbmRDb250cm9sU2hvdywgb25BY3Rpb25DbGljazogX3RoaXMuaGFuZGxlQWN0aW9uQ2xpY2ssIHRocmVhZDogdGhyZWFkLCBzaG93VW5zdWJzY3JpYmU6ICEhX3RoaXMucHJvcHMudW5zdWJzY3JpYmVMaW5rLCBtZTogX3RoaXMucHJvcHMubWUsIGhpZGVBY3Rpb25zOiBfdGhpcy5wcm9wcy5oaWRlQWN0aW9ucyB9KSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0aHJlYWQtZGV0YWlsLXRhYmxlIGxvYWRpbmciLCB0YWJJbmRleDogLTEgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTG9hZGVyLCBudWxsKSkpKTsgfTsKICAgICAgICAvLyByZXR1cm4gdGhpcy5yZW5kZXJFcnJvcih0aHJlYWQsIGNvbW1hbmRDb250cm9sU2hvdywgdW5zdWJzY3JpYmVMaW5rLCBtZSk7CiAgICAgICAgX3RoaXMucmVuZGVyRXJyb3IgPSBmdW5jdGlvbiAodGhyZWFkKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCBjb21tYW5kQ29udHJvbFNob3cgPSBfYS5jb21tYW5kQ29udHJvbFNob3csIG1lID0gX2EubWUsIHVuc3Vic2NyaWJlTGluayA9IF9hLnVuc3Vic2NyaWJlTGluaywgaGlkZUFjdGlvbnMgPSBfYS5oaWRlQWN0aW9uczsKICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRocmVhZC1kZXRhaWwiIH0sCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRocmVhZERldGFpbEhlYWRlciwgeyBzdWJqZWN0OiB0aHJlYWQuc3ViamVjdCwgcGFydGljaXBhbnRzOiB0aHJlYWQucGFydGljaXBhbnRzLCBjb21tYW5kQ29udHJvbFNob3c6IGNvbW1hbmRDb250cm9sU2hvdywgb25BY3Rpb25DbGljazogX3RoaXMuaGFuZGxlQWN0aW9uQ2xpY2ssIHRocmVhZDogdGhyZWFkLCBzaG93VW5zdWJzY3JpYmU6ICEhdW5zdWJzY3JpYmVMaW5rLCBtZTogbWUsIGhpZGVBY3Rpb25zOiBoaWRlQWN0aW9ucyB9KSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGhyZWFkLWRldGFpbC10YWJsZSIsIHRhYkluZGV4OiAtMSB9LAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZXJyb3IiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZXJyb3ItdGl0bGUiIH0sICJTb3JyeSwgdGhlcmUgd2FzIGFuIGlzc3VlIGxvYWRpbmcgdGhpcyBjb252ZXJzYXRpb24iKSwKICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJlcnJvci1kZXNjcmlwdGlvbiIgfSwgIlBsZWFzZSBjaGVjayB5b3VyIGludGVybmV0IGNvbm5lY3Rpb24gYW5kIHRyeSBhZ2FpbiIpKSkpKTsKICAgICAgICB9OwogICAgICAgIC8vIHJldHVybiB0aGlzLnJlbmRlckVycm9yKHRocmVhZCwgY29tbWFuZENvbnRyb2xTaG93LCB1bnN1YnNjcmliZUxpbmssIG1lKTsKICAgICAgICBfdGhpcy5yZW5kZXJTaGFyZWRUaHJlYWRFcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIG1lID0gX2EubWUsIGNvbW1hbmRDb250cm9sU2hvdyA9IF9hLmNvbW1hbmRDb250cm9sU2hvdywgdW5zdWJzY3JpYmVMaW5rID0gX2EudW5zdWJzY3JpYmVMaW5rLCB0aHJlYWQgPSBfYS50aHJlYWQ7CiAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0aHJlYWQtZGV0YWlsIiB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChUaHJlYWREZXRhaWxIZWFkZXIsIHsgc3ViamVjdDogJ0NvbnZlcnNhdGlvbiBOb3QgRm91bmQnLCBwYXJ0aWNpcGFudHM6IHRocmVhZCAmJiB0aHJlYWQucGFydGljaXBhbnRzIHx8IFtdLCBjb21tYW5kQ29udHJvbFNob3c6IGNvbW1hbmRDb250cm9sU2hvdywgb25BY3Rpb25DbGljazogX3RoaXMuaGFuZGxlQWN0aW9uQ2xpY2ssIHRocmVhZDogdGhyZWFkLCBzaG93VW5zdWJzY3JpYmU6ICEhdW5zdWJzY3JpYmVMaW5rLCBtZTogbWUsIGhpZGVBY3Rpb25zOiB0cnVlIH0pLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0aHJlYWQtZGV0YWlsLXRhYmxlIiwgdGFiSW5kZXg6IC0xIH0sCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChTaGFyZWRUaHJlYWRFcnJvclBhZ2UsIHsgZW1haWw6IG1lICYmIG1lLmVtYWlsIHx8ICcnIH0pKSkpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMucmVuZGVyQ29tcG9zZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCBtZSA9IF9hLm1lLCBhY2NvdW50cyA9IF9hLmFjY291bnRzLCB0aHJlYWQgPSBfYS50aHJlYWQsIGRyYWZ0ID0gX2EuZHJhZnQsIHNlbGVjdGVkU2hhcmVkVGhyZWFkID0gX2Euc2VsZWN0ZWRTaGFyZWRUaHJlYWQsIGhpZGVBY3Rpb25zID0gX2EuaGlkZUFjdGlvbnM7CiAgICAgICAgICAgIHZhciBjb21wb3NlckhlaWdodCA9IF90aGlzLnN0YXRlLmNvbXBvc2VySGVpZ2h0OwogICAgICAgICAgICBpZiAoIW1lIHx8ICFhY2NvdW50cykgewogICAgICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRG8gbm90IHVzZSByZXNpemFibGUgY29tcG9uZW50IHdoZW4gbm8gZHJhZnQgb3Igc3RhdHVzIGlzIHNlbmRpbmcgYmMgKG9wdGltaXN0aWMpCiAgICAgICAgICAgIGlmICghZHJhZnQgfHwgaXNEcmFmdFNlbmRpbmcoZHJhZnQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29tcG9zZXIsIHsgbWU6IG1lLCBhY2NvdW50czogYWNjb3VudHMsIHRocmVhZDogdGhyZWFkLCBkcmFmdDogdW5kZWZpbmVkLCBvbkV4cGFuZDogX3RoaXMuaGFuZGxlRXhwYW5kLCBoaWRlQWN0aW9uczogaGlkZUFjdGlvbnMsIGhpZGVDb21tZW50RWRpdG9yOiBzZWxlY3RlZFNoYXJlZFRocmVhZCAmJiBzZWxlY3RlZFNoYXJlZFRocmVhZC5kYXRhICYmIG1lICYmCiAgICAgICAgICAgICAgICAgICAgICAgIG1lLnRlYW0gIT09IHNlbGVjdGVkU2hhcmVkVGhyZWFkLmRhdGEudGVhbSB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KFJlc2l6YWJsZSwgeyBrZXk6IGRyYWZ0LmlkLCBjbGFzc05hbWU6IGNsYXNzbmFtZXMoJ2NvbXBvc2VyLXJlc2l6YWJsZScsIHsgcmVzaXplZDogISFjb21wb3NlckhlaWdodCB9KSwgZW5hYmxlOiB7CiAgICAgICAgICAgICAgICAgICAgdG9wOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHJpZ2h0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBib3R0b206IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGxlZnQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHRvcFJpZ2h0OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBib3R0b21SaWdodDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgYm90dG9tTGVmdDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgdG9wTGVmdDogZmFsc2UsCiAgICAgICAgICAgICAgICB9LCBoYW5kbGVDbGFzc2VzOiB7CiAgICAgICAgICAgICAgICAgICAgdG9wOiAnY29tcG9zZXItcmVzaXplLWhhbmRsZXInLAogICAgICAgICAgICAgICAgfSwgZGVmYXVsdFNpemU6IHsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogJ2F1dG8nLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogY29tcG9zZXJIZWlnaHQgfHwgJ2F1dG8nLAogICAgICAgICAgICAgICAgfSwgb25SZXNpemU6IF90aGlzLmhhbmRsZUNvbXBvc2VyUmVzaXplU3RvcCwgb25SZXNpemVTdG9wOiBfdGhpcy5oYW5kbGVDb21wb3NlclJlc2l6ZVN0b3AgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29tcG9zZXIsIHsgbWU6IG1lLCBhY2NvdW50czogYWNjb3VudHMsIHRocmVhZDogdGhyZWFkLCBkcmFmdDogZHJhZnQsIG9uRXhwYW5kOiBfdGhpcy5oYW5kbGVFeHBhbmQsIGhpZGVBY3Rpb25zOiBoaWRlQWN0aW9ucywgaGlkZUNvbW1lbnRFZGl0b3I6IHNlbGVjdGVkU2hhcmVkVGhyZWFkICYmIHNlbGVjdGVkU2hhcmVkVGhyZWFkLmRhdGEgJiYgbWUgJiYKICAgICAgICAgICAgICAgICAgICAgICAgbWUudGVhbSAhPT0gc2VsZWN0ZWRTaGFyZWRUaHJlYWQuZGF0YS50ZWFtIH0pKSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVFeHBhbmQgPSBmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIV90aGlzLnJlZikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBjZWxscyA9IF90aGlzLnJlZi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdleHBhbmRlZC1jZWxsJyk7CiAgICAgICAgICAgIHZhciBjZWxsID0gbWVzc2FnZSA/CiAgICAgICAgICAgICAgICBBcnJheS5mcm9tKGNlbGxzKS5maWx0ZXIoZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5kYXRhc2V0Lm1lc3NhZ2UgPT09IG1lc3NhZ2U7IH0pWzBdCiAgICAgICAgICAgICAgICA6IGxhc3QoY2VsbHMpOwogICAgICAgICAgICBpZiAoY2VsbCkgewogICAgICAgICAgICAgICAgaWYgKF90aGlzLnRpbWVvdXQpIHsKICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoX3RoaXMudGltZW91dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfdGhpcy50aW1lb3V0ID0gZ2xvYmFsLnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGlmIChjZWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc2Nyb2xsSW50b1ZpZXcoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVoYXZpb3I6ICdhdXRvJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrOiAnc3RhcnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5saW5lOiAnbmVhcmVzdCcsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVSZWYgPSBmdW5jdGlvbiAocmVmKSB7CiAgICAgICAgICAgIF90aGlzLnJlZiA9IHJlZjsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVJlbW92ZUZvbGxvd1VwUmVtaW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCB0aHJlYWQgPSBfYS50aHJlYWQsIHN1Ym1pdENvbW1pdE1ldGEgPSBfYS5zdWJtaXRDb21taXRNZXRhOwogICAgICAgICAgICBpZiAodGhyZWFkKSB7CiAgICAgICAgICAgICAgICBzdWJtaXRDb21taXRNZXRhKHsgc2luZ2xlUmVzb3VyY2U6IHRocmVhZC5pZCwgd2FpdGluZzogbnVsbCB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQ29tcG9zZXJSZXNpemVTdG9wID0gZnVuY3Rpb24gKGV2ZW50LCBkaXJlY3Rpb24sIHJlZlRvRWxlbWVudCwgZGVsdGEpIHsKICAgICAgICAgICAgaWYgKHJlZlRvRWxlbWVudC5jbGllbnRXaWR0aCkgewogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBjb21wb3NlckhlaWdodDogcmVmVG9FbGVtZW50LmNsaWVudFdpZHRoIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgICAgICAgZXhwYW5kZWRLZXlzOiB7fSwKICAgICAgICAgICAgY2VsbHM6IF90aGlzLmdldENlbGxzKHByb3BzKSwKICAgICAgICAgICAgaGFzT3B0aW1pc3RpYzogX3RoaXMuZ2V0SGFzT3B0aW1pc3RpYyhwcm9wcy50aHJlYWQpLAogICAgICAgICAgICBzY3JvbGxlZDogZmFsc2UsCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICB9CiAgICBUaHJlYWREZXRhaWwucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfYSA9IHRoaXMucHJvcHMsIHRocmVhZCA9IF9hLnRocmVhZCwgZHJhZnQgPSBfYS5kcmFmdDsKICAgICAgICBpZiAodGhyZWFkKSB7CiAgICAgICAgICAgIHZhciBleHBhbmRlZE1lc3NhZ2VzID0gdGhyZWFkLm1lc3NhZ2VzLmZpbHRlcihmdW5jdGlvbiAobSkgeyByZXR1cm4gIW0ucmVhZDsgfSkubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiBtLmlkOyB9KTsKICAgICAgICAgICAgdmFyIHNjcm9sbFRvID0gJyc7CiAgICAgICAgICAgIC8vIERldGVjdCBsYXN0IG1lc3NhZ2UgcmVmZXJlbmNlIHdlIHdhbnQgdG8gc2Nyb2xsIHRvIG9uIGluaXRpYWwgcmVuZGVyCiAgICAgICAgICAgIGlmIChkcmFmdCAmJiBkcmFmdC5tZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBleHBhbmRlZE1lc3NhZ2VzLnB1c2goZHJhZnQubWVzc2FnZSk7CiAgICAgICAgICAgICAgICBzY3JvbGxUbyA9IGRyYWZ0Lm1lc3NhZ2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoZXhwYW5kZWRNZXNzYWdlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHNjcm9sbFRvID0gZXhwYW5kZWRNZXNzYWdlc1swXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh0aHJlYWQubWVzc2FnZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB2YXIgbGFzdE1lc3NhZ2UgPSBsYXN0KHRocmVhZC5tZXNzYWdlcyk7CiAgICAgICAgICAgICAgICBpZiAobGFzdE1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICBzY3JvbGxUbyA9IGxhc3RNZXNzYWdlLmlkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMucHJvY2Vzc0NlbGxDb2xsYXBzZVN0YXRlcyh0aHJlYWQsIGV4cGFuZGVkTWVzc2FnZXMsIHNjcm9sbFRvKTsKICAgICAgICB9CiAgICAgICAgdGhpcy52aWV3SW50ZXJ2YWwgPSBnbG9iYWwuc2V0SW50ZXJ2YWwodGhpcy5yZWNvcmRWaWV3LCBQSU5HX0lOVEVSVkFMKTsKICAgIH07CiAgICBUaHJlYWREZXRhaWwucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLnRpbWVvdXQpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnJlYWRUaW1lb3V0KSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnJlYWRUaW1lb3V0KTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMudmlld0ludGVydmFsKSB7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy52aWV3SW50ZXJ2YWwpOwogICAgICAgIH0KICAgIH07CiAgICBUaHJlYWREZXRhaWwucHJvdG90eXBlLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzID0gZnVuY3Rpb24gKG5leHRQcm9wcykgewogICAgICAgIC8vIFJldHVybiBmb2N1cyB0byB0b3AgbGV2ZWwgd2hlbiBkcmFmdCBoYXMgYmVlbiByZW1vdmVkCiAgICAgICAgaWYgKCFuZXh0UHJvcHMuZHJhZnQgJiYgdGhpcy5wcm9wcy5kcmFmdCAmJiB0aGlzLnJlZikgewogICAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMucmVmOwogICAgICAgICAgICBpZiAobm9kZSAmJiBub2RlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuZm9jdXMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBEbyBub3RoaW5nIGlmIHRocmVhZCBpcyBub3QgcGFzc2VkIGluCiAgICAgICAgaWYgKCFuZXh0UHJvcHMudGhyZWFkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGV4cGFuZGVkTWVzc2FnZXMgPSBuZXh0UHJvcHMudGhyZWFkLm1lc3NhZ2VzLmZpbHRlcihmdW5jdGlvbiAobSkgeyByZXR1cm4gIW0ucmVhZDsgfSkubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiBtLmlkOyB9KTsKICAgICAgICB2YXIgc2Nyb2xsVG8gPSAnJzsKICAgICAgICAvLyBIYW5kbGUgY2hhbmdlcyB0byB0aHJlYWQKICAgICAgICBpZiAoIXRoaXMucHJvcHMudGhyZWFkIHx8IHRoaXMucHJvcHMudGhyZWFkLmlkICE9PSBuZXh0UHJvcHMudGhyZWFkLmlkKSB7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlUmVhZFN0YXR1cyhuZXh0UHJvcHMudGhyZWFkKTsKICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNjcm9sbGVkOiBmYWxzZSB9KTsKICAgICAgICB9CiAgICAgICAgLy8gc2Nyb2xsIHRvIG5ldyByZXBseQogICAgICAgIHZhciBsYXN0TWVzc2FnZSA9IG5leHRQcm9wcy50aHJlYWQubWVzc2FnZXMubGVuZ3RoICYmIGxhc3QobmV4dFByb3BzLnRocmVhZC5tZXNzYWdlcyk7CiAgICAgICAgdmFyIHNhbWVNZXNzYWdlTGVuZ3RoID0gdGhpcy5wcm9wcy50aHJlYWQgJiYgbmV4dFByb3BzLnRocmVhZCAmJgogICAgICAgICAgICB0aGlzLnByb3BzLnRocmVhZC5tZXNzYWdlcy5sZW5ndGggPT09IG5leHRQcm9wcy50aHJlYWQubWVzc2FnZXMubGVuZ3RoOwogICAgICAgIHZhciBoYXNPcHRpbWlzdGljID0gdGhpcy5nZXRIYXNPcHRpbWlzdGljKG5leHRQcm9wcy50aHJlYWQpOwogICAgICAgIGlmIChoYXNPcHRpbWlzdGljICYmICFzYW1lTWVzc2FnZUxlbmd0aCkgewogICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2Nyb2xsZWQ6IGZhbHNlIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuc3RhdGUuc2Nyb2xsZWQpIHsKICAgICAgICAgICAgaWYgKG5leHRQcm9wcy5kcmFmdCAmJiBuZXh0UHJvcHMuZHJhZnQubWVzc2FnZSkgewogICAgICAgICAgICAgICAgc2Nyb2xsVG8gPSBuZXh0UHJvcHMuZHJhZnQubWVzc2FnZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChoYXNPcHRpbWlzdGljICYmIGxhc3RNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBzY3JvbGxUbyA9IGxhc3RNZXNzYWdlLmlkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGV4cGFuZGVkTWVzc2FnZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBzY3JvbGxUbyA9IGV4cGFuZGVkTWVzc2FnZXNbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAobGFzdE1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIHNjcm9sbFRvID0gbGFzdE1lc3NhZ2UuaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gSGFuZGxlIG5ldyBtZXNzYWdlcyAtPiBleHBhbmQgdGhlbSBhdXRvbWF0aWNhbGx5CiAgICAgICAgaWYgKHRoaXMucHJvcHMudGhyZWFkICYmIG5leHRQcm9wcy50aHJlYWQgJiYgbmV4dFByb3BzLnRocmVhZC5pZCA9PT0gdGhpcy5wcm9wcy50aHJlYWQuaWQpIHsKICAgICAgICAgICAgdmFyIG9sZE1lc3NhZ2VzXzEgPSB7fTsKICAgICAgICAgICAgdGhpcy5wcm9wcy50aHJlYWQubWVzc2FnZXMuZm9yRWFjaChmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgICAgICAgICAgb2xkTWVzc2FnZXNfMVttZXNzYWdlLmlkXSA9IHRydWUgJiYgbWVzc2FnZS5yZWFkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZXhwYW5kZWRNZXNzYWdlcyA9IG5leHRQcm9wcy50aHJlYWQubWVzc2FnZXMKICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKG1lc3NhZ2UpIHsgcmV0dXJuICFvbGRNZXNzYWdlc18xW21lc3NhZ2UuaWRdOyB9KQogICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAobWVzc2FnZSkgeyByZXR1cm4gbWVzc2FnZS5pZDsgfSk7CiAgICAgICAgfQogICAgICAgIC8vIGV4cGFuZCBkcmFmdCBtZXNzYWdlCiAgICAgICAgdmFyIG5ld0RyYWZ0ID0gbmV4dFByb3BzLmRyYWZ0ICYmCiAgICAgICAgICAgICghdGhpcy5wcm9wcy5kcmFmdCB8fCBuZXh0UHJvcHMuZHJhZnQuaWQgIT09IHRoaXMucHJvcHMuZHJhZnQuaWQpOwogICAgICAgIGlmIChuZXdEcmFmdCkgewogICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgY29tcG9zZXJIZWlnaHQ6IHVuZGVmaW5lZCB9KTsKICAgICAgICAgICAgaWYgKG5leHRQcm9wcy5kcmFmdCAmJiBuZXh0UHJvcHMuZHJhZnQubWVzc2FnZSkgewogICAgICAgICAgICAgICAgZXhwYW5kZWRNZXNzYWdlcy5wdXNoKG5leHRQcm9wcy5kcmFmdC5tZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBwcmVzZXJ2ZSBleHBhbmRlZCBjZWxscwogICAgICAgIGlmICh0aGlzLnN0YXRlLmV4cGFuZGVkS2V5cykgewogICAgICAgICAgICBmb3JFYWNoKHRoaXMuc3RhdGUuZXhwYW5kZWRLZXlzLCBmdW5jdGlvbiAodmFsdWUsIGtleSkgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlICYmIGV4cGFuZGVkTWVzc2FnZXMuaW5kZXhPZihrZXkpID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGV4cGFuZGVkTWVzc2FnZXMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgLy8gSGFuZGxlIHRocmVhZCBtZXNzYWdlcyBjb2xsYXBzZWQvdW5jb2xsYXBzZWQgc3RhdGUKICAgICAgICBpZiAobmV4dFByb3BzLnRocmVhZCkgewogICAgICAgICAgICB0aGlzLnByb2Nlc3NDZWxsQ29sbGFwc2VTdGF0ZXMobmV4dFByb3BzLnRocmVhZCwgZXhwYW5kZWRNZXNzYWdlcywgc2Nyb2xsVG8pOwogICAgICAgIH0KICAgICAgICBpZiAobmV4dFByb3BzLnRocmVhZCAhPT0gdGhpcy5wcm9wcy50aHJlYWQgfHwKICAgICAgICAgICAgbmV4dFByb3BzLnRocmVhZC5tZXNzYWdlcyAhPT0gdGhpcy5wcm9wcy50aHJlYWQubWVzc2FnZXMgfHwKICAgICAgICAgICAgbmV4dFByb3BzLmNvbW1lbnRzICE9PSB0aGlzLnByb3BzLmNvbW1lbnRzIHx8CiAgICAgICAgICAgIG5leHRQcm9wcy50YXNrcyAhPT0gdGhpcy5wcm9wcy50YXNrcyB8fAogICAgICAgICAgICBuZXh0UHJvcHMucmVwbHlpbmcgIT09IHRoaXMucHJvcHMucmVwbHlpbmcgfHwKICAgICAgICAgICAgbmV4dFByb3BzLmNvbW1lbnRpbmcgIT09IHRoaXMucHJvcHMuY29tbWVudGluZykgewogICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGNlbGxzOiB0aGlzLmdldENlbGxzKG5leHRQcm9wcyksCiAgICAgICAgICAgICAgICBoYXNPcHRpbWlzdGljOiBoYXNPcHRpbWlzdGljLAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwogICAgVGhyZWFkRGV0YWlsLnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiAob2xkUHJvcHMpIHsKICAgICAgICAvLyBIYW5kbGVzIG1vdmluZyBzY3JvbGwgcG9zaXRpb24gd2hlbmV2ZXIgbmV3IGNvbW1lbnRzIGFyZSBsb2FkZWQKICAgICAgICB2YXIgbmV3Q29tbWVudHMgPSB0aGlzLnByb3BzLmNvbW1lbnRzIHx8IFtdOwogICAgICAgIHZhciBvbGRDb21tZW50cyA9IG9sZFByb3BzLmNvbW1lbnRzIHx8IFtdOwogICAgICAgIGlmIChuZXdDb21tZW50cy5sZW5ndGggPiBvbGRDb21tZW50cy5sZW5ndGggJiYgdGhpcy5zdGF0ZS5zY3JvbGxlZCkgewogICAgICAgICAgICB2YXIgbGFzdENvbW1lbnRfMiA9IGxhc3QobmV3Q29tbWVudHMpOwogICAgICAgICAgICBpZiAobGFzdENvbW1lbnRfMiAmJiB0aGlzLnJlZikgewogICAgICAgICAgICAgICAgdmFyIGNlbGxzID0gdGhpcy5yZWYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY29tbWVudC1jZWxsJyk7CiAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IEFycmF5LmZyb20oY2VsbHMpCiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLmRhdGFzZXQuY29tbWVudCA9PT0gbGFzdENvbW1lbnRfMi5pZDsgfSlbMF07CiAgICAgICAgICAgICAgICBpZiAoY2VsbCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9IHRoaXMucmVmLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RocmVhZC1kZXRhaWwtdGFibGUnKTsKICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVbMF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IGNlbGwub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVswXS5zY3JvbGxUbyh7IHRvcDogdmFsLCBiZWhhdmlvcjogJ3Ntb290aCcgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBuZXdUeXBpbmdDZWxscyA9IGNvbmNhdCh0aGlzLnByb3BzLnJlcGx5aW5nLm1hcChmdW5jdGlvbiAocikgeyByZXR1cm4gInItIiArIHIudXNlcklkOyB9KSwgdGhpcy5wcm9wcy5jb21tZW50aW5nLm1hcChmdW5jdGlvbiAoYykgeyByZXR1cm4gImMtIiArIGMudXNlcklkOyB9KSk7CiAgICAgICAgdmFyIG9sZFR5cGluZ0NlbGxzID0gY29uY2F0KG9sZFByb3BzLnJlcGx5aW5nLm1hcChmdW5jdGlvbiAocikgeyByZXR1cm4gInItIiArIHIudXNlcklkOyB9KSwgb2xkUHJvcHMuY29tbWVudGluZy5tYXAoZnVuY3Rpb24gKGMpIHsgcmV0dXJuICJjLSIgKyBjLnVzZXJJZDsgfSkpOwogICAgICAgIGlmIChuZXdUeXBpbmdDZWxscy5qb2luKCcnKSAhPT0gb2xkVHlwaW5nQ2VsbHMuam9pbignJykgJiYgdGhpcy5zdGF0ZS5zY3JvbGxlZCkgewogICAgICAgICAgICB2YXIgdHlwaW5nQ2VsbHMgPSB0aGlzLnJlZiAmJiB0aGlzLnJlZi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0eXBpbmctY2VsbCcpOwogICAgICAgICAgICBpZiAodHlwaW5nQ2VsbHMgJiYgdHlwaW5nQ2VsbHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IHR5cGluZ0NlbGxzW3R5cGluZ0NlbGxzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgaWYgKGNlbGwpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSB0aGlzLnJlZi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0aHJlYWQtZGV0YWlsLXRhYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWwgPSBjZWxsLm9mZnNldFRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVbMF0uc2Nyb2xsVG8oeyB0b3A6IHZhbCwgYmVoYXZpb3I6ICdzbW9vdGgnIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgb2xkQWN0aW9ucyA9IG9sZFByb3BzLmhvdGtleUFjdGlvbnMgfHwge307CiAgICAgICAgdmFyIG5ld0FjdGlvbnMgPSB0aGlzLnByb3BzLmhvdGtleUFjdGlvbnMgfHwge307CiAgICAgICAgdGhpcy5oYW5kbGVIb3RrZXlBY3Rpb25zQ2hhbmdlKG9sZEFjdGlvbnMsIG5ld0FjdGlvbnMpOwogICAgfTsKICAgIFRocmVhZERldGFpbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgdmFyIF9hID0gdGhpcy5wcm9wcywgdGhyZWFkID0gX2EudGhyZWFkLCBtZSA9IF9hLm1lLCBjb21tYW5kQ29udHJvbFNob3cgPSBfYS5jb21tYW5kQ29udHJvbFNob3csIGRyYWZ0ID0gX2EuZHJhZnQsIGJvZGllcyA9IF9hLmJvZGllcywgdW5zdWJzY3JpYmVMaW5rID0gX2EudW5zdWJzY3JpYmVMaW5rLCBlcnJvciA9IF9hLmVycm9yLCBpbml0aWFsU3luY2luZyA9IF9hLmluaXRpYWxTeW5jaW5nLCBsaXN0cyA9IF9hLmxpc3RzLCBzZWxlY3RlZENhbGVuZGFyRXZlbnQgPSBfYS5zZWxlY3RlZENhbGVuZGFyRXZlbnQsIGhpZGVBY3Rpb25zID0gX2EuaGlkZUFjdGlvbnMsIHNlbGVjdGVkU2hhcmVkVGhyZWFkID0gX2Euc2VsZWN0ZWRTaGFyZWRUaHJlYWQ7CiAgICAgICAgdmFyIF9iID0gdGhpcy5zdGF0ZSwgY2VsbHMgPSBfYi5jZWxscywgaGFzT3B0aW1pc3RpYyA9IF9iLmhhc09wdGltaXN0aWMsIHNjcm9sbGVkID0gX2Iuc2Nyb2xsZWQ7CiAgICAgICAgdmFyIGlzT3duZXIgPSAhc2VsZWN0ZWRTaGFyZWRUaHJlYWQgfHwKICAgICAgICAgICAgKHNlbGVjdGVkU2hhcmVkVGhyZWFkLmRhdGEgJiYgbWUgJiYgc2VsZWN0ZWRTaGFyZWRUaHJlYWQuZGF0YS51c2VyID09PSBtZS5pZCk7CiAgICAgICAgLy8gUmVuZGVyIG5ldyBkcmFmdAogICAgICAgIGlmIChkcmFmdCAmJiAhdGhyZWFkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlck5ld0RyYWZ0KCk7CiAgICAgICAgfQogICAgICAgIC8vIFNoYXJlZCB0aHJlYWQgZXJyb3IKICAgICAgICBpZiAoc2VsZWN0ZWRTaGFyZWRUaHJlYWQgJiYgc2VsZWN0ZWRTaGFyZWRUaHJlYWQuZXJyb3IpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyU2hhcmVkVGhyZWFkRXJyb3IoKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aHJlYWQgJiYgaW5pdGlhbFN5bmNpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVySW5pdGlhbFN5bmNpbmcoKTsKICAgICAgICB9CiAgICAgICAgLy8gTG9hZGluZyB3aGVuIHNlbGVjdGVkIHNoYXJlZCB0aHJlYWQKICAgICAgICBpZiAoIXRocmVhZCAmJiAhIXNlbGVjdGVkU2hhcmVkVGhyZWFkKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlclRocmVhZExvYWRpbmcoKTsKICAgICAgICB9CiAgICAgICAgLy8gTm8gVGhyZWFkIFNlbGVjdGVkCiAgICAgICAgaWYgKCF0aHJlYWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTm9TZWxlY3Rpb24oKTsKICAgICAgICB9CiAgICAgICAgLy8gRXJyb3IgU3RhdGUKICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyRXJyb3IodGhyZWFkKTsKICAgICAgICB9CiAgICAgICAgLy8gTG9hZGluZyBTdGF0ZQogICAgICAgIGlmIChib2RpZXMubGVuZ3RoIDwgMSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJCb2RpZXNMb2FkaW5nKHRocmVhZCk7CiAgICAgICAgfQogICAgICAgIHZhciBmb2xsb3dVcCA9IGdldEZvbGxvd1VwUmVtaW5kZXJEaXNwbGF5U3RyaW5nKHRocmVhZCk7CiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IHRhYkluZGV4OiAtMSwgY2xhc3NOYW1lOiAidGhyZWFkLWRldGFpbCIsIHJlZjogdGhpcy5oYW5kbGVSZWYgfSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChUaHJlYWREZXRhaWxIZWFkZXIsIHsgc2hhcmVkVGhyZWFkOiBzZWxlY3RlZFNoYXJlZFRocmVhZCAmJiBzZWxlY3RlZFNoYXJlZFRocmVhZC5kYXRhLCBzdWJqZWN0OiB0aHJlYWQuc3ViamVjdCwgcGFydGljaXBhbnRzOiB0aHJlYWQucGFydGljaXBhbnRzLCBjb21tYW5kQ29udHJvbFNob3c6IGNvbW1hbmRDb250cm9sU2hvdywgb25BY3Rpb25DbGljazogdGhpcy5oYW5kbGVBY3Rpb25DbGljaywgdGhyZWFkOiB0aHJlYWQsIHNob3dVbnN1YnNjcmliZTogISF1bnN1YnNjcmliZUxpbmssIG1lOiBtZSwgbGlzdHM6IGxpc3RzLCBoaWRlQWN0aW9uczogaGlkZUFjdGlvbnMgfSksCiAgICAgICAgICAgICEhc2VsZWN0ZWRDYWxlbmRhckV2ZW50ICYmIGlzT3duZXIgJiYKICAgICAgICAgICAgICAgIHNlbGVjdGVkQ2FsZW5kYXJFdmVudC5zdGF0dXMgIT09IENhbGVuZGFyRXZlbnRTdGF0dXMuQ2FuY2VsbGVkICYmCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENhbGVuZGFySW52aXRlQmFyLCB7IHRocmVhZDogdGhyZWFkIH0pLAogICAgICAgICAgICAhIWZvbGxvd1VwICYmICFoYXNPcHRpbWlzdGljICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZm9sbG93LXVwLXJlbWluZGVyIiB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZXh0IiB9LAogICAgICAgICAgICAgICAgICAgICJSZW1pbmQgbWUgaWYgbm8gcmVzcG9uc2UgYnkgIiwKICAgICAgICAgICAgICAgICAgICBmb2xsb3dVcCksCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEhvdmVyVGlwLCB7IGJvdHRvbTogIi0zMHB4IiwgcmlnaHQ6ICI1cHgiLCBjb3B5OiAiUmVtb3ZlIHJlbWluZGVyIiwgaG90a2V5QWN0aW9uOiBIb3RrZXlBY3Rpb24uQ2FuY2VsRm9sbG93dXAgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogInJlbW92ZSIsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlUmVtb3ZlRm9sbG93VXBSZW1pbmRlciB9LAogICAgICAgICAgICAgICAgICAgICAgICAiUmVtb3ZlIHJlbWluZGVyIiwKICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChDbG9zZSwgeyB3aWR0aDogIjhweCIsIGhlaWdodDogIjhweCIgfSkpKSksCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGhyZWFkLWRldGFpbC10YWJsZSIsIHN0eWxlOiB7IHZpc2liaWxpdHk6IHNjcm9sbGVkID8gJ3Zpc2libGUnIDogJ2hpZGRlbicgfSB9LCBjZWxscy5tYXAoZnVuY3Rpb24gKGNlbGwpIHsKICAgICAgICAgICAgICAgIGlmIChjZWxsLnR5cGUgPT09IENlbGxUeXBlLk1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmluZEluZGV4KHRocmVhZC5tZXNzYWdlcywgeyBpZDogY2VsbC5kYXRhLmlkIH0pID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlbmRlckNlbGwoY2VsbC5kYXRhLmlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjZWxsLnR5cGUgPT09IENlbGxUeXBlLlRhc2spIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucmVuZGVyVGFzayhjZWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjZWxsLnR5cGUgPT09IENlbGxUeXBlLlR5cGluZykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yZW5kZXJUeXBpbmcoY2VsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY2VsbC50eXBlID09PSBDZWxsVHlwZS5EcmFmdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yZW5kZXJTaGFyZWREcmFmdENlbGwoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yZW5kZXJDb21tZW50KGNlbGwpOwogICAgICAgICAgICB9KSksCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVW5kb1NlbmRQb3B1cCwgbnVsbCksCiAgICAgICAgICAgIHRoaXMucmVuZGVyQ29tcG9zZXIoKSkpOwogICAgfTsKICAgIHJldHVybiBUaHJlYWREZXRhaWw7Cn0oUmVhY3QuUHVyZUNvbXBvbmVudCkpOwpleHBvcnQgZGVmYXVsdCBUaHJlYWREZXRhaWw7Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/ThreadDetail.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/ThreadDetail.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport { forEach, last, findIndex, concat } from 'lodash';\nimport CustomLoader from 'react-loaders';\nimport Loader from '@src/components/Loader/Loader';\nimport classnames from 'classnames';\n\nimport {\n  Thread,\n  MessageBody,\n  Me,\n  Account,\n  CommandControlType,\n  ThreadCommitMeta,\n  ThreadBox,\n  FilterBox,\n  Draft,\n  Preferences,\n  List,\n  CalendarEvent,\n  CalendarEventStatus,\n  Resource,\n  Message,\n  Action,\n} from '@src/types';\nimport {\n  Comment,\n  Cell,\n  CellType,\n  SharedThread,\n  SharedThreadActivityType,\n  SharedThreadActivity,\n} from '@src/types/sharedThreads';\n\nimport ThreadDetailHeader from './components/ThreadDetailHeader';\nimport CollapsedCell from './components/Cell/CollapsedCell';\nimport ExpandedCell from './components/Cell/ExpandedCell';\nimport Composer from './components/Composer';\nimport UndoSendPopup from './components/UndoSendPopup';\n\nimport './ThreadDetail.scss';\n// tslint:disable-next-line:max-line-length\nimport CalendarInviteBar from '@src/components/ThreadDetail/components/CalendarInviteBar';\nimport CommentCell from '@src/components/Cells/CommentCell';\nimport Close from '@src/components/Icons/Close.svg';\n\n// tslint:disable-next-line:max-line-length\nimport SharedThreadErrorPage from '@src/routes/PublicSharedThreads/components/SharedThreadErrorPage';\nimport { AsanaTask } from '@src/types/asana';\nimport AsanaTaskCell from '@src/components/Cells/AsanaTaskCell';\nimport { getFollowUpReminderDisplayString } from '@src/lib/thread';\nimport HoverTip from '@src/components/Base/HoverTip';\nimport { SharedThreadActivityCreateMeta, PING_INTERVAL } from '@src/ducks/sharedThreads';\nimport TypingCell, { TypingType } from '@src/components/Cells/TypingCell/TypingCell';\nimport Resizable, { NumberSize } from 're-resizable';\nimport { Filter } from '@src/types/filters';\nimport { hotkeyUpdate, hotkeySuggest } from '@src/ducks/hotkeys';\nimport { checkNextHotkeyChange, getHotkeyByName, HotkeyAction } from '@src/lib/hotkeys';\nimport { isDraftSending } from '@src/lib/draft';\nimport SharedDraftCell from './components/Cell/SharedDraftCell';\nimport KeyboardSymbol from '../Base/KeyboardSymbol/KeyboardSymbol';\n\nexport interface Props {\n  onThreadDelete?: () => void;\n}\nexport interface StateProps {\n  thread?: Thread;\n  bodies: MessageBody[];\n  me?: Me;\n  accounts?: Account[];\n  draft?: Draft;\n  selectedDraft?: string;\n  preferences?: Preferences;\n  unsubscribeLink?: string;\n  noBranding: boolean;\n  error?: Error;\n  initialSyncing?: boolean;\n  lists: List[];\n  selectedCalendarEvent?: CalendarEvent;\n  comments?: Comment[];\n  hideActions?: boolean;\n  selectedSharedThread?: Resource<SharedThread>;\n  tasks?: AsanaTask[];\n  replying: SharedThreadActivity[];\n  commenting: SharedThreadActivity[];\n  blockFilter?: Filter;\n  sharedThreadDraft?: Draft;\n  hotkeyActions?: { [key: string]: number };\n}\n\nexport interface DispatchProps {\n  commandControlShow: (type: CommandControlType) => void;\n  submitCommitMeta: (commitMeta: ThreadCommitMeta) => void;\n  createSharedThreadActivity: (meta: SharedThreadActivityCreateMeta) => void;\n  dispatchAction: (action: Action<any, any>) => void;\n}\n\ninterface State {\n  expandedKeys: { [id: string]: boolean; };\n  cells: Cell[];\n  hasOptimistic: boolean;\n  composerHeight?: number;\n  lastExpanded?: string;\n  scrolled: boolean;\n}\n\nclass ThreadDetail extends React.PureComponent<StateProps & Props & DispatchProps, State> {\n  private timeout: NodeJS.Timer;\n  private readTimeout: NodeJS.Timer;\n  private ref: HTMLDivElement;\n  private viewInterval: NodeJS.Timer;\n\n  constructor(props: Props & StateProps & DispatchProps) {\n    super(props);\n\n    this.state = {\n      expandedKeys: {},\n      cells: this.getCells(props),\n      hasOptimistic: this.getHasOptimistic(props.thread),\n      scrolled: false,\n    };\n  }\n\n  recordView = () => {\n    const { selectedSharedThread, createSharedThreadActivity } = this.props;\n\n    if (selectedSharedThread && selectedSharedThread.data && selectedSharedThread.data.id) {\n      createSharedThreadActivity({\n        type: SharedThreadActivityType.View,\n        sharedThread: selectedSharedThread.data.id,\n      });\n    }\n  }\n\n  componentDidMount() {\n    const { thread, draft } = this.props;\n    if (thread) {\n      const expandedMessages = thread.messages.filter(m => !m.read).map(m => m.id);\n      let scrollTo: string = '';\n\n      // Detect last message reference we want to scroll to on initial render\n      if (draft && draft.message) {\n        expandedMessages.push(draft.message);\n        scrollTo = draft.message;\n      } else if (expandedMessages.length) {\n        scrollTo = expandedMessages[0];\n      } else if (thread.messages.length) {\n        const lastMessage = last(thread.messages);\n\n        if (lastMessage) {\n          scrollTo = lastMessage.id;\n        }\n      }\n\n      this.processCellCollapseStates(thread, expandedMessages, scrollTo);\n    }\n\n    this.viewInterval = global.setInterval(\n      this.recordView, PING_INTERVAL,\n    );\n  }\n\n  componentWillUnmount() {\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n    }\n\n    if (this.readTimeout) {\n      clearTimeout(this.readTimeout);\n    }\n\n    if (this.viewInterval) {\n      clearInterval(this.viewInterval);\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: StateProps & DispatchProps) {\n    // Return focus to top level when draft has been removed\n    if (!nextProps.draft && this.props.draft && this.ref) {\n      const node = this.ref;\n      if (node && node instanceof HTMLElement) {\n        document.body.focus();\n      }\n    }\n\n    // Do nothing if thread is not passed in\n    if (!nextProps.thread) {\n      return;\n    }\n\n    let expandedMessages: string[] = nextProps.thread.messages.filter(m => !m.read).map(m => m.id);\n    let scrollTo: string = '';\n    // Handle changes to thread\n    if (!this.props.thread || this.props.thread.id !== nextProps.thread.id) {\n      this.handleReadStatus(nextProps.thread);\n      this.setState({ scrolled: false });\n    }\n\n    // scroll to new reply\n    const lastMessage = nextProps.thread.messages.length && last(nextProps.thread.messages);\n    const sameMessageLength = this.props.thread && nextProps.thread &&\n        this.props.thread.messages.length === nextProps.thread.messages.length;\n    const hasOptimistic = this.getHasOptimistic(nextProps.thread);\n    if (hasOptimistic && !sameMessageLength) {\n      this.setState({ scrolled: false });\n    }\n\n    if (!this.state.scrolled) {\n      if (nextProps.draft && nextProps.draft.message) {\n        scrollTo = nextProps.draft.message;\n      } else if (hasOptimistic && lastMessage) {\n        scrollTo = lastMessage.id;\n      } else if (expandedMessages.length) {\n        scrollTo = expandedMessages[0];\n      } else if (lastMessage) {\n        scrollTo = lastMessage.id;\n      }\n    }\n\n    // Handle new messages -> expand them automatically\n    if (this.props.thread && nextProps.thread && nextProps.thread.id === this.props.thread.id) {\n      const oldMessages: { [id: string]: boolean } = {};\n\n      this.props.thread.messages.forEach((message) => {\n        oldMessages[message.id] = true && message.read;\n      });\n\n      expandedMessages = nextProps.thread.messages\n        .filter(message => !oldMessages[message.id])\n        .map(message => message.id);\n    }\n\n    // expand draft message\n    const newDraft = nextProps.draft &&\n      (!this.props.draft || nextProps.draft.id !== this.props.draft.id);\n    if (newDraft) {\n      this.setState({ composerHeight: undefined });\n      if (nextProps.draft && nextProps.draft.message) {\n        expandedMessages.push(nextProps.draft.message);\n      }\n    }\n\n    // preserve expanded cells\n    if (this.state.expandedKeys) {\n      forEach(this.state.expandedKeys, (value, key) => {\n        if (value && expandedMessages.indexOf(key) === -1) {\n          expandedMessages.push(key);\n        }\n      });\n    }\n\n    // Handle thread messages collapsed/uncollapsed state\n    if (nextProps.thread) {\n      this.processCellCollapseStates(nextProps.thread, expandedMessages, scrollTo);\n    }\n\n    if (nextProps.thread !== this.props.thread ||\n      nextProps.thread.messages !== this.props.thread.messages ||\n      nextProps.comments !== this.props.comments ||\n      nextProps.tasks !== this.props.tasks ||\n      nextProps.replying !== this.props.replying ||\n      nextProps.commenting !== this.props.commenting\n    ) {\n      this.setState({\n        cells: this.getCells(nextProps),\n        hasOptimistic,\n      });\n    }\n  }\n\n  componentDidUpdate(oldProps: StateProps) {\n    // Handles moving scroll position whenever new comments are loaded\n    const newComments = this.props.comments || [];\n    const oldComments = oldProps.comments || [];\n\n    if (newComments.length > oldComments.length && this.state.scrolled) {\n      const lastComment = last(newComments);\n      if (lastComment && this.ref) {\n        const cells = this.ref.getElementsByClassName('comment-cell');\n        const cell = Array.from(cells)\n          .filter((el: HTMLElement) => el.dataset.comment === lastComment.id)[0];\n        if (cell) {\n          const table = this.ref.getElementsByClassName('thread-detail-table');\n          if (table[0]) {\n            const val = (cell as any).offsetTop;\n            table[0].scrollTo({ top: val, behavior: 'smooth' });\n          }\n        }\n      }\n    }\n\n    const newTypingCells = concat(\n      this.props.replying.map(r => `r-${r.userId}`),\n      this.props.commenting.map(c => `c-${c.userId}`),\n    );\n    const oldTypingCells = concat(\n      oldProps.replying.map(r => `r-${r.userId}`),\n      oldProps.commenting.map(c => `c-${c.userId}`),\n    );\n    if (newTypingCells.join('') !== oldTypingCells.join('') && this.state.scrolled) {\n      const typingCells = this.ref && this.ref.getElementsByClassName('typing-cell');\n      if (typingCells && typingCells.length) {\n        const cell = typingCells[typingCells.length - 1];\n        if (cell) {\n          const table = this.ref.getElementsByClassName('thread-detail-table');\n          if (table[0]) {\n            const val = (cell as any).offsetTop;\n            table[0].scrollTo({ top: val, behavior: 'smooth' });\n          }\n        }\n      }\n    }\n\n    const oldActions = oldProps.hotkeyActions || {};\n    const newActions = this.props.hotkeyActions || {};\n    this.handleHotkeyActionsChange(oldActions, newActions);\n  }\n\n  handleHotkeyActionsChange = (\n    oldActions: { [action: string]: number },\n    newActions: { [action: string]: number },\n  ) => {\n    // Handle CC toggle\n    if (checkNextHotkeyChange(HotkeyAction.PopoutMessage, newActions, oldActions)) {\n      const { thread } = this.props;\n      const { expandedKeys, lastExpanded } = this.state;\n      if (!thread) {\n        return;\n      }\n      const expandedMessages = thread.messages.filter(m => !!expandedKeys[m.id]);\n      const lastExpandedId = lastExpanded ||\n        (expandedMessages.length && expandedMessages.slice(-1)[0].id) || undefined;\n      if (lastExpandedId && thread) {\n        const messageLink = `/popout/threads/${thread.id}/messages/${lastExpandedId}`;\n        window.open(messageLink, '_blank', 'height=500,width=800');\n      }\n    }\n  }\n\n  getHasOptimistic = (thread?: Thread) => {\n    if (!thread || !thread.messages.length) {\n      return false;\n    }\n\n    const lastMessage = last(thread.messages);\n    if (lastMessage) {\n      return !!lastMessage.optimistic;\n    }\n\n    return false;\n  }\n\n  getCells = (props: StateProps & DispatchProps) => {\n    if (props.thread) {\n      const messages: Cell[] = props.thread.messages.map(m => ({\n        type: CellType.Message,\n        date: m.internal,\n        data: m,\n      }));\n      const comments: Cell[] = (props.comments || []).map(c => ({\n        type: CellType.Comment,\n        date: c.created,\n        data: c,\n      }));\n      const tasks: Cell[] = (props.tasks || []).map(t => ({\n        type: CellType.Task,\n        date: t.created,\n        data: t,\n      }));\n      const replying: Cell[] = (props.replying || []).map(r => ({\n        type: CellType.Typing,\n        date: r.timestamp,\n        data: r,\n      }));\n      const commenting: Cell[] = (props.commenting || []).map(c => ({\n        type: CellType.Typing,\n        date: c.timestamp,\n        data: c,\n      }));\n\n      const drafts: Cell[] = (props.sharedThreadDraft && [props.sharedThreadDraft] || [])\n      .map(c => ({\n        type: CellType.Draft,\n        date: c.updated,\n        data: c,\n      }));\n\n      return messages.concat(comments).concat(tasks).sort((a, b) => {\n        if (a.date < b.date) {\n          return  -1;\n        }\n\n        if (a.date > b.date) {\n          return 1;\n        }\n\n        return 0;\n      }).concat(replying).concat(commenting).concat(drafts);\n    }\n\n    return [];\n  }\n\n  renderSharedDraftCell = () => {\n    return (\n      <SharedDraftCell />\n    );\n  }\n\n  // Gets DOM scroll offset for last comment\n  getLastCommentScrollPosition = (): number => {\n    const { comments } = this.props;\n    if (comments && comments.length) {\n      const lastComment = last(comments);\n      if (lastComment && this.ref) {\n        const cells = this.ref.getElementsByClassName('comment-cell');\n        const cell = Array.from(cells)\n          .filter((el: HTMLElement) => el.dataset.comment === lastComment.id)[0];\n        if (cell) {\n          const val = (cell as any).offsetTop;\n          return val;\n        }\n      }\n    }\n    return 0;\n  }\n\n  // Gets DOM scroll offset for last expanded message\n  getLastMessageScrollPosition = (): number => {\n    const { thread } = this.props;\n\n    if (!thread) {\n      return 0;\n    }\n\n    // Always show last id for now\n    const lastMessage = last(thread.messages);\n    const lastId = lastMessage && lastMessage.id || '';\n\n    const cells = this.ref.getElementsByClassName('expanded-cell');\n    const cell = Array.from(cells)\n      .filter((el: HTMLElement) => el.dataset.message === lastId)[0];\n    if (cell) {\n      const val = (cell as any).offsetTop;\n      return val;\n    }\n\n    return 0;\n  }\n\n  processCellCollapseStates = (thread: Thread, forceExpand?: string[], scrollTo?: string) => {\n    const expandedKeys = {};\n\n    thread.messages.forEach((message) => {\n      expandedKeys[message.id] = forceExpand && forceExpand.indexOf(message.id) > -1 ? true : false;\n    });\n\n    // Always show last id for now\n    const lastMessage = last(thread.messages);\n    const lastId = lastMessage && lastMessage.id || '';\n\n    expandedKeys[lastId] = true;\n\n    this.setState({ expandedKeys }, () => {\n      if (this.state.scrolled) {\n        return;\n      }\n\n      if (this.timeout) {\n        clearTimeout(this.timeout);\n      }\n\n      this.timeout = global.setTimeout(\n        () => {\n          const { draft } = this.props;\n          const draftMessageExists = draft && !!draft.message;\n          if (this.ref && scrollTo) {\n            const cells = this.ref.getElementsByClassName('expanded-cell');\n            const cellsArray = Array.from(cells);\n            let cell = cellsArray\n              .filter((el: HTMLElement) => scrollTo ?\n                el.dataset.message === scrollTo : el.dataset.message === lastId)[0];\n\n            // Backup mechanism for scrollto location will use the last message if no match found\n            // NOTE(SHIN): Reference will be lost to draft message\n            // if message ID becomes out of date (optimistic)\n            if (!cell) {\n              cell = cellsArray\n              .filter((el: HTMLElement) => el.dataset.message === lastId)[0];\n            }\n\n            if (cell) {\n              this.setState({ scrolled: true });\n              const table = this.ref.getElementsByClassName('thread-detail-table');\n              if (table[0]) {\n                const collapsedCellHeight = 26;\n                const commentScrollPosition = this.getLastCommentScrollPosition()\n                  - collapsedCellHeight;\n                const messageScrollPosition = (cell as any).offsetTop - collapsedCellHeight;\n                const val = draftMessageExists\n                  ? messageScrollPosition\n                  : Math.max(commentScrollPosition, messageScrollPosition);\n\n                // NOTE(SHAHAN): Calculate whether we need to introduce a 300ms delay\n                // for a rare image edge-case with scrolling. This edge-case occurs\n                // when images with no height set exist above a comment, as it takes\n                // a bit of time for images to load, which would result in a jump otherwise\n                let containsImagesNoHeight = false;\n                if (commentScrollPosition > messageScrollPosition && !draftMessageExists) {\n                  const images = this.ref.querySelectorAll('.message-content img:not([height])');\n\n                  // tslint:disable-next-line: prefer-for-of\n                  for (let i = 0; i < images.length; i += 1) {\n                    const img = images[i];\n                    if (img.scrollHeight === 0 && !img.hasAttribute('data-pm-tracking')) {\n                      containsImagesNoHeight = true;\n                      break;\n                    }\n                  }\n                }\n\n                if (containsImagesNoHeight) {\n                  if (this.timeout) {\n                    clearTimeout(this.timeout);\n                  }\n\n                  this.timeout = global.setTimeout(\n                    () => {\n                      // The position may have moved, so recalculate based on where\n                      // the last comment scroll position is\n                      const newPosition = this.getLastCommentScrollPosition()\n                        - collapsedCellHeight;\n\n                      if (table && table[0]) {\n                        table[0].scrollTo({ top: newPosition, behavior: 'auto' });\n                      }\n                    },\n                    300,\n                  );\n                } else {\n                  table[0].scrollTo({ top: val, behavior: 'auto' });\n                }\n              }\n            }\n          }\n        },\n        0,\n      );\n    });\n  }\n\n  // Handles thread read on a 0.7 second timeout.\n  handleReadStatus = (thread: Thread) => {\n    const { submitCommitMeta } = this.props;\n    if (!thread.read) {\n      const threadId = thread.id;\n      if (this.readTimeout) {\n        clearTimeout(this.readTimeout);\n      }\n      this.readTimeout = global.setTimeout(\n        () => {\n          const currentThread = this.props.thread;\n          if (currentThread && !currentThread.read && currentThread.id === threadId) {\n            submitCommitMeta({ singleResource: thread.id, read: true });\n            return;\n          }\n        },\n        700,\n      );\n    }\n  }\n\n  handleCellExpand = (key: string) => {\n    const oldValue  = this.state.expandedKeys[key] || false;\n    const expandedKeys = { ...this.state.expandedKeys, [key]: !oldValue };\n    this.setState({ expandedKeys, lastExpanded: key });\n  }\n\n  handleActionClick = (box: ThreadBox | FilterBox | string) => {\n    const {\n      thread,\n      submitCommitMeta,\n      commandControlShow,\n      onThreadDelete,\n      hideActions,\n      dispatchAction,\n      blockFilter,\n    } = this.props;\n\n    if (hideActions) {\n      return;\n    }\n\n    // Handle single actions\n    switch (box) {\n      case ThreadBox.Later:\n        commandControlShow(CommandControlType.ReadLater);\n        dispatchAction(hotkeySuggest(HotkeyAction.ReadLater));\n        return;\n      case ThreadBox.List:\n        commandControlShow(CommandControlType.Label);\n        dispatchAction(hotkeySuggest(HotkeyAction.Label));\n        return;\n      case 'Block Sender': // Replaced behavior of blocks\n        if (blockFilter) {\n          dispatchAction(hotkeyUpdate(HotkeyAction.UnblockSender));\n        } else {\n          dispatchAction(hotkeyUpdate(HotkeyAction.BlockSender));\n        }\n        dispatchAction(hotkeySuggest(HotkeyAction.BlockSender));\n        return;\n      case 'Mute Conversation':\n        dispatchAction(hotkeySuggest(HotkeyAction.MuteConversation));\n        if (thread) {\n          submitCommitMeta({ singleResource: thread.id, muted: !thread.muted });\n        }\n        return;\n      default:\n        break;\n    }\n\n    // Handle flags\n    if (thread) {\n      switch (box) {\n        case FilterBox.Unread:\n          dispatchAction(hotkeySuggest(HotkeyAction.ToggleUnread));\n          submitCommitMeta({ read: !thread.read });\n          return;\n        case FilterBox.Starred:\n          dispatchAction(hotkeySuggest(HotkeyAction.ToggleStar));\n          submitCommitMeta({ starred: !thread.starred });\n          return;\n        case ThreadBox.Trash:\n          dispatchAction(hotkeySuggest(HotkeyAction.Trash));\n          if (thread.box === ThreadBox.Trash && onThreadDelete) {\n            onThreadDelete();\n            return;\n          }\n          break;\n        case ThreadBox.Archive:\n          dispatchAction(hotkeySuggest(HotkeyAction.Archive));\n          break;\n        default:\n          break;\n      }\n\n      // Handle box\n      const commitMeta = { box: box as ThreadBox };\n      submitCommitMeta(commitMeta);\n    }\n  }\n\n  renderCell = (key: string) => {\n    const { thread, bodies, hideActions } = this.props;\n    const collapsed = !this.state.expandedKeys[key];\n    const ExpandedCellConnect = ExpandedCell as any;\n    const CollapsedCellConnect = CollapsedCell as any;\n\n    if (thread) {\n      const message = thread.messages.filter(m => m.id === key)[0];\n      const body = bodies && bodies.filter(b => b.id === key)[0];\n\n      if (collapsed) {\n        return (\n          <CollapsedCellConnect\n            id={key}\n            onToggleExpand={this.handleCellExpand}\n            key={key}\n            message={message}\n          />\n        );\n      }\n      return (\n        <ExpandedCellConnect\n          onToggleExpand={this.handleCellExpand}\n          key={key}\n          message={message}\n          messageBody={body}\n          threadId={thread.id}\n          hideActions={hideActions}\n        />\n      );\n    }\n\n    return <div />;\n  }\n\n  renderComment = (cell: Cell) => {\n    const data = cell.data as Comment;\n\n    return <CommentCell comment={data} key={data.id} />;\n  }\n\n  renderTask = (cell: Cell) => {\n    const data = cell.data as AsanaTask;\n    return <AsanaTaskCell task={data} key={data.id} />;\n  }\n\n  renderTyping = (cell: Cell) => {\n    const data = cell.data as SharedThreadActivity;\n    if (!data.user) {\n      return null;\n    }\n\n    let type;\n    switch (data.type) {\n      case SharedThreadActivityType.Comment:\n        type = TypingType.Comment;\n        break;\n      case SharedThreadActivityType.Reply:\n        type = TypingType.Reply;\n        break;\n      default:\n        return null;\n    }\n\n    return (\n      <TypingCell\n        key={`${type}-${data.userId}`}\n        type={type}\n        user={{\n          firstName: data.user.firstName, photoUrl: data.user.photoUrl,\n        }}\n      />\n    );\n  }\n\n  renderNewDraft = () => {\n    const { thread, draft, me, accounts } = this.props;\n\n    if (draft && !!draft.threadV2 && !thread) {\n      return (\n        <div className=\"thread-detail\">\n          <div className=\"thread-detail-filler\" />\n          {this.renderComposer()}\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"thread-detail\" tabIndex={-1}>\n        {me && accounts &&\n          <Composer\n            me={me}\n            accounts={accounts}\n            thread={thread}\n            draft={draft}\n            showFullHeight\n          />\n        }\n      </div>\n    );\n  }\n\n  renderOptionDesc = (desc: string) => {\n    return desc.split('+').map((c, i) => (\n      <KeyboardSymbol\n        key={`${c}-${i}`}\n        character={c}\n      />\n    ));\n  }\n\n  renderHotkeysSection = () => {\n    const hotkeys = [\n      HotkeyAction.NewDraft,\n      HotkeyAction.ToggleCommandControl,\n      HotkeyAction.NavigationCenter,\n      HotkeyAction.KeyboardShortcutGuide,\n    ];\n\n    return (\n      <div className=\"hotkeys-section\">\n        {hotkeys\n          .map(h => getHotkeyByName(h))\n          .map(h => (\n            <div\n              className=\"hotkey-cell\"\n              key={`hotkey-info-${h?.name}`}\n            >\n              <div className=\"hotkey-title\">\n                {h?.name}\n              </div>\n              <div className=\"spacer\" />\n              {h?.text && (\n                <div className=\"hotkey-symbol\">\n                  {this.renderOptionDesc(h.text)}\n                </div>\n              )}\n            </div>\n          ))}\n      </div>\n    );\n  }\n\n  renderNoSelection = () => {\n    return (\n      <div className=\"thread-detail\">\n        <div className=\"thread-detail-no-thread\" tabIndex={-1}>\n          <div className=\"copy\">\n            No Conversation Selected\n          </div>\n          {this.renderHotkeysSection()}\n        </div>\n      </div>\n    );\n  }\n\n  renderInitialSyncing = () => {\n    const description = 'Feel free to do something else in the meantime, '\n      + 'we\\'ll let you know once your inbox is ready!';\n    return (\n      <div className=\"thread-detail\">\n        <div className=\"thread-detail-table\" tabIndex={-1}>\n          <div className=\"initial-sync\">\n            <CustomLoader\n              type=\"line-scale-pulse-out-rapid\"\n              innerClassName=\"custom-loader-inner\"\n              active\n            />\n            <div className=\"title\">\n              Creating your inbox...\n            </div>\n            <div className=\"description\">\n              {description}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderThreadLoading = () => (\n    <div className=\"thread-detail\">\n      <div className=\"thread-detail-table loading\" tabIndex={-1}>\n        <Loader />\n      </div>\n    </div>\n  )\n\n  // Show loading indicator when thread exists\n  renderBodiesLoading = (thread: Thread) => (\n    <div className=\"thread-detail\">\n      <ThreadDetailHeader\n        subject={thread.subject}\n        participants={thread.participants}\n        commandControlShow={this.props.commandControlShow}\n        onActionClick={this.handleActionClick}\n        thread={thread}\n        showUnsubscribe={!!this.props.unsubscribeLink}\n        me={this.props.me}\n        hideActions={this.props.hideActions}\n      />\n      <div className=\"thread-detail-table loading\" tabIndex={-1}>\n        <Loader />\n      </div>\n    </div>\n  )\n\n  // return this.renderError(thread, commandControlShow, unsubscribeLink, me);\n  renderError = (thread: Thread) => {\n    const { commandControlShow, me, unsubscribeLink, hideActions } = this.props;\n    return (\n      <div className=\"thread-detail\">\n        <ThreadDetailHeader\n          subject={thread.subject}\n          participants={thread.participants}\n          commandControlShow={commandControlShow}\n          onActionClick={this.handleActionClick}\n          thread={thread}\n          showUnsubscribe={!!unsubscribeLink}\n          me={me}\n          hideActions={hideActions}\n        />\n        <div className=\"thread-detail-table\" tabIndex={-1}>\n          <div className=\"error\">\n            <div className=\"error-title\">\n              Sorry, there was an issue loading this conversation\n          </div>\n            <div className=\"error-description\">\n              Please check your internet connection and try again\n          </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n    // return this.renderError(thread, commandControlShow, unsubscribeLink, me);\n  renderSharedThreadError = () => {\n    const { me, commandControlShow, unsubscribeLink, thread } = this.props;\n    return (\n      <div className=\"thread-detail\">\n        <ThreadDetailHeader\n          subject={'Conversation Not Found'}\n          participants={thread && thread.participants || []}\n          commandControlShow={commandControlShow}\n          onActionClick={this.handleActionClick}\n          thread={thread}\n          showUnsubscribe={!!unsubscribeLink}\n          me={me}\n          hideActions={true}\n        />\n        <div className=\"thread-detail-table\" tabIndex={-1}>\n          <SharedThreadErrorPage\n            email={me && me.email || ''}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  renderComposer = () => {\n    const {\n      me,\n      accounts,\n      thread,\n      draft,\n      selectedSharedThread,\n      hideActions,\n    } = this.props;\n    const { composerHeight } = this.state;\n\n    if (!me || !accounts) {\n      return (<div/>);\n    }\n\n    // Do not use resizable component when no draft or status is sending bc (optimistic)\n    if (!draft || isDraftSending(draft)) {\n      return (\n        <Composer\n          me={me}\n          accounts={accounts}\n          thread={thread}\n          draft={undefined}\n          onExpand={this.handleExpand}\n          hideActions={hideActions}\n          hideCommentEditor={selectedSharedThread && selectedSharedThread.data && me &&\n            me.team !== selectedSharedThread.data.team\n          }\n        />\n      );\n    }\n\n    return (\n      <Resizable\n        key={draft.id}\n        className={classnames('composer-resizable', { resized: !!composerHeight })}\n        enable={{\n          top: true,\n          right: false,\n          bottom: false,\n          left: false,\n          topRight: false,\n          bottomRight: false,\n          bottomLeft: false,\n          topLeft: false,\n        }}\n        handleClasses={{\n          top: 'composer-resize-handler',\n        }}\n        defaultSize={{\n          width: 'auto',\n          height: composerHeight || 'auto',\n        }}\n        onResize={this.handleComposerResizeStop}\n        onResizeStop={this.handleComposerResizeStop}\n      >\n        <Composer\n          me={me}\n          accounts={accounts}\n          thread={thread}\n          draft={draft}\n          onExpand={this.handleExpand}\n          hideActions={hideActions}\n          hideCommentEditor={selectedSharedThread && selectedSharedThread.data && me &&\n            me.team !== selectedSharedThread.data.team\n          }\n        />\n      </Resizable>\n    );\n  }\n\n  handleExpand = (message?: string) => {\n    if (!this.ref) {\n      return;\n    }\n\n    const cells = this.ref.getElementsByClassName('expanded-cell');\n    const cell = message ?\n      Array.from(cells).filter((el: HTMLElement) => el.dataset.message === message)[0]\n      : last(cells);\n\n    if (cell) {\n      if (this.timeout) {\n        clearTimeout(this.timeout);\n      }\n\n      this.timeout = global.setTimeout(\n        () => {\n          if (cell) {\n            (cell as HTMLElement).scrollIntoView({\n              behavior: 'auto',\n              block: 'start',\n              inline: 'nearest',\n            });\n          }\n        },\n        0,\n      );\n    }\n  }\n\n  handleRef = (ref: HTMLDivElement) => {\n    this.ref = ref;\n  }\n\n  handleRemoveFollowUpReminder = () => {\n    const { thread, submitCommitMeta } = this.props;\n\n    if (thread) {\n      submitCommitMeta({ singleResource: thread.id, waiting: null });\n    }\n  }\n\n  handleComposerResizeStop = (\n    event: MouseEvent,\n    direction: string,\n    refToElement: HTMLElement,\n    delta: NumberSize,\n  ) => {\n    if (refToElement.clientWidth) {\n      this.setState({ composerHeight: refToElement.clientWidth });\n    }\n  }\n\n  render() {\n    const {\n      thread,\n      me,\n      commandControlShow,\n      draft,\n      bodies,\n      unsubscribeLink,\n      error,\n      initialSyncing,\n      lists,\n      selectedCalendarEvent,\n      hideActions,\n      selectedSharedThread,\n    } = this.props;\n    const { cells, hasOptimistic, scrolled } = this.state;\n    const isOwner = !selectedSharedThread ||\n      (selectedSharedThread.data && me && selectedSharedThread.data.user === me.id);\n\n    // Render new draft\n    if (draft && !thread) {\n      return this.renderNewDraft();\n    }\n\n    // Shared thread error\n    if (selectedSharedThread && selectedSharedThread.error) {\n      return this.renderSharedThreadError();\n    }\n\n    if (!thread && initialSyncing) {\n      return this.renderInitialSyncing();\n    }\n\n    // Loading when selected shared thread\n    if (!thread && !!selectedSharedThread) {\n      return this.renderThreadLoading();\n    }\n\n    // No Thread Selected\n    if (!thread) {\n      return this.renderNoSelection();\n    }\n\n    // Error State\n    if (error) {\n      return this.renderError(thread);\n    }\n\n    // Loading State\n    if (bodies.length < 1) {\n      return this.renderBodiesLoading(thread);\n    }\n\n    const followUp = getFollowUpReminderDisplayString(thread);\n\n    return (\n      <div\n        tabIndex={-1}\n        className=\"thread-detail\"\n        ref={this.handleRef}\n      >\n        <ThreadDetailHeader\n          sharedThread={selectedSharedThread && selectedSharedThread.data}\n          subject={thread.subject}\n          participants={thread.participants}\n          commandControlShow={commandControlShow}\n          onActionClick={this.handleActionClick}\n          thread={thread}\n          showUnsubscribe={!!unsubscribeLink}\n          me={me}\n          lists={lists}\n          hideActions={hideActions}\n        />\n        {!!selectedCalendarEvent && isOwner &&\n          selectedCalendarEvent.status !== CalendarEventStatus.Cancelled &&\n          <CalendarInviteBar thread={thread} />}\n        {!!followUp && !hasOptimistic && <div className=\"follow-up-reminder\">\n          <div className=\"text\">\n            Remind me if no response by {followUp}\n          </div>\n          <HoverTip\n            bottom=\"-30px\"\n            right=\"5px\"\n            copy=\"Remove reminder\"\n            hotkeyAction={HotkeyAction.CancelFollowup}\n          >\n            <button className=\"remove\" onClick={this.handleRemoveFollowUpReminder}>\n              Remove reminder\n              <Close width=\"8px\" height=\"8px\" />\n            </button>\n          </HoverTip>\n        </div>}\n        <div className=\"thread-detail-table\"\n          style={{ visibility: scrolled ? 'visible' : 'hidden' }}>\n          {cells.map((cell) => {\n            if (cell.type === CellType.Message) {\n              if (findIndex(thread.messages, { id: (cell.data as Message).id }) === -1) {\n                return null;\n              }\n              return this.renderCell((cell.data as Message).id);\n            }\n\n            if (cell.type === CellType.Task) {\n              return this.renderTask(cell);\n            }\n\n            if (cell.type === CellType.Typing) {\n              return this.renderTyping(cell);\n            }\n\n            if (cell.type === CellType.Draft) {\n              return this.renderSharedDraftCell();\n            }\n\n            return this.renderComment(cell);\n          })}\n        </div>\n        <UndoSendPopup />\n        {this.renderComposer()}\n      </div>\n    );\n  }\n}\n\nexport default ThreadDetail;\n"]}]}