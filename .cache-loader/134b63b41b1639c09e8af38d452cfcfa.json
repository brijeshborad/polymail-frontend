{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/billing.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/billing.ts","mtime":1675280254054},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnOwppbXBvcnQgYnJvd3Nlckhpc3RvcnkgZnJvbSAnQHNyYy9saWIvYnJvd3Nlckhpc3RvcnknOwppbXBvcnQgeyBBY3Rpb25TdGF0dXMgfSBmcm9tICdAc3JjL3R5cGVzJzsKaW1wb3J0IHsgQ291cG9uVHlwZSB9IGZyb20gJ0BzcmMvdHlwZXMvYmlsbGluZyc7CmltcG9ydCB7IHRvYXN0U2V0IH0gZnJvbSAnQHNyYy9kdWNrcy90b2FzdHMnOwppbXBvcnQgeyBCSUxMSU5HX0ZFVENILCBiaWxsaW5nRmV0Y2gsIEJJTExJTkdfQ1JFQVRFLCBiaWxsaW5nQ3JlYXRlLCBCSUxMSU5HX1VQREFURSwgYmlsbGluZ1VwZGF0ZSwgQklMTElOR19DQU5DRUwsIGJpbGxpbmdDYW5jZWwsIEJJTExJTkdfVVBEQVRFX0NBUkQsIGJpbGxpbmdVcGRhdGVDYXJkLCBCSUxMSU5HX0NBTkNFTExBVElPTl9GRUVEQkFDSywgYmlsbGluZ0NhbmNlbGxhdGlvbkZlZWRiYWNrLCBCSUxMSU5HX0NPVVBPTl9WQUxJREFURSwgYmlsbGluZ0NvdXBvblZhbGlkYXRlLCBCSUxMSU5HX1VQR1JBREVfQ09VUE9OX1NFVCwgYmlsbGluZ0NvdXBvbktleSwgfSBmcm9tICdAc3JjL2R1Y2tzL2JpbGxpbmcnOwppbXBvcnQgeyByZWNvcmRHQUV2ZW50LCByZWNvcmRGQkV2ZW50IH0gZnJvbSAnQHNyYy9saWIvYW5hbHl0aWNzJzsKaW1wb3J0IHsgdGVhbUZldGNoIH0gZnJvbSAnQHNyYy9kdWNrcy90ZWFtJzsKaW1wb3J0IHsgbWVGZXRjaCB9IGZyb20gJ0BzcmMvZHVja3MvbWUnOwp2YXIgZmV0Y2ggPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUsIGRlcHMpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShCSUxMSU5HX0ZFVENIKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5iaWxsaW5nLmdldCgpCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGJpbGxpbmcpIHsgcmV0dXJuIGJpbGxpbmdGZXRjaChhY3Rpb24ubWV0YSwgYmlsbGluZyk7IH0pCiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gT2JzZXJ2YWJsZS5vZihiaWxsaW5nRmV0Y2goYWN0aW9uLm1ldGEsIGUpKTsgfSk7CiAgICB9KTsKfTsKdmFyIGNyZWF0ZSA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEJJTExJTkdfQ1JFQVRFKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5iaWxsaW5nLmNyZWF0ZShhY3Rpb24ubWV0YSkKICAgICAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGJpbGxpbmcpIHsKICAgICAgICAgICAgdmFyIF9hOwogICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5tZXJnZSgKICAgICAgICAgICAgLy8gSWYgdGhlIGJpbGxpbmcgY3JlYXRpb24gd2FzIHN1Y2Nlc3NmdWwsIHdlIG5lZWQgdG8gZmV0Y2ggdGhlIHRlYW0gYW5kIG1lCiAgICAgICAgICAgIC8vIHJlbW92ZSBhbnkgZXhpc3RpbmcgY291cG9uCiAgICAgICAgICAgIE9ic2VydmFibGUub2YobWVGZXRjaChDb3Vwb25UeXBlLlJlbW92ZSkpLCBPYnNlcnZhYmxlLm9mKHRlYW1GZXRjaCgoKF9hID0gc3RvcmUuZ2V0U3RhdGUoKS50ZWFtLmRhdGEpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCkgfHwgJycpKSwgT2JzZXJ2YWJsZS5vZihiaWxsaW5nQ3JlYXRlKGFjdGlvbi5tZXRhLCBiaWxsaW5nKSkpOwogICAgICAgIH0pCiAgICAgICAgICAgIC5kbyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJlY29yZEdBRXZlbnQoJ2JpbGxpbmcnLCAnY3JlYXRlJyk7CiAgICAgICAgICAgIHJlY29yZEZCRXZlbnQoJ3RyYWNrJywgJ1N1YnNjcmliZScpOwogICAgICAgICAgICBicm93c2VySGlzdG9yeS5wdXNoKGFjdGlvbi5tZXRhLm5hdmlnYXRlVG8gfHwgJy9zZXR0aW5ncy9iaWxsaW5nJyk7CiAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKGJpbGxpbmdDcmVhdGUoYWN0aW9uLm1ldGEsIGUpKTsgfSk7CiAgICB9KTsKfTsKdmFyIHVwZGF0ZSA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEJJTExJTkdfVVBEQVRFKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5iaWxsaW5nLnVwZGF0ZShhY3Rpb24ubWV0YSkKICAgICAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGJpbGxpbmcpIHsKICAgICAgICAgICAgdmFyIF9hOwogICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5tZXJnZShPYnNlcnZhYmxlLm9mKHRlYW1GZXRjaCgoKF9hID0gc3RvcmUuZ2V0U3RhdGUoKS50ZWFtLmRhdGEpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pZCkgfHwgJycpKSwgT2JzZXJ2YWJsZS5vZihiaWxsaW5nVXBkYXRlKGFjdGlvbi5tZXRhLCBiaWxsaW5nKSkpOwogICAgICAgIH0pCiAgICAgICAgICAgIC5kbyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJlY29yZEdBRXZlbnQoJ2JpbGxpbmcnLCAndXBkYXRlJyk7CiAgICAgICAgICAgIHJlY29yZEZCRXZlbnQoJ3RyYWNrQ3VzdG9tJywgJ1VwZGF0ZUJpbGxpbmcnKTsKICAgICAgICAgICAgYnJvd3Nlckhpc3RvcnkucHVzaCgnL3NldHRpbmdzL2JpbGxpbmcnKTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZihiaWxsaW5nVXBkYXRlKGFjdGlvbi5tZXRhLCBlKSksIE9ic2VydmFibGUub2YodG9hc3RTZXQoZSkpKTsgfSk7CiAgICB9KTsKfTsKdmFyIHVwZGF0ZUNhcmQgPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUsIGRlcHMpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShCSUxMSU5HX1VQREFURV9DQVJEKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5iaWxsaW5nLnVwZGF0ZUNhcmQoYWN0aW9uLm1ldGEpCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHBheWxvYWQpIHsgcmV0dXJuIGJpbGxpbmdVcGRhdGVDYXJkKGFjdGlvbi5tZXRhLCBwYXlsb2FkKTsgfSkKICAgICAgICAgICAgLmRvKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJyb3dzZXJIaXN0b3J5LnB1c2goJy9zZXR0aW5ncy9iaWxsaW5nJyk7IH0pCiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAvLyBIQUNLIChmZXIpOiBXZSBuZWVkIHRvIGRvIHRoaXMgYmVjYXVzZSB0aGUgc3RyaXBlIEFQSSByZXR1cm5zIGEgc3RyaW5nCiAgICAgICAgICAgIC8vIGluIHRoZSBlcnJvciBtZXNzYWdlIHRoYXQgaXMgdGhlIHN0cmluZ2lmaWVkIGVycm9yIG9iamVjdC4KICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9ICdFcnJvciB1cGRhdGluZyBjYXJkJzsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IEpTT04ucGFyc2UoZS5tZXNzYWdlKS5tZXNzYWdlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAvLyBrZWVwIHRoZSBkZWZhdWx0IG1lc3NhZ2UKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5tZXJnZShPYnNlcnZhYmxlLm9mKGJpbGxpbmdVcGRhdGVDYXJkKGFjdGlvbi5tZXRhLCBlKSksIE9ic2VydmFibGUub2YodG9hc3RTZXQobmV3IEVycm9yKGVycm9yTWVzc2FnZSkpKSk7CiAgICAgICAgfSk7CiAgICB9KTsKfTsKdmFyIGNhbmNlbCA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEJJTExJTkdfQ0FOQ0VMKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5iaWxsaW5nLmNhbmNlbCgpCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGJpbGxpbmcpIHsgcmV0dXJuIGJpbGxpbmdDYW5jZWwobnVsbCwgYmlsbGluZyk7IH0pCiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gT2JzZXJ2YWJsZS5tZXJnZShPYnNlcnZhYmxlLm9mKGJpbGxpbmdDYW5jZWwobnVsbCwgZSkpLCBPYnNlcnZhYmxlLm9mKHRvYXN0U2V0KGUpKSk7IH0pOwogICAgfSk7Cn07CnZhciBjYW5jZWxsYXRpb25GZWVkYmFjayA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEJJTExJTkdfQ0FOQ0VMTEFUSU9OX0ZFRURCQUNLKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5iaWxsaW5nLmNhbmNlbGxhdGlvbkZlZWRiYWNrKGFjdGlvbi5tZXRhKQogICAgICAgICAgICAubWFwKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGJpbGxpbmdDYW5jZWxsYXRpb25GZWVkYmFjayhhY3Rpb24ubWV0YSwgbnVsbCk7IH0pCiAgICAgICAgICAgIC5kbyhmdW5jdGlvbiAoKSB7IHJldHVybiBicm93c2VySGlzdG9yeS5wdXNoKCcvc2V0dGluZ3MvYmlsbGluZycpOyB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZihiaWxsaW5nQ2FuY2VsbGF0aW9uRmVlZGJhY2soYWN0aW9uLm1ldGEsIGUpKSwgT2JzZXJ2YWJsZS5vZih0b2FzdFNldChlKSkpOyB9KTsKICAgIH0pOwp9Owp2YXIgdHJpZ2dlclZhbGlkYXRlQ291cG9uID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoQklMTElOR19VUEdSQURFX0NPVVBPTl9TRVQpCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgdmFyIGNvdXBvbiA9IHN0b3JlLmdldFN0YXRlKCkuYmlsbGluZy5jb3Vwb25zW2JpbGxpbmdDb3Vwb25LZXkoYWN0aW9uLm1ldGEpXTsKICAgICAgICB2YXIgaGF2ZUNvdXBvbiA9IGNvdXBvbiAmJiBjb3Vwb24uZGF0YTsKICAgICAgICByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0ICYmICFoYXZlQ291cG9uOwogICAgfSkKICAgICAgICAuZGVib3VuY2VUaW1lKDcwMCwgZGVwcy5zY2hlZHVsZXIpCiAgICAgICAgLm1hcChmdW5jdGlvbiAoYWN0aW9uKSB7IHJldHVybiBiaWxsaW5nQ291cG9uVmFsaWRhdGUoYWN0aW9uLm1ldGEpOyB9KTsKfTsKdmFyIHZhbGlkYXRlQ291cG9uID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoQklMTElOR19DT1VQT05fVkFMSURBVEUpCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWN0aW9uKSB7IHJldHVybiBhY3Rpb24uc3RhdHVzID09PSBBY3Rpb25TdGF0dXMuU3RhcnQ7IH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBkZXBzLmJpbGxpbmcudmFsaWRhdGVDb3Vwb24oYWN0aW9uLm1ldGEpCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGNvdXBvbikgeyByZXR1cm4gYmlsbGluZ0NvdXBvblZhbGlkYXRlKGFjdGlvbi5tZXRhLCBjb3Vwb24pOyB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE9ic2VydmFibGUub2YoYmlsbGluZ0NvdXBvblZhbGlkYXRlKGFjdGlvbi5tZXRhLCBlKSk7IH0pOwogICAgfSk7Cn07CmV4cG9ydCBkZWZhdWx0IFsKICAgIGZldGNoLAogICAgY3JlYXRlLAogICAgdXBkYXRlLAogICAgdXBkYXRlQ2FyZCwKICAgIGNhbmNlbCwKICAgIGNhbmNlbGxhdGlvbkZlZWRiYWNrLAogICAgdHJpZ2dlclZhbGlkYXRlQ291cG9uLAogICAgdmFsaWRhdGVDb3Vwb24sCl07Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/billing.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/billing.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable } from 'rxjs';\nimport { Epic } from 'redux-observable';\n\nimport browserHistory from '@src/lib/browserHistory';\n\nimport { Partial, StoreState, Action, ActionStatus } from '@src/types';\nimport { Billing, BillingSubscription, BillingCouponKey, BillingCoupon, CouponType } from '@src/types/billing';\n\nimport { Deps } from '@src/lib/epic';\n\nimport { toastSet } from '@src/ducks/toasts';\n\nimport {\n  BILLING_FETCH, billingFetch,\n  BILLING_CREATE, billingCreate,\n  BILLING_UPDATE, billingUpdate,\n  BILLING_CANCEL, billingCancel,\n  BILLING_UPDATE_CARD, billingUpdateCard,\n  BILLING_CANCELLATION_FEEDBACK, billingCancellationFeedback,\n  BILLING_COUPON_VALIDATE, billingCouponValidate, BILLING_UPGRADE_COUPON_SET, billingCouponKey,\n} from '@src/ducks/billing';\n\nimport { BillingCreateBody, BillingCancellationFeedbackBody } from '@src/api/billing';\nimport { recordGAEvent, recordFBEvent } from '@src/lib/analytics';\nimport { teamFetch } from '@src/ducks/team';\nimport { TeamBody } from '@src/api/team';\nimport { meFetch } from '@src/ducks/me';\nimport { MeBody } from '@src/api/me';\n\nconst fetch: Epic<Action<null, Billing>, StoreState, Deps> = (action$, store, deps) =>\n  action$.ofType(BILLING_FETCH)\n    .filter(action => action.status === ActionStatus.Start)\n    .flatMap(action =>\n      deps.billing.get()\n        .map(billing => billingFetch(action.meta, billing))\n        .catch((e: Error) => Observable.of(billingFetch(action.meta, e))),\n    );\n\nconst create: Epic<\nAction<BillingCreateBody|Error|string|null, Billing|null|TeamBody|MeBody>,\nStoreState,\nDeps\n> =\n  (action$, store, deps) =>\n    action$.ofType(BILLING_CREATE)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<BillingCreateBody, Billing>) =>\n        deps.billing.create(action.meta)\n          .flatMap(billing => Observable.merge(\n            // If the billing creation was successful, we need to fetch the team and me\n            // remove any existing coupon\n            Observable.of(meFetch(CouponType.Remove)),\n            Observable.of(teamFetch(store.getState().team.data?.id || '')),\n            Observable.of(billingCreate(action.meta, billing))),\n          )\n          .do(() => {\n            recordGAEvent('billing', 'create');\n            recordFBEvent('track', 'Subscribe');\n            browserHistory.push(action.meta.navigateTo || '/settings/billing');\n          })\n          .catch((e: Error) => Observable.of(billingCreate(action.meta, e))),\n      );\n\nconst update: Epic<\n  Action<Partial<BillingSubscription>|Error|null|string, Billing|null|TeamBody\n>, StoreState, Deps> =\n  (action$, store, deps) =>\n    action$.ofType(BILLING_UPDATE)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<Partial<BillingSubscription>, Billing>) =>\n        deps.billing.update(action.meta)\n          .flatMap(billing => Observable.merge(\n            Observable.of(teamFetch(store.getState().team.data?.id || '')),\n            Observable.of(billingUpdate(action.meta, billing))),\n          )\n          .do(() => {\n            recordGAEvent('billing', 'update');\n            recordFBEvent('trackCustom', 'UpdateBilling');\n            browserHistory.push('/settings/billing');\n          })\n          .catch((e: Error) => Observable.merge(\n            Observable.of(billingUpdate(action.meta, e)),\n            Observable.of(toastSet(e)),\n          )),\n      );\n\nconst updateCard: Epic<Action<string|Error|null, Billing|null>, StoreState, Deps> =\n  (action$, store, deps) =>\n    action$.ofType(BILLING_UPDATE_CARD)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<string, Billing>) =>\n        deps.billing.updateCard(action.meta)\n          .map(payload => billingUpdateCard(action.meta, payload))\n          .do(() => browserHistory.push('/settings/billing'))\n          .catch((e: Error) => {\n            // HACK (fer): We need to do this because the stripe API returns a string\n            // in the error message that is the stringified error object.\n            let errorMessage: string = 'Error updating card';\n            try {\n              errorMessage = JSON.parse(e.message).message;\n            } catch (e) {\n              // keep the default message\n            }\n\n            return Observable.merge(\n              Observable.of(billingUpdateCard(action.meta, e)),\n              Observable.of(toastSet(new Error(errorMessage))),\n            );\n          }),\n      );\n\nconst cancel: Epic<Action<null|Error, Billing|null>, StoreState, Deps> =\n  (action$, store, deps) =>\n    action$.ofType(BILLING_CANCEL)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap(action =>\n        deps.billing.cancel()\n          .map(billing => billingCancel(null, billing))\n          .catch((e: Error) => Observable.merge(\n            Observable.of(billingCancel(null, e)),\n            Observable.of(toastSet(e)),\n          )),\n      );\n\nconst cancellationFeedback: Epic<\n  Action<BillingCancellationFeedbackBody|Error|null, null>, StoreState, Deps\n> = (action$, store, deps) =>\n  action$.ofType(BILLING_CANCELLATION_FEEDBACK)\n    .filter(action => action.status === ActionStatus.Start)\n    .flatMap((action: Action <BillingCancellationFeedbackBody, null>) =>\n      deps.billing.cancellationFeedback(action.meta)\n        .map(() => billingCancellationFeedback(action.meta, null))\n        .do(() => browserHistory.push('/settings/billing'))\n        .catch((e: Error) => Observable.merge(\n          Observable.of(billingCancellationFeedback(action.meta, e)),\n          Observable.of(toastSet(e)),\n        )),\n    );\n\nconst triggerValidateCoupon: Epic<Action<BillingCouponKey, BillingCoupon|null>, StoreState, Deps> =\n    (action$, store, deps) =>\n      action$.ofType(BILLING_UPGRADE_COUPON_SET)\n        .filter((action) => {\n          const coupon = store.getState().billing.coupons[billingCouponKey(action.meta)];\n          const haveCoupon = coupon && coupon.data;\n          return action.status === ActionStatus.Start && !haveCoupon;\n        })\n        .debounceTime(700, deps.scheduler)\n        .map(action => billingCouponValidate(action.meta));\n\nconst validateCoupon: Epic<Action<BillingCouponKey, BillingCoupon>, StoreState, Deps> =\n    (action$, store, deps) =>\n      action$.ofType(BILLING_COUPON_VALIDATE)\n        .filter(action => action.status === ActionStatus.Start)\n        .flatMap(action =>\n          deps.billing.validateCoupon(action.meta)\n            .map(coupon => billingCouponValidate(action.meta, coupon))\n            .catch(e => Observable.of(billingCouponValidate(action.meta, e))),\n        );\n\nexport default [\n  fetch,\n  create,\n  update,\n  updateCard,\n  cancel,\n  cancellationFeedback,\n  triggerValidateCoupon,\n  validateCoupon,\n];\n"]}]}