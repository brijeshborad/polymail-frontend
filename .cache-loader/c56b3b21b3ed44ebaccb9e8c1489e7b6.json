{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/cookies.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/cookies.ts","mtime":1675280254062},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IENvb2tpZXMgZnJvbSAnanMtY29va2llJzsKaW1wb3J0IHsgZ2V0Q29va2llRG9tYWluIH0gZnJvbSAnQHNyYy9hcGkvYmFzZSc7CmltcG9ydCB7IFRva2VuVHlwZSB9IGZyb20gJ0BzcmMvYXBpL2F1dGgnOwpleHBvcnQgdmFyIFNUQU5EQVJEX0NPT0tJRV9BVFRSSUJVVEVTID0gewogICAgcGF0aDogJy8nLAogICAgZG9tYWluOiBnZXRDb29raWVEb21haW4oKSwKICAgIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdkZXZlbG9wbWVudCcgPyB0cnVlIDogZmFsc2UsCiAgICBzYW1lU2l0ZTogJ2xheCcsCn07CmV4cG9ydCBmdW5jdGlvbiBkZWxldGVBdXRoQ29va2llKCkgewogICAgQ29va2llcy5yZW1vdmUocHJvY2Vzcy5lbnYuQ09PS0lFX05BTUUsIHsKICAgICAgICBwYXRoOiAnLycsCiAgICAgICAgZG9tYWluOiBnZXRDb29raWVEb21haW4oKSwKICAgICAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAnZGV2ZWxvcG1lbnQnID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgIHNhbWVTaXRlOiAnbGF4JywKICAgIH0pOwp9CmV4cG9ydCBmdW5jdGlvbiBkZWxldGVURkFOZWVkZWRDb29raWUoKSB7CiAgICBDb29raWVzLnJlbW92ZSh0ZmFDb29raWVOYW1lKCksIHsKICAgICAgICBwYXRoOiAnLycsCiAgICAgICAgZG9tYWluOiBnZXRDb29raWVEb21haW4oKSwKICAgICAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAnZGV2ZWxvcG1lbnQnID8gdHJ1ZSA6IGZhbHNlLAogICAgICAgIHNhbWVTaXRlOiAnbGF4JywKICAgIH0pOwp9CmV4cG9ydCBmdW5jdGlvbiBzZXRBdXRoQ29va2llKHRva2VuKSB7CiAgICB2YXIgZXhwaXJlczsKICAgIC8vIFdhbnQgbGltaXRlZCBjb29raWUgdG8gYmUgYSBzZXNzaW9uIGNvb2tpZQogICAgaWYgKHRva2VuLmV4cGlyZXMgJiYgdG9rZW4udHlwZSAhPT0gVG9rZW5UeXBlLkxpbWl0ZWQpIHsKICAgICAgICBleHBpcmVzID0gbmV3IERhdGUodG9rZW4uZXhwaXJlcyk7CiAgICB9CiAgICBDb29raWVzLnNldChwcm9jZXNzLmVudi5DT09LSUVfTkFNRSwgdG9rZW4udG9rZW4sIHsKICAgICAgICBwYXRoOiAnLycsCiAgICAgICAgZG9tYWluOiBnZXRDb29raWVEb21haW4oKSwKICAgICAgICBleHBpcmVzOiBleHBpcmVzLAogICAgICAgIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdkZXZlbG9wbWVudCcgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgc2FtZVNpdGU6ICdsYXgnLAogICAgfSk7CiAgICAvLyBIYW5kbGUgVEZBIGRldGVjdGlvbgogICAgaWYgKHRva2VuLnR5cGUgPT09IFRva2VuVHlwZS5CYXNpYykgewogICAgICAgIENvb2tpZXMuc2V0KHRmYUNvb2tpZU5hbWUoKSwgJ3RydWUnLCB7CiAgICAgICAgICAgIHBhdGg6ICcvJywKICAgICAgICAgICAgZG9tYWluOiBnZXRDb29raWVEb21haW4oKSwKICAgICAgICAgICAgZXhwaXJlczogZXhwaXJlcywKICAgICAgICAgICAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ2RldmVsb3BtZW50JyA/IHRydWUgOiBmYWxzZSwKICAgICAgICAgICAgc2FtZVNpdGU6ICdsYXgnLAogICAgICAgIH0pOwogICAgfQp9CmZ1bmN0aW9uIHRmYUNvb2tpZU5hbWUoKSB7CiAgICByZXR1cm4gcHJvY2Vzcy5lbnYuQ09PS0lFX05BTUUgKyAnVEZBTmVlZGVkJzsKfQpleHBvcnQgZnVuY3Rpb24gZ2V0QXV0aFRva2VuRnJvbUNvb2tpZSgpIHsKICAgIHJldHVybiBDb29raWVzLmdldChwcm9jZXNzLmVudi5DT09LSUVfTkFNRSk7Cn0KZXhwb3J0IGZ1bmN0aW9uIGdldE5lZWRzVEZBRnJvbUNvb2tpZSgpIHsKICAgIHJldHVybiBDb29raWVzLmdldCh0ZmFDb29raWVOYW1lKCkpID09PSAndHJ1ZSc7Cn0K"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/cookies.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/cookies.ts"],"names":[],"mappings":"AAAA,OAAO,OAA6B,MAAM,WAAW,CAAC;AACtD,OAAO,EAAE,eAAe,EAAE,MAAM,eAAe,CAAC;AAChD,OAAO,EAAE,SAAS,EAAS,MAAM,eAAe,CAAC;AAEjD,MAAM,CAAC,IAAM,0BAA0B,GAAqB;IAC1D,IAAI,EAAE,GAAG;IACT,MAAM,EAAE,eAAe,EAAE;IACzB,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK;IAC7D,QAAQ,EAAE,KAAK;CAChB,CAAC;AAEF,MAAM,UAAU,gBAAgB;IAC9B,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,WAAY,EAAE;QACvC,IAAI,EAAE,GAAG;QACT,MAAM,EAAE,eAAe,EAAE;QACzB,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK;QAC7D,QAAQ,EAAE,KAAK;KACT,CAAC,CAAC;AACZ,CAAC;AAED,MAAM,UAAU,qBAAqB;IACnC,OAAO,CAAC,MAAM,CAAC,aAAa,EAAE,EAAE;QAC9B,IAAI,EAAE,GAAG;QACT,MAAM,EAAE,eAAe,EAAE;QACzB,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK;QAC7D,QAAQ,EAAE,KAAK;KACT,CAAC,CAAC;AACZ,CAAC;AAED,MAAM,UAAU,aAAa,CAAC,KAAY;IACxC,IAAI,OAAO,CAAC;IAEZ,6CAA6C;IAC7C,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,CAAC,OAAO,EAAE;QACrD,OAAO,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;KACnC;IAED,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,WAAY,EAAE,KAAK,CAAC,KAAK,EAAE;QACjD,IAAI,EAAE,GAAG;QACT,MAAM,EAAE,eAAe,EAAE;QACzB,OAAO,SAAA;QACP,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK;QAC7D,QAAQ,EAAE,KAAK;KACT,CAAC,CAAC;IAEV,uBAAuB;IACvB,IAAI,KAAK,CAAC,IAAI,KAAK,SAAS,CAAC,KAAK,EAAE;QAClC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,EAAE,MAAM,EAAE;YACnC,IAAI,EAAE,GAAG;YACT,MAAM,EAAE,eAAe,EAAE;YACzB,OAAO,SAAA;YACP,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK;YAC7D,QAAQ,EAAE,KAAK;SACT,CAAC,CAAC;KACX;AACH,CAAC;AAED,SAAS,aAAa;IACpB,OAAO,OAAO,CAAC,GAAG,CAAC,WAAY,GAAG,WAAW,CAAC;AAChD,CAAC;AAED,MAAM,UAAU,sBAAsB;IACpC,OAAO,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,WAAY,CAAC,CAAC;AAC/C,CAAC;AAED,MAAM,UAAU,qBAAqB;IACnC,OAAO,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC,KAAK,MAAM,CAAC;AACjD,CAAC","sourcesContent":["import Cookies, { CookieAttributes } from 'js-cookie';\nimport { getCookieDomain } from '@src/api/base';\nimport { TokenType, Token } from '@src/api/auth';\n\nexport const STANDARD_COOKIE_ATTRIBUTES: CookieAttributes = {\n  path: '/',\n  domain: getCookieDomain(),\n  secure: process.env.NODE_ENV !== 'development' ? true : false,\n  sameSite: 'lax',\n};\n\nexport function deleteAuthCookie() {\n  Cookies.remove(process.env.COOKIE_NAME!, {\n    path: '/',\n    domain: getCookieDomain(),\n    secure: process.env.NODE_ENV !== 'development' ? true : false,\n    sameSite: 'lax',\n  } as any);\n}\n\nexport function deleteTFANeededCookie() {\n  Cookies.remove(tfaCookieName(), {\n    path: '/',\n    domain: getCookieDomain(),\n    secure: process.env.NODE_ENV !== 'development' ? true : false,\n    sameSite: 'lax',\n  } as any);\n}\n\nexport function setAuthCookie(token: Token) {\n  let expires;\n\n  // Want limited cookie to be a session cookie\n  if (token.expires && token.type !== TokenType.Limited) {\n    expires = new Date(token.expires);\n  }\n\n  Cookies.set(process.env.COOKIE_NAME!, token.token, {\n    path: '/',\n    domain: getCookieDomain(),\n    expires,\n    secure: process.env.NODE_ENV !== 'development' ? true : false,\n    sameSite: 'lax',\n  } as any);\n\n  // Handle TFA detection\n  if (token.type === TokenType.Basic) {\n    Cookies.set(tfaCookieName(), 'true', {\n      path: '/',\n      domain: getCookieDomain(),\n      expires,\n      secure: process.env.NODE_ENV !== 'development' ? true : false,\n      sameSite: 'lax',\n    } as any);\n  }\n}\n\nfunction tfaCookieName(): string {\n  return process.env.COOKIE_NAME! + 'TFANeeded';\n}\n\nexport function getAuthTokenFromCookie(): string|undefined {\n  return Cookies.get(process.env.COOKIE_NAME!);\n}\n\nexport function getNeedsTFAFromCookie(): boolean {\n  return Cookies.get(tfaCookieName()) === 'true';\n}\n"]}]}