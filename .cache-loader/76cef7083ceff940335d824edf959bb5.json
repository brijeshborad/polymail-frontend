{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/sync/TemplateSync.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/sync/TemplateSync.ts","mtime":1675280254126},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CmltcG9ydCB7IFN0b3JlcyB9IGZyb20gJ0BzcmMvbGliL2RiJzsKaW1wb3J0IHsgVGVtcGxhdGVDbGllbnQgfSBmcm9tICdAc3JjL2FwaS90ZW1wbGF0ZXMnOwppbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7CmltcG9ydCB7IEFQSVN5bmMgfSBmcm9tICcuL0FQSVN5bmMnOwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7CmltcG9ydCB7IHNlbmRUZW1wbGF0ZVVwZGF0ZWQgfSBmcm9tICdAc3JjL3dvcmtlci9icmlkZ2Uvd29ya2VyRXZlbnRzJzsKdmFyIFRlbXBsYXRlU3luYyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKICAgIF9fZXh0ZW5kcyhUZW1wbGF0ZVN5bmMsIF9zdXBlcik7CiAgICAvLyAtIGFwcCBicmlkZ2UgaW50ZXJmYWNlCiAgICBmdW5jdGlvbiBUZW1wbGF0ZVN5bmModGVhbSwgYXBpKSB7CiAgICAgICAgaWYgKGFwaSA9PT0gdm9pZCAwKSB7IGFwaSA9IG5ldyBUZW1wbGF0ZUNsaWVudCgpOyB9CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICBpZiAodGVhbSAmJiB0ZWFtICE9PSAnJykgewogICAgICAgICAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICdUZW1wbGF0ZVN5bmMtJyArIHRlYW0sIFN0b3Jlcy5UZW1wbGF0ZXMsIGZhbHNlKSB8fCB0aGlzOwogICAgICAgICAgICBfdGhpcy50ZWFtID0gdGVhbTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgJ1RlbXBsYXRlU3luYycsIFN0b3Jlcy5UZW1wbGF0ZXMsIGZhbHNlKSB8fCB0aGlzOwogICAgICAgIH0KICAgICAgICBfdGhpcy5hcGkgPSBhcGk7CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgfQogICAgVGVtcGxhdGVTeW5jLnByb3RvdHlwZS5mZXRjaE5leHRQYWdlID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLnRlYW0pIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXBpLmxpc3RCeVRlYW0odGhpcy50ZWFtLCB0aGlzLm9mZnNldCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmFwaS5saXN0KHRoaXMub2Zmc2V0KTsKICAgIH07CiAgICBUZW1wbGF0ZVN5bmMucHJvdG90eXBlLm5leHRQYWdlT2Zmc2V0ID0gZnVuY3Rpb24gKG1vZGVscykgewogICAgICAgIHJldHVybiBtb21lbnQobW9kZWxzW21vZGVscy5sZW5ndGggLSAxXS51cGRhdGVkKS50b0lTT1N0cmluZygpOwogICAgfTsKICAgIFRlbXBsYXRlU3luYy5wcm90b3R5cGUub25TYXZlID0gZnVuY3Rpb24gKG1vZGVscykgewogICAgICAgIG1vZGVscy5mb3JFYWNoKGZ1bmN0aW9uIChtb2RlbCkgeyByZXR1cm4gc2VuZFRlbXBsYXRlVXBkYXRlZChtb2RlbCk7IH0pOwogICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKG51bGwpOwogICAgfTsKICAgIHJldHVybiBUZW1wbGF0ZVN5bmM7Cn0oQVBJU3luYykpOwpleHBvcnQgeyBUZW1wbGF0ZVN5bmMgfTsKZXhwb3J0IGRlZmF1bHQgVGVtcGxhdGVTeW5jOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/sync/TemplateSync.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/sync/TemplateSync.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AAErC,OAAO,EAAe,cAAc,EAAE,MAAM,oBAAoB,CAAC;AACjE,OAAO,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AAClC,OAAO,EAAE,OAAO,EAAE,MAAM,WAAW,CAAC;AACpC,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,mBAAmB,EAAE,MAAM,iCAAiC,CAAC;AAEtE;IAAkC,gCAAiB;IAMjD,yBAAyB;IAEzB,sBACE,IAAa,EACb,GAAuC;QAAvC,oBAAA,EAAA,UAAuB,cAAc,EAAE;QAFzC,iBAWC;QAPC,IAAI,IAAI,IAAI,IAAI,KAAK,EAAE,EAAE;YACvB,QAAA,kBAAM,eAAe,GAAG,IAAI,EAAE,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,SAAC;YACvD,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC;SAClB;aAAM;YACL,QAAA,kBAAM,cAAc,EAAE,MAAM,CAAC,SAAS,EAAE,KAAK,CAAC,SAAC;SAChD;QACD,KAAI,CAAC,GAAG,GAAG,GAAG,CAAC;;IACjB,CAAC;IAES,oCAAa,GAAvB;QACE,IAAI,IAAI,CAAC,IAAI,EAAE;YACb,OAAO,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;SACpD;QACD,OAAO,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACpC,CAAC;IAES,qCAAc,GAAxB,UAAyB,MAAkB;QACzC,OAAO,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC;IACjE,CAAC;IAES,6BAAM,GAAhB,UAAiB,MAAkB;QACjC,MAAM,CAAC,OAAO,CAAC,UAAA,KAAK,IAAI,OAAA,mBAAmB,CAAC,KAAK,CAAC,EAA1B,CAA0B,CAAC,CAAC;QACpD,OAAO,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IACH,mBAAC;AAAD,CAAC,AApCD,CAAkC,OAAO,GAoCxC;;AAED,eAAe,YAAY,CAAC","sourcesContent":["import { Stores } from '@src/lib/db';\nimport { Template } from '@src/types';\nimport { TemplateAPI, TemplateClient } from '@src/api/templates';\nimport { Observable } from 'rxjs';\nimport { APISync } from './APISync';\nimport moment from 'moment';\nimport { sendTemplateUpdated } from '@src/worker/bridge/workerEvents';\n\nexport class TemplateSync extends APISync<Template> {\n\n  // State\n\n  // Dependencies\n  private api: TemplateAPI;\n  // - app bridge interface\n\n  constructor(\n    team?: string,\n    api: TemplateAPI = new TemplateClient(),\n  ) {\n    if (team && team !== '') {\n      super('TemplateSync-' + team, Stores.Templates, false);\n      this.team = team;\n    } else {\n      super('TemplateSync', Stores.Templates, false);\n    }\n    this.api = api;\n  }\n\n  protected fetchNextPage(): Observable<Template[]> {\n    if (this.team) {\n      return this.api.listByTeam(this.team, this.offset);\n    }\n    return this.api.list(this.offset);\n  }\n\n  protected nextPageOffset(models: Template[]): string {\n    return moment(models[models.length - 1].updated).toISOString();\n  }\n\n  protected onSave(models: Template[]): Observable<null> {\n    models.forEach(model => sendTemplateUpdated(model));\n    return Observable.of(null);\n  }\n}\n\nexport default TemplateSync;\n"]}]}