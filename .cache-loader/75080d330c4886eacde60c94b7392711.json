{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/mailCountBot.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/mailCountBot.ts","mtime":1675280254124},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY2FwdHVyZUV4Y2VwdGlvbiB9IGZyb20gJ0BzZW50cnkvYnJvd3Nlcic7CmltcG9ydCB7IGdldEJ1cywgQnVzRXZlbnROYW1lIH0gZnJvbSAnQHNyYy93b3JrZXIvYnVzJzsKaW1wb3J0IHsgZ2V0TmV3TWFpbENvdW50LCBNQVhfTElTVF9DT1VOVCB9IGZyb20gJ0BzcmMvbGliL21vZGVscy9tYWlsQ291bnQnOwppbXBvcnQgeyBzZW5kTWFpbENvdW50VXBkYXRlZCB9IGZyb20gJy4vYnJpZGdlL3dvcmtlckV2ZW50cyc7CmltcG9ydCB7IHVuaXFCeSB9IGZyb20gJ2xvZGFzaCc7CmltcG9ydCB7IERvY2tDb3VudCwgTGVmdFNpZGViYXJDb3VudCB9IGZyb20gJ0BzcmMvdHlwZXMnOwpleHBvcnQgdmFyIE1haWxDb3VudFR5cGU7CihmdW5jdGlvbiAoTWFpbENvdW50VHlwZSkgewogICAgTWFpbENvdW50VHlwZVsiSW5ib3giXSA9ICJpbmJveCI7CiAgICBNYWlsQ291bnRUeXBlWyJMaXN0VW5yZWFkIl0gPSAibGlzdFVucmVhZCI7CiAgICBNYWlsQ291bnRUeXBlWyJMYXRlckNvdW50Il0gPSAibGF0ZXJDb3VudCI7CiAgICBNYWlsQ291bnRUeXBlWyJTdGFycmVkQ291bnQiXSA9ICJzdGFycmVkQ291bnQiOwogICAgTWFpbENvdW50VHlwZVsiRm9sbG93VXBDb3VudCJdID0gImZvbGxvd1VwQ291bnQiOwp9KShNYWlsQ291bnRUeXBlIHx8IChNYWlsQ291bnRUeXBlID0ge30pKTsKdmFyIE1haWxDb3VudEJvdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIE1haWxDb3VudEJvdCgpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlOwogICAgICAgIHRoaXMubGlzdHMgPSBbXTsKICAgICAgICB0aGlzLmlnbm9yZWRMaXN0cyA9IHt9OwogICAgICAgIHRoaXMucXVlcmllcyA9IFtdOwogICAgICAgIC8vIERlZmF1bHQgdG8gc2V0dGluZ3MgdGhhdCByZXN1bHQgaW4gbm8gb3B0aW1pemF0aW9ucwogICAgICAgIHRoaXMubGVmdFNpZGViYXJDb3VudCA9IExlZnRTaWRlYmFyQ291bnQuQWxsOwogICAgICAgIHRoaXMuZG9ja0NvdW50ID0gRG9ja0NvdW50LlVucmVhZDsKICAgICAgICAvLyBFbXB0eSBsaXN0IGRpY3Rpb25hcnkgZm9yIGFjY291bnQgKyBMaXN0UXVlcnkgKyBsaXN0CiAgICAgICAgLy8gb25seSByZXNldCB3aXRoIHVwZGF0ZXMgZnJvbSBUaHJlYWRTeW5jL0hpc3RvcnlTeW5jCiAgICAgICAgdGhpcy5lbXB0eUxpc3RIYXNoZXMgPSB7fTsKICAgICAgICB0aGlzLnJlc2V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5pZ25vcmVkTGlzdHMgPSB7fTsKICAgICAgICAgICAgX3RoaXMuZW1wdHlMaXN0SGFzaGVzID0ge307CiAgICAgICAgfTsKICAgICAgICB0aGlzLnVwZGF0ZVVucmVhZExpc3RIYXNoID0gZnVuY3Rpb24gKGFjY291bnQsIGxpc3QpIHsKICAgICAgICAgICAgdmFyIGhhc2ggPSBhY2NvdW50ICsgTWFpbENvdW50VHlwZS5MaXN0VW5yZWFkICsgbGlzdDsKICAgICAgICAgICAgZGVsZXRlIF90aGlzLmVtcHR5TGlzdEhhc2hlc1toYXNoXTsKICAgICAgICB9OwogICAgICAgIHRoaXMudXBkYXRlUHJlZmVyZW5jZXMgPSBmdW5jdGlvbiAobGVmdFNpZGViYXJDb3VudCwgZG9ja0NvdW50KSB7CiAgICAgICAgICAgIF90aGlzLmxlZnRTaWRlYmFyQ291bnQgPSBsZWZ0U2lkZWJhckNvdW50OwogICAgICAgICAgICBfdGhpcy5kb2NrQ291bnQgPSBkb2NrQ291bnQ7CiAgICAgICAgfTsKICAgICAgICB0aGlzLnNldFF1ZXJpZXMgPSBmdW5jdGlvbiAoYWNjb3VudCkgewogICAgICAgICAgICBfdGhpcy5xdWVyaWVzLnB1c2goewogICAgICAgICAgICAgICAgYWNjb3VudDogYWNjb3VudCwKICAgICAgICAgICAgICAgIHR5cGU6IE1haWxDb3VudFR5cGUuSW5ib3gsCiAgICAgICAgICAgICAgICBoYXNoOiBhY2NvdW50ICsgTWFpbENvdW50VHlwZS5JbmJveCwKICAgICAgICAgICAgICAgIHByaW9yaXR5OiAwLAogICAgICAgICAgICAgICAgbGVmdFNpZGViYXJDb3VudDogX3RoaXMubGVmdFNpZGViYXJDb3VudCwKICAgICAgICAgICAgICAgIGRvY2tDb3VudDogX3RoaXMuZG9ja0NvdW50LAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXMucXVlcmllcy5wdXNoKHsKICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY291bnQsCiAgICAgICAgICAgICAgICB0eXBlOiBNYWlsQ291bnRUeXBlLkxhdGVyQ291bnQsCiAgICAgICAgICAgICAgICBoYXNoOiBhY2NvdW50ICsgTWFpbENvdW50VHlwZS5MYXRlckNvdW50LAogICAgICAgICAgICAgICAgcHJpb3JpdHk6IDEsCiAgICAgICAgICAgICAgICBsZWZ0U2lkZWJhckNvdW50OiBfdGhpcy5sZWZ0U2lkZWJhckNvdW50LAogICAgICAgICAgICAgICAgZG9ja0NvdW50OiBfdGhpcy5kb2NrQ291bnQsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfdGhpcy5xdWVyaWVzLnB1c2goewogICAgICAgICAgICAgICAgYWNjb3VudDogYWNjb3VudCwKICAgICAgICAgICAgICAgIHR5cGU6IE1haWxDb3VudFR5cGUuU3RhcnJlZENvdW50LAogICAgICAgICAgICAgICAgaGFzaDogYWNjb3VudCArIE1haWxDb3VudFR5cGUuU3RhcnJlZENvdW50LAogICAgICAgICAgICAgICAgcHJpb3JpdHk6IDEsCiAgICAgICAgICAgICAgICBsZWZ0U2lkZWJhckNvdW50OiBfdGhpcy5sZWZ0U2lkZWJhckNvdW50LAogICAgICAgICAgICAgICAgZG9ja0NvdW50OiBfdGhpcy5kb2NrQ291bnQsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfdGhpcy5xdWVyaWVzLnB1c2goewogICAgICAgICAgICAgICAgYWNjb3VudDogYWNjb3VudCwKICAgICAgICAgICAgICAgIHR5cGU6IE1haWxDb3VudFR5cGUuRm9sbG93VXBDb3VudCwKICAgICAgICAgICAgICAgIGhhc2g6IGFjY291bnQgKyBNYWlsQ291bnRUeXBlLkZvbGxvd1VwQ291bnQsCiAgICAgICAgICAgICAgICBwcmlvcml0eTogMSwKICAgICAgICAgICAgICAgIGxlZnRTaWRlYmFyQ291bnQ6IF90aGlzLmxlZnRTaWRlYmFyQ291bnQsCiAgICAgICAgICAgICAgICBkb2NrQ291bnQ6IF90aGlzLmRvY2tDb3VudCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF90aGlzLmxpc3RzLmZvckVhY2goZnVuY3Rpb24gKGwpIHsKICAgICAgICAgICAgICAgIC8vIENoZWNrIGxpc3QgYmxvY2tsaXN0CiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaWdub3JlZExpc3RzW2xdKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGxpc3RRdWVyeSA9IHsKICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NvdW50LAogICAgICAgICAgICAgICAgICAgIHR5cGU6IE1haWxDb3VudFR5cGUuTGlzdFVucmVhZCwKICAgICAgICAgICAgICAgICAgICBoYXNoOiBhY2NvdW50ICsgTWFpbENvdW50VHlwZS5MaXN0VW5yZWFkICsgbCwKICAgICAgICAgICAgICAgICAgICBsaXN0OiBsLAogICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiAyLAogICAgICAgICAgICAgICAgICAgIGxlZnRTaWRlYmFyQ291bnQ6IF90aGlzLmxlZnRTaWRlYmFyQ291bnQsCiAgICAgICAgICAgICAgICAgICAgZG9ja0NvdW50OiBfdGhpcy5kb2NrQ291bnQsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgLy8gRG8gbm90IHJlZmV0Y2ggZm9yIGxpc3RzIHRoYXQgaGF2ZSBlbXB0eSBxdWVyeQogICAgICAgICAgICAgICAgaWYgKF90aGlzLmVtcHR5TGlzdEhhc2hlc1tsaXN0UXVlcnkuaGFzaF0pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfdGhpcy5xdWVyaWVzLnB1c2gobGlzdFF1ZXJ5KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGFuZCBzb3J0IGJ5IHByaW9yaXR5CiAgICAgICAgICAgIF90aGlzLnF1ZXJpZXMgPSB1bmlxQnkoX3RoaXMucXVlcmllcywgJ2hhc2gnKS5zb3J0KChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5wcmlvcml0eSAtIGIucHJpb3JpdHk7IH0pKTsKICAgICAgICB9OwogICAgICAgIHRoaXMuc2V0TGlzdHMgPSBmdW5jdGlvbiAobGlzdHMpIHsKICAgICAgICAgICAgX3RoaXMubGlzdHMgPSBsaXN0czsKICAgICAgICB9OwogICAgfQogICAgTWFpbENvdW50Qm90LnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIGdldEJ1cygpCiAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIGlmIChldmVudC5uYW1lID09PSBCdXNFdmVudE5hbWUudXBkYXRlTGlzdFVucmVhZENvdW50KSB7CiAgICAgICAgICAgICAgICBfdGhpcy51cGRhdGVVbnJlYWRMaXN0SGFzaChldmVudC5kYXRhLmFjY291bnRJZCwgZXZlbnQuZGF0YS5saXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZXZlbnQubmFtZSA9PT0gQnVzRXZlbnROYW1lLlVwZGF0ZU1haWxDb3VudCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0pCiAgICAgICAgICAgIC5idWZmZXJUaW1lKDEwMDApCiAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGV2ZW50cykgeyByZXR1cm4gZXZlbnRzLmxlbmd0aCA+IDA7IH0pCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGV2ZW50cykgewogICAgICAgICAgICBldmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICAgIF90aGlzLnNldFF1ZXJpZXMoZXZlbnQuZGF0YS5hY2NvdW50SWQpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICAgICAgICAuc3Vic2NyaWJlKHsKICAgICAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5ydW5uaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMucnVuKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgY2FwdHVyZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1jb25zb2xlCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfTsKICAgIE1haWxDb3VudEJvdC5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgICAgaWYgKHRoaXMucnVubmluZykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBxdWVyeSA9IHRoaXMucXVlcmllcy5zaGlmdCgpOwogICAgICAgIGlmIChxdWVyeSkgewogICAgICAgICAgICB0aGlzLnJ1bm5pbmcgPSB0cnVlOwogICAgICAgICAgICBnZXROZXdNYWlsQ291bnQocXVlcnkpCiAgICAgICAgICAgICAgICAuZGVsYXkoMjApCiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKHsKICAgICAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uIChwYXJ0aWFsTWFpbENvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChxdWVyeS50eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTWFpbENvdW50VHlwZS5MaXN0VW5yZWFkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGwgPSBxdWVyeS5saXN0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW5kTWFpbENvdW50VXBkYXRlZChxdWVyeS5hY2NvdW50LCBwYXJ0aWFsTWFpbENvdW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydGlhbE1haWxDb3VudC5saXN0c1VucmVhZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdENvdW50ID0gcGFydGlhbE1haWxDb3VudC5saXN0c1VucmVhZFtsXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RDb3VudCA+IE1BWF9MSVNUX0NPVU5UKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5pZ25vcmVkTGlzdHNbbF0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIGhhc2ggZm9yIGxpc3RzIHRoYXQgaGF2ZSAwIG1lc3NhZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsaXN0Q291bnQgPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVtcHR5TGlzdEhhc2hlc1txdWVyeS5oYXNoXSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNYWlsQ291bnRVcGRhdGVkKHF1ZXJ5LmFjY291bnQsIHBhcnRpYWxNYWlsQ291bnQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBfdGhpcy5ydW5uaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMucnVuKCk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMucnVubmluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGNhcHR1cmVFeGNlcHRpb24oZSk7CiAgICAgICAgICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWNvbnNvbGUKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgICAgICAgICAgICAgIF90aGlzLnF1ZXJpZXMucHVzaChxdWVyeSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwogICAgcmV0dXJuIE1haWxDb3VudEJvdDsKfSgpKTsKZXhwb3J0IHsgTWFpbENvdW50Qm90IH07Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/mailCountBot.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/mailCountBot.ts"],"names":[],"mappings":"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","sourcesContent":["import { captureException } from '@sentry/browser';\n\nimport { getBus, BusEventName } from '@src/worker/bus';\nimport { getNewMailCount, MAX_LIST_COUNT } from '@src/lib/models/mailCount';\nimport { sendMailCountUpdated } from './bridge/workerEvents';\nimport { uniqBy } from 'lodash';\nimport { DockCount, LeftSidebarCount } from '@src/types';\n\nexport interface MailCount {\n  inboxRead: number;\n  inboxUnread: number;\n  listsUnread: { [id: string]: number };\n  laterCount: number;\n  starredCount: number;\n  followUpCount: number;\n}\n\nexport const enum MailCountType {\n  Inbox = 'inbox',\n  ListUnread = 'listUnread',\n  LaterCount = 'laterCount',\n  StarredCount = 'starredCount',\n  FollowUpCount = 'followUpCount',\n}\n\nexport interface MailCountQuery {\n  account: string;\n  type: MailCountType;\n  hash: string;\n  list?: string;\n  priority: number;\n\n  // Used for optimizations around inbox counts\n  leftSidebarCount: LeftSidebarCount;\n  dockCount: DockCount;\n}\n\nexport class MailCountBot {\n  private running = false;\n  private lists: string[] = [];\n  private ignoredLists: { [listId: string]: boolean } = {};\n  private queries: MailCountQuery[] = [];\n\n  // Default to settings that result in no optimizations\n  private leftSidebarCount: LeftSidebarCount = LeftSidebarCount.All;\n  private dockCount: DockCount = DockCount.Unread;\n\n  // Empty list dictionary for account + ListQuery + list\n  // only reset with updates from ThreadSync/HistorySync\n  private emptyListHashes: { [hash: string]: boolean } = {};\n\n  start() {\n    getBus()\n      .filter((event) => {\n        if (event.name === BusEventName.updateListUnreadCount) {\n          this.updateUnreadListHash(event.data.accountId, event.data.list);\n        }\n\n        if (event.name === BusEventName.UpdateMailCount) {\n          return true;\n        }\n\n        return false;\n      })\n      .bufferTime(1000)\n      .filter(events => events.length > 0)\n      .map((events) => {\n        events.forEach((event) => {\n          this.setQueries(event.data.accountId);\n        });\n      })\n      .subscribe({\n        next: () => {\n          if (!this.running) {\n            this.run();\n          }\n        },\n        error: (e) => {\n          captureException(e);\n          // tslint:disable-next-line:no-console\n          console.error(e);\n        },\n      });\n  }\n\n  reset = () => {\n    this.ignoredLists = {};\n    this.emptyListHashes = {};\n  }\n\n  updateUnreadListHash = (account: string, list: string) => {\n    const hash = account + MailCountType.ListUnread + list;\n    delete this.emptyListHashes[hash];\n  }\n\n  updatePreferences = (leftSidebarCount: LeftSidebarCount, dockCount: DockCount) => {\n    this.leftSidebarCount = leftSidebarCount;\n    this.dockCount = dockCount;\n  }\n\n  setQueries = (account: string) => {\n\n    this.queries.push({\n      account,\n      type: MailCountType.Inbox,\n      hash: account + MailCountType.Inbox,\n      priority: 0,\n      leftSidebarCount: this.leftSidebarCount,\n      dockCount: this.dockCount,\n    });\n\n    this.queries.push({\n      account,\n      type: MailCountType.LaterCount,\n      hash: account + MailCountType.LaterCount,\n      priority: 1,\n      leftSidebarCount: this.leftSidebarCount,\n      dockCount: this.dockCount,\n    });\n\n    this.queries.push({\n      account,\n      type: MailCountType.StarredCount,\n      hash: account + MailCountType.StarredCount,\n      priority: 1,\n      leftSidebarCount: this.leftSidebarCount,\n      dockCount: this.dockCount,\n    });\n\n    this.queries.push({\n      account,\n      type: MailCountType.FollowUpCount,\n      hash: account + MailCountType.FollowUpCount,\n      priority: 1,\n      leftSidebarCount: this.leftSidebarCount,\n      dockCount: this.dockCount,\n    });\n\n    this.lists.forEach((l) => {\n      // Check list blocklist\n      if (this.ignoredLists[l]) {\n        return;\n      }\n\n      const listQuery = {\n        account,\n        type: MailCountType.ListUnread,\n        hash: account + MailCountType.ListUnread + l,\n        list: l,\n        priority: 2,\n        leftSidebarCount: this.leftSidebarCount,\n        dockCount: this.dockCount,\n      };\n\n      // Do not refetch for lists that have empty query\n      if (this.emptyListHashes[listQuery.hash]) {\n        return;\n      }\n\n      this.queries.push(listQuery);\n    });\n\n    // Remove duplicates and sort by priority\n    this.queries = uniqBy(this.queries, 'hash').sort(((a, b) => a.priority - b.priority));\n  }\n\n  setLists = (lists: string[]) => {\n    this.lists = lists;\n  }\n\n  private run() {\n    if (this.running) {\n      return;\n    }\n\n    const query = this.queries.shift();\n    if (query) {\n      this.running = true;\n\n      getNewMailCount(query)\n      .delay(20)\n      .subscribe({\n        next: (partialMailCount) => {\n          switch (query.type) {\n            case MailCountType.ListUnread:\n              const l = query.list;\n              if (l) {\n                sendMailCountUpdated(query.account, partialMailCount);\n                if (partialMailCount.listsUnread) {\n                  const listCount = partialMailCount.listsUnread[l];\n                  if (listCount > MAX_LIST_COUNT) {\n                    this.ignoredLists[l] = true;\n                  }\n\n                  // Create a hash for lists that have 0 messages\n                  if (listCount === 0) {\n                    this.emptyListHashes[query.hash] = true;\n                  }\n                }\n              }\n\n              break;\n            default:\n              sendMailCountUpdated(query.account, partialMailCount);\n          }\n\n          this.running = false;\n          this.run();\n        },\n        error: (e) => {\n          this.running = false;\n          captureException(e);\n          // tslint:disable-next-line:no-console\n          console.error(e);\n          this.queries.push(query);\n        },\n      });\n    }\n  }\n}\n"]}]}