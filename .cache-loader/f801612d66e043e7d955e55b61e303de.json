{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/referralInvites.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/referralInvites.ts","mtime":1675280254057},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgQWN0aW9uU3RhdHVzLCB9IGZyb20gJ0BzcmMvdHlwZXMnOwppbXBvcnQgeyBSRUZFUlJBTF9JTlZJVEVfQ1JFQVRFLCByZWZlcnJhbEludml0ZUNyZWF0ZSwgUkVGRVJSQUxfSU5WSVRFX0xJU1QsIHJlZmVycmFsSW52aXRlTGlzdCwgUkVGRVJSQUxfSU5WSVRFX1JFU0VORCwgfSBmcm9tICdAc3JjL2R1Y2tzL3JlZmVycmFsSW52aXRlcyc7CmltcG9ydCB7IHRvYXN0U2V0LCBDb25maXJtYXRpb25FcnJvciB9IGZyb20gJ0BzcmMvZHVja3MvdG9hc3RzJzsKaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBMT0NBVElPTl9DSEFOR0UgfSBmcm9tICdyZWFjdC1yb3V0ZXItcmVkdXgnOwppbXBvcnQgeyBBbXBsaXR1ZGVFdmVudHMsIGxvZ0FtcGxpdHVkZUV2ZW50IH0gZnJvbSAnQHNyYy9saWIvYW1wbGl0dWRlLWFuYWx5dGljcyc7CnZhciBsb2NhdGlvbkNoYW5nZVJlZmVycmFsSW52aXRlTGlzdCA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSkgewogICAgcmV0dXJuIGFjdGlvbiQKICAgICAgICAub2ZUeXBlKExPQ0FUSU9OX0NIQU5HRSkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICB2YXIgc3BsaXQgPSBhY3Rpb24ucGF5bG9hZC5wYXRobmFtZS5zcGxpdCgnLycpOwogICAgICAgIHJldHVybiBzcGxpdC5sZW5ndGggPiAyICYmIHNwbGl0WzJdID09PSAncmVmZXItZnJpZW5kcyc7CiAgICB9KQogICAgICAgIC5tYXAoZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVmZXJyYWxJbnZpdGVMaXN0KCcnKTsgfSk7Cn07CnZhciByZWZlcnJhbEludml0ZUNyZWF0ZUVwaWMgPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUsIGRlcHMpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShSRUZFUlJBTF9JTlZJVEVfQ1JFQVRFKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5yZWZlcnJhbEludml0ZXMuY3JlYXRlKGFjdGlvbi5tZXRhKQogICAgICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoaW52aXRlKSB7CiAgICAgICAgICAgIGxvZ0FtcGxpdHVkZUV2ZW50KEFtcGxpdHVkZUV2ZW50cy5SZWZlckZyaWVuZCwgeyBkZXRhaWxzOiAnU2VudCBJbnZpdGUgZnJvbSBlbWFpbCBpbnB1dCcgfSk7CiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKE9ic2VydmFibGUub2YocmVmZXJyYWxJbnZpdGVDcmVhdGUoYWN0aW9uLm1ldGEsIGludml0ZSkpLCBPYnNlcnZhYmxlLm9mKHJlZmVycmFsSW52aXRlTGlzdCgnJykpLCBPYnNlcnZhYmxlLm9mKHRvYXN0U2V0KG5ldyBDb25maXJtYXRpb25FcnJvcigiSW52aXRhdGlvbiBzZW50IHRvOiAiICsgYWN0aW9uLm1ldGEsIHRydWUsICdjZW50ZXInKSkpKTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikgeyByZXR1cm4gT2JzZXJ2YWJsZS5vZih0b2FzdFNldChlcnIpKTsgfSk7CiAgICB9KTsKfTsKdmFyIHJlZmVycmFsSW52aXRlTGlzdEVwaWMgPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUsIGRlcHMpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShSRUZFUlJBTF9JTlZJVEVfTElTVCkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIGRlcHMucmVmZXJyYWxJbnZpdGVzLmxpc3QoKQogICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChpbnZpdGVzKSB7IHJldHVybiByZWZlcnJhbEludml0ZUxpc3QoYWN0aW9uLm1ldGEsIGludml0ZXMpOyB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikgeyByZXR1cm4gT2JzZXJ2YWJsZS5vZih0b2FzdFNldChlcnIpKTsgfSk7CiAgICB9KTsKfTsKdmFyIHJlZmVycmFsSW52aXRlUmVzZW5kRXBpYyA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKFJFRkVSUkFMX0lOVklURV9SRVNFTkQpCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWN0aW9uKSB7IHJldHVybiBhY3Rpb24uc3RhdHVzID09PSBBY3Rpb25TdGF0dXMuU3RhcnQ7IH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBkZXBzLnJlZmVycmFsSW52aXRlcy5yZXNlbmQoYWN0aW9uLm1ldGEpCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVmZXJyYWxJbnZpdGVMaXN0KCcnKTsgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsgcmV0dXJuIE9ic2VydmFibGUub2YodG9hc3RTZXQoZXJyKSk7IH0pOwogICAgfSk7Cn07CmV4cG9ydCBkZWZhdWx0IFsKICAgIHJlZmVycmFsSW52aXRlQ3JlYXRlRXBpYywKICAgIHJlZmVycmFsSW52aXRlTGlzdEVwaWMsCiAgICBsb2NhdGlvbkNoYW5nZVJlZmVycmFsSW52aXRlTGlzdCwKICAgIHJlZmVycmFsSW52aXRlUmVzZW5kRXBpYywKXTsK"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/referralInvites.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/referralInvites.ts"],"names":[],"mappings":"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","sourcesContent":["import { Epic } from 'redux-observable';\nimport { Deps } from '@src/lib/epic';\nimport {\n  ActionStatus, Action, StoreState, ReferralInvite,\n} from '@src/types';\nimport {\n  REFERRAL_INVITE_CREATE,\n  referralInviteCreate,\n  REFERRAL_INVITE_LIST,\n  referralInviteList,\n  REFERRAL_INVITE_RESEND,\n} from '@src/ducks/referralInvites';\nimport { toastSet, ConfirmationError } from '@src/ducks/toasts';\nimport { Observable } from 'rxjs';\nimport { LOCATION_CHANGE, LocationChangeAction } from 'react-router-redux';\nimport { AmplitudeEvents, logAmplitudeEvent } from '@src/lib/amplitude-analytics';\n\nconst locationChangeReferralInviteList: Epic<Action<any, any>, StoreState> = (action$, store) =>\n  action$\n    .ofType(LOCATION_CHANGE)\n    .filter((action: any) => {\n      const split = (action as LocationChangeAction).payload.pathname.split('/');\n      return split.length > 2 && split[2] === 'refer-friends';\n    })\n    .map(() => referralInviteList(''));\n\nconst referralInviteCreateEpic:\n  Epic<Action<string|null|Error, ReferralInvite|Error|null|ReferralInvite[]>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(REFERRAL_INVITE_CREATE)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<string, ReferralInvite>) =>\n        deps.referralInvites.create(action.meta)\n          .flatMap((invite: ReferralInvite) => {\n            logAmplitudeEvent(\n              AmplitudeEvents.ReferFriend, { details: 'Sent Invite from email input' },\n            );\n\n            return Observable.merge(\n              Observable.of(referralInviteCreate(action.meta, invite)),\n              Observable.of(referralInviteList('')),\n              Observable.of(toastSet(\n                new ConfirmationError(`Invitation sent to: ${action.meta}`, true, 'center'),\n              )),\n            );\n          },\n          )\n          .catch(err => Observable.of(toastSet(err))),\n      );\n\nconst referralInviteListEpic:\n  Epic<Action<string|null|Error, ReferralInvite[]|null>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(REFERRAL_INVITE_LIST)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<string, ReferralInvite[]>) =>\n        deps.referralInvites.list()\n          .map(invites => referralInviteList(action.meta, invites))\n          .catch(err => Observable.of(toastSet(err))),\n      );\n\nconst referralInviteResendEpic:\n  Epic<Action<string|null|Error, null|ReferralInvite[]>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(REFERRAL_INVITE_RESEND)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<string, null>) =>\n        deps.referralInvites.resend(action.meta)\n          .map(() => referralInviteList(''))\n          .catch(err => Observable.of(toastSet(err))),\n      );\n\nexport default [\n  referralInviteCreateEpic,\n  referralInviteListEpic,\n  locationChangeReferralInviteList,\n  referralInviteResendEpic,\n];\n"]}]}