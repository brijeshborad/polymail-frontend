{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/Threads.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/Threads.tsx","mtime":1675280254112},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHsKICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7CiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkKICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgIH07CiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfTsKaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgbGFzdCwgZmlsdGVyLCBzdGFydENhc2UgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgeyBDb21tYW5kQ29udHJvbFR5cGUsIE1haWxib3hUeXBlLCBUaHJlYWRCb3gsIFVuc3Vic2NyaWJlQmVoYXZpb3IsIEtleUNvZGUsIEJsb2NrQ29udGFjdEFjdGlvblR5cGUsIE9uYm9hcmRpbmdUeXBlLCBUaGVtZVNldHRpbmcsIH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCB7IFJpZ2h0U2lkZWJhclRhYiwgUGFnZSwgfSBmcm9tICdAc3JjL3R5cGVzL3JpZ2h0U2lkZWJhcic7CmltcG9ydCB7IEhvdGtleUFjdGlvbiwgZ2V0SG90a2V5LCBjaGVja05leHRIb3RrZXlDaGFuZ2UgfSBmcm9tICdAc3JjL2xpYi9ob3RrZXlzJzsKaW1wb3J0IHsgcGFyc2VBZGRyZXNzLCBhZGRyZXNzVG9FbWFpbCB9IGZyb20gJ0BzcmMvbGliL2FkZHJlc3MnOwppbXBvcnQgeyB0aHJlYWRNb3ZlVW5kbywgdGhyZWFkQ29tbWl0c1N1Ym1pdCwgdGhyZWFkRGlzYWJsZVRyYWNrIH0gZnJvbSAnQHNyYy9kdWNrcy90aHJlYWRzJzsKaW1wb3J0ICcuL1RocmVhZHMuc2Nzcyc7CmltcG9ydCBUaHJlYWRMaXN0IGZyb20gJy4vY29tcG9uZW50cy9UaHJlYWRMaXN0JzsKaW1wb3J0IFRocmVhZERldGFpbCBmcm9tICdAc3JjL2NvbXBvbmVudHMvVGhyZWFkRGV0YWlsJzsKaW1wb3J0IExlZnRTaWRlYmFyIGZyb20gJ0BzcmMvY29tcG9uZW50cy9MZWZ0U2lkZWJhcic7CmltcG9ydCBSaWdodFNpZGViYXIgZnJvbSAnQHNyYy9jb21wb25lbnRzL1JpZ2h0U2lkZWJhcic7CmltcG9ydCBDb21tYW5kQ29udHJvbCBmcm9tICdAc3JjL2NvbXBvbmVudHMvQ29tbWFuZENvbnRyb2wnOwppbXBvcnQgSW5ib3haZXJvIGZyb20gJy4vY29tcG9uZW50cy9JbmJveFplcm8vSW5ib3haZXJvJzsKaW1wb3J0IFRvYXN0IGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL1RvYXN0JzsKaW1wb3J0IHsgcmVjb3JkRXZlbnQsIFVzZXJFdmVudHMgfSBmcm9tICdAc3JjL2xpYi9hbmFseXRpY3MnOwppbXBvcnQgQ29uZmlybSBmcm9tICdAc3JjL2NvbXBvbmVudHMvQmFzZS9Db25maXJtJzsKLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aAppbXBvcnQgQmxvY2tDb25maXJtIGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL0Jsb2NrQ29uZmlybS9CbG9ja0NvbmZpcm0nOwppbXBvcnQgT25ib2FyZGluZ0Zvb3RlciBmcm9tICdAc3JjL2NvbXBvbmVudHMvQmFubmVyL09uYm9hcmRpbmdGb290ZXIvT25ib2FyZGluZ0Zvb3Rlcic7CmltcG9ydCB7IGNvbW1hbmRDb250cm9sU2hvdyB9IGZyb20gJ0BzcmMvZHVja3MvY29tbWFuZENvbnRyb2wnOwppbXBvcnQgYnJvd3Nlckhpc3RvcnkgZnJvbSAnQHNyYy9saWIvYnJvd3Nlckhpc3RvcnknOwppbXBvcnQgeyBvbmJvYXJkaW5nUGF0Y2ggfSBmcm9tICdAc3JjL2R1Y2tzL21lJzsKaW1wb3J0IHsgZHJhZnRDcmVhdGUsIGRyYWZ0RGVsZXRlLCBkcmFmdFNlbmROb3csIGRyYWZ0VXBkYXRlIH0gZnJvbSAnQHNyYy9kdWNrcy9kcmFmdHMnOwppbXBvcnQgeyBjcmVhdGVNYWlsVG9EcmFmdCwgaXNEcmFmdFNlbmRpbmcgfSBmcm9tICdAc3JjL2xpYi9kcmFmdCc7CmltcG9ydCBHZXR0aW5nU3RhcnRlZCBmcm9tICdAc3JjL2NvbXBvbmVudHMvT25ib2FyZGluZy9jb21wb25lbnRzL0dldHRpbmdTdGFydGVkJzsKaW1wb3J0IEtleWJvYXJkU3ltYm9sIGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL0tleWJvYXJkU3ltYm9sL0tleWJvYXJkU3ltYm9sJzsKaW1wb3J0IHsgaXNFbGVjdHJvbk1hYyB9IGZyb20gJ0BzcmMvbGliL2VsZWN0cm9uJzsKaW1wb3J0IEFwcGxlSWNvbldoaXRlIGZyb20gJ0BzcmMvY29tcG9uZW50cy9JY29ucy9BcHBsZUljb25XaGl0ZS5zdmcnOwppbXBvcnQgeyBob3RrZXlVcGRhdGUgfSBmcm9tICdAc3JjL2R1Y2tzL2hvdGtleXMnOwppbXBvcnQgeyBmaWx0ZXJEZWxldGUsIGZpbHRlclNldCwgZmlsdGVyQmxvY2tDcmVhdGUgfSBmcm9tICdAc3JjL2R1Y2tzL2ZpbHRlcnMnOwppbXBvcnQgeyBpc0RyYWZ0Qm94IH0gZnJvbSAnQHNyYy9saWIvbWFpbGJveCc7CmltcG9ydCB7IHRvYXN0U2V0LCBDb25maXJtYXRpb25FcnJvciB9IGZyb20gJ0BzcmMvZHVja3MvdG9hc3RzJzsKaW1wb3J0IHsgZ2V0T25ib2FyZGluZ0FjdGlvbnMgfSBmcm9tICdAc3JjL2xpYi9PbmJvYXJkaW5nRGlzcGF0Y2hlcic7CmltcG9ydCB7IGFwcFRoZW1lU2V0IH0gZnJvbSAnQHNyYy9kdWNrcy9hcHAnOwppbXBvcnQgeyBsZWZ0U2lkZWJhclRvZ2dsZSB9IGZyb20gJ0BzcmMvZHVja3MvbGVmdFNpZGViYXInOwppbXBvcnQgVGVhbUpvaW5lZCBmcm9tICdAc3JjL2NvbXBvbmVudHMvT25ib2FyZGluZy9jb21wb25lbnRzL1RlYW1Kb2luZWQnOwppbXBvcnQgeyByaWdodFNpZGViYXJUYWJTZWxlY3QgfSBmcm9tICdAc3JjL2R1Y2tzL3JpZ2h0U2lkZWJhcic7CmltcG9ydCB7IEFtcGxpdHVkZUV2ZW50cywgbG9nQW1wbGl0dWRlRXZlbnQgfSBmcm9tICdAc3JjL2xpYi9hbXBsaXR1ZGUtYW5hbHl0aWNzJzsKaW1wb3J0IENvbnRhY3RTdXBwb3J0IGZyb20gJ0BzcmMvY29tcG9uZW50cy9Db250YWN0U3VwcG9ydCc7CnZhciBUaHJlYWRzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgX19leHRlbmRzKFRocmVhZHMsIF9zdXBlcik7CiAgICBmdW5jdGlvbiBUaHJlYWRzKHByb3BzKSB7CiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKICAgICAgICBfdGhpcy5oYW5kbGVIb3RrZXlBY3Rpb25zQ2hhbmdlID0gZnVuY3Rpb24gKG9sZEFjdGlvbnMsIG5ld0FjdGlvbnMpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIGRpc3BhdGNoQWN0aW9uID0gX2EuZGlzcGF0Y2hBY3Rpb24sIHNlbGVjdGVkVGhyZWFkID0gX2Euc2VsZWN0ZWRUaHJlYWQsIHByZWZlcmVuY2VzID0gX2EucHJlZmVyZW5jZXMsIHN1Ym1pdENvbW1pdE1ldGEgPSBfYS5zdWJtaXRDb21taXRNZXRhLCBibG9ja0ZpbHRlciA9IF9hLmJsb2NrRmlsdGVyLCB1bnN1YnNjcmliZUxpbmsgPSBfYS51bnN1YnNjcmliZUxpbms7CiAgICAgICAgICAgIC8vIEhhbmRsZSBEYXJrTW9kZSB0b2dnbGUKICAgICAgICAgICAgaWYgKGNoZWNrTmV4dEhvdGtleUNoYW5nZShIb3RrZXlBY3Rpb24uVG9nZ2xlRGFya01vZGUsIG5ld0FjdGlvbnMsIG9sZEFjdGlvbnMpKSB7CiAgICAgICAgICAgICAgICB2YXIgdGhlbWUgPSBkb2N1bWVudC5ib2R5LmdldEF0dHJpYnV0ZSgndGhlbWUnKSA9PT0gJ3RoZW1lLWRhcmsnCiAgICAgICAgICAgICAgICAgICAgPyBUaGVtZVNldHRpbmcuTGlnaHQKICAgICAgICAgICAgICAgICAgICA6IFRoZW1lU2V0dGluZy5EYXJrOwogICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oYXBwVGhlbWVTZXQodGhlbWUpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBIYW5kbGUgVW5ibG9jayB0b2dnbGUKICAgICAgICAgICAgaWYgKGNoZWNrTmV4dEhvdGtleUNoYW5nZShIb3RrZXlBY3Rpb24uVW5ibG9ja1NlbmRlciwgbmV3QWN0aW9ucywgb2xkQWN0aW9ucykpIHsKICAgICAgICAgICAgICAgIGlmIChibG9ja0ZpbHRlcikgewogICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKGZpbHRlckRlbGV0ZShibG9ja0ZpbHRlci5pZCkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBIYW5kbGUgRGlzYWJsZSBUcmFja3MgYnkgZmlyc3Qgc2hvd2luZyBjb25maXJtIG1vZGFsCiAgICAgICAgICAgIGlmIChjaGVja05leHRIb3RrZXlDaGFuZ2UoSG90a2V5QWN0aW9uLkRpc2FibGVUcmFja3MsIG5ld0FjdGlvbnMsIG9sZEFjdGlvbnMpKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRUaHJlYWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZGlzYWJsZVRyYWNrc0NvbmZpcm1Qcm9wcyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdEaXNhYmxlIFRyYWNraW5nIGZvciB0aGlzIENvbnZlcnNhdGlvbj8nLAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVHJhY2tpbmcgd2lsbCBiZSB0dXJuZWQgb2ZmIHRoaXMgY29udmVyc2F0aW9uIGFuZCBubyBuZXcgYWN0aXZpdHkgd2lsbCBiZSByZWNvcmRlZC4gVGhpcyBpcyBub3QgcmV2ZXJzaWJsZS4gV291bGQgeW91IGxpa2UgdG8gY29udGludWU/JywKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUNvcHk6ICdPaycsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbENvcHk6ICdDYW5jZWwnLAogICAgICAgICAgICAgICAgICAgICAgICBvbkNvbmZpcm06IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgY29uZmlybVByb3BzOiB1bmRlZmluZWQgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLmRpc3BhdGNoQWN0aW9uKHRocmVhZERpc2FibGVUcmFjayhzZWxlY3RlZFRocmVhZC5pZCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbmZpcm1Qcm9wczogdW5kZWZpbmVkIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IGRpc2FibGVUcmFja3NDb25maXJtUHJvcHMgfSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEhhbmRsZSBCbG9jayB0b2dnbGUKICAgICAgICAgICAgaWYgKGNoZWNrTmV4dEhvdGtleUNoYW5nZShIb3RrZXlBY3Rpb24uQmxvY2tTZW5kZXIsIG5ld0FjdGlvbnMsIG9sZEFjdGlvbnMpKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRUaHJlYWQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc2VuZGVyTGFzdE1lc3NhZ2UgPSBsYXN0KHNlbGVjdGVkVGhyZWFkLm1lc3NhZ2VzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXNlbmRlckxhc3RNZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwcmVmZXJlbmNlcykgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBzZXR0aW5nIGJsb2NrCiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbmRlcl8xID0gYWRkcmVzc1RvRW1haWwoc2VuZGVyTGFzdE1lc3NhZ2UuZnJvbSkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICB2YXIgYmxvY2tDb25maXJtUHJvcHMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAiQmxvY2sgIiArIHNlbmRlcl8xLAogICAgICAgICAgICAgICAgICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICJNZXNzYWdlcyByZWNlaXZlZCBmcm9tIHRoaXMgc2VuZGVyIHdpbGwgYmUgYmxvY2tlZCBhbmQgYXV0b21hdGljYWxseSBtb3ZlZCB0byAiICsgc3RhcnRDYXNlKHByZWZlcmVuY2VzLmJsb2NrQ29udGFjdEFjdGlvbikgKyAiLiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGhhc1Vuc3Vic2NyaWJlOiAhIXVuc3Vic2NyaWJlTGluaywKICAgICAgICAgICAgICAgICAgICAgICAgb25VbnN1YnNjcmliZUNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgdW5zdWJzY3JpYmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgYmxvY2tDb25maXJtUHJvcHM6IHVuZGVmaW5lZCB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5oYW5kbGVVbnN1YnNjcmliZSgpOyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0FtcGxpdHVkZUV2ZW50KEFtcGxpdHVkZUV2ZW50cy5VbnN1YnNjcmliZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29uZmlybTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQmxvY2sgZmlsdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihmaWx0ZXJTZXQoZmlsdGVyQmxvY2tDcmVhdGUoc2VuZGVyXzEpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgc2VuZGluZyB0byBwcm9wZXIgZGVzdGluYXRpb24gYm94CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHByZWZlcmVuY2VzLmJsb2NrQ29udGFjdEFjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgQmxvY2tDb250YWN0QWN0aW9uVHlwZS5BcmNoaXZlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYmxvY2tBcmNoaXZlQ29tbWl0ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzb3VyY2U6IHNlbGVjdGVkVGhyZWFkLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94OiBUaHJlYWRCb3guQXJjaGl2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0Q29tbWl0TWV0YShibG9ja0FyY2hpdmVDb21taXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEJsb2NrQ29udGFjdEFjdGlvblR5cGUuVHJhc2g6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibG9ja1RyYXNoQ29tbWl0ID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzb3VyY2U6IHNlbGVjdGVkVGhyZWFkLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94OiBUaHJlYWRCb3guVHJhc2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdENvbW1pdE1ldGEoYmxvY2tUcmFzaENvbW1pdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nQW1wbGl0dWRlRXZlbnQoQW1wbGl0dWRlRXZlbnRzLkJsb2NrU2VuZGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBjb25maXJtUHJvcHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgYmxvY2tDb25maXJtUHJvcHM6IHVuZGVmaW5lZCB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgYmxvY2tDb25maXJtUHJvcHM6IHVuZGVmaW5lZCB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIC8vIFNldCBDb25maXJtUHJvcHMgdG8gY29uZmlybSBibG9jawogICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgYmxvY2tDb25maXJtUHJvcHM6IGJsb2NrQ29uZmlybVByb3BzIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVGb2N1cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgJiYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICdib2R5JykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBzZWxlY3RlZFRocmVhZCA9IF90aGlzLnByb3BzLnNlbGVjdGVkVGhyZWFkOwogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnaW5maW5pdGUtdGhyZWFkLWxpc3QnKTsKICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBzZWxlY3RlZFRocmVhZCAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxlY3RlZFRocmVhZC5pZCk7CiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY29udGFpbmVyICYmIGNvbnRhaW5lci5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lclswXS5mb2N1cygpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvLyBBYmlsaXR5IHRvIGhhbmRsZSBtb3ZlcyBmb3IgYWxsIHRocmVhZHMKICAgICAgICBfdGhpcy5oYW5kbGVUaHJlYWRNb3ZlID0gZnVuY3Rpb24gKGJveCkgewogICAgICAgICAgICBfdGhpcy5wcm9wcy5zdWJtaXRDb21taXRNZXRhKHsgYm94OiBib3ggfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVUcmlhbEV4cGlyZWRDbG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMucHJvcHMuY2xvc2VCYW5uZXIoJ1RyaWFsRXhwaXJlZCcpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVGhyZWFkRGVsZXRlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY29uZmlybVByb3BzID0gewogICAgICAgICAgICAgICAgdGl0bGU6ICdQZXJtYW5lbnRseSBkZWxldGUgdGhpcyB0aHJlYWQ/JywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdBcmUgeW91IHN1cmU/IFRoaXMgY2Fubm90IGJlIHVuZG9uZS4nLAogICAgICAgICAgICAgICAgY29uZmlybUNvcHk6ICdEZWxldGUnLAogICAgICAgICAgICAgICAgY2FuY2VsQ29weTogJ0NhbmNlbCcsCiAgICAgICAgICAgICAgICBvbkNvbmZpcm06IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVUaHJlYWRNb3ZlKFRocmVhZEJveC5UcmFzaCk7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IHVuZGVmaW5lZCB9KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IHVuZGVmaW5lZCB9KTsgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IGNvbmZpcm1Qcm9wcyB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUtleURvd24gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgX2EsIF9iLCBfYzsKICAgICAgICAgICAgdmFyIF9kID0gX3RoaXMucHJvcHMsIGhpc3RvcnkgPSBfZC5oaXN0b3J5LCBzZWxlY3RlZE1haWxib3ggPSBfZC5zZWxlY3RlZE1haWxib3gsIHNlbGVjdGVkVGhyZWFkID0gX2Quc2VsZWN0ZWRUaHJlYWQsIGRpc3BhdGNoQWN0aW9uID0gX2QuZGlzcGF0Y2hBY3Rpb24sIGRyYWZ0ID0gX2QuZHJhZnQsIHN1Ym1pdENvbW1pdE1ldGEgPSBfZC5zdWJtaXRDb21taXRNZXRhLCB1bnN1YnNjcmliZUxpbmsgPSBfZC51bnN1YnNjcmliZUxpbmssIHByZWZlcmVuY2VzID0gX2QucHJlZmVyZW5jZXMsIHJpZ2h0U2lkZWJhckNvbGxhcHNlZCA9IF9kLnJpZ2h0U2lkZWJhckNvbGxhcHNlZCwgY29sbGFwc2VSaWdodFNpZGViYXIgPSBfZC5jb2xsYXBzZVJpZ2h0U2lkZWJhciwgc2VsZWN0ZWRBY2NvdW50ID0gX2Quc2VsZWN0ZWRBY2NvdW50LCByaWdodFNpZGViYXJUYWIgPSBfZC5yaWdodFNpZGViYXJUYWIsIGJsb2NrRmlsdGVyID0gX2QuYmxvY2tGaWx0ZXI7CiAgICAgICAgICAgIHZhciBoYW5kbGVkID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50LnRhZ05hbWUgPT09ICdJTlBVVCcgfHwKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQudGFnTmFtZSA9PT0gJ1RFWFRBUkVBJykpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgaG90a2V5ID0gZ2V0SG90a2V5KGUpOwogICAgICAgICAgICBzd2l0Y2ggKGhvdGtleSAmJiBob3RrZXkubmFtZSB8fCBlLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLlNlYXJjaDoKICAgICAgICAgICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihob3RrZXlVcGRhdGUoSG90a2V5QWN0aW9uLlNlYXJjaCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uU2hvd0xpbmtzOgogICAgICAgICAgICAgICAgICAgIGlmICghIXNlbGVjdGVkVGhyZWFkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKHJpZ2h0U2lkZWJhclRhYlNlbGVjdCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByc2JUYWI6IFJpZ2h0U2lkZWJhclRhYi5MaW5rRXh0cmFjdG9yLAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLktleWJvYXJkU2hvcnRjdXRHdWlkZToKICAgICAgICAgICAgICAgICAgICBpZiAoaG90a2V5ICYmIGhvdGtleS5hY3Rpb24gJiYgcmlnaHRTaWRlYmFyVGFiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKGhvdGtleS5hY3Rpb24ocmlnaHRTaWRlYmFyVGFiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLk5ld0RyYWZ0OgogICAgICAgICAgICAgICAgICAgIGlmIChob3RrZXkgJiYgaG90a2V5LmFjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihob3RrZXkuYWN0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gVUkgVG9nZ2xlCiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5Ub2dnbGVMU0I6CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24obGVmdFNpZGViYXJUb2dnbGUodHJ1ZSkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gVUkgVG9nZ2xlCiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5Ub2dnbGVSU0I6CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgY29sbGFwc2VSaWdodFNpZGViYXIoIXJpZ2h0U2lkZWJhckNvbGxhcHNlZCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAvLyBEcmFmdHMKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLlJlcGx5OgogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uUmVwbHlBbGw6CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5Gb3J3YXJkOgogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uUmVhZExhdGVyOgogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uTGFiZWw6CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5SZXBseUJDQzogewogICAgICAgICAgICAgICAgICAgIC8vIERvIG5vdCB0cmlnZ2VyIGlmIGxhc3QgbWVzc2FnZSByZWNpcGllbnRzIGlzIGxlc3MgdGhhbiB0d28KICAgICAgICAgICAgICAgICAgICBpZiAoKGhvdGtleSA9PT0gbnVsbCB8fCBob3RrZXkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGhvdGtleS5uYW1lKSA9PT0gSG90a2V5QWN0aW9uLlJlcGx5QkNDKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsYXN0TWVzc2FnZSA9IHNlbGVjdGVkVGhyZWFkICYmIHNlbGVjdGVkVGhyZWFkLm1lc3NhZ2VzLmxlbmd0aCA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0KGZpbHRlcihzZWxlY3RlZFRocmVhZC5tZXNzYWdlcywgZnVuY3Rpb24gKG1lc3NhZ2UpIHsgcmV0dXJuICFtZXNzYWdlLnNlbnQ7IH0pKSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFsYXN0TWVzc2FnZSB8fCBsYXN0TWVzc2FnZS50by5jb25jYXQobGFzdE1lc3NhZ2UuY2MpLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoaG90a2V5ICYmIGhvdGtleS5hY3Rpb24gJiYgc2VsZWN0ZWRUaHJlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5LmFjdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIE5hdmlnYXRpb24KICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLk5hdmlnYXRlSW5ib3g6CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5OYXZpZ2F0ZVN0YXJyZWQ6CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5OYXZpZ2F0ZVJlYWRMYXRlcjoKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLk5hdmlnYXRlQXJjaGl2ZToKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLk5hdmlnYXRlVHJhc2g6CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5OYXZpZ2F0ZUZvbGxvd1VwOgogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uTmF2aWdhdGVTZW50OgogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uTmF2aWdhdGVTZW5kTGF0ZXI6CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5OYXZpZ2F0ZURyYWZ0OgogICAgICAgICAgICAgICAgICAgIGlmIChoaXN0b3J5ICYmIHNlbGVjdGVkTWFpbGJveCAmJiBob3RrZXkgJiYgaG90a2V5LnJvdXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaChob3RrZXkucm91dGUoc2VsZWN0ZWRNYWlsYm94LCBzZWxlY3RlZEFjY291bnQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uTWVzc2FnZVRlbXBsYXRlczoKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLkNhbGVuZGFySW52aXRlOgogICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChob3RrZXkgJiYgaG90a2V5LmFjdGlvbiAmJiBkcmFmdCkgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihob3RrZXkuYWN0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uSW5ib3g6CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkVGhyZWFkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZVRocmVhZE1vdmUoVGhyZWFkQm94LkluYm94KTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uQXJjaGl2ZToKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMucHJvcHMucnNiT25ib2FyZGluZ1R5cGUgPT09IE9uYm9hcmRpbmdUeXBlLkFyY2hpdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24ob25ib2FyZGluZ1BhdGNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNraXBwZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogeyBzdGVwczogKF9hID0ge30sIF9hW09uYm9hcmRpbmdUeXBlLkFyY2hpdmVdID0gdHJ1ZSwgX2EpIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nQW1wbGl0dWRlRXZlbnQoQW1wbGl0dWRlRXZlbnRzLlRvdXJTdGVwU2V2ZW4sIHsgc2tpcHBlZDogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGdldE9uYm9hcmRpbmdBY3Rpb25zKCkubmV4dChPbmJvYXJkaW5nVHlwZS5BcmNoaXZlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRUaHJlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlVGhyZWFkTW92ZShUaHJlYWRCb3guQXJjaGl2ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uQ2FuY2VsRm9sbG93dXA6IC8vIEhhbmRsZXMgY2FuY2VsbGluZyBmb2xsb3cgdXAgcmVtaW5kZXJzIHZpYSBob3RrZXkKICAgICAgICAgICAgICAgICAgICBpZiAoZHJhZnQgJiYgZHJhZnQud2FpdGluZykgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihkcmFmdFVwZGF0ZShfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZHJhZnQpLCB7IHdhaXRpbmc6IG51bGwgfSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGVjdGVkVGhyZWFkICYmIHNlbGVjdGVkVGhyZWFkLndhaXRpbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1pdE1ldGEgPSB7IHNpbmdsZVJlc291cmNlOiBzZWxlY3RlZFRocmVhZC5pZCwgd2FpdGluZzogbnVsbCB9OwogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbih0aHJlYWRDb21taXRzU3VibWl0KGNvbW1pdE1ldGEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFNob3cgZm9sbG93dXAgcmVtb3ZhbAogICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKHRvYXN0U2V0KG5ldyBDb25maXJtYXRpb25FcnJvcignWW91ciBmb2xsb3d1cCBoYXMgYmVlbiBjYW5jZWxlZCEnLCB0cnVlKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLlRyYXNoOgogICAgICAgICAgICAgICAgY2FzZSBLZXlDb2RlLkV4dGVuZGVkRGVsZXRlOgogICAgICAgICAgICAgICAgY2FzZSBLZXlDb2RlLkRlbGV0ZToKICAgICAgICAgICAgICAgICAgICAvLyBFbmFibGUgZGVsZXRpb25zIG9mIGRyYWZ0cyB1c2luZyBub3JtYWwgZGVsZXRlIHdoZW4gbWFpbGJveCBpcyBkcmFmdCB0eXBlCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkTWFpbGJveCAmJiBpc0RyYWZ0Qm94KHNlbGVjdGVkTWFpbGJveC50eXBlKSAmJiBkcmFmdCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlzY2FyZERyYWZ0SWRzID0gQXJyYXkuZnJvbShfdGhpcy5wcm9wcy5zZWxlY3RlZElkcy5rZXlzKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMucHJvcHMuc2VsZWN0ZWRNYWlsYm94ICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5zZWxlY3RlZE1haWxib3gudHlwZSA9PT0gTWFpbGJveFR5cGUuRHJhZnRzICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNjYXJkRHJhZnRJZHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVTZWxlY3RlZERyYWZ0c0RlbGV0ZShkaXNjYXJkRHJhZnRJZHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkTWFpbGJveCAmJiBzZWxlY3RlZE1haWxib3gudHlwZSA9PT0gTWFpbGJveFR5cGUuVHJhc2ggJiYKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRUaHJlYWQgJiYgc2VsZWN0ZWRUaHJlYWQuYm94ID09PSBUaHJlYWRCb3guVHJhc2gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlVGhyZWFkRGVsZXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChzZWxlY3RlZFRocmVhZCAmJiBzZWxlY3RlZFRocmVhZC5ib3ggIT09IFRocmVhZEJveC5UcmFzaCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVUaHJlYWRNb3ZlKFRocmVhZEJveC5UcmFzaCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLkRpc2NhcmQ6CiAgICAgICAgICAgICAgICAgICAgLy8gRW5hYmxlIGRlbGV0aW9ucyBvZiBkcmFmdHMgdXNpbmcgbm9ybWFsIGRlbGV0ZSB3aGVuIG1haWxib3ggaXMgZHJhZnQgdHlwZQogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE1haWxib3ggJiYKICAgICAgICAgICAgICAgICAgICAgICAgW01haWxib3hUeXBlLkRyYWZ0cywgTWFpbGJveFR5cGUuU2VuZExhdGVyXS5pbmRleE9mKHNlbGVjdGVkTWFpbGJveC50eXBlKSA+IC0xICYmCiAgICAgICAgICAgICAgICAgICAgICAgIGRyYWZ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWxldGVEcmFmdElkcyA9IEFycmF5LmZyb20oX3RoaXMucHJvcHMuc2VsZWN0ZWRJZHMua2V5cygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnByb3BzLnNlbGVjdGVkTWFpbGJveCAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcHMuc2VsZWN0ZWRNYWlsYm94LnR5cGUgPT09IE1haWxib3hUeXBlLkRyYWZ0cyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlRHJhZnRJZHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmhhbmRsZVNlbGVjdGVkRHJhZnRzRGVsZXRlKGRlbGV0ZURyYWZ0SWRzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChkcmFmdCAmJiAhaXNEcmFmdFNlbmRpbmcoZHJhZnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVTZWxlY3RlZERyYWZ0c0RlbGV0ZShbZHJhZnQuaWRdKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5Db21tZW50OgogICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLnVwZGF0ZUhvdGtleShIb3RrZXlBY3Rpb24uQ29tbWVudCk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5VbmRvOgogICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5wcm9wcy5yc2JPbmJvYXJkaW5nVHlwZSA9PT0gT25ib2FyZGluZ1R5cGUuVW5kbykgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihvbmJvYXJkaW5nUGF0Y2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2tpcHBlZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7IHN0ZXBzOiAoX2IgPSB7fSwgX2JbT25ib2FyZGluZ1R5cGUuVW5kb10gPSB0cnVlLCBfYikgfSwKICAgICAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2dBbXBsaXR1ZGVFdmVudChBbXBsaXR1ZGVFdmVudHMuVG91clN0ZXBFaWdodCwgeyBza2lwcGVkOiBmYWxzZSB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZ2V0T25ib2FyZGluZ0FjdGlvbnMoKS5uZXh0KE9uYm9hcmRpbmdUeXBlLlVuZG8pOwogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE1haWxib3gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcHMuZGlzcGF0Y2hBY3Rpb24odGhyZWFkTW92ZVVuZG8oc2VsZWN0ZWRNYWlsYm94KSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uVG9nZ2xlVW5yZWFkOgogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFRocmVhZCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRDb21taXRNZXRhKHsgcmVhZDogIXNlbGVjdGVkVGhyZWFkLnJlYWQgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uVG9nZ2xlU3RhcjoKICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRUaHJlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0Q29tbWl0TWV0YSh7IHN0YXJyZWQ6ICFzZWxlY3RlZFRocmVhZC5zdGFycmVkIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLk5hdmlnYXRpb25DZW50ZXI6CiAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcHMuZGlzcGF0Y2hBY3Rpb24oY29tbWFuZENvbnRyb2xTaG93KENvbW1hbmRDb250cm9sVHlwZS5OYXZpZ2F0aW9uKSk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5Ub2dnbGVDb21tYW5kQ29udHJvbDoKICAgICAgICAgICAgICAgICAgICBpZiAoaG90a2V5ICYmIGhvdGtleS5hY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBkcmFmdCAmJiAhaXNEcmFmdFNlbmRpbmcoZHJhZnQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IENvbW1hbmRDb250cm9sVHlwZS5EcmFmdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBDb21tYW5kQ29udHJvbFR5cGUuVGhyZWFkOwogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5kaXNwYXRjaEFjdGlvbihob3RrZXkuYWN0aW9uKHR5cGUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uVW5ibG9ja1NlbmRlcjoKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLkJsb2NrU2VuZGVyOgogICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5wcm9wcy5yc2JPbmJvYXJkaW5nVHlwZSA9PT0gT25ib2FyZGluZ1R5cGUuQmxvY2spIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcHMuZGlzcGF0Y2hBY3Rpb24ob25ib2FyZGluZ1BhdGNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNraXBwZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogeyBzdGVwczogKF9jID0ge30sIF9jW09uYm9hcmRpbmdUeXBlLkJsb2NrXSA9IHRydWUsIF9jKSB9LAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGdldE9uYm9hcmRpbmdBY3Rpb25zKCkubmV4dChPbmJvYXJkaW5nVHlwZS5CbG9jayk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2NrRmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKGhvdGtleVVwZGF0ZShIb3RrZXlBY3Rpb24uVW5ibG9ja1NlbmRlcikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5VXBkYXRlKEhvdGtleUFjdGlvbi5CbG9ja1NlbmRlcikpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5NdXRlQ29udmVyc2F0aW9uOgogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uVW5tdXRlQ29udmVyc2F0aW9uOgogICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFRocmVhZCkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXV0ZUNvbW1pdE1ldGEgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVSZXNvdXJjZTogc2VsZWN0ZWRUaHJlYWQuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdXRlZDogIXNlbGVjdGVkVGhyZWFkLm11dGVkLAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRDb21taXRNZXRhKG11dGVDb21taXRNZXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uVW5zdWJzY3JpYmU6CiAgICAgICAgICAgICAgICAgICAgLy8gSGFuZGxlIHVuc3Vic2NyaWJlCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkVGhyZWFkICYmIHVuc3Vic2NyaWJlTGluayAmJiBwcmVmZXJlbmNlcykgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVVbnN1YnNjcmliZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIEhvdGtleUFjdGlvbi5Db3B5U2NoZWR1bGluZ1VybDoKICAgICAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5kaXNwYXRjaEFjdGlvbihjb21tYW5kQ29udHJvbFNob3coQ29tbWFuZENvbnRyb2xUeXBlLlNjaGVkdWxpbmdQYWdlcykpOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gc2VuZCBpbW1lZGlhdGVseSB3aXRoIGRvdWJsZSBjbWQvY3RybCtlbnRlcgogICAgICAgICAgICAgICAgY2FzZSBIb3RrZXlBY3Rpb24uU2VuZDoKICAgICAgICAgICAgICAgIGNhc2UgSG90a2V5QWN0aW9uLlNlbmRJbW1lZGlhdGVseToKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMucHJvcHMuc2VuZGluZ0RyYWZ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLmRpc3BhdGNoQWN0aW9uKGRyYWZ0U2VuZE5vdyhfdGhpcy5wcm9wcy5zZW5kaW5nRHJhZnQpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoYW5kbGVkKSB7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVVbmRvID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2VsZWN0ZWRNYWlsYm94ID0gX3RoaXMucHJvcHMuc2VsZWN0ZWRNYWlsYm94OwogICAgICAgICAgICBpZiAoc2VsZWN0ZWRNYWlsYm94KSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5kaXNwYXRjaEFjdGlvbih0aHJlYWRNb3ZlVW5kbyhzZWxlY3RlZE1haWxib3gpKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCBzZWxlY3RlZFRocmVhZCA9IF9hLnNlbGVjdGVkVGhyZWFkLCB1bnN1YnNjcmliZUxpbmsgPSBfYS51bnN1YnNjcmliZUxpbmssIHByZWZlcmVuY2VzID0gX2EucHJlZmVyZW5jZXMsIHN1Ym1pdENvbW1pdE1ldGEgPSBfYS5zdWJtaXRDb21taXRNZXRhOwogICAgICAgICAgICBpZiAoc2VsZWN0ZWRUaHJlYWQgJiYgdW5zdWJzY3JpYmVMaW5rICYmIHByZWZlcmVuY2VzKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1bnN1YnNjcmliZUxpbmssICdfYmxhbmsnKTsKICAgICAgICAgICAgICAgIHJlY29yZEV2ZW50KFVzZXJFdmVudHMuVW5zdWJzY3JpYmVkKTsKICAgICAgICAgICAgICAgIHN3aXRjaCAocHJlZmVyZW5jZXMudW5zdWJzY3JpYmVCZWhhdmlvcikgewogICAgICAgICAgICAgICAgICAgIGNhc2UgVW5zdWJzY3JpYmVCZWhhdmlvci5BcmNoaXZlOgogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRDb21taXRNZXRhKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpbmdsZVJlc291cmNlOiBzZWxlY3RlZFRocmVhZC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJveDogVGhyZWFkQm94LkFyY2hpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIFVuc3Vic2NyaWJlQmVoYXZpb3IuVHJhc2g6CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdENvbW1pdE1ldGEoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2luZ2xlUmVzb3VyY2U6IHNlbGVjdGVkVGhyZWFkLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm94OiBUaHJlYWRCb3guVHJhc2gsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlU3RhcnRPbmJvYXJkaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgZGlzcGF0Y2hBY3Rpb24gPSBfYS5kaXNwYXRjaEFjdGlvbiwgYWNjb3VudHMgPSBfYS5hY2NvdW50cywgcHJlZmVyZW5jZXMgPSBfYS5wcmVmZXJlbmNlcywgZmVhdHVyZXMgPSBfYS5mZWF0dXJlczsKICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24ob25ib2FyZGluZ1BhdGNoKHsgc2tpcHBlZDogZmFsc2UsIHR5cGU6IHsgZXhwbG9yZU1vZGFsOiB0cnVlIH0gfSkpOwogICAgICAgICAgICBpZiAoIXByZWZlcmVuY2VzKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG1haWxUb1N0cmluZyA9ICdQb2x5IEJvdCA8b25ib2FyZGluZ0Bwb2x5bWFpbC5pbz4/c3ViamVjdD3imqHvuI8gJwogICAgICAgICAgICAgICAgKyAnU2VuZCB5b3VyIGZpcnN0IG1lc3NhZ2Ugd2l0aCB0cmFja2luZyEmYm9keT1IZWxsbyEg8J+Ri/Cfj7xcblxuJwogICAgICAgICAgICAgICAgKyAnUG9seW1haWwgYXV0b21hdGljYWxseSBnaXZlcyB5b3UgaW5zaWdodHMgb24gdGhlIGVtYWlscyB5b3Ugc2VuZCEnCiAgICAgICAgICAgICAgICArICdcblxuJwogICAgICAgICAgICAgICAgKyAnVHJ5IGNsaWNraW5nIHNlbmQgdG8gc2VlIGhvdyBpdCB3b3JrcyEnOwogICAgICAgICAgICBicm93c2VySGlzdG9yeS5wdXNoKCcvbWFpbCcpOwogICAgICAgICAgICB2YXIgZHJhZnQgPSBjcmVhdGVNYWlsVG9EcmFmdChhY2NvdW50c1swXSwgcHJlZmVyZW5jZXMsIGZlYXR1cmVzLCBtYWlsVG9TdHJpbmcpOwogICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihkcmFmdENyZWF0ZShkcmFmdCkpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlU2VsZWN0ZWREcmFmdHNEZWxldGUgPSBmdW5jdGlvbiAoaWRzKSB7CiAgICAgICAgICAgIHZhciBkcmFmdElkcyA9IGlkczsKICAgICAgICAgICAgdmFyIHRpdGxlID0gZHJhZnRJZHMubGVuZ3RoID4gMQogICAgICAgICAgICAgICAgPyAiRGVsZXRlICIgKyBkcmFmdElkcy5sZW5ndGggKyAiIGRyYWZ0cz8iCiAgICAgICAgICAgICAgICA6ICdEZWxldGUgdGhpcyBkcmFmdD8nOwogICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGRyYWZ0SWRzLmxlbmd0aCA+IDEKICAgICAgICAgICAgICAgID8gJ1RoZXNlIGRyYWZ0cyB3aWxsIGJlIHBlcm1hbmVudGx5IGRlbGV0ZWQuJwogICAgICAgICAgICAgICAgOiAnVGhpcyBkcmFmdCB3aWxsIGJlIHBlcm1hbmVudGx5IGRlbGV0ZWQuJzsKICAgICAgICAgICAgdmFyIGRpc2NhcmRQcm9wcyA9IHsKICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgICBvbkNvbmZpcm06IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBkcmFmdElkcy5mb3JFYWNoKGZ1bmN0aW9uIChkcmFmdElkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLmRpc3BhdGNoQWN0aW9uKGRyYWZ0RGVsZXRlKGRyYWZ0SWQpKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbmZpcm1Qcm9wczogdW5kZWZpbmVkIH0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGNvbmZpcm1Db3B5OiAnT0snLAogICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbmZpcm1Qcm9wczogdW5kZWZpbmVkIH0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IGRpc2NhcmRQcm9wcyB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLnJlbmRlck9uYm9hcmRpbmdGb290ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCBkaXNwYXRjaEFjdGlvbiA9IF9hLmRpc3BhdGNoQWN0aW9uLCBhY2NvdW50cyA9IF9hLmFjY291bnRzLCBwcmVmZXJlbmNlcyA9IF9hLnByZWZlcmVuY2VzLCBzaG93Q29tcGxldGVPbmJvYXJkaW5nID0gX2Euc2hvd0NvbXBsZXRlT25ib2FyZGluZywgc2hvd0NyZWF0ZURyYWZ0T25ib2FyZGluZyA9IF9hLnNob3dDcmVhdGVEcmFmdE9uYm9hcmRpbmcsIHNob3dDb21tYW5kQ2VudGVyT25ib2FyZGluZyA9IF9hLnNob3dDb21tYW5kQ2VudGVyT25ib2FyZGluZywgc2hvd01lbnRpb25zVGFiT25ib2FyZGluZyA9IF9hLnNob3dNZW50aW9uc1RhYk9uYm9hcmRpbmcsIHNob3dJbnZpdGVUZWFtT25ib2FyZGluZyA9IF9hLnNob3dJbnZpdGVUZWFtT25ib2FyZGluZywgZmVhdHVyZXMgPSBfYS5mZWF0dXJlczsKICAgICAgICAgICAgdmFyIG9uYm9hcmRpbmdIYW5kbGVycyA9IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZDogJ2NyZWF0ZURyYWZ0JywKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1JlYWwtdGltZSBpbnNpZ2h0cyBvbiBldmVyeSBtZXNzYWdlJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVHJhY2sgd2hlbiBwZW9wbGUgb3BlbiwgY2xpY2snICsKICAgICAgICAgICAgICAgICAgICAgICAgJyBhbmQgZW5nYWdlIHdpdGggeW91ciBlbWFpbHMgYnkgc2VuZGluZyB0aGVtIHdpdGggUG9seW1haWwnLAogICAgICAgICAgICAgICAgICAgIGJ1dHRvbkNvcHk6ICdUcnkgaXQnLAogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByZWZlcmVuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWFpbFRvU3RyaW5nID0gJ1BvbHkgQm90IDxvbmJvYXJkaW5nQHBvbHltYWlsLmlvPj9zdWJqZWN0PeKaoe+4jyAnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnU2VuZCB5b3VyIGZpcnN0IG1lc3NhZ2Ugd2l0aCB0cmFja2luZyEmYm9keT1IZWxsbyEg8J+Ri/Cfj7xcblxuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJ1BvbHltYWlsIGF1dG9tYXRpY2FsbHkgdHJhY2tzIHlvdXIgbWVzc2FnZXMgdG8gbm90aWZ5IHlvdSB3aGVuIHRoZXnigJl2ZSBiZWVuIHJlYWQuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJ1xuXG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAnVHJ5IGNsaWNraW5nIHNlbmQgdG8gc2VlIGhvdyBpdCB3b3JrcyEnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRyYWZ0ID0gY3JlYXRlTWFpbFRvRHJhZnQoYWNjb3VudHNbMF0sIHByZWZlcmVuY2VzLCBmZWF0dXJlcywgbWFpbFRvU3RyaW5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKGRyYWZ0Q3JlYXRlKGRyYWZ0KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24ob25ib2FyZGluZ1BhdGNoKHsgc2tpcHBlZDogZmFsc2UsIHR5cGU6IHsgY3JlYXRlRHJhZnQ6IHRydWUgfSB9KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvblNraXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24ob25ib2FyZGluZ1BhdGNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNraXBwZWQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlRHJhZnQ6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE1lc3NhZ2U6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyZWFkRGV0YWlsVHJhY2tpbmc6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWQ6ICdzZXF1ZW5jZXMnLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnQXV0b21hdGUgb3V0cmVhY2ggd2l0aCBTZXF1ZW5jZXMnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdSZWFjaGluZyBvdXQgdG8gcG90ZW50aWFsIGN1c3RvbWVycyBvciBjbGllbnRzPycgKwogICAgICAgICAgICAgICAgICAgICAgICAnIEF1dG9tYXRlIHlvdXIgZW1haWwgb3V0cmVhY2ggYW5kIGZvbGxvdy11cCB3aXRoIFNlcXVlbmNlcy4nLAogICAgICAgICAgICAgICAgICAgIGJ1dHRvbkNvcHk6ICdUcnkgU2VxdWVuY2VzJywKICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKG9uYm9hcmRpbmdQYXRjaCh7IHNraXBwZWQ6IGZhbHNlLCB0eXBlOiB7IHNlcXVlbmNlczogdHJ1ZSB9IH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3Nlckhpc3RvcnkucHVzaCgnL3NlcXVlbmNlcycpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25Ta2lwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKG9uYm9hcmRpbmdQYXRjaCh7IHNraXBwZWQ6IHRydWUsIHR5cGU6IHsgc2VxdWVuY2VzOiB0cnVlIH0gfSkpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlkOiAnc2NoZWR1bGluZycsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdTY2hlZHVsZSBtZWV0aW5ncyBpbnN0YW50bHknLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdDcmVhdGUgeW91ciBwZXJzb25hbCBQb2x5bWFpbCBjYWxlbmRhciBwYWdlICcgKwogICAgICAgICAgICAgICAgICAgICAgICAnIHRvIHNoYXJlIGF2YWlsYWJsZSBtZWV0aW5nIHRpbWVzIGFuZCBsZXQgcGVvcGxlIGJvb2sgbWVldGluZ3Mgd2l0aCB5b3UgaW5zdGFudGx5LicsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ29weTogJ1NldCBVcCBDYWxlbmRhcicsCiAgICAgICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBicm93c2VySGlzdG9yeS5wdXNoKCcvc2V0dGluZ3MvY2FsZW5kYXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24ob25ib2FyZGluZ1BhdGNoKHsgc2tpcHBlZDogZmFsc2UsIHR5cGU6IHsgc2NoZWR1bGluZzogdHJ1ZSB9IH0pKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uU2tpcDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihvbmJvYXJkaW5nUGF0Y2goeyBza2lwcGVkOiB0cnVlLCB0eXBlOiB7IHNjaGVkdWxpbmc6IHRydWUgfSB9KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWQ6ICdkb3dubG9hZE5hdGl2ZUFwcHMnLAogICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnWW91XCdyZSBhbGwgc2V0IScsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0Rvd25sb2FkIHRoZSBQb2x5bWFpbCBhcHBzIGZvciBNYWMgYW5kIGlPUycKICAgICAgICAgICAgICAgICAgICAgICAgKyAnIGZvciBmdWxsIGFjY2VzcyB0byBtZXNzYWdlcyBhbmQgbm90aWZpY2F0aW9ucyBvbiB0aGUgZ28uJywKICAgICAgICAgICAgICAgICAgICBidXR0b25Db3B5OiAnRG93bmxvYWQnLAogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24ob25ib2FyZGluZ1BhdGNoKHsgc2tpcHBlZDogZmFsc2UsIHR5cGU6IHsgZG93bmxvYWROYXRpdmVBcHBzOiB0cnVlIH0gfSkpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2dBbXBsaXR1ZGVFdmVudChBbXBsaXR1ZGVFdmVudHMuVG91clN0ZXBUaGlydGVlbiwgeyBza2lwcGVkOiBmYWxzZSB9KTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uU2tpcDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihvbmJvYXJkaW5nUGF0Y2goeyBza2lwcGVkOiBmYWxzZSwgdHlwZTogeyBkb3dubG9hZE5hdGl2ZUFwcHM6IHRydWUgfSB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ0FtcGxpdHVkZUV2ZW50KEFtcGxpdHVkZUV2ZW50cy5Ub3VyU3RlcFRoaXJ0ZWVuLCB7IHNraXBwZWQ6IHRydWUgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaWQ6ICdjb21tYW5kQ2VudGVyJywKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0dldCBhcm91bmQgUG9seW1haWwgZmFzdGVyIOKcqCcsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUh0bWw6IChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAnVXNlICcsCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoS2V5Ym9hcmRTeW1ib2wsIHsgY2hhcmFjdGVyOiAnQ21kJyB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChLZXlib2FyZFN5bWJvbCwgeyBjaGFyYWN0ZXI6IEtleUNvZGUuSiB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgJyB0byBlYXNpbHkgbmF2aWdhdGUgYW5kIHBlcmZvcm0gYWN0aW9ucyBpbiBQb2x5bWFpbCEnKSksCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ29weTogJ1RyeSBpdCcsCiAgICAgICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihjb21tYW5kQ29udHJvbFNob3coQ29tbWFuZENvbnRyb2xUeXBlLlRocmVhZCkpOwogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihvbmJvYXJkaW5nUGF0Y2goeyBza2lwcGVkOiBmYWxzZSwgdHlwZTogeyBjb21tYW5kQ2VudGVyOiB0cnVlIH0gfSkpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25Ta2lwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKG9uYm9hcmRpbmdQYXRjaCh7IHNraXBwZWQ6IHRydWUsIHR5cGU6IHsgY29tbWFuZENlbnRlcjogdHJ1ZSB9IH0pKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBpZDogJ21lbnRpb25zJywKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1lvdVwndmUgYmVlbiBtZW50aW9uZWQhJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU29tZW9uZSBAbWVudGlvbmVkIHlvdSBpbiBhIGNvbW1lbnQhIENsaWNrIHRoZSBNZW50aW9ucyB0YWInCiAgICAgICAgICAgICAgICAgICAgICAgICsgJyB0byB2aWV3IGNvbnZlcnNhdGlvbnMgeW91XCd2ZSBiZWVuIEBtZW50aW9uZWQgaW4nLAogICAgICAgICAgICAgICAgICAgIGJ1dHRvbkNvcHk6ICdTZWUgTWVudGlvbnMnLAogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYnJvd3Nlckhpc3RvcnkucHVzaCgnL21lbnRpb25zJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKG9uYm9hcmRpbmdQYXRjaCh7IHNraXBwZWQ6IGZhbHNlLCB0eXBlOiB7IG1lbnRpb25zVGFiOiB0cnVlIH0gfSkpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25Ta2lwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKG9uYm9hcmRpbmdQYXRjaCh7IHNraXBwZWQ6IGZhbHNlLCB0eXBlOiB7IG1lbnRpb25zVGFiOiB0cnVlIH0gfSkpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlkOiAndGVhbUludml0ZScsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdKdXN0IEFkZCBUZWFtbWF0ZXMnLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUbyBnZXQgdGhlIG1vc3Qgb3V0IG9mIFBvbHltYWlsLCBpbnZpdGUgc29tZSBjb3dvcmtlcnMgdG8gc3RhcnQgY29sbGFib3JhdGluZycsCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uQ29weTogJ0ludml0ZSBUZWFtbWF0ZXMnLAogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5VXBkYXRlKEhvdGtleUFjdGlvbi5JbnZpdGVUZWFtTWVtYmVycykpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25Ta2lwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKG9uYm9hcmRpbmdQYXRjaCh7IHNraXBwZWQ6IHRydWUsIHR5cGU6IHsgaW52aXRlVGVhbU1lbWJlcnM6IHRydWUgfSB9KSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIHZhciBwcm9wczsKICAgICAgICAgICAgaWYgKHNob3dDb21tYW5kQ2VudGVyT25ib2FyZGluZykgewogICAgICAgICAgICAgICAgcHJvcHMgPSBvbmJvYXJkaW5nSGFuZGxlcnNbNF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNob3dDb21wbGV0ZU9uYm9hcmRpbmcpIHsKICAgICAgICAgICAgICAgIHByb3BzID0gb25ib2FyZGluZ0hhbmRsZXJzWzNdOwogICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkSU9TQ2xpY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4oJ2h0dHBzOi8vaXR1bmVzLmFwcGxlLmNvbS91cy9hcHAvcG9seW1haWwvaWQxMDgyMDU4Mzg2P210PTgnLCAnX2JsYW5rJyk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkRWxlY3Ryb25DbGljayA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3BlbignaHR0cHM6Ly9wb2x5bWFpbC5pby9kb3dubG9hZD9kb3dubG9hZF9tYWM9MSZ1dG1fc291cmNlPXdlYmFwcCcsICdfYmxhbmsnKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBwcm9wcy5idXR0b25IdG1sID0gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZG93bmxvYWQtYnV0dG9ucyIgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImluZm8tc2VjdGlvbiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgIkRvd25sb2FkIFBvbHltYWlsIGZvcjoiLAogICAgICAgICAgICAgICAgICAgICAgICAhaXNFbGVjdHJvbk1hYyAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgeyBjbGFzc05hbWU6ICJkb3dubG9hZC1idXR0b24iLCBvbkNsaWNrOiBkb3dubG9hZEVsZWN0cm9uQ2xpY2sgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEFwcGxlSWNvbldoaXRlLCB7IGhlaWdodDogIjE1cHgiLCB3aWR0aDogIjE1cHgiLCBjbGFzc05hbWU6ICJpY29uIiB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTWFjIiksCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsgb25DbGljazogZG93bmxvYWRJT1NDbGljaywgY2xhc3NOYW1lOiAiZG93bmxvYWQtYnV0dG9uIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChBcHBsZUljb25XaGl0ZSwgeyBoZWlnaHQ6ICIxNXB4Iiwgd2lkdGg6ICIxNXB4IiwgY2xhc3NOYW1lOiAiaWNvbiIgfSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiaU9TIikpKSk7CiAgICAgICAgICAgICAgICBwcm9wcy5za2lwQ29weSA9ICdEb25lJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2hvd01lbnRpb25zVGFiT25ib2FyZGluZykgewogICAgICAgICAgICAgICAgcHJvcHMgPSBvbmJvYXJkaW5nSGFuZGxlcnNbNV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNob3dJbnZpdGVUZWFtT25ib2FyZGluZykgewogICAgICAgICAgICAgICAgcHJvcHMgPSBvbmJvYXJkaW5nSGFuZGxlcnNbNl07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNob3dDcmVhdGVEcmFmdE9uYm9hcmRpbmcpIHsKICAgICAgICAgICAgICAgIHByb3BzID0gb25ib2FyZGluZ0hhbmRsZXJzWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcHJvcHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChPbmJvYXJkaW5nRm9vdGVyLCBfX2Fzc2lnbih7fSwgcHJvcHMpKSk7CiAgICAgICAgfTsKICAgICAgICB2YXIgc2VsZWN0ZWRUaHJlYWQgPSBwcm9wcy5zZWxlY3RlZFRocmVhZDsKICAgICAgICB2YXIgbGFzdE1lc3NhZ2UgPSBzZWxlY3RlZFRocmVhZCAmJiBzZWxlY3RlZFRocmVhZC5tZXNzYWdlcy5sZW5ndGggPwogICAgICAgICAgICBsYXN0KGZpbHRlcihzZWxlY3RlZFRocmVhZC5tZXNzYWdlcywgZnVuY3Rpb24gKG1lc3NhZ2UpIHsgcmV0dXJuICFtZXNzYWdlLnNlbnQ7IH0pKSA6IHVuZGVmaW5lZDsKICAgICAgICB2YXIgc2VuZGVyID0gbGFzdE1lc3NhZ2UgJiYgbGFzdE1lc3NhZ2UuZnJvbTsKICAgICAgICBpZiAoc2VuZGVyKSB7CiAgICAgICAgICAgIHByb3BzLnNlbGVjdENvbnRhY3QocGFyc2VBZGRyZXNzKHNlbmRlcikuZW1haWwpOwogICAgICAgIH0KICAgICAgICBfdGhpcy5zdGF0ZSA9IHt9OwogICAgICAgIHJldHVybiBfdGhpczsKICAgIH0KICAgIFRocmVhZHMucHJvdG90eXBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5oYW5kbGVGb2N1cyk7CiAgICB9OwogICAgVGhyZWFkcy5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5oYW5kbGVGb2N1cyk7CiAgICB9OwogICAgVGhyZWFkcy5wcm90b3R5cGUuY29tcG9uZW50RGlkVXBkYXRlID0gZnVuY3Rpb24gKG9sZFByb3BzKSB7CiAgICAgICAgdmFyIG9sZEFjdGlvbnMgPSBvbGRQcm9wcy5ob3RrZXlBY3Rpb25zIHx8IHt9OwogICAgICAgIHZhciBuZXdBY3Rpb25zID0gdGhpcy5wcm9wcy5ob3RrZXlBY3Rpb25zIHx8IHt9OwogICAgICAgIHRoaXMuaGFuZGxlSG90a2V5QWN0aW9uc0NoYW5nZShvbGRBY3Rpb25zLCBuZXdBY3Rpb25zKTsKICAgICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiBkb2N1bWVudC5hY3RpdmVFbGVtZW50LnRhZ05hbWUgPT09ICdCT0RZJykgewogICAgICAgICAgICB0aGlzLmhhbmRsZUZvY3VzKCk7CiAgICAgICAgfQogICAgICAgIHZhciBzZWxlY3RlZFRocmVhZCA9IG9sZFByb3BzLnNlbGVjdGVkVGhyZWFkLCBzZWxlY3RDb250YWN0ID0gb2xkUHJvcHMuc2VsZWN0Q29udGFjdCwgc2VsZWN0ZWRDb250YWN0ID0gb2xkUHJvcHMuc2VsZWN0ZWRDb250YWN0OwogICAgICAgIHZhciBsYXN0TWVzc2FnZSA9IHNlbGVjdGVkVGhyZWFkICYmIHNlbGVjdGVkVGhyZWFkLm1lc3NhZ2VzLmxlbmd0aCA/CiAgICAgICAgICAgIGxhc3QoZmlsdGVyKHNlbGVjdGVkVGhyZWFkLm1lc3NhZ2VzLCBmdW5jdGlvbiAobWVzc2FnZSkgeyByZXR1cm4gIW1lc3NhZ2Uuc2VudDsgfSkpIDogdW5kZWZpbmVkOwogICAgICAgIHZhciBzZW5kZXIgPSBsYXN0TWVzc2FnZSAmJiBsYXN0TWVzc2FnZS5mcm9tOwogICAgICAgIHZhciBlbWFpbCA9IHNlbmRlciAmJiBwYXJzZUFkZHJlc3Moc2VuZGVyKS5lbWFpbDsKICAgICAgICBpZiAoZW1haWwgJiYgKCFzZWxlY3RlZENvbnRhY3QgfHwgc2VsZWN0ZWRUaHJlYWQgIT09IHRoaXMucHJvcHMuc2VsZWN0ZWRUaHJlYWQpKSB7CiAgICAgICAgICAgIHNlbGVjdENvbnRhY3QoZW1haWwpOwogICAgICAgIH0KICAgICAgICAvLyBJZiBDb21tYW5kQ29udHJvbCB3YXMgZGlzbWlzc2VkLCB0aGVuIHJlc2V0IGZvY3VzIGJhY2sgdG8gdGhyZWFkcywgdW5sZXNzIGRyYWZ0IGlzIHNldAogICAgICAgIGlmICghdGhpcy5wcm9wcy5jb21tYW5kQ29udHJvbFR5cGUgJiYgb2xkUHJvcHMuY29tbWFuZENvbnRyb2xUeXBlKSB7CiAgICAgICAgICAgIC8vIEhBQ0soU0hJTik6IERvIG5vdCBkbyBhbnl0aGluZyBpZiBjb250ZW50ZWRpdGFibGUgb3Igc2VhcmNoIGhhcyBmb2N1cwogICAgICAgICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgewogICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5hY3RpdmVFbGVtZW50LmdldEF0dHJpYnV0ZSgndHlwZScpID09PSAnc2VhcmNoJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5kcmFmdCkgewogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRFZGl0YWJsZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29tcG9zZS1lZGl0YWJsZScpOwogICAgICAgICAgICAgICAgdmFyIGNvbXBvc2VFbGVtZW50ID0gY29udGVudEVkaXRhYmxlRWxlbWVudCAmJiBjb250ZW50RWRpdGFibGVFbGVtZW50LnBhcmVudEVsZW1lbnQ7CiAgICAgICAgICAgICAgICBpZiAoY29udGVudEVkaXRhYmxlRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ICYmIGNvbXBvc2VFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaGFuZGxlRm9jdXMoKTsKICAgICAgICB9CiAgICAgICAgLy8gSWRlbnRpZnkgaWYgYm94IHR5cGUgY2hhbmdlZCB0byByZWZvY3VzIHRocmVhZHMgbGlzdAogICAgICAgIHZhciBvbGRNYWlsYm94ID0gdGhpcy5wcm9wcy5zZWxlY3RlZE1haWxib3g7CiAgICAgICAgdmFyIG5ld01haWxib3ggPSBvbGRQcm9wcy5zZWxlY3RlZE1haWxib3g7CiAgICAgICAgdmFyIGJveFR5cGVDaGFuZ2VkID0gKG5ld01haWxib3ggJiYgKCFvbGRNYWlsYm94IHx8IG9sZE1haWxib3ggJiYgb2xkTWFpbGJveC50eXBlICE9PSBuZXdNYWlsYm94LnR5cGUpKTsKICAgICAgICAvLyBSZXR1cm4gZm9jdXMgb24gZHJhZnQgZGVsZXRlIG9yIG1haWxib3ggY2hhbmdlCiAgICAgICAgaWYgKGJveFR5cGVDaGFuZ2VkIHx8ICghdGhpcy5wcm9wcy5kcmFmdCAmJiBvbGRQcm9wcy5kcmFmdCkpIHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVGb2N1cygpOwogICAgICAgIH0KICAgIH07CiAgICBUaHJlYWRzLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9hID0gdGhpcy5wcm9wcywgc2VsZWN0ZWRNYWlsYm94ID0gX2Euc2VsZWN0ZWRNYWlsYm94LCBzZXNzaW9uSWQgPSBfYS5zZXNzaW9uSWQsIG1haWxDb3VudCA9IF9hLm1haWxDb3VudCwgc2VsZWN0ZWRUaHJlYWQgPSBfYS5zZWxlY3RlZFRocmVhZCwgZHJhZnQgPSBfYS5kcmFmdCwgaW5pdGlhbFN5bmNpbmcgPSBfYS5pbml0aWFsU3luY2luZywgc2hvd0V4cGxvcmVNb2RhbCA9IF9hLnNob3dFeHBsb3JlTW9kYWwsIHNob3dUZWFtSW52aXRlSm9pbmVkUHJvbXB0ID0gX2Euc2hvd1RlYW1JbnZpdGVKb2luZWRQcm9tcHQ7CiAgICAgICAgdmFyIF9iID0gdGhpcy5zdGF0ZSwgY29uZmlybVByb3BzID0gX2IuY29uZmlybVByb3BzLCBibG9ja0NvbmZpcm1Qcm9wcyA9IF9iLmJsb2NrQ29uZmlybVByb3BzOwogICAgICAgIHZhciBpc0luYm94WmVybyA9IG1haWxDb3VudCAmJiBtYWlsQ291bnQuaW5ib3hSZWFkICsgbWFpbENvdW50LmluYm94VW5yZWFkID09PSAwCiAgICAgICAgICAgICYmICFkcmFmdAogICAgICAgICAgICAmJiAhc2VsZWN0ZWRUaHJlYWQKICAgICAgICAgICAgJiYgIWluaXRpYWxTeW5jaW5nCiAgICAgICAgICAgICYmIHNlbGVjdGVkTWFpbGJveCAmJiAhc2VsZWN0ZWRNYWlsYm94LnF1ZXJ5CiAgICAgICAgICAgICYmIHNlbGVjdGVkTWFpbGJveC50eXBlID09PSBNYWlsYm94VHlwZS5JbmJveDsKICAgICAgICAvLyBUT0RPIChDaW5keSAmIFNoaW4pOiBGaWd1cmUgb3V0IGJldHRlciB3YXkgb2YgY29ubmVjdGluZyBjb250YWluZXIKICAgICAgICB2YXIgVGhyZWFkTGlzdENvbm5lY3QgPSBUaHJlYWRMaXN0OwogICAgICAgIHZhciBMZWZ0U2lkZWJhckNvbm5lY3QgPSBMZWZ0U2lkZWJhcjsKICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGhyZWFkcyIsIG9uS2V5RG93bjogdGhpcy5oYW5kbGVLZXlEb3duIH0sCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29udGFjdFN1cHBvcnQsIG51bGwpLAogICAgICAgICAgICBibG9ja0NvbmZpcm1Qcm9wcyAmJgogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChCbG9ja0NvbmZpcm0sIF9fYXNzaWduKHt9LCBibG9ja0NvbmZpcm1Qcm9wcykpLAogICAgICAgICAgICBjb25maXJtUHJvcHMgJiYKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29uZmlybSwgX19hc3NpZ24oe30sIGNvbmZpcm1Qcm9wcykpLAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogIm1haW4tYXBwIiB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChMZWZ0U2lkZWJhckNvbm5lY3QsIHsgYWNjb3VudHM6IFtdIH0pLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChUaHJlYWRMaXN0Q29ubmVjdCwgeyBvblVuZG86IHRoaXMuaGFuZGxlVW5kbyB9KSwKICAgICAgICAgICAgICAgICFpc0luYm94WmVybyAmJgogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVGhyZWFkRGV0YWlsLCB7IG9uVGhyZWFkRGVsZXRlOiB0aGlzLmhhbmRsZVRocmVhZERlbGV0ZSB9KSwKICAgICAgICAgICAgICAgIGlzSW5ib3haZXJvICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSW5ib3haZXJvLCB7IGlkOiBzZXNzaW9uSWQgfSksCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFJpZ2h0U2lkZWJhciwgeyBwYWdlOiBQYWdlLlRocmVhZHMgfSksCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENvbW1hbmRDb250cm9sLCB7IGRlZmF1bHQ6IENvbW1hbmRDb250cm9sVHlwZS5UaHJlYWQgfSkpLAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRvYXN0LCBudWxsKSwKICAgICAgICAgICAgdGhpcy5yZW5kZXJPbmJvYXJkaW5nRm9vdGVyKCksCiAgICAgICAgICAgIHNob3dUZWFtSW52aXRlSm9pbmVkUHJvbXB0ICYmIChSZWFjdC5jcmVhdGVFbGVtZW50KFRlYW1Kb2luZWQsIG51bGwpKSwKICAgICAgICAgICAgc2hvd0V4cGxvcmVNb2RhbCAmJiAhc2hvd1RlYW1JbnZpdGVKb2luZWRQcm9tcHQgJiYKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoR2V0dGluZ1N0YXJ0ZWQsIHsgb25OZXh0OiB0aGlzLmhhbmRsZVN0YXJ0T25ib2FyZGluZyB9KSkpOwogICAgfTsKICAgIHJldHVybiBUaHJlYWRzOwp9KFJlYWN0LlB1cmVDb21wb25lbnQpKTsKZXhwb3J0IGRlZmF1bHQgVGhyZWFkczsK"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/Threads.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/Threads.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport { History } from 'history';\nimport { last, filter, startCase } from 'lodash';\n\nimport {\n  Thread,\n  ContactGroup,\n  CommandControlType,\n  MessageBody,\n  MailboxType,\n  Mailbox,\n  Account,\n  ThreadBox,\n  Draft,\n  Action,\n  ThreadCommitMeta,\n  Resource,\n  MailCount,\n  Preferences,\n  UnsubscribeBehavior,\n  Me,\n  ShareLink,\n  KeyCode,\n  BlockContactActionType,\n  Features,\n  OnboardingType,\n  ThemeSetting,\n} from '@src/types';\nimport {\n  RightSidebarTab, Page,\n} from '@src/types/rightSidebar';\n\nimport { HotkeyAction, getHotkey, checkNextHotkeyChange } from '@src/lib/hotkeys';\nimport { parseAddress, addressToEmail } from '@src/lib/address';\nimport { threadMoveUndo, threadCommitsSubmit, threadDisableTrack } from '@src/ducks/threads';\n\nimport './Threads.scss';\n\nimport ThreadList from './components/ThreadList';\nimport ThreadDetail from '@src/components/ThreadDetail';\nimport LeftSidebar from '@src/components/LeftSidebar';\nimport RightSidebar from '@src/components/RightSidebar';\nimport CommandControl from '@src/components/CommandControl';\nimport InboxZero from './components/InboxZero/InboxZero';\nimport Toast from '@src/components/Base/Toast';\nimport { recordEvent, UserEvents } from '@src/lib/analytics';\nimport { UpgradePrompt } from '@src/types/billing';\nimport Confirm, { Props as ConfirmProps } from '@src/components/Base/Confirm';\n// tslint:disable-next-line:max-line-length\nimport BlockConfirm, { Props as BlockConfirmProps } from '@src/components/Base/BlockConfirm/BlockConfirm';\nimport OnboardingFooter from '@src/components/Banner/OnboardingFooter/OnboardingFooter';\nimport { commandControlShow } from '@src/ducks/commandControl';\nimport browserHistory from '@src/lib/browserHistory';\nimport { onboardingPatch } from '@src/ducks/me';\nimport { draftCreate, draftDelete, draftSendNow, draftUpdate } from '@src/ducks/drafts';\nimport { createMailToDraft, isDraftSending } from '@src/lib/draft';\nimport GettingStarted from '@src/components/Onboarding/components/GettingStarted';\nimport KeyboardSymbol from '@src/components/Base/KeyboardSymbol/KeyboardSymbol';\nimport { isElectronMac } from '@src/lib/electron';\nimport AppleIconWhite from '@src/components/Icons/AppleIconWhite.svg';\nimport { hotkeyUpdate } from '@src/ducks/hotkeys';\nimport { filterDelete, filterSet, filterBlockCreate } from '@src/ducks/filters';\nimport { Filter } from '@src/types/filters';\nimport { isDraftBox } from '@src/lib/mailbox';\nimport { toastSet, ConfirmationError } from '@src/ducks/toasts';\nimport { getOnboardingActions } from '@src/lib/OnboardingDispatcher';\nimport { appThemeSet } from '@src/ducks/app';\nimport { leftSidebarToggle } from '@src/ducks/leftSidebar';\nimport TeamJoined from '@src/components/Onboarding/components/TeamJoined';\nimport { rightSidebarTabSelect } from '@src/ducks/rightSidebar';\nimport { AmplitudeEvents, logAmplitudeEvent } from '@src/lib/amplitude-analytics';\nimport ContactSupport from '@src/components/ContactSupport';\n\nexport interface Props {\n  history?: History;\n  contactGroups: { [id: string]: ContactGroup; };\n  selectedThread?: Thread;\n  selectedIds: Map<string, boolean>;\n  bodies: MessageBody[];\n  sessionId: number;\n  selectedMailbox: Mailbox;\n  accounts: Account[];\n  threads: Resource<Thread[]>;\n  selectedContact?: string;\n  commandControlType?: CommandControlType;\n  draft?: Draft;\n  sendingDraft?: Draft;\n  mailCount?: MailCount;\n  unsubscribeLink?: string;\n  preferences?: Preferences;\n  me: Resource<Me>;\n  shareLink?: ShareLink;\n  initialSyncing?: boolean;\n  upgradePrompts: UpgradePrompt;\n  closedBanners: { [id: string]: boolean };\n  rightSidebarCollapsed: boolean;\n  rightSidebarTab?: RightSidebarTab;\n  selectedAccount?: string;\n  schedulingUrl?: string;\n  hotkeyActions?: { [key: string]: number };\n  blockFilter?: Filter;\n  features: Features;\n\n  showCommandCenterOnboarding?: boolean;\n  showCompleteOnboarding?: boolean;\n  showCreateDraftOnboarding?: boolean;\n  showExploreModal?: boolean;\n  showInviteTeamOnboarding?: boolean;\n  showMentionsTabOnboarding?: boolean;\n  rsbOnboardingType?: OnboardingType;\n  showTeamInviteJoinedPrompt?: boolean;\n}\n\nexport interface DispatchProps {\n  dispatchAction: (action: Action<any, any>) => void;\n  selectContact: (email: string) => void;\n  submitCommitMeta: (commitMeta: ThreadCommitMeta) => void;\n  updateSelections: (selections: Map<string, boolean>) => void;\n  closeBanner: (banner: string) => void;\n  collapseRightSidebar: (collapse: boolean) => void;\n  updateHotkey: (hotkey: HotkeyAction) => void;\n}\n\nexport interface State {\n  confirmProps?: ConfirmProps;\n  blockConfirmProps?: BlockConfirmProps;\n}\n\nclass Threads extends React.PureComponent<Props & DispatchProps, State> {\n  constructor(props: Props & DispatchProps) {\n    super();\n\n    const { selectedThread } = props;\n    const lastMessage = selectedThread && selectedThread.messages.length ?\n      last(filter(selectedThread.messages, message => !message.sent)) : undefined;\n    const sender = lastMessage && lastMessage.from;\n    if (sender) {\n      props.selectContact(parseAddress(sender).email);\n    }\n\n    this.state = {};\n  }\n\n  UNSAFE_componentWillMount() {\n    window.addEventListener('focus', this.handleFocus);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('focus', this.handleFocus);\n  }\n\n  componentDidUpdate(oldProps: Props & DispatchProps) {\n    const oldActions = oldProps.hotkeyActions || {};\n    const newActions = this.props.hotkeyActions || {};\n    this.handleHotkeyActionsChange(oldActions, newActions);\n\n    if (document.activeElement && document.activeElement.tagName === 'BODY') {\n      this.handleFocus();\n    }\n\n    const { selectedThread, selectContact, selectedContact } = oldProps;\n    const lastMessage = selectedThread && selectedThread.messages.length ?\n      last(filter(selectedThread.messages, message => !message.sent)) : undefined;\n    const sender = lastMessage && lastMessage.from;\n    const email = sender && parseAddress(sender).email;\n    if (email && (!selectedContact || selectedThread !== this.props.selectedThread)) {\n      selectContact(email);\n    }\n\n    // If CommandControl was dismissed, then reset focus back to threads, unless draft is set\n    if (!this.props.commandControlType && oldProps.commandControlType) {\n        // HACK(SHIN): Do not do anything if contenteditable or search has focus\n      if (document.activeElement) {\n        if (document.activeElement.getAttribute('contenteditable')) {\n          return;\n        }\n        if (document.activeElement.getAttribute('type') === 'search') {\n          return;\n        }\n      }\n\n      if (this.props.draft) {\n        const contentEditableElement = document.querySelector('.compose-editable');\n        const composeElement = contentEditableElement && contentEditableElement.parentElement;\n        if (contentEditableElement instanceof HTMLElement && composeElement) {\n          return;\n        }\n\n        return;\n      }\n      this.handleFocus();\n    }\n\n    // Identify if box type changed to refocus threads list\n    const oldMailbox = this.props.selectedMailbox;\n    const newMailbox = oldProps.selectedMailbox;\n    const boxTypeChanged = (\n      newMailbox && (!oldMailbox || oldMailbox && oldMailbox.type !== newMailbox.type));\n\n    // Return focus on draft delete or mailbox change\n    if (boxTypeChanged || (!this.props.draft && oldProps.draft)) {\n      this.handleFocus();\n    }\n  }\n\n  handleHotkeyActionsChange = (\n    oldActions: { [action: string]: number },\n    newActions: { [action: string]: number },\n  ) => {\n    const {\n      dispatchAction,\n      selectedThread,\n      preferences,\n      submitCommitMeta,\n      blockFilter,\n      unsubscribeLink,\n    } = this.props;\n\n    // Handle DarkMode toggle\n    if (checkNextHotkeyChange(HotkeyAction.ToggleDarkMode, newActions, oldActions)) {\n      const theme = document.body.getAttribute('theme') === 'theme-dark'\n        ? ThemeSetting.Light\n        : ThemeSetting.Dark;\n      dispatchAction(appThemeSet(theme));\n      return;\n    }\n\n    // Handle Unblock toggle\n    if (checkNextHotkeyChange(HotkeyAction.UnblockSender, newActions, oldActions)) {\n      if (blockFilter) {\n        dispatchAction(filterDelete(blockFilter.id));\n        return;\n      }\n    }\n\n    // Handle Disable Tracks by first showing confirm modal\n    if (checkNextHotkeyChange(HotkeyAction.DisableTracks, newActions, oldActions)) {\n      if (selectedThread) {\n        const disableTracksConfirmProps: ConfirmProps = {\n          title: 'Disable Tracking for this Conversation?',\n          message: 'Tracking will be turned off this conversation and no new activity will be recorded. This is not reversible. Would you like to continue?',\n          confirmCopy: 'Ok',\n          cancelCopy: 'Cancel',\n          onConfirm: () => {\n            this.setState({ confirmProps: undefined }, () => {\n              this.props.dispatchAction(threadDisableTrack(selectedThread.id));\n            });\n          },\n          onCancel: () => {\n            this.setState({ confirmProps: undefined });\n          },\n        };\n\n        this.setState({ confirmProps: disableTracksConfirmProps });\n        return;\n      }\n    }\n\n    // Handle Block toggle\n    if (checkNextHotkeyChange(HotkeyAction.BlockSender, newActions, oldActions)) {\n      if (selectedThread) {\n        const senderLastMessage = last(selectedThread.messages);\n        if (!senderLastMessage) {\n          return;\n        }\n\n        if (!preferences) {\n          return;\n        }\n\n        // Handle setting block\n        const sender = addressToEmail(senderLastMessage.from).toLowerCase();\n        const blockConfirmProps: BlockConfirmProps = {\n          title: `Block ${sender}`,\n          // tslint:disable-next-line:max-line-length\n          message: `Messages received from this sender will be blocked and automatically moved to ${startCase(preferences.blockContactAction)}.`,\n          hasUnsubscribe: !!unsubscribeLink,\n          onUnsubscribeClick: () => {\n            // Handle unsubscribe\n            this.setState(\n              { blockConfirmProps: undefined },\n              () => this.handleUnsubscribe(),\n            );\n            logAmplitudeEvent(AmplitudeEvents.Unsubscribe);\n          },\n          onConfirm: () => {\n            // Block filter\n            dispatchAction(filterSet(filterBlockCreate(sender)));\n\n            // Handle sending to proper destination box\n            switch (preferences.blockContactAction) {\n              case BlockContactActionType.Archive:\n                const blockArchiveCommit: ThreadCommitMeta = {\n                  singleResource: selectedThread.id,\n                  box: ThreadBox.Archive,\n                };\n                submitCommitMeta(blockArchiveCommit);\n                break;\n              case BlockContactActionType.Trash:\n                const blockTrashCommit: ThreadCommitMeta = {\n                  singleResource: selectedThread.id,\n                  box: ThreadBox.Trash,\n                };\n                submitCommitMeta(blockTrashCommit);\n                break;\n              default: break;\n            }\n            logAmplitudeEvent(AmplitudeEvents.BlockSender);\n\n            // Remove confirmProps\n            this.setState({ blockConfirmProps: undefined });\n          },\n          onCancel: () => {\n            this.setState({ blockConfirmProps: undefined });\n          },\n        };\n\n        // Set ConfirmProps to confirm block\n        this.setState({ blockConfirmProps });\n      }\n    }\n  }\n\n  handleFocus = () => {\n    if (document.activeElement && document.activeElement.tagName.toLowerCase() !== 'body') {\n      return;\n    }\n\n    const { selectedThread } = this.props;\n    const container = document.getElementsByClassName('infinite-thread-list');\n    const element = selectedThread && document.getElementById(selectedThread.id);\n\n    if (element) {\n      element.focus();\n    } else if (container && container.length) {\n      (container[0] as HTMLElement).focus();\n    }\n  }\n\n  // Ability to handle moves for all threads\n  handleThreadMove = (box: ThreadBox) => {\n    this.props.submitCommitMeta({ box });\n  }\n\n  handleTrialExpiredClose = () => {\n    this.props.closeBanner('TrialExpired');\n  }\n\n  handleThreadDelete = () => {\n    const confirmProps: ConfirmProps = {\n      title: 'Permanently delete this thread?',\n      message: 'Are you sure? This cannot be undone.',\n      confirmCopy: 'Delete',\n      cancelCopy: 'Cancel',\n      onConfirm: () => {\n        this.handleThreadMove(ThreadBox.Trash);\n        this.setState({ confirmProps: undefined });\n      },\n      onCancel: () => this.setState({ confirmProps: undefined }),\n    };\n\n    this.setState({ confirmProps });\n  }\n\n  handleKeyDown = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    const {\n      history,\n      selectedMailbox,\n      selectedThread,\n      dispatchAction,\n      draft,\n      submitCommitMeta,\n      unsubscribeLink,\n      preferences,\n      rightSidebarCollapsed,\n      collapseRightSidebar,\n      selectedAccount,\n      rightSidebarTab,\n      blockFilter,\n    } = this.props;\n    let handled = false;\n\n    if (document.activeElement && (document.activeElement.tagName === 'INPUT' ||\n      document.activeElement.tagName === 'TEXTAREA')) {\n      return;\n    }\n\n    const hotkey = getHotkey(e);\n    switch (hotkey && hotkey.name || e.keyCode) {\n      case HotkeyAction.Search:\n        handled = true;\n        dispatchAction(hotkeyUpdate(HotkeyAction.Search));\n        break;\n      case HotkeyAction.ShowLinks:\n        if (!!selectedThread) {\n          dispatchAction(rightSidebarTabSelect({\n            rsbTab: RightSidebarTab.LinkExtractor,\n          }));\n          handled = true;\n        }\n        break;\n      case HotkeyAction.KeyboardShortcutGuide:\n        if (hotkey && hotkey.action && rightSidebarTab) {\n          dispatchAction(hotkey.action(rightSidebarTab));\n          handled = true;\n        }\n        break;\n      case HotkeyAction.NewDraft:\n        if (hotkey && hotkey.action) {\n          dispatchAction(hotkey.action);\n          handled = true;\n        }\n        break;\n      // UI Toggle\n      case HotkeyAction.ToggleLSB:\n        handled = true;\n        dispatchAction(leftSidebarToggle(true));\n        break;\n      // UI Toggle\n      case HotkeyAction.ToggleRSB:\n        handled = true;\n        collapseRightSidebar(!rightSidebarCollapsed);\n        break;\n\n      // Drafts\n      case HotkeyAction.Reply:\n      case HotkeyAction.ReplyAll:\n      case HotkeyAction.Forward:\n      case HotkeyAction.ReadLater:\n      case HotkeyAction.Label:\n      case HotkeyAction.ReplyBCC: {\n\n        // Do not trigger if last message recipients is less than two\n        if (hotkey?.name === HotkeyAction.ReplyBCC) {\n          const lastMessage = selectedThread && selectedThread.messages.length ?\n            last(filter(selectedThread.messages, message => !message.sent)) : undefined;\n          if (!lastMessage || lastMessage.to.concat(lastMessage.cc).length < 2) {\n            return;\n          }\n        }\n\n        if (hotkey && hotkey.action && selectedThread) {\n          dispatchAction(hotkey.action);\n          handled = true;\n        }\n        break;\n      }\n\n      // Navigation\n      case HotkeyAction.NavigateInbox:\n      case HotkeyAction.NavigateStarred:\n      case HotkeyAction.NavigateReadLater:\n      case HotkeyAction.NavigateArchive:\n      case HotkeyAction.NavigateTrash:\n      case HotkeyAction.NavigateFollowUp:\n      case HotkeyAction.NavigateSent:\n      case HotkeyAction.NavigateSendLater:\n      case HotkeyAction.NavigateDraft:\n        if (history && selectedMailbox && hotkey && hotkey.route) {\n          history.push(hotkey.route(selectedMailbox, selectedAccount));\n          handled = true;\n        }\n        break;\n      case HotkeyAction.MessageTemplates:\n      case HotkeyAction.CalendarInvite:\n        handled = true;\n        if (hotkey && hotkey.action && draft) {\n          dispatchAction(hotkey.action);\n          handled = true;\n        }\n        break;\n      case HotkeyAction.Inbox:\n        if (selectedThread) {\n          this.handleThreadMove(ThreadBox.Inbox);\n          handled = true;\n        }\n        break;\n      case HotkeyAction.Archive:\n        if (this.props.rsbOnboardingType === OnboardingType.Archive) {\n          dispatchAction(onboardingPatch({\n            skipped: false,\n            type: { steps: { [OnboardingType.Archive]: true } },\n          }));\n          logAmplitudeEvent(AmplitudeEvents.TourStepSeven, { skipped: false });\n        }\n        getOnboardingActions().next(OnboardingType.Archive);\n        if (selectedThread) {\n          this.handleThreadMove(ThreadBox.Archive);\n        }\n        break;\n      case HotkeyAction.CancelFollowup: // Handles cancelling follow up reminders via hotkey\n        if (draft && draft.waiting) {\n          dispatchAction(draftUpdate({ ...draft, waiting: null }));\n          handled = true;\n        } else if (selectedThread && selectedThread.waiting) {\n          const commitMeta = { singleResource: selectedThread.id, waiting: null };\n          dispatchAction(threadCommitsSubmit(commitMeta));\n          handled = true;\n        }\n\n        // Show followup removal\n        if (handled) {\n          dispatchAction(\n            toastSet(new ConfirmationError(\n              'Your followup has been canceled!',\n              true,\n            )),\n          );\n        }\n        break;\n      case HotkeyAction.Trash:\n      case KeyCode.ExtendedDelete:\n      case KeyCode.Delete:\n        // Enable deletions of drafts using normal delete when mailbox is draft type\n        if (selectedMailbox && isDraftBox(selectedMailbox.type) && draft) {\n          const discardDraftIds = Array.from(this.props.selectedIds.keys());\n          if (this.props.selectedMailbox &&\n            this.props.selectedMailbox.type === MailboxType.Drafts &&\n            discardDraftIds.length\n          ) {\n            this.handleSelectedDraftsDelete(discardDraftIds);\n          }\n          handled = true;\n          break;\n        }\n        if (selectedMailbox && selectedMailbox.type === MailboxType.Trash &&\n          selectedThread && selectedThread.box === ThreadBox.Trash) {\n          this.handleThreadDelete();\n          handled = true;\n        } else if (selectedThread && selectedThread.box !== ThreadBox.Trash) {\n          this.handleThreadMove(ThreadBox.Trash);\n          handled = true;\n        }\n\n        break;\n      case HotkeyAction.Discard:\n        // Enable deletions of drafts using normal delete when mailbox is draft type\n        if (\n          selectedMailbox &&\n          [MailboxType.Drafts, MailboxType.SendLater].indexOf(selectedMailbox.type) > -1 &&\n          draft\n        ) {\n          const deleteDraftIds = Array.from(this.props.selectedIds.keys());\n          if (this.props.selectedMailbox &&\n            this.props.selectedMailbox.type === MailboxType.Drafts &&\n            deleteDraftIds.length\n          ) {\n            handled = true;\n            this.handleSelectedDraftsDelete(deleteDraftIds);\n          }\n        } else if (draft && !isDraftSending(draft)) {\n          handled = true;\n          this.handleSelectedDraftsDelete([draft.id]);\n        }\n\n        break;\n      case HotkeyAction.Comment:\n        this.props.updateHotkey(HotkeyAction.Comment);\n        handled = true;\n        break;\n      case HotkeyAction.Undo:\n        if (this.props.rsbOnboardingType === OnboardingType.Undo) {\n          dispatchAction(onboardingPatch({\n            skipped: false,\n            type: { steps: { [OnboardingType.Undo]: true } },\n          }));\n          logAmplitudeEvent(AmplitudeEvents.TourStepEight, { skipped: false });\n        }\n        getOnboardingActions().next(OnboardingType.Undo);\n        if (selectedMailbox) {\n          this.props.dispatchAction(threadMoveUndo(selectedMailbox));\n        }\n        break;\n      case HotkeyAction.ToggleUnread:\n        if (selectedThread) {\n          submitCommitMeta({ read: !selectedThread.read });\n        }\n        handled = true;\n        break;\n      case HotkeyAction.ToggleStar:\n        if (selectedThread) {\n          submitCommitMeta({ starred: !selectedThread.starred });\n        }\n        handled = true;\n        break;\n      case HotkeyAction.NavigationCenter:\n        this.props.dispatchAction(commandControlShow(CommandControlType.Navigation));\n        handled = true;\n        break;\n      case HotkeyAction.ToggleCommandControl:\n        if (hotkey && hotkey.action) {\n          const type = draft && !isDraftSending(draft)\n            ? CommandControlType.Draft\n            : CommandControlType.Thread;\n          this.props.dispatchAction(hotkey.action(type));\n          handled = true;\n        }\n        break;\n      case HotkeyAction.UnblockSender:\n      case HotkeyAction.BlockSender:\n        if (this.props.rsbOnboardingType === OnboardingType.Block) {\n          this.props.dispatchAction(onboardingPatch({\n            skipped: false,\n            type: { steps: { [OnboardingType.Block]: true }  },\n          }));\n        }\n        getOnboardingActions().next(OnboardingType.Block);\n        if (blockFilter) {\n          dispatchAction(hotkeyUpdate(HotkeyAction.UnblockSender));\n        } else {\n          dispatchAction(hotkeyUpdate(HotkeyAction.BlockSender));\n        }\n        return;\n\n      case HotkeyAction.MuteConversation:\n      case HotkeyAction.UnmuteConversation:\n        if (selectedThread) {\n          const muteCommitMeta = {\n            singleResource: selectedThread.id,\n            muted: !selectedThread.muted,\n          };\n          submitCommitMeta(muteCommitMeta);\n        }\n        return;\n\n      case HotkeyAction.Unsubscribe:\n        // Handle unsubscribe\n        if (selectedThread && unsubscribeLink && preferences) {\n          this.handleUnsubscribe();\n          handled = true;\n        }\n        break;\n      case HotkeyAction.CopySchedulingUrl:\n        this.props.dispatchAction(commandControlShow(CommandControlType.SchedulingPages));\n        handled = true;\n        break;\n\n      // send immediately with double cmd/ctrl+enter\n      case HotkeyAction.Send:\n      case HotkeyAction.SendImmediately:\n        if (this.props.sendingDraft) {\n          this.props.dispatchAction(draftSendNow(this.props.sendingDraft));\n        }\n        break;\n\n      default:\n        break;\n    }\n\n    if (handled) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  handleUndo = () => {\n    const { selectedMailbox } = this.props;\n    if (selectedMailbox) {\n      this.props.dispatchAction(threadMoveUndo(selectedMailbox));\n    }\n  }\n\n  handleUnsubscribe = () => {\n    const { selectedThread, unsubscribeLink, preferences, submitCommitMeta } = this.props;\n    if (selectedThread && unsubscribeLink && preferences) {\n      window.open(unsubscribeLink, '_blank');\n      recordEvent(UserEvents.Unsubscribed);\n      switch (preferences.unsubscribeBehavior) {\n        case UnsubscribeBehavior.Archive:\n          submitCommitMeta({\n            singleResource: selectedThread.id,\n            box: ThreadBox.Archive,\n          });\n          break;\n        case UnsubscribeBehavior.Trash:\n          submitCommitMeta({\n            singleResource: selectedThread.id,\n            box: ThreadBox.Trash,\n          });\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  handleStartOnboarding = () => {\n    const { dispatchAction, accounts, preferences, features } = this.props;\n    dispatchAction(onboardingPatch({ skipped: false, type: { exploreModal: true } }));\n    if (!preferences) {\n      return;\n    }\n\n    const mailToString = 'Poly Bot <onboarding@polymail.io>?subject=⚡️ '\n    + 'Send your first message with tracking!&body=Hello! 👋🏼\\n\\n'\n    + 'Polymail automatically gives you insights on the emails you send!'\n    + '\\n\\n'\n    + 'Try clicking send to see how it works!';\n    browserHistory.push('/mail');\n    const draft = createMailToDraft(accounts[0], preferences, features, mailToString);\n    dispatchAction(draftCreate(draft));\n  }\n\n  handleSelectedDraftsDelete = (ids: string[]) => {\n    const draftIds = ids;\n    const title = draftIds.length > 1\n      ? `Delete ${draftIds.length} drafts?`\n      : 'Delete this draft?';\n    const message = draftIds.length > 1\n      ? 'These drafts will be permanently deleted.'\n      : 'This draft will be permanently deleted.';\n    const discardProps: ConfirmProps = {\n      title,\n      message,\n      onConfirm: () => {\n        draftIds.forEach((draftId) => {\n          this.props.dispatchAction(draftDelete(draftId));\n        });\n        this.setState({ confirmProps: undefined });\n      },\n      confirmCopy: 'OK',\n      onCancel: () => {\n        this.setState({ confirmProps: undefined });\n      },\n    };\n\n    this.setState({ confirmProps: discardProps });\n  }\n\n  renderOnboardingFooter = () => {\n    const {\n      dispatchAction,\n      accounts,\n      preferences,\n      showCompleteOnboarding,\n      showCreateDraftOnboarding,\n      showCommandCenterOnboarding,\n      showMentionsTabOnboarding,\n      showInviteTeamOnboarding,\n      features,\n    } = this.props;\n\n    const onboardingHandlers = [\n      {\n        id: 'createDraft',\n        title: 'Real-time insights on every message',\n        message: 'Track when people open, click' +\n         ' and engage with your emails by sending them with Polymail',\n        buttonCopy: 'Try it',\n        onClick: () => {\n          if (preferences) {\n            const mailToString = 'Poly Bot <onboarding@polymail.io>?subject=⚡️ '\n            +  'Send your first message with tracking!&body=Hello! 👋🏼\\n\\n'\n            + 'Polymail automatically tracks your messages to notify you when they’ve been read.'\n            + '\\n\\n'\n            + 'Try clicking send to see how it works!';\n            const draft = createMailToDraft(accounts[0], preferences, features, mailToString);\n            dispatchAction(draftCreate(draft));\n          }\n          dispatchAction(onboardingPatch({ skipped: false, type: { createDraft: true } }));\n        },\n        onSkip: () => {\n          dispatchAction(onboardingPatch({\n            skipped: true,\n            type: {\n              createDraft: true,\n              sendMessage: true,\n              threadDetailTracking: true,\n            },\n          }));\n        },\n      },\n      {\n        id: 'sequences',\n        title: 'Automate outreach with Sequences',\n        message: 'Reaching out to potential customers or clients?' +\n          ' Automate your email outreach and follow-up with Sequences.',\n        buttonCopy: 'Try Sequences',\n        onClick: () => {\n          dispatchAction(onboardingPatch({ skipped: false, type: { sequences: true } }));\n          browserHistory.push('/sequences');\n        },\n        onSkip: () => {\n          dispatchAction(onboardingPatch({ skipped: true, type: { sequences: true } }));\n        },\n      },\n      {\n        id: 'scheduling',\n        title: 'Schedule meetings instantly',\n        message: 'Create your personal Polymail calendar page ' +\n          ' to share available meeting times and let people book meetings with you instantly.',\n        buttonCopy: 'Set Up Calendar',\n        onClick: () => {\n          browserHistory.push('/settings/calendar');\n          dispatchAction(onboardingPatch({ skipped: false, type: { scheduling: true } }));\n        },\n        onSkip: () => {\n          dispatchAction(onboardingPatch({ skipped: true, type: { scheduling: true } }));\n        },\n      },\n      {\n        id: 'downloadNativeApps',\n        title: 'You\\'re all set!',\n        message: 'Download the Polymail apps for Mac and iOS'\n          + ' for full access to messages and notifications on the go.',\n        buttonCopy: 'Download',\n        onClick: () => {\n          dispatchAction(onboardingPatch({ skipped: false, type: { downloadNativeApps: true } }));\n          logAmplitudeEvent(AmplitudeEvents.TourStepThirteen, { skipped: false });\n        },\n        onSkip: () => {\n          dispatchAction(onboardingPatch({ skipped: false, type: { downloadNativeApps: true } }));\n          logAmplitudeEvent(AmplitudeEvents.TourStepThirteen, { skipped: true });\n        },\n      },\n      {\n        id: 'commandCenter',\n        title: 'Get around Polymail faster ✨',\n        messageHtml: (\n          <div>\n            {'Use '}\n              <KeyboardSymbol character={'Cmd'} />\n              <KeyboardSymbol character={KeyCode.J} />\n            {' to easily navigate and perform actions in Polymail!'}\n          </div>\n        ),\n        buttonCopy: 'Try it',\n        onClick: () => {\n          dispatchAction(commandControlShow(CommandControlType.Thread));\n          dispatchAction(onboardingPatch({ skipped: false, type: { commandCenter: true } }));\n        },\n        onSkip: () => {\n          dispatchAction(onboardingPatch({ skipped: true, type: { commandCenter: true } }));\n        },\n      },\n      {\n        id: 'mentions',\n        title: 'You\\'ve been mentioned!',\n        message: 'Someone @mentioned you in a comment! Click the Mentions tab'\n        + ' to view conversations you\\'ve been @mentioned in',\n        buttonCopy: 'See Mentions',\n        onClick: () => {\n          browserHistory.push('/mentions');\n          dispatchAction(onboardingPatch({ skipped: false, type: { mentionsTab: true } }));\n        },\n        onSkip: () => {\n          dispatchAction(onboardingPatch({ skipped: false, type: { mentionsTab: true } }));\n        },\n      },\n      {\n        id: 'teamInvite',\n        title: 'Just Add Teammates',\n        message: 'To get the most out of Polymail, invite some coworkers to start collaborating',\n        buttonCopy: 'Invite Teammates',\n        onClick: () => {\n          dispatchAction(hotkeyUpdate(HotkeyAction.InviteTeamMembers));\n        },\n        onSkip: () => {\n          dispatchAction(onboardingPatch({ skipped: true, type: { inviteTeamMembers: true } }));\n        },\n      },\n    ];\n    let props: any|undefined;\n    if (showCommandCenterOnboarding) {\n      props = onboardingHandlers[4];\n    }\n\n    if (showCompleteOnboarding) {\n      props = onboardingHandlers[3];\n      const downloadIOSClick = () => {\n        window.open('https://itunes.apple.com/us/app/polymail/id1082058386?mt=8', '_blank');\n      };\n\n      const downloadElectronClick = () => {\n        window.open(\n          'https://polymail.io/download?download_mac=1&utm_source=webapp',\n          '_blank',\n        );\n      };\n      props.buttonHtml = (\n        <div className=\"download-buttons\">\n          <div className=\"info-section\">\n            Download Polymail for:\n            {!isElectronMac &&\n              <button\n                className=\"download-button\"\n                onClick={downloadElectronClick}\n              >\n                <AppleIconWhite height=\"15px\" width=\"15px\" className=\"icon\" />\n                Mac\n              </button>\n            }\n            <button\n              onClick={downloadIOSClick}\n              className=\"download-button\"\n            >\n              <AppleIconWhite height=\"15px\" width=\"15px\" className=\"icon\" />\n              iOS\n            </button>\n          </div>\n        </div>\n      );\n      props.skipCopy = 'Done';\n    }\n\n    if (showMentionsTabOnboarding) {\n      props = onboardingHandlers[5];\n    }\n\n    if (showInviteTeamOnboarding) {\n      props = onboardingHandlers[6];\n    }\n\n    if (showCreateDraftOnboarding) {\n      props = onboardingHandlers[0];\n    }\n\n    if (!props) {\n      return null;\n    }\n\n    return (\n      <OnboardingFooter\n        {...props}\n      />\n    );\n  }\n\n  render() {\n    const {\n      selectedMailbox,\n      sessionId,\n      mailCount,\n      selectedThread,\n      draft,\n      initialSyncing,\n      showExploreModal,\n      showTeamInviteJoinedPrompt,\n    } = this.props;\n    const { confirmProps, blockConfirmProps } = this.state;\n\n    const isInboxZero = mailCount && mailCount.inboxRead + mailCount.inboxUnread === 0\n      && !draft\n      && !selectedThread\n      && !initialSyncing\n      && selectedMailbox && !selectedMailbox.query\n      && selectedMailbox.type === MailboxType.Inbox;\n    // TODO (Cindy & Shin): Figure out better way of connecting container\n    const ThreadListConnect = ThreadList as any;\n    const LeftSidebarConnect = LeftSidebar as any;\n\n    return (\n      <div\n        className=\"threads\"\n        onKeyDown={this.handleKeyDown}\n      >\n        <ContactSupport />\n        {blockConfirmProps &&\n          <BlockConfirm\n            {...blockConfirmProps}\n          />\n        }\n        {confirmProps &&\n          <Confirm\n            {...confirmProps}\n          />\n        }\n        <div className=\"main-app\">\n          <LeftSidebarConnect accounts={[]} />\n          <ThreadListConnect\n            onUndo={this.handleUndo}\n          />\n          {!isInboxZero &&\n            <ThreadDetail\n              onThreadDelete={this.handleThreadDelete}\n            />\n          }\n          {isInboxZero && <InboxZero id={sessionId} />}\n          <RightSidebar page={Page.Threads} />\n          <CommandControl default={CommandControlType.Thread}/>\n        </div>\n        <Toast />\n        {this.renderOnboardingFooter()}\n        {showTeamInviteJoinedPrompt && (\n          <TeamJoined />\n        )}\n        {showExploreModal && !showTeamInviteJoinedPrompt &&\n          <GettingStarted\n            onNext={this.handleStartOnboarding}\n          />\n        }\n      </div>\n    );\n  }\n}\n\nexport default Threads;\n"]}]}