{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/hubspot.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/hubspot.ts","mtime":1675280254056},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBBY3Rpb25TdGF0dXMgfSBmcm9tICdAc3JjL3R5cGVzJzsKaW1wb3J0IHsgSFVCU1BPVF9DT05UQUNUX0ZFVENILCBodWJzcG90Q29udGFjdEZldGNoLCBIVUJTUE9UX0RJUkVDVF9PUEVOLCB9IGZyb20gJ0BzcmMvZHVja3MvaHVic3BvdCc7CmltcG9ydCB7IHNlbGVjdEh1YnNwb3RJbnRlZ3JhdGlvbiB9IGZyb20gJ0BzcmMvZHVja3MvaW50ZWdyYXRpb25zJzsKaW1wb3J0IHsgcmVjb3JkRXZlbnQsIFVzZXJFdmVudHMgfSBmcm9tICdAc3JjL2xpYi9hbmFseXRpY3MnOwp2YXIgaHVic3BvdERpcmVjdE9wZW5FcGljID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoSFVCU1BPVF9ESVJFQ1RfT1BFTikKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICB2YXIgX2E7CiAgICAgICAgdmFyIHN0YXRlID0gc3RvcmUuZ2V0U3RhdGUoKTsKICAgICAgICB2YXIgaHVic3BvdEludGVncmF0aW9uID0gc2VsZWN0SHVic3BvdEludGVncmF0aW9uKHN0b3JlLmdldFN0YXRlKCkpOwogICAgICAgIGlmICghaHVic3BvdEludGVncmF0aW9uKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgLy8gSGFuZGxlIGRpcmVjdGx5IG9wZW5pbmcgaHVic3BvdCB1cmwKICAgICAgICB2YXIgZW1haWwgPSBlbmNvZGVVUklDb21wb25lbnQoYWN0aW9uLm1ldGEpOwogICAgICAgIHZhciBodWJzcG90UHJvZmlsZSA9IHN0YXRlLmh1YnNwb3QucHJvZmlsZXNbZW1haWxdOwogICAgICAgIHZhciB1cmwgPSAoX2EgPSBodWJzcG90UHJvZmlsZSA9PT0gbnVsbCB8fCBodWJzcG90UHJvZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaHVic3BvdFByb2ZpbGUuZGF0YSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRldGFpbHMudXJsOwogICAgICAgIGlmICh1cmwpIHsKICAgICAgICAgICAgcmVjb3JkRXZlbnQoVXNlckV2ZW50cy5IdWJzcG90UGFnZVZpc2l0ZWQpOwogICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBkZXBzLmh1YnNwb3QuZmV0Y2hDb250YWN0KGFjdGlvbi5tZXRhKQogICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChwYXlsb2FkKSB7CiAgICAgICAgICAgIC8vIEhhbmRsZSBkaXJlY3RseSBvcGVuaW5nIGh1YnNwb3QgdXJsCiAgICAgICAgICAgIHZhciB1cmwgPSBwYXlsb2FkLmRldGFpbHMudXJsOwogICAgICAgICAgICBpZiAodXJsKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gaHVic3BvdENvbnRhY3RGZXRjaChhY3Rpb24ubWV0YSwgcGF5bG9hZCk7CiAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZihodWJzcG90Q29udGFjdEZldGNoKGFjdGlvbi5tZXRhLCBlcnIpKSk7CiAgICAgICAgfSk7CiAgICB9KTsKfTsKdmFyIGh1YnNwb3RDb250YWN0RmV0Y2hFcGljID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoSFVCU1BPVF9DT05UQUNUX0ZFVENIKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBodWJzcG90SW50ZWdyYXRpb24gPSBzZWxlY3RIdWJzcG90SW50ZWdyYXRpb24oc3RvcmUuZ2V0U3RhdGUoKSk7CiAgICAgICAgaWYgKCFodWJzcG90SW50ZWdyYXRpb24pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBkZXBzLmh1YnNwb3QuZmV0Y2hDb250YWN0KGFjdGlvbi5tZXRhKQogICAgICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAocGF5bG9hZCkgewogICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihodWJzcG90Q29udGFjdEZldGNoKGFjdGlvbi5tZXRhLCBwYXlsb2FkKSk7CiAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZihodWJzcG90Q29udGFjdEZldGNoKGFjdGlvbi5tZXRhLCBlcnIpKSk7CiAgICAgICAgfSk7CiAgICB9KTsKfTsKZXhwb3J0IGRlZmF1bHQgW2h1YnNwb3RDb250YWN0RmV0Y2hFcGljLCBodWJzcG90RGlyZWN0T3BlbkVwaWNdOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/hubspot.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/hubspot.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AAGlC,OAAO,EAAE,YAAY,EAAsB,MAAM,YAAY,CAAC;AAG9D,OAAO,EACL,qBAAqB,EAAE,mBAAmB,EAAE,mBAAmB,GAChE,MAAM,oBAAoB,CAAC;AAC5B,OAAO,EAAE,wBAAwB,EAAE,MAAM,yBAAyB,CAAC;AAEnE,OAAO,EAAE,WAAW,EAAE,UAAU,EAAE,MAAM,oBAAoB,CAAC;AAE7D,IAAM,qBAAqB,GAEvB,UAAC,OAAO,EAAE,KAAK,EAAE,IAAI;IACrB,OAAA,OAAO,CAAC,MAAM,CAAC,mBAAmB,CAAC;SAChC,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,MAAM,KAAK,YAAY,CAAC,KAAK,EAApC,CAAoC,CAAC;SACtD,MAAM,CAAC,UAAC,MAAM;;QACb,IAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,EAAE,CAAC;QAC/B,IAAM,kBAAkB,GAAG,wBAAwB,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;QACtE,IAAI,CAAC,kBAAkB,EAAE;YACvB,OAAO,KAAK,CAAC;SACd;QAED,sCAAsC;QACtC,IAAM,KAAK,GAAG,kBAAkB,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QAC9C,IAAM,cAAc,GAAG,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QACrD,IAAM,GAAG,SAAG,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,IAAI,0CAAE,OAAO,CAAC,GAAG,CAAC;QAC9C,IAAI,GAAG,EAAE;YACP,WAAW,CAAC,UAAU,CAAC,kBAAkB,CAAC,CAAC;YAC3C,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;YAC3B,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;SACD,OAAO,CAAC,UAAC,MAA6C;QACrD,OAAA,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC;aACnC,GAAG,CAAC,UAAC,OAAO;YACX,sCAAsC;YACtC,IAAM,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC;YAChC,IAAI,GAAG,EAAE;gBACP,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;aAC5B;YACD,OAAO,mBAAmB,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QACnD,CAAC,CAAC;aACD,KAAK,CAAC,UAAC,GAAG;YACT,OAAO,UAAU,CAAC,KAAK,CACrB,UAAU,CAAC,EAAE,CAAC,mBAAmB,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CACrD,CAAC;QACJ,CAAC,CAAC;IAbJ,CAaI,CACL;AApCH,CAoCG,CAAC;AAER,IAAM,uBAAuB,GAEzB,UAAC,OAAO,EAAE,KAAK,EAAE,IAAI;IACrB,OAAA,OAAO,CAAC,MAAM,CAAC,qBAAqB,CAAC;SAClC,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,MAAM,KAAK,YAAY,CAAC,KAAK,EAApC,CAAoC,CAAC;SACtD,MAAM,CAAC;QACN,IAAM,kBAAkB,GAAG,wBAAwB,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;QACtE,IAAI,CAAC,kBAAkB,EAAE;YACvB,OAAO,KAAK,CAAC;SACd;QAED,OAAO,IAAI,CAAC;IACd,CAAC,CAAC;SACD,OAAO,CAAC,UAAC,MAA6C;QACrD,OAAA,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC;aACnC,OAAO,CAAC,UAAA,OAAO;YACd,OAAA,UAAU,CAAC,EAAE,CAAC,mBAAmB,CAAC,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QAAxD,CAAwD,CACzD;aACA,KAAK,CAAC,UAAC,GAAG;YACT,OAAO,UAAU,CAAC,KAAK,CACrB,UAAU,CAAC,EAAE,CAAC,mBAAmB,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CACrD,CAAC;QACJ,CAAC,CAAC;IARJ,CAQI,CACL;AApBH,CAoBG,CAAC;AAER,eAAe,CAAC,uBAAuB,EAAE,qBAAqB,CAAC,CAAC","sourcesContent":["import { Observable } from 'rxjs';\nimport { Epic } from 'redux-observable';\n\nimport { ActionStatus, Action, StoreState } from '@src/types';\n\nimport { Deps } from '@src/lib/epic';\nimport {\n  HUBSPOT_CONTACT_FETCH, hubspotContactFetch, HUBSPOT_DIRECT_OPEN,\n} from '@src/ducks/hubspot';\nimport { selectHubspotIntegration } from '@src/ducks/integrations';\nimport { HubspotContactProfile } from '@src/types/hubspot';\nimport { recordEvent, UserEvents } from '@src/lib/analytics';\n\nconst hubspotDirectOpenEpic:\n  Epic<Action<string, HubspotContactProfile>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(HUBSPOT_DIRECT_OPEN)\n      .filter(action => action.status === ActionStatus.Start)\n      .filter((action) => {\n        const state = store.getState();\n        const hubspotIntegration = selectHubspotIntegration(store.getState());\n        if (!hubspotIntegration) {\n          return false;\n        }\n\n        // Handle directly opening hubspot url\n        const email = encodeURIComponent(action.meta);\n        const hubspotProfile = state.hubspot.profiles[email];\n        const url = hubspotProfile?.data?.details.url;\n        if (url) {\n          recordEvent(UserEvents.HubspotPageVisited);\n          window.open(url, '_blank');\n          return false;\n        }\n\n        return true;\n      })\n      .flatMap((action: Action<string, HubspotContactProfile>) =>\n        deps.hubspot.fetchContact(action.meta)\n          .map((payload) => {\n            // Handle directly opening hubspot url\n            const url = payload.details.url;\n            if (url) {\n              window.open(url, '_blank');\n            }\n            return hubspotContactFetch(action.meta, payload);\n          })\n          .catch((err) => {\n            return Observable.merge(\n              Observable.of(hubspotContactFetch(action.meta, err)),\n            );\n          }),\n      );\n\nconst hubspotContactFetchEpic:\n  Epic<Action<string, HubspotContactProfile>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(HUBSPOT_CONTACT_FETCH)\n      .filter(action => action.status === ActionStatus.Start)\n      .filter(() => {\n        const hubspotIntegration = selectHubspotIntegration(store.getState());\n        if (!hubspotIntegration) {\n          return false;\n        }\n\n        return true;\n      })\n      .flatMap((action: Action<string, HubspotContactProfile>) =>\n        deps.hubspot.fetchContact(action.meta)\n          .flatMap(payload =>\n            Observable.of(hubspotContactFetch(action.meta, payload)),\n          )\n          .catch((err) => {\n            return Observable.merge(\n              Observable.of(hubspotContactFetch(action.meta, err)),\n            );\n          }),\n      );\n\nexport default [hubspotContactFetchEpic, hubspotDirectOpenEpic];\n"]}]}