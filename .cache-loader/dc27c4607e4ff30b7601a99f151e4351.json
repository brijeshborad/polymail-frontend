{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/bridge/store.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/bridge/store.ts","mtime":1675280254123},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgewogICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHsKICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKQogICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfTsKICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9OwppbXBvcnQgeyBtZUZldGNoIH0gZnJvbSAnQHNyYy9kdWNrcy9tZSc7CmltcG9ydCB7IHRlYW1GZXRjaCB9IGZyb20gJ0BzcmMvZHVja3MvdGVhbSc7CmltcG9ydCB7IGRyYWZ0RGVsZXRlLCBkcmFmdFVwZGF0ZSwgYXR0YWNobWVudE1ldGFVcGRhdGUsIGRyYWZ0QXR0YWNobWVudEFkZCwgc2VsZWN0T3B0aW1pc3RpY01lc3NhZ2VzRm9yVGhyZWFkLCBkcmFmdFNlbmQsIGRyYWZ0TGlzdCwgfSBmcm9tICdAc3JjL2R1Y2tzL2RyYWZ0cyc7CmltcG9ydCB7IHRocmVhZERlbGV0ZSwgdGhyZWFkU2luZ2xlLCB0aHJlYWRMaXN0LCBpbmNyZW1lbnRhbFN0YXR1c1RvZ2dsZSwgc2VsZWN0ZWRJZHNVcGRhdGUsIHRocmVhZE1vdmVVbmRvLCB9IGZyb20gJ0BzcmMvZHVja3MvdGhyZWFkcyc7CmltcG9ydCB7IG1haWxDb3VudFVwZGF0ZSB9IGZyb20gJ0BzcmMvZHVja3MvbWFpbENvdW50cyc7CmltcG9ydCB7IG5vdGlmaWNhdGlvblNob3cgfSBmcm9tICdAc3JjL2R1Y2tzL25vdGlmaWNhdGlvbnMnOwppbXBvcnQgeyBnZXRUb2tlbiwgQVVUSF9UT0tFTl9OT05FIH0gZnJvbSAnQHNyYy9hcGkvYmFzZSc7CmltcG9ydCB7IE1haWxib3hUeXBlLCB9IGZyb20gJ0BzcmMvdHlwZXMnOwppbXBvcnQgeyBXb3JrZXJFdmVudE5hbWUgfSBmcm9tICcuL3dvcmtlckV2ZW50cyc7CmltcG9ydCB7IHNlbmRBY2NvdW50c1VwZGF0ZWQsIHNlbmRBdXRoVXBkYXRlZCwgc2VuZE1lVXBkYXRlZCwgc2VuZEZlYXR1cmVzVXBkYXRlZCwgc2VuZFByZWZlcmVuY2VzVXBkYXRlZCwgc2VuZFNlYXJjaERiRW5hYmxlLCBzZW5kQ29uZmlnLCBzZW5kTGlzdHNVcGRhdGVkLCB9IGZyb20gJy4vYXBwRXZlbnRzJzsKaW1wb3J0IHsgYWN0aXZpdHlGZWVkTGlzdCB9IGZyb20gJ0BzcmMvZHVja3MvYWN0aXZpdHlGZWVkJzsKaW1wb3J0IHsgdGVtcGxhdGVMaXN0IH0gZnJvbSAnQHNyYy9kdWNrcy90ZW1wbGF0ZXMnOwppbXBvcnQgaGlzdG9yeSBmcm9tICdAc3JjL2xpYi9icm93c2VySGlzdG9yeSc7CmltcG9ydCB7IHRlYW1NZW1iZXJGZXRjaCwgdGVhbUludml0ZUxpc3QgfSBmcm9tICdAc3JjL2R1Y2tzL3RlYW1NZW1iZXJzJzsKaW1wb3J0IHsgY2FsZW5kYXJMaXN0LCBDYWxlbmRhckxpc3RUcmlnZ2VyIH0gZnJvbSAnQHNyYy9kdWNrcy9jYWxlbmRhcnMnOwppbXBvcnQgeyB1bmlxQnkgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgeyBzaGFyZWRUaHJlYWREZWxldGUsIHNoYXJlZFRocmVhZFVwZGF0ZSwgc2hhcmVkVGhyZWFkQWN0aXZpdHlDcmVhdGUsIH0gZnJvbSAnQHNyYy9kdWNrcy9zaGFyZWRUaHJlYWRzJzsKaW1wb3J0IHsgbWFpbGJveFNlbGVjdCB9IGZyb20gJ0BzcmMvZHVja3MvbWFpbGJveCc7CmltcG9ydCB7IGlzRWxlY3Ryb24gfSBmcm9tICdAc3JjL2xpYi9lbGVjdHJvbic7CmltcG9ydCB7IGVuYWJsZVNlYXJjaERiLCBJU19DSFJPTUUsIGdldFNlYXJjaERiQ29uZmlnIH0gZnJvbSAnQHNyYy9saWIvZGV2aWNlJzsKaW1wb3J0IHsgZmlsdGVyRGVsZXRlLCBmaWx0ZXJTZXQgfSBmcm9tICdAc3JjL2R1Y2tzL2ZpbHRlcnMnOwppbXBvcnQgeyB1bnNlcmlhbGl6ZUVycm9yIH0gZnJvbSAnQHNyYy9saWIvZXJyb3JzJzsKaW1wb3J0IHsgZ2V0QWxsb3dSZWNvbm5lY3QgfSBmcm9tICdAc3JjL2xpYi9kYic7CmltcG9ydCB7IHRvYXN0U2V0LCBDb25maXJtYXRpb25FcnJvciwgQ29uZmlybWF0aW9uUG9zaXRvbiB9IGZyb20gJ0BzcmMvZHVja3MvdG9hc3RzJzsKaW1wb3J0IHsgYXBwU3RhdHVzU2V0IH0gZnJvbSAnQHNyYy9kdWNrcy9hcHAnOwppbXBvcnQgeyBpc0Rpc2FibGVkU3RhdGUgfSBmcm9tICdAc3JjL2xpYi9iYW5uZXInOwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7Ci8vIGJyaWRnZVN5bmNTdG9yZSBpcyB1c2VkIHRvIGNvbm5lY3QgdGhlIHJlZHV4IHN0b3JlIHRvIHRoZSB3b3JrZXIsCi8vICAgYW5kIGNhbGxlZCBvbiB0aGUgbWFpbiB1aSBhZnRlciBpbml0aWFsaXppbmcgdGhlIHdvcmtlciBhbmQgc3RvcmUKZXhwb3J0IGZ1bmN0aW9uIGJyaWRnZVN5bmNTdG9yZSh3b3JrZXIsIHN0b3JlKSB7CiAgICAod29ya2VyIGluc3RhbmNlb2YgV29ya2VyID8gd29ya2VyIDogd29ya2VyLnBvcnQpLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciBfYSwgX2I7CiAgICAgICAgdmFyIHdlID0gZXZlbnQuZGF0YTsKICAgICAgICBzd2l0Y2ggKHdlLm5hbWUpIHsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuQXBwU3RhdHVzVXBkYXRlOgogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goYXBwU3RhdHVzU2V0KHdlLmRhdGEpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5EcmFmdEF0dGFjaG1lbnRBZGRGYWlsZWQ6CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChkcmFmdEF0dGFjaG1lbnRBZGQod2UuZGF0YS5tZXRhLCB1bnNlcmlhbGl6ZUVycm9yKHdlLmRhdGEuZXJyb3IpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuRHJhZnRBdHRhY2htZW50QWRkZWQ6CiAgICAgICAgICAgICAgICB2YXIgZHJhZnRBdHRhY2htZW50TWV0YSA9IHdlLmRhdGEubWV0YTsKICAgICAgICAgICAgICAgIHZhciBkcmFmdEF0dGFjaG1lbnQgPSB3ZS5kYXRhLmF0dGFjaG1lbnQ7CiAgICAgICAgICAgICAgICAvLyBSZXZva2Ugb2JqZWN0IHVybCBvbiBkcmFmdCBhdHRhY2htZW50IGFkZCBzdWNjZXNzCiAgICAgICAgICAgICAgICB2YXIgZm91bmRSZXNvdXJjZU1ldGEgPSBzdG9yZS5nZXRTdGF0ZSgpLmF0dGFjaG1lbnRNZXRhc1tkcmFmdEF0dGFjaG1lbnRNZXRhLnJlc291cmNlSWRdOwogICAgICAgICAgICAgICAgdmFyIGZvdW5kTWV0YSA9IGZvdW5kUmVzb3VyY2VNZXRhICYmIGZvdW5kUmVzb3VyY2VNZXRhW2RyYWZ0QXR0YWNobWVudC5pZF07CiAgICAgICAgICAgICAgICBpZiAoZm91bmRNZXRhICYmIGZvdW5kTWV0YS5kYXRhICYmIGZvdW5kTWV0YS5kYXRhLmNsb3VkVXJsKSB7CiAgICAgICAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChmb3VuZE1ldGEuZGF0YS5jbG91ZFVybCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBEcmFmdCBBdHRhY2htZW50IEFkZCBzdWNjZXNzCiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChkcmFmdEF0dGFjaG1lbnRBZGQoZHJhZnRBdHRhY2htZW50TWV0YSwgZHJhZnRBdHRhY2htZW50KSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuQXR0YWNobWVudE1ldGFVcGRhdGVkOgogICAgICAgICAgICAgICAgdmFyIG1ldGEgPSB3ZS5kYXRhLm1ldGE7CiAgICAgICAgICAgICAgICAvLyBEbyBub3Qgc2VuZCB1cGRhdGVzIHdoZW4gbm90IGhlbGQgaW4gc3RhdGUgdG8gbWFrZSBzdXJlIGRlbGV0ZWQgbWV0YXMgc3RheSByZW1vdmVkCiAgICAgICAgICAgICAgICB2YXIgcmVzb3VyY2VNZXRhcyA9IHN0b3JlLmdldFN0YXRlKCkuYXR0YWNobWVudE1ldGFzW21ldGEucmVzb3VyY2VJZF07CiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VNZXRhcyAmJiByZXNvdXJjZU1ldGFzW21ldGEuYXR0YWNobWVudF0pIHsKICAgICAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChhdHRhY2htZW50TWV0YVVwZGF0ZShtZXRhKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuQWN0aXZpdHlVcGRhdGVkOgogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goYWN0aXZpdHlGZWVkTGlzdChzdG9yZS5nZXRTdGF0ZSgpLmFjdGl2aXR5RmVlZFNlYXJjaE1ldGEgfHwge30pKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5DYWxlbmRhcnNTeW5jZWQ6CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChjYWxlbmRhckxpc3QoeyB0eXBlOiBDYWxlbmRhckxpc3RUcmlnZ2VyLldvcmtlciB9KSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuSW5jcmVtZW50YWxTeW5jRmluaXNoZWQ6CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChpbmNyZW1lbnRhbFN0YXR1c1RvZ2dsZShmYWxzZSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgV29ya2VyRXZlbnROYW1lLkluY3JlbWVudGFsU3luY1N0YXJ0ZWQ6CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChpbmNyZW1lbnRhbFN0YXR1c1RvZ2dsZSh0cnVlKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuTWFpbENvdW50VXBkYXRlZDoKICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKG1haWxDb3VudFVwZGF0ZSh3ZS5kYXRhLmFjY291bnRJZCwgd2UuZGF0YS5jb3VudCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgV29ya2VyRXZlbnROYW1lLk1lVXBkYXRlZDoKICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKG1lRmV0Y2goJycpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5Ob3RpZmljYXRpb246CiAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnN0YXJ0c1dpdGgoJy9wb3BvdXQnKSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2gobm90aWZpY2F0aW9uU2hvdyh7CiAgICAgICAgICAgICAgICAgICAgZGF0YTogd2UuZGF0YSwKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2UuZGF0YS50aHJlYWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdNYXAgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdNYXAuc2V0KHdlLmRhdGEudGhyZWFkLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBxdWVyeSBhbmQgc2VsZWN0IGluYm94IGlmIGNsaWNraW5nIG9uIG5vdGlmaWNhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1haWxib3ggPSBzdG9yZS5nZXRTdGF0ZSgpLm1haWxib3g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISFtYWlsYm94LnF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2gobWFpbGJveFNlbGVjdChfX2Fzc2lnbihfX2Fzc2lnbih7fSwgbWFpbGJveCksIHsgdHlwZTogTWFpbGJveFR5cGUuSW5ib3gsIHF1ZXJ5OiAnJywgcHJvdmlkZXJTZWFyY2g6IHVuZGVmaW5lZCB9KSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goc2VsZWN0ZWRJZHNVcGRhdGUobmV3TWFwKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LnB1c2goIi9tYWlsL2FsbC9pbmJveC8iICsgd2UuZGF0YS50aHJlYWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHdlLmRhdGEuc2hhcmVkVGhyZWFkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LnB1c2goIi9tZW50aW9ucy8iICsgd2UuZGF0YS5zaGFyZWRUaHJlYWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5TaGFyZWRUaHJlYWREZWxldGVkOgogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goc2hhcmVkVGhyZWFkRGVsZXRlKHdlLmRhdGEuc2hhcmVkVGhyZWFkSWQsIHdlLmRhdGEuc2hhcmVkVGhyZWFkSWQpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5TaGFyZWRUaHJlYWRVcGRhdGVkOgogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goc2hhcmVkVGhyZWFkVXBkYXRlKHdlLmRhdGEuc2hhcmVkVGhyZWFkLCB3ZS5kYXRhLnNoYXJlZFRocmVhZCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgV29ya2VyRXZlbnROYW1lLlNoYXJlZFRocmVhZEFjdGl2aXR5OgogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goc2hhcmVkVGhyZWFkQWN0aXZpdHlDcmVhdGUoeyB0eXBlOiB3ZS5kYXRhLnR5cGUsIHNoYXJlZFRocmVhZDogd2UuZGF0YS5zaGFyZWRUaHJlYWQgfSwgX19hc3NpZ24oX19hc3NpZ24oe30sIHdlLmRhdGEpLCB7IHRpbWVzdGFtcDogbmV3IERhdGUod2UuZGF0YS50aW1lc3RhbXApIH0pKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuVGVhbVVwZGF0ZWQ6CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh0ZWFtRmV0Y2goJycpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5UZWFtTWVtYmVyVXBkYXRlZDoKICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHRlYW1NZW1iZXJGZXRjaChudWxsKSk7CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh0ZWFtSW52aXRlTGlzdChudWxsKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuVGVtcGxhdGVVcGRhdGVkOgogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2godGVtcGxhdGVMaXN0KCcnKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuVGhyZWFkRGVsZXRlZDoKICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKHRocmVhZERlbGV0ZSh3ZS5kYXRhLnRocmVhZElkKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuVGhyZWFkTW92ZVVuZG9Db21wbGV0ZWQ6CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh0aHJlYWRNb3ZlVW5kbyh3ZS5kYXRhLmJveCwgd2UuZGF0YS50aHJlYWQpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5UaHJlYWRVcGRhdGVkOgogICAgICAgICAgICAgICAgdmFyIHRocmVhZCA9IHdlLmRhdGEudGhyZWFkOwogICAgICAgICAgICAgICAgLy8gSGFuZGxlIHVwZGF0ZXMgd2l0aCBjb21wdXRlZCB0aHJlYWQKICAgICAgICAgICAgICAgIHZhciBvcHRpbWlzdGljTWVzc2FnZXMgPSBzZWxlY3RPcHRpbWlzdGljTWVzc2FnZXNGb3JUaHJlYWQoc3RvcmUuZ2V0U3RhdGUoKSwgdGhyZWFkLmlkKTsKICAgICAgICAgICAgICAgIC8vIEFwcGVuZCBhbnkgbmVjZXNzYXJ5IG9wdGltaXN0aWMgbWVzc2FnZXMKICAgICAgICAgICAgICAgIGlmIChvcHRpbWlzdGljTWVzc2FnZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFsbE1lc3NhZ2VzID0gdW5pcUJ5KHRocmVhZC5tZXNzYWdlcy5jb25jYXQob3B0aW1pc3RpY01lc3NhZ2VzKSwgJ3JmY0lkJyk7CiAgICAgICAgICAgICAgICAgICAgdGhyZWFkLm1lc3NhZ2VzID0gYWxsTWVzc2FnZXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh0aHJlYWRTaW5nbGUodGhyZWFkKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuRHJhZnRVcGRhdGVkOgogICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWREcmFmdCA9IHdlLmRhdGEuZHJhZnQ7CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChkcmFmdFVwZGF0ZSh1cGRhdGVkRHJhZnQsIHVwZGF0ZWREcmFmdCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgV29ya2VyRXZlbnROYW1lLkRyYWZ0RGVsZXRlZDoKICAgICAgICAgICAgICAgIHZhciBkcmFmdElkID0gd2UuZGF0YS5kcmFmdElkOwogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goZHJhZnREZWxldGUoZHJhZnRJZCwgZHJhZnRJZCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgV29ya2VyRXZlbnROYW1lLkRyYWZ0U2VudDoKICAgICAgICAgICAgICAgIHZhciBzZW50RHJhZnQgPSB3ZS5kYXRhLmRyYWZ0OwogICAgICAgICAgICAgICAgdmFyIHNlbmRNZXRhID0gd2UuZGF0YTsKICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKGRyYWZ0U2VuZChzZW5kTWV0YSwgc2VudERyYWZ0KSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuRHJhZnRCYXRjaFJlY2VpdmVkOgogICAgICAgICAgICAgICAgdmFyIGRyYWZ0cyA9IHdlLmRhdGEuZHJhZnRzOwogICAgICAgICAgICAgICAgaWYgKGRyYWZ0cyAmJiBkcmFmdHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goZHJhZnRMaXN0KCcnLCBkcmFmdHMpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5EcmFmdFN5bmNDb21wbGV0ZWQ6CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChkcmFmdExpc3QoJycpKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5EcmFmdFNlbmRGYWlsZWQ6CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaChkcmFmdFNlbmQod2UuZGF0YS5tZXRhLCB1bnNlcmlhbGl6ZUVycm9yKHdlLmRhdGEuZXJyb3IpKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuRmlsdGVyRGVsZXRlZDoKICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKGZpbHRlckRlbGV0ZSh3ZS5kYXRhLmZpbHRlcklkLCBudWxsKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuRmlsdGVyVXBkYXRlZDoKICAgICAgICAgICAgICAgIGlmICh3ZS5kYXRhLmZpbHRlcikgewogICAgICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKGZpbHRlclNldCh3ZS5kYXRhLmZpbHRlciwgd2UuZGF0YS5maWx0ZXIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5UaHJlYWRzUmVmcmVzaGVkOgogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2godGhyZWFkTGlzdCh0cnVlKSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBXb3JrZXJFdmVudE5hbWUuV29ya2VyUmVhZHk6CiAgICAgICAgICAgICAgICAvLyBIYW5kbGVzIHR1cm5pbmcgb24gc2VhcmNoIGRiCiAgICAgICAgICAgICAgICB2YXIgY3VycmVudENvbmZpZyA9IGdldFNlYXJjaERiQ29uZmlnKCk7CiAgICAgICAgICAgICAgICBpZiAoaXNFbGVjdHJvbiB8fCBJU19DSFJPTUUgfHwgY3VycmVudENvbmZpZy5lbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2U6IHdpbmRvdy5uYXZpZ2F0b3IgJiYgd2luZG93Lm5hdmlnYXRvci5sYW5ndWFnZSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm5hdmlnYXRvci5sYW5ndWFnZS50b0xvd2VyQ2FzZSgpIHx8IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgdGhyZWFkc0V2aWN0aW9uRGF5czogaXNFbGVjdHJvbiA/IGN1cnJlbnRDb25maWcudGhyZWFkc0V2aWN0aW9uRGF5cyA6IDE0LAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgZW5hYmxlU2VhcmNoRGIoY29uZmlnKTsKICAgICAgICAgICAgICAgICAgICBzZW5kU2VhcmNoRGJFbmFibGUod29ya2VyLCBjb25maWcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gU2VuZCBiYWNrIEF1dGggVXBkYXRlZAogICAgICAgICAgICAgICAgLy8gTk9URShTSEFIQU4pOiBXZSB3YW50IHRvIHNlbmQgdGhlIEFVVEhfVE9LRU5fTk9ORSBjYXNlLCBldmVuIHdoZW4KICAgICAgICAgICAgICAgIC8vIG5vdCBsb2dnZWQgaW4sIHRvIHRyaWdnZXIgYW55IHBvdGVudGlhbCByZXNldHRpbmcgb2YgdGhlIGRiIGlmIG5lZWRlZAogICAgICAgICAgICAgICAgLy8gV2Ugd2FudCB0byBzZW5kIG5vbmUgZm9yIHRoZSB0ZmFOZWVkZWQgY2FzZSB0b28sIGluIGNhc2UgdGhlcmUgaXMgYQogICAgICAgICAgICAgICAgLy8gIGNsZWFyIGNhY2hlIHRvIHBlcmZvcm0KICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IGdldFRva2VuKCk7CiAgICAgICAgICAgICAgICB2YXIgbWVEYXRhID0gc3RvcmUuZ2V0U3RhdGUoKS5tZS5kYXRhOwogICAgICAgICAgICAgICAgLy8gdXNlciBoYXZlIGEgMjRob3VycyBncmFjZSBwZXJpb2QgZm9yIHN5bmMgYWZ0ZXIgYmVpbmcgZGlzYWJsZWQKICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vcG9seW1haWwuYXRsYXNzaWFuLm5ldC9icm93c2UvUE0tMjU0CiAgICAgICAgICAgICAgICB2YXIgc3luY0V4cGlyZXMgPSAoX2EgPSBzdG9yZS5nZXRTdGF0ZSgpLnRlYW0uZGF0YSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN5bmNFeHBpcmVzOwogICAgICAgICAgICAgICAgdmFyIG5vd1RvVVRDID0gbW9tZW50KG5ldyBEYXRlKCkudG9VVENTdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB2YXIgaGFzMjRoRGlzYWJsZWRHcmFjZSA9ICEhc3luY0V4cGlyZXMgJiYgbW9tZW50KHN5bmNFeHBpcmVzKSA+IG5vd1RvVVRDOwogICAgICAgICAgICAgICAgaWYgKG1lRGF0YQogICAgICAgICAgICAgICAgICAgICYmIG1lRGF0YS5zdGF0dXMKICAgICAgICAgICAgICAgICAgICAmJiBtZURhdGEuc3RhdHVzTmV3CiAgICAgICAgICAgICAgICAgICAgJiYgaXNEaXNhYmxlZFN0YXRlKG1lRGF0YS5zdGF0dXNOZXcpCiAgICAgICAgICAgICAgICAgICAgJiYgdG9rZW4gIT09IEFVVEhfVE9LRU5fTk9ORQogICAgICAgICAgICAgICAgICAgICYmICFoYXMyNGhEaXNhYmxlZEdyYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgc2VuZEF1dGhVcGRhdGVkKHdvcmtlciwgdG9rZW4sIHRydWUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRva2VuID09PSBBVVRIX1RPS0VOX05PTkUgfHwgc3RvcmUuZ2V0U3RhdGUoKS50ZmFOZWVkZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZW5kQXV0aFVwZGF0ZWQod29ya2VyLCBBVVRIX1RPS0VOX05PTkUpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gc2VuZCBiYWNrIHRva2VuIGlmIGhhdmUgYSB0b2tlbiBhbmQgdGZhIGlzIG5vdCBuZWVkZWQKICAgICAgICAgICAgICAgIGlmICghc3RvcmUuZ2V0U3RhdGUoKS50ZmFOZWVkZWQpIHsKICAgICAgICAgICAgICAgICAgICBzZW5kQXV0aFVwZGF0ZWQod29ya2VyLCB0b2tlbik7CiAgICAgICAgICAgICAgICAgICAgdmFyIGFjY291bnRzID0gc3RvcmUuZ2V0U3RhdGUoKS5hY2NvdW50czsKICAgICAgICAgICAgICAgICAgICBpZiAoYWNjb3VudHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kQWNjb3VudHNVcGRhdGVkKHdvcmtlciwgYWNjb3VudHMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgbWUgPSBzdG9yZS5nZXRTdGF0ZSgpLm1lLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRNZVVwZGF0ZWQod29ya2VyLCBtZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBmZWF0dXJlcyA9IHN0b3JlLmdldFN0YXRlKCkuZmVhdHVyZXM7CiAgICAgICAgICAgICAgICAgICAgc2VuZEZlYXR1cmVzVXBkYXRlZCh3b3JrZXIsIGZlYXR1cmVzKTsKICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdHMgPSBzdG9yZS5nZXRTdGF0ZSgpLmxpc3RzOwogICAgICAgICAgICAgICAgICAgIHNlbmRMaXN0c1VwZGF0ZWQod29ya2VyLCBsaXN0cyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIHByZWZlcmVuY2VzID0gc3RvcmUuZ2V0U3RhdGUoKS5wcmVmZXJlbmNlczsKICAgICAgICAgICAgICAgICAgICBzZW5kUHJlZmVyZW5jZXNVcGRhdGVkKHdvcmtlciwgcHJlZmVyZW5jZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgV29ya2VyRXZlbnROYW1lLlRyaWdnZXJFbGVjdHJvbkNsZWFyQ2FjaGU6CiAgICAgICAgICAgICAgICBpZiAoKF9iID0gd2luZG93LlBNRWxlY3Ryb25CcmlkZ2UpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jbGVhckNhY2hlVjIpIHsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuUE1FbGVjdHJvbkJyaWRnZS5jbGVhckNhY2hlVjIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFdvcmtlckV2ZW50TmFtZS5SZXF1ZXN0Q29uZmlnOgogICAgICAgICAgICAgICAgc2VuZENvbmZpZyh3b3JrZXIsIGdldFRva2VuKCksIGlzRWxlY3Ryb24sIGdldEFsbG93UmVjb25uZWN0KCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgV29ya2VyRXZlbnROYW1lLlNlcnZlckNsZWFyQ2FjaGVTdGFydGVkOgogICAgICAgICAgICAgICAgdmFyIGNsZWFyQ2FjaGVDb3B5ID0gJ09uZSBzZWNvbmQgd2hpbGUgd2UgcmVzZXQgb3VyIGNhY2hlISc7CiAgICAgICAgICAgICAgICBzdG9yZS5kaXNwYXRjaCh0b2FzdFNldChuZXcgQ29uZmlybWF0aW9uRXJyb3IoY2xlYXJDYWNoZUNvcHksIHRydWUsIENvbmZpcm1hdGlvblBvc2l0b24uVG9wQ2VudGVyKSkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9Owp9Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/bridge/store.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/bridge/store.ts"],"names":[],"mappings":"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","sourcesContent":["import { Store } from 'redux';\nimport { meFetch } from '@src/ducks/me';\nimport { teamFetch } from '@src/ducks/team';\nimport {\n  draftDelete,\n  draftUpdate,\n  attachmentMetaUpdate,\n  draftAttachmentAdd,\n  selectOptimisticMessagesForThread,\n  draftSend,\n  draftList,\n} from '@src/ducks/drafts';\nimport {\n  threadDelete,\n  threadSingle,\n  threadList,\n  incrementalStatusToggle,\n  selectedIdsUpdate,\n  threadMoveUndo,\n} from '@src/ducks/threads';\nimport { mailCountUpdate } from '@src/ducks/mailCounts';\nimport { notificationShow } from '@src/ducks/notifications';\nimport { getToken, AUTH_TOKEN_NONE } from '@src/api/base';\nimport {\n  StoreState,\n  Thread,\n  Draft,\n  AttachmentMeta,\n  Attachment,\n  Message,\n  MailboxType,\n} from '@src/types';\nimport { WorkerEvent, WorkerEventName } from './workerEvents';\nimport {\n  sendAccountsUpdated, sendAuthUpdated,\n  sendMeUpdated, sendFeaturesUpdated, sendPreferencesUpdated,\n  sendSearchDbEnable, sendConfig, sendListsUpdated,\n} from './appEvents';\nimport { activityFeedList } from '@src/ducks/activityFeed';\nimport { templateList } from '@src/ducks/templates';\nimport history from '@src/lib/browserHistory';\nimport { teamMemberFetch, teamInviteList } from '@src/ducks/teamMembers';\nimport { calendarList, CalendarListTrigger } from '@src/ducks/calendars';\nimport { uniqBy } from 'lodash';\nimport {\n  sharedThreadDelete, sharedThreadUpdate, sharedThreadActivityCreate,\n} from '@src/ducks/sharedThreads';\nimport { mailboxSelect } from '@src/ducks/mailbox';\nimport { isElectron } from '@src/lib/electron';\nimport { enableSearchDb, IS_CHROME, SearchDbConfiguration, getSearchDbConfig } from '@src/lib/device';\nimport { filterDelete, filterSet } from '@src/ducks/filters';\nimport { unserializeError } from '@src/lib/errors';\nimport { getAllowReconnect } from '@src/lib/db';\nimport { toastSet, ConfirmationError, ConfirmationPositon } from '@src/ducks/toasts';\nimport { appStatusSet } from '@src/ducks/app';\nimport { isDisabledState } from '@src/lib/banner';\nimport moment from 'moment';\n\n// bridgeSyncStore is used to connect the redux store to the worker,\n//   and called on the main ui after initializing the worker and store\nexport function bridgeSyncStore(\n  worker: Worker|SharedWorker.SharedWorker,\n  store: Store<StoreState>,\n) {\n  (worker instanceof Worker ? worker : worker.port).onmessage = (event) => {\n    const we = event.data as WorkerEvent;\n\n    switch (we.name) {\n      case WorkerEventName.AppStatusUpdate:\n        store.dispatch(appStatusSet(we.data));\n        break;\n      case WorkerEventName.DraftAttachmentAddFailed:\n        store.dispatch(\n          draftAttachmentAdd(we.data.meta, unserializeError(we.data.error)),\n        );\n        break;\n\n      case WorkerEventName.DraftAttachmentAdded:\n        const draftAttachmentMeta = we.data.meta as AttachmentMeta;\n        const draftAttachment = we.data.attachment as Attachment;\n\n        // Revoke object url on draft attachment add success\n        const foundResourceMeta = store.getState().attachmentMetas[draftAttachmentMeta.resourceId];\n        const foundMeta = foundResourceMeta && foundResourceMeta[draftAttachment.id];\n        if (foundMeta && foundMeta.data && foundMeta.data.cloudUrl) {\n          URL.revokeObjectURL(foundMeta.data.cloudUrl);\n        }\n\n        // Draft Attachment Add success\n        store.dispatch(draftAttachmentAdd(draftAttachmentMeta, draftAttachment));\n        break;\n\n      case WorkerEventName.AttachmentMetaUpdated:\n        const meta = we.data.meta as AttachmentMeta;\n        // Do not send updates when not held in state to make sure deleted metas stay removed\n        const resourceMetas = store.getState().attachmentMetas[meta.resourceId];\n        if (resourceMetas && resourceMetas[meta.attachment]) {\n          store.dispatch(attachmentMetaUpdate(meta));\n        }\n        break;\n\n      case WorkerEventName.ActivityUpdated:\n        store.dispatch(activityFeedList(\n          store.getState().activityFeedSearchMeta || {},\n        ));\n        break;\n\n      case WorkerEventName.CalendarsSynced:\n        store.dispatch(calendarList({ type: CalendarListTrigger.Worker }));\n        break;\n\n      case WorkerEventName.IncrementalSyncFinished:\n        store.dispatch(incrementalStatusToggle(false));\n        break;\n\n      case WorkerEventName.IncrementalSyncStarted:\n        store.dispatch(incrementalStatusToggle(true));\n        break;\n\n      case WorkerEventName.MailCountUpdated:\n        store.dispatch(mailCountUpdate(we.data.accountId, we.data.count));\n        break;\n\n      case WorkerEventName.MeUpdated:\n        store.dispatch(meFetch(''));\n        break;\n\n      case WorkerEventName.Notification:\n        if (window.location.pathname.startsWith('/popout')) {\n          break;\n        }\n\n        store.dispatch(notificationShow({\n          data: we.data,\n          callback: () => {\n            if (we.data.thread) {\n              const newMap = new Map();\n              newMap.set(we.data.thread, true);\n\n              // Remove query and select inbox if clicking on notification\n              const mailbox = store.getState().mailbox;\n              if (!!mailbox.query) {\n                store.dispatch(mailboxSelect({\n                  ...mailbox,\n                  type: MailboxType.Inbox,\n                  query: '',\n                  providerSearch: undefined,\n                }));\n              }\n\n              store.dispatch(selectedIdsUpdate(newMap));\n              history.push(`/mail/all/inbox/${we.data.thread}`);\n            } else if (we.data.sharedThread) {\n              history.push(`/mentions/${we.data.sharedThread}`);\n            }\n          },\n        }));\n        break;\n\n      case WorkerEventName.SharedThreadDeleted:\n        store.dispatch(sharedThreadDelete(we.data.sharedThreadId, we.data.sharedThreadId));\n        break;\n\n      case WorkerEventName.SharedThreadUpdated:\n        store.dispatch(sharedThreadUpdate(we.data.sharedThread, we.data.sharedThread));\n        break;\n\n      case WorkerEventName.SharedThreadActivity:\n        store.dispatch(sharedThreadActivityCreate(\n          { type: we.data.type, sharedThread: we.data.sharedThread },\n          { ...we.data, timestamp: new Date(we.data.timestamp) },\n        ));\n        break;\n\n      case WorkerEventName.TeamUpdated:\n        store.dispatch(teamFetch(''));\n        break;\n\n      case WorkerEventName.TeamMemberUpdated:\n        store.dispatch(teamMemberFetch(null));\n        store.dispatch(teamInviteList(null));\n        break;\n\n      case WorkerEventName.TemplateUpdated:\n        store.dispatch(templateList(''));\n        break;\n\n      case WorkerEventName.ThreadDeleted:\n        store.dispatch(threadDelete(we.data.threadId));\n        break;\n\n      case WorkerEventName.ThreadMoveUndoCompleted:\n        store.dispatch(threadMoveUndo(we.data.box, we.data.thread));\n        break;\n\n      case WorkerEventName.ThreadUpdated:\n        const thread = we.data.thread as Thread;\n\n        // Handle updates with computed thread\n        const optimisticMessages: Message[] = selectOptimisticMessagesForThread(\n          store.getState(),\n          thread.id,\n        );\n\n        // Append any necessary optimistic messages\n        if (optimisticMessages.length) {\n          const allMessages = uniqBy(thread.messages.concat(optimisticMessages), 'rfcId');\n          thread.messages = allMessages;\n        }\n\n        store.dispatch(threadSingle(thread));\n        break;\n\n      case WorkerEventName.DraftUpdated:\n        const updatedDraft = we.data.draft as Draft;\n        store.dispatch(draftUpdate(updatedDraft, updatedDraft));\n        break;\n\n      case WorkerEventName.DraftDeleted:\n        const draftId = we.data.draftId;\n        store.dispatch(draftDelete(draftId , draftId));\n        break;\n\n      case WorkerEventName.DraftSent:\n        const sentDraft = we.data.draft;\n        const sendMeta = we.data;\n        store.dispatch(draftSend(sendMeta, sentDraft));\n        break;\n\n      case WorkerEventName.DraftBatchReceived:\n        const drafts = we.data.drafts;\n        if (drafts && drafts.length) {\n          store.dispatch(draftList('', drafts));\n        }\n        break;\n\n      case WorkerEventName.DraftSyncCompleted:\n        store.dispatch(draftList(''));\n        break;\n\n      case WorkerEventName.DraftSendFailed:\n        store.dispatch(draftSend(we.data.meta, unserializeError(we.data.error)));\n        break;\n\n      case WorkerEventName.FilterDeleted:\n        store.dispatch(filterDelete(we.data.filterId, null));\n        break;\n\n      case WorkerEventName.FilterUpdated:\n        if (we.data.filter) {\n          store.dispatch(filterSet(we.data.filter, we.data.filter));\n        }\n        break;\n\n      case WorkerEventName.ThreadsRefreshed:\n        store.dispatch(threadList(true));\n        break;\n\n      case WorkerEventName.WorkerReady:\n        // Handles turning on search db\n        const currentConfig = getSearchDbConfig();\n        if (isElectron || IS_CHROME || currentConfig.enabled) {\n          const config: SearchDbConfiguration = {\n            enabled: true,\n            language: window.navigator && window.navigator.language &&\n              window.navigator.language.toLowerCase() || undefined,\n            threadsEvictionDays: isElectron ? currentConfig.threadsEvictionDays : 14,\n          };\n          enableSearchDb(config);\n          sendSearchDbEnable(worker, config);\n        }\n\n        // Send back Auth Updated\n        // NOTE(SHAHAN): We want to send the AUTH_TOKEN_NONE case, even when\n        // not logged in, to trigger any potential resetting of the db if needed\n        // We want to send none for the tfaNeeded case too, in case there is a\n        //  clear cache to perform\n        const token = getToken();\n        const meData = store.getState().me.data;\n        // user have a 24hours grace period for sync after being disabled\n        // https://polymail.atlassian.net/browse/PM-254\n        const syncExpires = store.getState().team.data?.syncExpires;\n        const nowToUTC = moment(new Date().toUTCString());\n        const has24hDisabledGrace: boolean =\n          !!syncExpires && moment(syncExpires) > nowToUTC;\n\n        if (\n          meData\n          && meData.status\n          && meData.statusNew\n          && isDisabledState(meData.statusNew)\n          && token !== AUTH_TOKEN_NONE\n          && !has24hDisabledGrace\n          ) {\n          sendAuthUpdated(worker, token, true);\n          break;\n        }\n\n        if (token === AUTH_TOKEN_NONE || store.getState().tfaNeeded) {\n          sendAuthUpdated(worker, AUTH_TOKEN_NONE);\n          break;\n        }\n\n        // send back token if have a token and tfa is not needed\n        if (!store.getState().tfaNeeded) {\n          sendAuthUpdated(worker, token);\n          const accounts = store.getState().accounts;\n          if (accounts.length > 0) {\n            sendAccountsUpdated(worker, accounts);\n          }\n          const me = store.getState().me.data;\n          if (me) {\n            sendMeUpdated(worker, me);\n          }\n\n          const features = store.getState().features;\n          sendFeaturesUpdated(worker, features);\n\n          const lists = store.getState().lists;\n          sendListsUpdated(worker, lists);\n\n          const preferences = store.getState().preferences;\n          sendPreferencesUpdated(worker, preferences);\n        }\n        break;\n\n      case WorkerEventName.TriggerElectronClearCache:\n        if (window.PMElectronBridge?.clearCacheV2) {\n          window.PMElectronBridge.clearCacheV2();\n        }\n        break;\n\n      case WorkerEventName.RequestConfig:\n        sendConfig(worker, getToken(), isElectron, getAllowReconnect());\n        break;\n\n      case WorkerEventName.ServerClearCacheStarted:\n        const clearCacheCopy = 'One second while we reset our cache!';\n        store.dispatch(toastSet(new ConfirmationError(\n          clearCacheCopy,\n          true,\n          ConfirmationPositon.TopCenter,\n        )));\n        break;\n\n      default:\n        break;\n    }\n  };\n}\n"]}]}