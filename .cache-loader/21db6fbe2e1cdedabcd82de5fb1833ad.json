{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/me.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/me.ts","mtime":1675280254050},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgewogICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHsKICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKQogICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfTsKICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9Owp2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfaiwgX2ssIF9sLCBfbSwgX28sIF9wLCBfcTsKaW1wb3J0IHVwZGF0ZSBmcm9tICdpbW11dGFiaWxpdHktaGVscGVyJzsKaW1wb3J0IHsgc2V0VXNlciwgY2FwdHVyZUV4Y2VwdGlvbiB9IGZyb20gJ0BzZW50cnkvYnJvd3Nlcic7CmltcG9ydCBDb29raWVzIGZyb20gJ2pzLWNvb2tpZSc7CmltcG9ydCB7IGNyZWF0ZSB9IGZyb20gJ0BzcmMvbGliL3JlZHV4JzsKaW1wb3J0IHsgUmVzb3VyY2VTdGF0dXMsIEFjY291bnRTdGF0dXMsIE9uYm9hcmRpbmdUeXBlLCBNZVBsYW4sIE1lU3RhdHVzTmV3LCB9IGZyb20gJ0BzcmMvdHlwZXMnOwppbXBvcnQgeyBDb3Vwb25UeXBlIH0gZnJvbSAnQHNyYy90eXBlcy9iaWxsaW5nJzsKaW1wb3J0IHsgcmVzb3VyY2VPayB9IGZyb20gJ0BzcmMvbGliL3Jlc291cmNlJzsKaW1wb3J0IHsgY3JlYXRlU2VsZWN0b3IgfSBmcm9tICdAc3JjL2xpYi9zZWxlY3Rvcic7CmltcG9ydCB7IHNlbGVjdEFjY291bnRzIH0gZnJvbSAnQHNyYy9kdWNrcy9hY2NvdW50cyc7CmltcG9ydCB7IEVycm9yTWVzc2FnZSB9IGZyb20gJ0BzcmMvYXBpL2Jhc2UnOwppbXBvcnQgeyBSaWdodFNpZGViYXJUYWIgfSBmcm9tICdAc3JjL3R5cGVzL3JpZ2h0U2lkZWJhcic7CmltcG9ydCB7IE9uYm9hcmRpbmdTZWN0aW9uIH0gZnJvbSAnQHNyYy9saWIvb25ib2FyZGluZyc7CmltcG9ydCB7IGlzRWxlY3Ryb24gfSBmcm9tICdAc3JjL2xpYi9lbGVjdHJvbic7CmltcG9ydCB7IGVuYWJsZVVzZXJEZWJ1ZywgZGlzYWJsZVVzZXJEZWJ1ZyB9IGZyb20gJ0BzcmMvbGliL2RiJzsKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnOwppbXBvcnQgeyByZWNvcmRMb2cgfSBmcm9tICdAc3JjL2xpYi9sb2cnOwpleHBvcnQgdmFyIE1FX0NSRUFURSA9IChfYSA9IGNyZWF0ZSgnTUVfQ1JFQVRFJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgeyByZXR1cm4gKF9fYXNzaWduKF9fYXNzaWduKHt9LCBzdGF0ZSksIHsgc2lnblVwUGVuZGluZzogdHJ1ZSB9KSk7IH0sCiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsgcmV0dXJuIChfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3RhdGUpLCB7IHNpZ25VcFBlbmRpbmc6IGZhbHNlIH0pKTsgfSwKICAgIGZhaWx1cmU6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgZXJyb3IpIHsgcmV0dXJuIChfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3RhdGUpLCB7IHNpZ25VcFBlbmRpbmc6IGZhbHNlIH0pKTsgfSwKfSksIF9hLnR5cGUpLCBtZUNyZWF0ZSA9IF9hLmFjdGlvbiwgbWVDcmVhdGVSZWR1Y2VyID0gX2EucmVkdWNlcjsKLy8gRkVUQ0ggVVNFUgpleHBvcnQgdmFyIE1FX0ZFVENIID0gKF9iID0gY3JlYXRlKCdNRV9GRVRDSCcsIHsKICAgIHN0YXJ0OiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEpIHsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7IG1lOiB7IHN0YXR1czogeyAkc2V0OiBSZXNvdXJjZVN0YXR1cy5Mb2FkaW5nIH0gfSB9KTsKICAgIH0sCiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsKICAgICAgICB2YXIgbWVQYXlsb2FkID0gcGF5bG9hZC5tZTsKICAgICAgICAvLyBoYW5kbGUgU2VudHJ5IHVzZXIgaWRlbnRpZmljYXRpb24KICAgICAgICBzZXRVc2VyKHsKICAgICAgICAgICAgaWQ6IG1lUGF5bG9hZC5pZCwKICAgICAgICAgICAgZW1haWw6IG1lUGF5bG9hZC5lbWFpbCwKICAgICAgICB9KTsKICAgICAgICB2YXIgY29va2llID0gQ29va2llcy5nZXQoJ3JlZmVycmFsUHJvcGVydGllcycpOwogICAgICAgIGlmIChtZVBheWxvYWQucmVmZXJyYWxSZWRlZW1lZCAmJiBjb29raWUpIHsKICAgICAgICAgICAgQ29va2llcy5yZW1vdmUoJ3JlZmVycmFsUHJvcGVydGllcycpOwogICAgICAgIH0KICAgICAgICAvLyBnZXQgY291cG9uIC1pZiBhbnktIGZyb20gdGhlIGxvY2FsU3RvcmFnZQogICAgICAgIHZhciBjb3Vwb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShDb3Vwb25UeXBlLkNvdXBvbik7CiAgICAgICAgaWYgKGNvdXBvbiAmJiBtZXRhICE9PSBDb3Vwb25UeXBlLlJlbW92ZSkgewogICAgICAgICAgICB2YXIgcGFyc2VkQ291cG9uID0gSlNPTi5wYXJzZShjb3Vwb24pOwogICAgICAgICAgICBtZVBheWxvYWQgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgbWVQYXlsb2FkKSwgeyBjb3Vwb246IHBhcnNlZENvdXBvbiB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKG1ldGEgPT09IENvdXBvblR5cGUuUmVtb3ZlKSB7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKENvdXBvblR5cGUuQ291cG9uKTsKICAgICAgICB9CiAgICAgICAgLy8gc2F2ZSB0byBsb2NhbHN0b3JhZ2UKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbWUnLCBKU09OLnN0cmluZ2lmeShtZVBheWxvYWQpKTsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbGlzdHMnLCBKU09OLnN0cmluZ2lmeShwYXlsb2FkLmxpc3RzKSk7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FjY291bnRzJywgSlNPTi5zdHJpbmdpZnkocGF5bG9hZC5hY2NvdW50cykpOwogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdkZXZpY2VzJywgSlNPTi5zdHJpbmdpZnkocGF5bG9hZC5kZXZpY2VzKSk7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3ByZWZlcmVuY2VzJywgSlNPTi5zdHJpbmdpZnkocGF5bG9hZC5wcmVmZXJlbmNlcykpOwogICAgICAgIGlmIChtZVBheWxvYWQpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGJvb3QgaW50ZXJjb20KICAgICAgICAgICAgICAgIHdpbmRvdy5JbnRlcmNvbSgnYm9vdCcsIHsKICAgICAgICAgICAgICAgICAgICBhcHBfaWQ6ICdwcGNqM215eCcsCiAgICAgICAgICAgICAgICAgICAgdXNlcl9pZDogbWVQYXlsb2FkLmlkLAogICAgICAgICAgICAgICAgICAgIGVtYWlsOiBtZVBheWxvYWQuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgdXNlcl9oYXNoOiBtZVBheWxvYWQuaW50ZXJjb21JZGVudGl0eSwKICAgICAgICAgICAgICAgICAgICBoaWRlX2RlZmF1bHRfbGF1bmNoZXI6IHRydWUsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgY2FwdHVyZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBoYW5kbGUgZGVidWdnaW5nCiAgICAgICAgaWYgKG1lUGF5bG9hZCAmJiBtZVBheWxvYWQuZGVidWdVbnRpbCAmJiBtb21lbnQobWVQYXlsb2FkLmRlYnVnVW50aWwpLmlzQWZ0ZXIobW9tZW50KCkpKSB7CiAgICAgICAgICAgIGVuYWJsZVVzZXJEZWJ1ZygnJywgcmVjb3JkTG9nKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGRpc2FibGVVc2VyRGVidWcoKTsKICAgICAgICB9CiAgICAgICAgLy8gcmV0dXJuIHVwZGF0ZWQgc3RhdGUKICAgICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIHN0YXRlKSwgeyBtZTogcmVzb3VyY2VPayhtZVBheWxvYWQpLCBsaXN0czogcGF5bG9hZC5saXN0cywgYWNjb3VudHM6IHBheWxvYWQuYWNjb3VudHMsIHByZWZlcmVuY2VzOiBwYXlsb2FkLnByZWZlcmVuY2VzLCBkZXZpY2VzOiBwYXlsb2FkLmRldmljZXMsIHRmYU5lZWRlZDogZmFsc2UgfSk7CiAgICB9LAogICAgZmFpbHVyZTogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBlcnJvcikgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgbWU6IHsKICAgICAgICAgICAgICAgIHN0YXR1czogeyAkc2V0OiBSZXNvdXJjZVN0YXR1cy5GYWlsdXJlIH0sCiAgICAgICAgICAgICAgICBlcnJvcjogeyAkc2V0OiBlcnJvciB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICB0ZmFOZWVkZWQ6IHsKICAgICAgICAgICAgICAgICRzZXQ6IGVycm9yLm1lc3NhZ2UgPT09IEVycm9yTWVzc2FnZS5Ud29GYWN0b3JBdXRoTmVlZGVkLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9iLnR5cGUpLCBtZUZldGNoID0gX2IuYWN0aW9uLCBtZUZldGNoUmVkdWNlciA9IF9iLnJlZHVjZXI7CmV4cG9ydCB2YXIgTUVfRVhQRVJJTUVOVFNfRkVUQ0ggPSAoX2MgPSBjcmVhdGUoJ01FX0VYUEVSSU1FTlRTX0ZFVENIJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSkgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgbWU6IHsKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBleHBlcmltZW50czogewogICAgICAgICAgICAgICAgICAgICAgICAkc2V0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IFJlc291cmNlU3RhdHVzLkxvYWRpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBtZTogewogICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIGV4cGVyaW1lbnRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICRtZXJnZTogX19hc3NpZ24oeyBzdGF0dXM6IFJlc291cmNlU3RhdHVzLk9rIH0sIHBheWxvYWQpLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKICAgIGZhaWx1cmU6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgZXJyb3IpIHsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIG1lOiB7CiAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgZXhwZXJpbWVudHM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBSZXNvdXJjZVN0YXR1cy5GYWlsdXJlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9jLnR5cGUpLCBtZUV4cGVyaW1lbnRzRmV0Y2ggPSBfYy5hY3Rpb24sIG1lRXhwZXJpbWVudHNGZXRjaFJlZHVjZXIgPSBfYy5yZWR1Y2VyOwovLyBQQVRDSCBVU0VSCi8vIFRPRE8oU0hJTik6IEZpZ3VyZSBvdXQgZXJyb3IgY2FzZXMgZm9yIG9wdGltaXN0aWMgcGF0Y2hlcwpleHBvcnQgdmFyIE1FX1VQREFURSA9IChfZCA9IGNyZWF0ZSgnTUVfUEFUQ0gnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgeyBtZTogeyBkYXRhOiB7ICRzZXQ6IG1ldGEgfSB9IH0pOwogICAgfSwKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgewogICAgICAgIC8vIHJldHVybiB1cGRhdGVkIHN0YXRlCiAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBzdGF0ZSksIHsgbWU6IHJlc291cmNlT2socGF5bG9hZC5tZSkgfSk7CiAgICB9LAogICAgLy8gVE9ETyhTSElOKTogSGFuZGxlIHN0YXRlIGVycm9yCiAgICBmYWlsdXJlOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIGVycm9yKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgfSwKfSksIF9kLnR5cGUpLCBtZVVwZGF0ZSA9IF9kLmFjdGlvbiwgbWVVcGRhdGVSZWR1Y2VyID0gX2QucmVkdWNlcjsKZXhwb3J0IHZhciBNRV9ERUxFVEUgPSAoX2UgPSBjcmVhdGUoJ01FX0RFTEVURScsIHt9KSwgX2UudHlwZSksIG1lRGVsZXRlID0gX2UuYWN0aW9uLCBtZURlbGV0ZVJlZHVjZXIgPSBfZS5yZWR1Y2VyOwpleHBvcnQgdmFyIE9uYm9hcmRpbmdWZXJzaW9uOwooZnVuY3Rpb24gKE9uYm9hcmRpbmdWZXJzaW9uKSB7CiAgICBPbmJvYXJkaW5nVmVyc2lvblsiT25lIl0gPSAib25lIjsKICAgIE9uYm9hcmRpbmdWZXJzaW9uWyJUd28iXSA9ICJ0d28iOwp9KShPbmJvYXJkaW5nVmVyc2lvbiB8fCAoT25ib2FyZGluZ1ZlcnNpb24gPSB7fSkpOwpleHBvcnQgdmFyIE9OQk9BUkRJTkdfUkVTRVQgPSAoX2YgPSBjcmVhdGUoJ09OQk9BUkRJTkdfUkVTRVQnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgdmFyIF9hLCBfYiwgX2M7CiAgICAgICAgdmFyIG9uYm9hcmRpbmcgPSBzdGF0ZS5vbmJvYXJkaW5nOwogICAgICAgIGlmIChtZXRhID09PSBPbmJvYXJkaW5nVmVyc2lvbi5Ud28pIHsKICAgICAgICAgICAgb25ib2FyZGluZyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBzdGF0ZS5vbmJvYXJkaW5nKSwgKF9hID0ge30sIF9hW09uYm9hcmRpbmdUeXBlLkV4cGxvcmVNb2RhbF0gPSBmYWxzZSwgX2FbT25ib2FyZGluZ1R5cGUuQ2xhaW1DcmVkaXRdID0gZmFsc2UsIF9hLnN0ZXBzID0gKF9iID0ge30sCiAgICAgICAgICAgICAgICBfYltPbmJvYXJkaW5nVHlwZS5OZXh0VGhyZWFkXSA9IGZhbHNlLAogICAgICAgICAgICAgICAgX2JbT25ib2FyZGluZ1R5cGUuUHJldmlvdXNUaHJlYWRdID0gZmFsc2UsCiAgICAgICAgICAgICAgICBfYltPbmJvYXJkaW5nVHlwZS5BcmNoaXZlXSA9IGZhbHNlLAogICAgICAgICAgICAgICAgX2JbT25ib2FyZGluZ1R5cGUuVW5kb10gPSBmYWxzZSwKICAgICAgICAgICAgICAgIF9iW09uYm9hcmRpbmdUeXBlLlJlYWRMYXRlcl0gPSBmYWxzZSwKICAgICAgICAgICAgICAgIF9iW09uYm9hcmRpbmdUeXBlLkJsb2NrXSA9IGZhbHNlLAogICAgICAgICAgICAgICAgX2JbT25ib2FyZGluZ1R5cGUuQ29tbWFuZExhdGVyXSA9IGZhbHNlLAogICAgICAgICAgICAgICAgX2JbT25ib2FyZGluZ1R5cGUuU2VuZExhdGVyXSA9IGZhbHNlLAogICAgICAgICAgICAgICAgX2JbT25ib2FyZGluZ1R5cGUuTWVzc2FnZVRlbXBsYXRlc10gPSBmYWxzZSwKICAgICAgICAgICAgICAgIF9iW09uYm9hcmRpbmdUeXBlLkZvbGxvd1VwUmVtaW5kZXJdID0gZmFsc2UsCiAgICAgICAgICAgICAgICBfYltPbmJvYXJkaW5nVHlwZS5TYXZlQXNUZW1wbGF0ZV0gPSBmYWxzZSwKICAgICAgICAgICAgICAgIF9iW09uYm9hcmRpbmdUeXBlLk1lc3NhZ2VUZW1wbGF0ZXNdID0gZmFsc2UsCiAgICAgICAgICAgICAgICBfYltPbmJvYXJkaW5nVHlwZS5TaGFyZVRocmVhZF0gPSBmYWxzZSwKICAgICAgICAgICAgICAgIF9iW09uYm9hcmRpbmdUeXBlLkNvbW1lbnRdID0gZmFsc2UsCiAgICAgICAgICAgICAgICBfYltPbmJvYXJkaW5nVHlwZS5BY3Rpdml0eUZlZWRdID0gZmFsc2UsCiAgICAgICAgICAgICAgICBfYltPbmJvYXJkaW5nVHlwZS5TY2hlZHVsaW5nXSA9IGZhbHNlLAogICAgICAgICAgICAgICAgX2IpLCBfYSkpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgb25ib2FyZGluZyA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCBzdGF0ZS5vbmJvYXJkaW5nKSwgKF9jID0ge30sIF9jW09uYm9hcmRpbmdUeXBlLkNyZWF0ZURyYWZ0XSA9IGZhbHNlLCBfY1tPbmJvYXJkaW5nVHlwZS5TZW5kTWVzc2FnZV0gPSBmYWxzZSwgX2NbT25ib2FyZGluZ1R5cGUuVGhyZWFkRGV0YWlsVHJhY2tpbmddID0gZmFsc2UsIF9jW09uYm9hcmRpbmdUeXBlLkNyZWF0ZUNvbW1lbnRdID0gZmFsc2UsIF9jW09uYm9hcmRpbmdUeXBlLlNjaGVkdWxpbmddID0gZmFsc2UsIF9jW09uYm9hcmRpbmdUeXBlLlNlcXVlbmNlc10gPSBmYWxzZSwgX2NbT25ib2FyZGluZ1R5cGUuSW52aXRlVGVhbU1lbWJlcnNdID0gZmFsc2UsIF9jW09uYm9hcmRpbmdUeXBlLkNvbW1hbmRDZW50ZXJdID0gZmFsc2UsIF9jW09uYm9hcmRpbmdUeXBlLkRvd25sb2FkTmF0aXZlQXBwc10gPSBmYWxzZSwgX2NbT25ib2FyZGluZ1R5cGUuTWVudGlvbnNUYWJdID0gZmFsc2UsIF9jKSk7CiAgICAgICAgfQogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdvbmJvYXJkaW5nJywgSlNPTi5zdHJpbmdpZnkob25ib2FyZGluZykpOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgb25ib2FyZGluZzogewogICAgICAgICAgICAgICAgJHNldDogb25ib2FyZGluZywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmlnaHRTaWRlYmFyOiB7CiAgICAgICAgICAgICAgICB0YWI6IHsKICAgICAgICAgICAgICAgICAgICAkc2V0OiBtZXRhID09PSBPbmJvYXJkaW5nVmVyc2lvbi5Ud28KICAgICAgICAgICAgICAgICAgICAgICAgPyBSaWdodFNpZGViYXJUYWIuT25ib2FyZGluZwogICAgICAgICAgICAgICAgICAgICAgICA6IHN0YXRlLnJpZ2h0U2lkZWJhci50YWIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29sbGFwc2VkOiB7IHRocmVhZHM6IHsgJHNldDogZmFsc2UgfSB9LAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9mLnR5cGUpLCBvbmJvYXJkaW5nUmVzZXQgPSBfZi5hY3Rpb24sIG9uYm9hcmRpbmdSZXNldFJlZHVjZXIgPSBfZi5yZWR1Y2VyOwpleHBvcnQgdmFyIE9OQk9BUkRJTkdfRkVUQ0ggPSAoX2cgPSBjcmVhdGUoJ09OQk9BUkRJTkdfRkVUQ0gnLCB7CiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnb25ib2FyZGluZycsIEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKTsKICAgICAgICB2YXIgdXBkYXRlZFN0YXRlID0gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIG9uYm9hcmRpbmc6IHsgJHNldDogcGF5bG9hZCB9LAogICAgICAgIH0pOwogICAgICAgIHZhciBzaG93T25ib2FyZGluZ1RhYiA9IHNlbGVjdFJzYk9uYm9hcmRpbmcodXBkYXRlZFN0YXRlKSAhPT0gT25ib2FyZGluZ1R5cGUuQ29tcGxldGUgfHwKICAgICAgICAgICAgIXBheWxvYWQuZXhwbG9yZU1vZGFsOwogICAgICAgIHZhciByc2JUYWIgPSBzaG93T25ib2FyZGluZ1RhYgogICAgICAgICAgICA/IFJpZ2h0U2lkZWJhclRhYi5PbmJvYXJkaW5nCiAgICAgICAgICAgIDogUmlnaHRTaWRlYmFyVGFiLkNvbnRhY3Q7CiAgICAgICAgdmFyIGNvbGxhcHNlZFN0YXRlID0gcnNiVGFiID09PSBSaWdodFNpZGViYXJUYWIuT25ib2FyZGluZwogICAgICAgICAgICA/IGZhbHNlCiAgICAgICAgICAgIDogc3RhdGUucmlnaHRTaWRlYmFyLmNvbGxhcHNlZC50aHJlYWRzOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgb25ib2FyZGluZzogewogICAgICAgICAgICAgICAgJHNldDogcGF5bG9hZCwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmlnaHRTaWRlYmFyOiB7CiAgICAgICAgICAgICAgICB0YWI6IHsgJHNldDogcnNiVGFiIH0sCiAgICAgICAgICAgICAgICBjb2xsYXBzZWQ6IHsgdGhyZWFkczogeyAkc2V0OiBjb2xsYXBzZWRTdGF0ZSB9IH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2cudHlwZSksIG9uYm9hcmRpbmdGZXRjaCA9IF9nLmFjdGlvbiwgb25ib2FyZGluZ0ZldGNoUmVkdWNlciA9IF9nLnJlZHVjZXI7CmV4cG9ydCB2YXIgTUVfUEhPVE9fVVBEQVRFID0gKF9oID0gY3JlYXRlKCdNRV9QSE9UT19VUERBVEUnLCB7fSksIF9oLnR5cGUpLCBtZVBob3RvVXBkYXRlID0gX2guYWN0aW9uLCBtZVBob3RvVXBkYXRlUmVkdWNlciA9IF9oLnJlZHVjZXI7CmV4cG9ydCB2YXIgTUVfU0lHTl9VUF9JTkZPX1VQREFURSA9IChfaiA9IGNyZWF0ZSgnTUVfU0lHTl9VUF9JTkZPX1VQREFURScsIHt9KSwgX2oudHlwZSksIG1lU2lnblVwSW5mb1VwZGF0ZSA9IF9qLmFjdGlvbiwgbWVTaWduVXBJbmZvVXBkYXRlUmVkdWNlciA9IF9qLnJlZHVjZXI7CmV4cG9ydCB2YXIgTUVfVEZBX1NFVCA9IChfayA9IGNyZWF0ZSgnTUVfVEZBX1NFVCcsIHsKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgbWU6IHsKICAgICAgICAgICAgICAgIHRmYTogewogICAgICAgICAgICAgICAgICAgICRzZXQ6IHBheWxvYWQsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICB0ZmFQYXNzd29yZENvbmZpcm1lZDogeyAkc2V0OiB0cnVlIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgZmFpbHVyZTogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICB0ZmFQYXNzd29yZENvbmZpcm1lZDogeyAkc2V0OiBmYWxzZSB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9rLnR5cGUpLCBtZVRmYVNldCA9IF9rLmFjdGlvbiwgbWVUZmFTZXRSZWR1Y2VyID0gX2sucmVkdWNlcjsKZXhwb3J0IHZhciBNRV9URkFfVU5TRVQgPSAoX2wgPSBjcmVhdGUoJ01FX1RGQV9VTlNFVCcsIHsKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgbWU6IHsKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAkdW5zZXQ6IFsndGZhJ10sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICB0ZmFQYXNzd29yZENvbmZpcm1lZDogeyAkc2V0OiBmYWxzZSB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9sLnR5cGUpLCBtZVRmYVVuc2V0ID0gX2wuYWN0aW9uLCBtZVRmYVVuc2V0UmVkdWNlciA9IF9sLnJlZHVjZXI7CmV4cG9ydCB2YXIgTUVfVEZBX1ZFUklGWSA9IChfbSA9IGNyZWF0ZSgnTUVfVEZBX1ZFUklGWScsIHsKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgbWU6IHsKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICB0ZmE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCn0pLCBfbS50eXBlKSwgbWVUZmFWZXJpZnkgPSBfbS5hY3Rpb24sIG1lVGZhVmVyaWZ5UmVkdWNlciA9IF9tLnJlZHVjZXI7CmV4cG9ydCB2YXIgT05CT0FSRElOR19QQVRDSCA9IChfbyA9IGNyZWF0ZSgnT05CT0FSRElOR19QQVRDSCcsIHsKICAgIHN0YXJ0OiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEpIHsKICAgICAgICAvLyBUT0RPKFNISU4pOiBDb3VsZCBtYXliZSBhYnN0cmFjdCBpbiBjb21wb25lbnQKICAgICAgICAvLyBQcmV2ZW50IG90aGVyIG9uYm9hcmRpbmcgc3RlcHMgaWYgZXhwbG9yZSBtb2RhbCBpcyBzaG93aW5nCiAgICAgICAgaWYgKG1ldGEudHlwZS5zZW5kTWVzc2FnZSAmJiAhc3RhdGUub25ib2FyZGluZy5leHBsb3JlTW9kYWwpIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgIH0KICAgICAgICAvLyBGb3JjZSBPbmJvYXJkaW5nIHRhYiBpZiBzZXR0aW5nIGV4cGxvcmUgbW9kYWwgdG8gdHJ1ZQogICAgICAgIHZhciByc2JUYWIgPSBtZXRhLnR5cGUuZXhwbG9yZU1vZGFsID09PSB0cnVlCiAgICAgICAgICAgID8gUmlnaHRTaWRlYmFyVGFiLk9uYm9hcmRpbmcKICAgICAgICAgICAgOiBzdGF0ZS5yaWdodFNpZGViYXIudGFiOwogICAgICAgIHZhciB1cGRhdGVkID0gX19hc3NpZ24oX19hc3NpZ24oX19hc3NpZ24oe30sIHN0YXRlLm9uYm9hcmRpbmcpLCBtZXRhLnR5cGUpLCB7IHN0ZXBzOiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3RhdGUub25ib2FyZGluZy5zdGVwcyksIG1ldGEudHlwZS5zdGVwcykgfSk7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ29uYm9hcmRpbmcnLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVkKSk7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBvbmJvYXJkaW5nOiB7CiAgICAgICAgICAgICAgICAkc2V0OiB1cGRhdGVkLAogICAgICAgICAgICB9LAogICAgICAgICAgICByaWdodFNpZGViYXI6IHsKICAgICAgICAgICAgICAgIHRhYjogeyAkc2V0OiByc2JUYWIgfSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCn0pLCBfby50eXBlKSwgb25ib2FyZGluZ1BhdGNoID0gX28uYWN0aW9uLCBvbmJvYXJkaW5nUGF0Y2hSZWR1Y2VyID0gX28ucmVkdWNlcjsKZXhwb3J0IHZhciBPTkJPQVJESU5HX0NSRURJVF9DTEFJTSA9IChfcCA9IGNyZWF0ZSgnT05CT0FSRElOR19DUkVESVRfQ0xBSU0nLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgdmFyIHVwZGF0ZWQgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3RhdGUub25ib2FyZGluZyksIHsgY2xhaW1lZENyZWRpdDogdHJ1ZSB9KTsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnb25ib2FyZGluZycsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWQpKTsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIG9uYm9hcmRpbmc6IHsKICAgICAgICAgICAgICAgICRzZXQ6IHVwZGF0ZWQsCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX3AudHlwZSksIG9uYm9hcmRpbmdDcmVkaXRDbGFpbSA9IF9wLmFjdGlvbiwgb25ib2FyZGluZ0NyZWRpdENsYWltUmVkdWNlciA9IF9wLnJlZHVjZXI7Ci8vIFBBVENIIFVTRVIKLy8gVE9ETyhTSElOKTogRmlndXJlIG91dCBlcnJvciBjYXNlcyBmb3Igb3B0aW1pc3RpYyBwYXRjaGVzCmV4cG9ydCB2YXIgUFJFRkVSRU5DRVNfVVBEQVRFID0gKF9xID0gY3JlYXRlKCdQUkVGRVJFTkNFU19VUERBVEUnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgeyBwcmVmZXJlbmNlczogeyAkc2V0OiBtZXRhIH0gfSk7CiAgICB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgLy8gcmV0dXJuIHVwZGF0ZWQgc3RhdGUKICAgICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIHN0YXRlKSwgeyBtZTogcmVzb3VyY2VPayhwYXlsb2FkLm1lKSB9KTsKICAgIH0sCiAgICAvLyBUT0RPKFNISU4pOiBIYW5kbGUgc3RhdGUgZXJyb3IKICAgIGZhaWx1cmU6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgZXJyb3IpIHsKICAgICAgICByZXR1cm4gc3RhdGU7CiAgICB9LAp9KSwgX3EudHlwZSksIHByZWZlcmVuY2VzVXBkYXRlID0gX3EuYWN0aW9uLCBwcmVmZXJlbmNlc1VwZGF0ZVJlZHVjZXIgPSBfcS5yZWR1Y2VyOwpleHBvcnQgZGVmYXVsdCBbCiAgICBtZUZldGNoUmVkdWNlciwKICAgIG1lQ3JlYXRlUmVkdWNlciwKICAgIG1lVXBkYXRlUmVkdWNlciwKICAgIHByZWZlcmVuY2VzVXBkYXRlUmVkdWNlciwKICAgIG9uYm9hcmRpbmdGZXRjaFJlZHVjZXIsCiAgICBvbmJvYXJkaW5nUGF0Y2hSZWR1Y2VyLAogICAgb25ib2FyZGluZ0NyZWRpdENsYWltUmVkdWNlciwKICAgIG9uYm9hcmRpbmdSZXNldFJlZHVjZXIsCiAgICBtZVRmYVNldFJlZHVjZXIsCiAgICBtZVRmYVVuc2V0UmVkdWNlciwKICAgIG1lRXhwZXJpbWVudHNGZXRjaFJlZHVjZXIsCl07CmV4cG9ydCBmdW5jdGlvbiBzZWxlY3RNZShzdGF0ZSkgewogICAgcmV0dXJuIHN0YXRlLm1lLmRhdGE7Cn0KZXhwb3J0IGZ1bmN0aW9uIHNlbGVjdFVzZXJJc0FkbWluKHN0YXRlKSB7CiAgICByZXR1cm4gc3RhdGUubWUuZGF0YSAmJiBzdGF0ZS50ZWFtLmRhdGEKICAgICAgICAmJiBzdGF0ZS50ZWFtLmRhdGEuYWRtaW5zLmZpbHRlcihmdW5jdGlvbiAoaWQpIHsgcmV0dXJuIGlkID09PSBzdGF0ZS5tZS5kYXRhLmlkOyB9KS5sZW5ndGggPiAwIHx8IGZhbHNlOwp9Ci8vIElkZW50aWZpZXMgd2hldGhlciBhbiBvbmJvYXJkaW5nIHRpcCBzaG91bGQgYmUgc2hvd24KZXhwb3J0IHZhciBzZWxlY3RSc2JPbmJvYXJkaW5nID0gY3JlYXRlU2VsZWN0b3IoWwogICAgZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBzdGF0ZS5vbmJvYXJkaW5nOyB9LAogICAgZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBzdGF0ZS5mZWF0dXJlczsgfSwKXSwgZnVuY3Rpb24gKG9uYm9hcmRpbmcsIGZlYXR1cmVzKSB7CiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfaiwgX2ssIF9sLCBfbSwgX28sIF9wOwogICAgaWYgKCFvbmJvYXJkaW5nLnN0ZXBzKSB7CiAgICAgICAgcmV0dXJuIE9uYm9hcmRpbmdUeXBlLkNvbXBsZXRlOwogICAgfQogICAgdmFyIG9wdGlvbnMgPSBbCiAgICAgICAgKF9hID0ge30sCiAgICAgICAgICAgIF9hW09uYm9hcmRpbmdUeXBlLlNlbmRNZXNzYWdlXSA9IG9uYm9hcmRpbmcuc2VuZE1lc3NhZ2UsCiAgICAgICAgICAgIF9hKSwKICAgICAgICAoX2IgPSB7fSwKICAgICAgICAgICAgX2JbT25ib2FyZGluZ1R5cGUuU2VuZExhdGVyXSA9IG9uYm9hcmRpbmcuc3RlcHMuc2VuZExhdGVyLAogICAgICAgICAgICBfYiksCiAgICAgICAgKF9jID0ge30sCiAgICAgICAgICAgIF9jW09uYm9hcmRpbmdUeXBlLkZvbGxvd1VwUmVtaW5kZXJdID0gb25ib2FyZGluZy5zdGVwcy5mb2xsb3dVcFJlbWluZGVyLAogICAgICAgICAgICBfYyksCiAgICAgICAgKF9kID0ge30sCiAgICAgICAgICAgIF9kW09uYm9hcmRpbmdUeXBlLk1lc3NhZ2VUZW1wbGF0ZXNdID0gb25ib2FyZGluZy5zdGVwcy5tZXNzYWdlVGVtcGxhdGVzLAogICAgICAgICAgICBfZCksCiAgICAgICAgKF9lID0ge30sCiAgICAgICAgICAgIF9lW09uYm9hcmRpbmdUeXBlLlNhdmVBc1RlbXBsYXRlXSA9IG9uYm9hcmRpbmcuc3RlcHMuc2F2ZUFzVGVtcGxhdGUsCiAgICAgICAgICAgIF9lKSwKICAgICAgICAoX2YgPSB7fSwKICAgICAgICAgICAgX2ZbT25ib2FyZGluZ1R5cGUuTmV4dFRocmVhZF0gPSBvbmJvYXJkaW5nLnN0ZXBzLm5leHRUaHJlYWQsCiAgICAgICAgICAgIF9mKSwKICAgICAgICAoX2cgPSB7fSwKICAgICAgICAgICAgX2dbT25ib2FyZGluZ1R5cGUuQXJjaGl2ZV0gPSBvbmJvYXJkaW5nLnN0ZXBzLmFyY2hpdmUsCiAgICAgICAgICAgIF9nKSwKICAgICAgICAoX2ggPSB7fSwKICAgICAgICAgICAgX2hbT25ib2FyZGluZ1R5cGUuVW5kb10gPSBvbmJvYXJkaW5nLnN0ZXBzLnVuZG8sCiAgICAgICAgICAgIF9oKSwKICAgICAgICAoX2ogPSB7fSwKICAgICAgICAgICAgX2pbT25ib2FyZGluZ1R5cGUuUmVhZExhdGVyXSA9IG9uYm9hcmRpbmcuc3RlcHMucmVhZExhdGVyLAogICAgICAgICAgICBfaiksCiAgICAgICAgKF9rID0ge30sCiAgICAgICAgICAgIF9rW09uYm9hcmRpbmdUeXBlLlNoYXJlVGhyZWFkXSA9IG9uYm9hcmRpbmcuc3RlcHMuc2hhcmVUaHJlYWQsCiAgICAgICAgICAgIF9rKSwKICAgICAgICAoX2wgPSB7fSwKICAgICAgICAgICAgX2xbT25ib2FyZGluZ1R5cGUuQ29tbWVudF0gPSBvbmJvYXJkaW5nLnN0ZXBzLmNvbW1lbnQsCiAgICAgICAgICAgIF9sKSwKICAgICAgICAoX20gPSB7fSwKICAgICAgICAgICAgX21bT25ib2FyZGluZ1R5cGUuU2NoZWR1bGluZ10gPSBvbmJvYXJkaW5nLnN0ZXBzLnNjaGVkdWxpbmcsCiAgICAgICAgICAgIF9tKSwKICAgIF07CiAgICAvLyBBZGQgZG93bmxvYWQgbmF0aXZlIG9wdGlvbgogICAgaWYgKCFpc0VsZWN0cm9uKSB7CiAgICAgICAgb3B0aW9ucy5wdXNoKChfbyA9IHt9LCBfb1tPbmJvYXJkaW5nVHlwZS5Eb3dubG9hZE5hdGl2ZUFwcHNdID0gb25ib2FyZGluZy5kb3dubG9hZE5hdGl2ZUFwcHMsIF9vKSk7CiAgICB9CiAgICAvLyBPbmx5IHNob3cgY2xhaW0gY3JlZGl0IGlmIG9wdGlvbiBpcyBhdmFpbGFibGUKICAgIGlmIChvbmJvYXJkaW5nLmNyZWRpdENsYWltYWJsZSkgewogICAgICAgIG9wdGlvbnMucHVzaCgoX3AgPSB7fSwKICAgICAgICAgICAgX3BbT25ib2FyZGluZ1R5cGUuQ2xhaW1DcmVkaXRdID0gb25ib2FyZGluZy5jbGFpbWVkQ3JlZGl0LAogICAgICAgICAgICBfcCkpOwogICAgfQogICAgdmFyIGZpbHRlcmVkT3B0aW9ucyA9IG9wdGlvbnMKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhKSB7IHJldHVybiAhT2JqZWN0LnZhbHVlcyhhKVswXTsgfSkKICAgICAgICAubWFwKGZ1bmN0aW9uIChhKSB7IHJldHVybiBPYmplY3Qua2V5cyhhKVswXTsgfSk7CiAgICBpZiAoIWZpbHRlcmVkT3B0aW9ucy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gT25ib2FyZGluZ1R5cGUuQ29tcGxldGU7CiAgICB9CiAgICByZXR1cm4gZmlsdGVyZWRPcHRpb25zWzBdOwp9LCBmdW5jdGlvbiAob25ib2FyZGluZywgZmVhdHVyZXMpIHsgcmV0dXJuICdyc2Itb25ib2FyZGluZyc7IH0sIFsnb25ib2FyZGluZycsICdmZWF0dXJlcyddKTsKLy8gSWRlbnRpZmllcyB3aGV0aGVyIGFuIG9uYm9hcmRpbmcgdGlwIHNob3VsZCBiZSBzaG93bgpleHBvcnQgdmFyIHNlbGVjdFNob3duT25ib2FyZGluZ1NlY3Rpb25zID0gY3JlYXRlU2VsZWN0b3IoWwogICAgZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBzdGF0ZS5vbmJvYXJkaW5nOyB9LApdLCBmdW5jdGlvbiAob25ib2FyZGluZykgewogICAgdmFyIGJhc2VTZXR0aW5ncyA9IFsKICAgICAgICBPbmJvYXJkaW5nU2VjdGlvbi5Db21wb3NpbmcsCiAgICAgICAgT25ib2FyZGluZ1NlY3Rpb24uTmF2aWdhdGluZ1BvbHltYWlsLAogICAgICAgIE9uYm9hcmRpbmdTZWN0aW9uLk1hbmFnaW5nWW91ckVtYWlsLAogICAgICAgIE9uYm9hcmRpbmdTZWN0aW9uLlBvd2VyVXNlciwKICAgIF07CiAgICBpZiAoIWlzRWxlY3Ryb24pIHsKICAgICAgICBiYXNlU2V0dGluZ3MucHVzaChPbmJvYXJkaW5nU2VjdGlvbi5Eb3dubG9hZE5hdGl2ZUFwcHMpOwogICAgfQogICAgaWYgKG9uYm9hcmRpbmcuY3JlZGl0Q2xhaW1hYmxlKSB7CiAgICAgICAgYmFzZVNldHRpbmdzLnB1c2goT25ib2FyZGluZ1NlY3Rpb24uQ2xhaW1DcmVkaXQpOwogICAgfQogICAgcmV0dXJuIGJhc2VTZXR0aW5nczsKfSwgZnVuY3Rpb24gKG9uYm9hcmRpbmcpIHsgcmV0dXJuICdvbmJvYXJkaW5nLXNlY3Rpb25zJzsgfSwgWydvbmJvYXJkaW5nJywgJ2ZlYXR1cmVzJ10pOwovLyBJZGVudGlmaWVzIHdoZXRoZXIgYW4gb25ib2FyZGluZyB0aXAgc2hvdWxkIGJlIHNob3duCmV4cG9ydCB2YXIgc2VsZWN0QWxsT25ib2FyZGluZ1N0ZXBzID0gY3JlYXRlU2VsZWN0b3IoWwogICAgZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBzdGF0ZS5vbmJvYXJkaW5nOyB9LApdLCBmdW5jdGlvbiAob25ib2FyZGluZykgewogICAgdmFyIGJhc2VTZXR0aW5ncyA9IFsKICAgICAgICBPbmJvYXJkaW5nVHlwZS5TZW5kTWVzc2FnZSwKICAgICAgICBPbmJvYXJkaW5nVHlwZS5TZW5kTGF0ZXIsCiAgICAgICAgT25ib2FyZGluZ1R5cGUuRm9sbG93VXBSZW1pbmRlciwKICAgICAgICBPbmJvYXJkaW5nVHlwZS5NZXNzYWdlVGVtcGxhdGVzLAogICAgICAgIE9uYm9hcmRpbmdUeXBlLlNhdmVBc1RlbXBsYXRlLAogICAgICAgIE9uYm9hcmRpbmdUeXBlLk5leHRUaHJlYWQsCiAgICAgICAgT25ib2FyZGluZ1R5cGUuQXJjaGl2ZSwKICAgICAgICBPbmJvYXJkaW5nVHlwZS5VbmRvLAogICAgICAgIE9uYm9hcmRpbmdUeXBlLlJlYWRMYXRlciwKICAgICAgICBPbmJvYXJkaW5nVHlwZS5TaGFyZVRocmVhZCwKICAgICAgICBPbmJvYXJkaW5nVHlwZS5Db21tZW50LAogICAgICAgIE9uYm9hcmRpbmdUeXBlLlNjaGVkdWxpbmcsCiAgICBdOwogICAgaWYgKCFpc0VsZWN0cm9uKSB7CiAgICAgICAgYmFzZVNldHRpbmdzLnB1c2goT25ib2FyZGluZ1R5cGUuRG93bmxvYWROYXRpdmVBcHBzKTsKICAgIH0KICAgIGlmIChvbmJvYXJkaW5nLmNyZWRpdENsYWltYWJsZSkgewogICAgICAgIGJhc2VTZXR0aW5ncy5wdXNoKE9uYm9hcmRpbmdUeXBlLkNsYWltQ3JlZGl0KTsKICAgIH0KICAgIHJldHVybiBiYXNlU2V0dGluZ3M7Cn0sIGZ1bmN0aW9uIChvbmJvYXJkaW5nKSB7IHJldHVybiAnYWxsLW9uYm9hcmRpbmctdHlwZXNnJzsgfSwgWydvbmJvYXJkaW5nJywgJ2ZlYXR1cmVzJ10pOwovLyBJZGVudGlmaWVzIHdoZXRoZXIgYW4gb25ib2FyZGluZyB0aXAgc2hvdWxkIGJlIHNob3duCmV4cG9ydCB2YXIgc2VsZWN0T25ib2FyZGluZ1Nob3cgPSBjcmVhdGVTZWxlY3RvcihbCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLm9uYm9hcmRpbmc7IH0sCiAgICBmdW5jdGlvbiAoc3RhdGUsIHR5cGUpIHsgcmV0dXJuIHR5cGU7IH0sCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLmZlYXR1cmVzOyB9LApdLCBmdW5jdGlvbiAob25ib2FyZGluZywgdHlwZSwgZmVhdHVyZXMpIHsKICAgIGlmIChvbmJvYXJkaW5nW3R5cGVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlIE9uYm9hcmRpbmdUeXBlLkNyZWF0ZURyYWZ0OgogICAgICAgICAgICByZXR1cm4gb25ib2FyZGluZy5leHBsb3JlTW9kYWwgJiYgIW9uYm9hcmRpbmcuY3JlYXRlRHJhZnQ7CiAgICAgICAgY2FzZSBPbmJvYXJkaW5nVHlwZS5TZW5kTWVzc2FnZToKICAgICAgICAgICAgcmV0dXJuIG9uYm9hcmRpbmcuY3JlYXRlRHJhZnQgJiYgIW9uYm9hcmRpbmcuc2VuZE1lc3NhZ2U7CiAgICAgICAgY2FzZSBPbmJvYXJkaW5nVHlwZS5UaHJlYWREZXRhaWxUcmFja2luZzoKICAgICAgICAgICAgcmV0dXJuICFvbmJvYXJkaW5nLnRocmVhZERldGFpbFRyYWNraW5nOwogICAgICAgIGNhc2UgT25ib2FyZGluZ1R5cGUuQ3JlYXRlQ29tbWVudDoKICAgICAgICAgICAgcmV0dXJuIG9uYm9hcmRpbmcudGhyZWFkRGV0YWlsVHJhY2tpbmcgJiYgZmVhdHVyZXMuY29tbWVudHMgJiYgIW9uYm9hcmRpbmcuY3JlYXRlQ29tbWVudDsKICAgICAgICBjYXNlIE9uYm9hcmRpbmdUeXBlLlNjaGVkdWxpbmc6CiAgICAgICAgICAgIHJldHVybiBvbmJvYXJkaW5nLm1lbnRpb25zVGFiICYmICFvbmJvYXJkaW5nLnNjaGVkdWxpbmc7CiAgICAgICAgY2FzZSBPbmJvYXJkaW5nVHlwZS5TZXF1ZW5jZXM6CiAgICAgICAgICAgIHJldHVybiBvbmJvYXJkaW5nLnNjaGVkdWxpbmcgJiYgIW9uYm9hcmRpbmcuc2VxdWVuY2VzOwogICAgICAgIGNhc2UgT25ib2FyZGluZ1R5cGUuSW52aXRlVGVhbU1lbWJlcnM6CiAgICAgICAgICAgIHJldHVybiBmZWF0dXJlcy5jb21tZW50cyAmJiBvbmJvYXJkaW5nLmNyZWF0ZUNvbW1lbnQgJiYgIW9uYm9hcmRpbmcuaW52aXRlVGVhbU1lbWJlcnM7CiAgICAgICAgY2FzZSBPbmJvYXJkaW5nVHlwZS5Db21tYW5kQ2VudGVyOgogICAgICAgICAgICByZXR1cm4gb25ib2FyZGluZy5jcmVhdGVDb21tZW50ICYmIG9uYm9hcmRpbmcuaW52aXRlVGVhbU1lbWJlcnMgJiYKICAgICAgICAgICAgICAgICFvbmJvYXJkaW5nLmNvbW1hbmRDZW50ZXI7CiAgICAgICAgY2FzZSBPbmJvYXJkaW5nVHlwZS5Eb3dubG9hZE5hdGl2ZUFwcHM6CiAgICAgICAgICAgIHJldHVybiBvbmJvYXJkaW5nLmNvbW1hbmRDZW50ZXIgJiYgIW9uYm9hcmRpbmcuZG93bmxvYWROYXRpdmVBcHBzOwogICAgICAgIGNhc2UgT25ib2FyZGluZ1R5cGUuTWVudGlvbnNUYWI6CiAgICAgICAgICAgIHJldHVybiBvbmJvYXJkaW5nLmRvd25sb2FkTmF0aXZlQXBwcyAmJiBmZWF0dXJlcy5jb21tZW50cyAmJiAhb25ib2FyZGluZy5tZW50aW9uc1RhYjsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gIShvbmJvYXJkaW5nW3R5cGVdKTsKICAgIH0KfSwgZnVuY3Rpb24gKG9uYm9hcmRpbmcsIHR5cGUsIGZlYXR1cmVzKSB7IHJldHVybiB0eXBlOyB9LCBbJ29uYm9hcmRpbmcnLCAnZmVhdHVyZXMnXSk7Ci8vIElkZW50aWZpZXMgaWYgdXNlciBoYXMgYmVlbiBzeW5jZWQKZXhwb3J0IHZhciBzZWxlY3RVc2VySW5pdGlhbFN5bmNGaW5pc2hlZCA9IGNyZWF0ZVNlbGVjdG9yKFsKICAgIGZ1bmN0aW9uIChzdGF0ZSkgeyByZXR1cm4gc2VsZWN0QWNjb3VudHMoc3RhdGUpOyB9LApdLCBmdW5jdGlvbiAoYWNjb3VudHMpIHsKICAgIHZhciBhY2NvdW50c09rID0gYWNjb3VudHMuZmlsdGVyKGZ1bmN0aW9uIChhY2NvdW50KSB7IHJldHVybiBhY2NvdW50LnN0YXR1cyA9PT0gQWNjb3VudFN0YXR1cy5PazsgfSk7CiAgICB2YXIgc3luY2VkQWNjb3VudHNMZW5ndGggPSBhY2NvdW50c09rLmZpbHRlcihmdW5jdGlvbiAoZWFjaCkgeyByZXR1cm4gISFlYWNoLm1haWxJbml0U3luY2VkOyB9KS5sZW5ndGg7CiAgICByZXR1cm4gc3luY2VkQWNjb3VudHNMZW5ndGggPT09IGFjY291bnRzT2subGVuZ3RoOwp9LCB1bmRlZmluZWQsIFsnYWNjb3VudHMnXSk7CmV4cG9ydCB2YXIgc2VsZWN0U2hvdWxkU2VlVHJpYWxFbmRlZEJhbm5lciA9IGNyZWF0ZVNlbGVjdG9yKFsKICAgIGZ1bmN0aW9uIChzdGF0ZSkgeyByZXR1cm4gc3RhdGUubWU7IH0sCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLmZlYXR1cmVzOyB9LApdLCBmdW5jdGlvbiAobWUsIGZlYXR1cmVzKSB7CiAgICB2YXIgX2EsIF9iOwogICAgLy8gbGVnYWN5IGxvZ2ljCiAgICB2YXIgaXNFeHBpcmVkU3RhdHVzUGxhbiA9ICFmZWF0dXJlcy5mcmVlVGllcgogICAgICAgICYmICgoX2EgPSBtZS5kYXRhKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucGxhbikgPT09IE1lUGxhbi5GcmVlOwogICAgLy8gbmV3IGxvZ2ljCiAgICB2YXIgbWVTdGF0dXNOZXcgPSAoX2IgPSBtZS5kYXRhKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Iuc3RhdHVzTmV3OwogICAgdmFyIGlzRXhwaXJlZFN0YXR1c05ldyA9IG1lU3RhdHVzTmV3ID09PSBNZVN0YXR1c05ldy5UcmlhbEV4cGlyZWQ7CiAgICAvLyBzdGF0dXNOZXcgdGFrZXMgcHJlY2VkZW5jZQogICAgaWYgKG1lU3RhdHVzTmV3KSB7CiAgICAgICAgcmV0dXJuIGlzRXhwaXJlZFN0YXR1c05ldzsKICAgIH0KICAgIC8vIGZvciBsZWdhY3kgYWNjb3VudCB3aXRob3V0IHN0YXR1c05ldwogICAgcmV0dXJuIGlzRXhwaXJlZFN0YXR1c1BsYW47Cn0sIHVuZGVmaW5lZCwgWydtZScsICdmZWF0dXJlcyddKTsK"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/me.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/me.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,OAAO,MAAM,MAAM,qBAAqB,CAAC;AACzC,OAAO,EAAE,OAAO,EAAE,gBAAgB,EAAE,MAAM,iBAAiB,CAAC;AAC5D,OAAO,OAAO,MAAM,WAAW,CAAC;AAEhC,OAAO,EAAE,MAAM,EAAE,MAAM,gBAAgB,CAAC;AAExC,OAAO,EAGL,cAAc,EAId,aAAa,EACb,cAAc,EAId,MAAM,EACN,WAAW,GACZ,MAAM,YAAY,CAAC;AACpB,OAAO,EAAU,UAAU,EAAE,MAAM,oBAAoB,CAAC;AAExD,OAAO,EAAE,UAAU,EAAE,MAAM,mBAAmB,CAAC;AAC/C,OAAO,EAAE,cAAc,EAAE,MAAM,mBAAmB,CAAC;AACnD,OAAO,EAAE,cAAc,EAAE,MAAM,qBAAqB,CAAC;AACrD,OAAO,EAAE,YAAY,EAAE,MAAM,eAAe,CAAC;AAC7C,OAAO,EAAE,eAAe,EAAE,MAAM,yBAAyB,CAAC;AAC1D,OAAO,EAAE,iBAAiB,EAAE,MAAM,qBAAqB,CAAC;AACxD,OAAO,EAAE,UAAU,EAAE,MAAM,mBAAmB,CAAC;AAC/C,OAAO,EAAE,eAAe,EAAE,gBAAgB,EAAE,MAAM,aAAa,CAAC;AAChE,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,EAAE,SAAS,EAAE,MAAM,cAAc,CAAC;AA+BzC,MAAM,CACJ,IAAA;;;;YAAe,EACf,oBAAgB,EAChB,4BAAwB,CAKvB;AAEH,aAAa;AACb,MAAM,CACJ,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAAc,EACd,mBAAe,EACf,2BAAuB,CAkFtB;AAEH,MAAM,CACJ,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAA0B,EAC1B,8BAA0B,EAC1B,sCAAkC,CA6CjC;AAEH,aAAa;AACb,4DAA4D;AAC5D,MAAM,CACJ,IAAA;;;;;;;;;;;;YAAe,EACf,oBAAgB,EAChB,4BAAwB,CAkBvB;AAEH,MAAM,CACJ,IAAA,mDAAe,EACf,oBAAgB,EAChB,4BAAwB,CACc;AAExC,MAAM,CAAN,IAAY,iBAGX;AAHD,WAAY,iBAAiB;IAC3B,gCAAW,CAAA;IACX,gCAAW,CAAA;AACb,CAAC,EAHW,iBAAiB,KAAjB,iBAAiB,QAG5B;AAED,MAAM,CACJ,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAAsB,EACtB,2BAAuB,EACvB,mCAA+B,CA2D9B;AAEH,MAAM,CACJ,IAAA;;;;;;;;;;;;;;;;;;;;;;;;YAAsB,EACtB,2BAAuB,EACvB,mCAA+B,CA2B9B;AAEH,MAAM,CACJ,IAAA,+DAAqB,EACrB,yBAAqB,EACrB,iCAA6B,CACa;AAS5C,MAAM,CACJ,IAAA,6EAA4B,EAC5B,8BAA0B,EAC1B,sCAAkC,CAC6B;AAOjE,MAAM,CACJ,IAAA;;;;;;;;;;;;;;;;YAAgB,EAChB,oBAAgB,EAChB,4BAAwB,CAiBvB;AAEH,MAAM,CACJ,IAAA;;;;;;;;;;;YAAkB,EAClB,sBAAkB,EAClB,8BAA0B,CAYzB;AAEH,MAAM,CACJ,IAAA;;;;;;;;;;;;YAAmB,EACnB,uBAAmB,EACnB,+BAA2B,CAa1B;AAOH,MAAM,CACJ,IAAA;;;;;;;;;;;;;;;;;;;;;;YAAsB,EACtB,2BAAuB,EACvB,mCAA+B,CAiC9B;AAEH,MAAM,CACJ,IAAA;;;;;;;;;;YAA6B,EAC7B,iCAA6B,EAC7B,yCAAqC,CAcpC;AAEH,aAAa;AACb,4DAA4D;AAC5D,MAAM,CACJ,IAAA;;;;;;;;;;;;YAAwB,EACxB,6BAAyB,EACzB,qCAAiC,CAkBhC;AAEH,eAAe;IACb,cAAc;IACd,eAAe;IACf,eAAe;IACf,wBAAwB;IACxB,sBAAsB;IACtB,sBAAsB;IACtB,4BAA4B;IAC5B,sBAAsB;IACtB,eAAe;IACf,iBAAiB;IACjB,yBAAyB;CAC1B,CAAC;AAEF,MAAM,UAAU,QAAQ,CAAC,KAAiB;IACxC,OAAO,KAAK,CAAC,EAAE,CAAC,IAAK,CAAC;AACxB,CAAC;AAED,MAAM,UAAU,iBAAiB,CAAC,KAAiB;IACjD,OAAO,KAAK,CAAC,EAAE,CAAC,IAAI,IAAI,KAAK,CAAC,IAAI,CAAC,IAAI;WAClC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,UAAA,EAAE,IAAI,OAAA,EAAE,KAAK,KAAK,CAAC,EAAE,CAAC,IAAK,CAAC,EAAE,EAAxB,CAAwB,CAAC,CAAC,MAAM,GAAG,CAAC,IAAI,KAAK,CAAC;AACzF,CAAC;AAED,uDAAuD;AACvD,MAAM,CAAC,IAAM,mBAAmB,GAAG,cAAc,CAG/C;IACE,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,UAAU,EAAhB,CAAgB;IACzB,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,QAAQ,EAAd,CAAc;CACxB,EACD,UAAC,UAAsB,EAAE,QAAkB;;IACzC,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE;QACrB,OAAO,cAAc,CAAC,QAAQ,CAAC;KAChC;IAED,IAAM,OAAO,GAAsC;;YAG/C,GAAC,cAAc,CAAC,WAAW,IAAG,UAAU,CAAC,WAAW;;;YAGpD,GAAC,cAAc,CAAC,SAAS,IAAG,UAAU,CAAC,KAAK,CAAC,SAAS;;;YAGtD,GAAC,cAAc,CAAC,gBAAgB,IAAG,UAAU,CAAC,KAAK,CAAC,gBAAgB;;;YAGpE,GAAC,cAAc,CAAC,gBAAgB,IAAG,UAAU,CAAC,KAAK,CAAC,gBAAgB;;;YAGpE,GAAC,cAAc,CAAC,cAAc,IAAG,UAAU,CAAC,KAAK,CAAC,cAAc;;;YAKhE,GAAC,cAAc,CAAC,UAAU,IAAG,UAAU,CAAC,KAAK,CAAC,UAAU;;;YAIxD,GAAC,cAAc,CAAC,OAAO,IAAG,UAAU,CAAC,KAAK,CAAC,OAAO;;;YAGlD,GAAC,cAAc,CAAC,IAAI,IAAG,UAAU,CAAC,KAAK,CAAC,IAAI;;;YAG5C,GAAC,cAAc,CAAC,SAAS,IAAG,UAAU,CAAC,KAAK,CAAC,SAAS;;;YAKtD,GAAC,cAAc,CAAC,WAAW,IAAG,UAAU,CAAC,KAAK,CAAC,WAAW;;;YAG1D,GAAC,cAAc,CAAC,OAAO,IAAG,UAAU,CAAC,KAAK,CAAC,OAAO;;;YAGlD,GAAC,cAAc,CAAC,UAAU,IAAG,UAAU,CAAC,KAAK,CAAC,UAAU;;KAE3D,CAAC;IAEF,6BAA6B;IAC7B,IAAI,CAAC,UAAU,EAAE;QACf,OAAO,CAAC,IAAI,WAAG,GAAC,cAAc,CAAC,kBAAkB,IAAG,UAAU,CAAC,kBAAkB,MAAG,CAAC;KACtF;IAED,gDAAgD;IAChD,IAAI,UAAU,CAAC,eAAe,EAAE;QAC9B,OAAO,CAAC,IAAI;YACV,GAAC,cAAc,CAAC,WAAW,IAAG,UAAU,CAAC,aAAa;gBACtD,CAAC;KACJ;IAED,IAAM,eAAe,GAAG,OAAO;SAC5B,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAApB,CAAoB,CAAC;SACjC,GAAG,CAAC,UAAA,CAAC,IAAI,OAAA,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAmB,EAAnC,CAAmC,CAAC,CAAC;IAEjD,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE;QAC3B,OAAO,cAAc,CAAC,QAAQ,CAAC;KAChC;IACD,OAAO,eAAe,CAAC,CAAC,CAAC,CAAC;AAC5B,CAAC,EACD,UAAC,UAAsB,EAAE,QAAkB,IAAK,OAAA,gBAAgB,EAAhB,CAAgB,EAChE,CAAC,YAAY,EAAE,UAAU,CAAC,CAC3B,CAAC;AAEF,uDAAuD;AACvD,MAAM,CAAC,IAAM,6BAA6B,GAAG,cAAc,CAGzD;IACE,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,UAAU,EAAhB,CAAgB;CAC1B,EACD,UAAC,UAAsB;IAErB,IAAM,YAAY,GAAG;QACnB,iBAAiB,CAAC,SAAS;QAC3B,iBAAiB,CAAC,kBAAkB;QACpC,iBAAiB,CAAC,iBAAiB;QACnC,iBAAiB,CAAC,SAAS;KAC5B,CAAC;IAEF,IAAI,CAAC,UAAU,EAAE;QACf,YAAY,CAAC,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,CAAC,CAAC;KACzD;IAED,IAAI,UAAU,CAAC,eAAe,EAAE;QAC9B,YAAY,CAAC,IAAI,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;KAClD;IAED,OAAO,YAAY,CAAC;AACtB,CAAC,EACD,UAAC,UAAsB,IAAK,OAAA,qBAAqB,EAArB,CAAqB,EACjD,CAAC,YAAY,EAAE,UAAU,CAAC,CAC3B,CAAC;AAEF,uDAAuD;AACvD,MAAM,CAAC,IAAM,wBAAwB,GAAG,cAAc,CAGpD;IACE,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,UAAU,EAAhB,CAAgB;CAC1B,EACD,UAAC,UAAsB;IACrB,IAAM,YAAY,GAAG;QACnB,cAAc,CAAC,WAAW;QAC1B,cAAc,CAAC,SAAS;QACxB,cAAc,CAAC,gBAAgB;QAC/B,cAAc,CAAC,gBAAgB;QAC/B,cAAc,CAAC,cAAc;QAC7B,cAAc,CAAC,UAAU;QACzB,cAAc,CAAC,OAAO;QACtB,cAAc,CAAC,IAAI;QACnB,cAAc,CAAC,SAAS;QACxB,cAAc,CAAC,WAAW;QAC1B,cAAc,CAAC,OAAO;QACtB,cAAc,CAAC,UAAU;KAC1B,CAAC;IAEF,IAAI,CAAC,UAAU,EAAE;QACf,YAAY,CAAC,IAAI,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC;KACtD;IAED,IAAI,UAAU,CAAC,eAAe,EAAE;QAC9B,YAAY,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;KAC/C;IAED,OAAO,YAAY,CAAC;AACtB,CAAC,EACD,UAAC,UAAsB,IAAK,OAAA,uBAAuB,EAAvB,CAAuB,EACnD,CAAC,YAAY,EAAE,UAAU,CAAC,CAC3B,CAAC;AAEF,uDAAuD;AACvD,MAAM,CAAC,IAAM,oBAAoB,GAAG,cAAc,CAGhD;IACE,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,UAAU,EAAhB,CAAgB;IACzB,UAAC,KAAiB,EAAE,IAAoB,IAAK,OAAA,IAAI,EAAJ,CAAI;IACjD,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,QAAQ,EAAd,CAAc;CACxB,EACD,UAAC,UAAsB,EAAE,IAAoB,EAAE,QAAkB;IAC/D,IAAI,UAAU,CAAC,IAAI,CAAC,KAAK,SAAS,EAAE;QAClC,OAAO,KAAK,CAAC;KACd;IAED,QAAQ,IAAI,EAAE;QACZ,KAAK,cAAc,CAAC,WAAW;YAC7B,OAAO,UAAU,CAAC,YAAY,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC;QAC5D,KAAK,cAAc,CAAC,WAAW;YAC7B,OAAO,UAAU,CAAC,WAAW,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC;QAC3D,KAAK,cAAc,CAAC,oBAAoB;YACtC,OAAO,CAAC,UAAU,CAAC,oBAAoB,CAAC;QAC1C,KAAK,cAAc,CAAC,aAAa;YAC/B,OAAO,UAAU,CAAC,oBAAoB,IAAI,QAAQ,CAAC,QAAQ,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;QAC3F,KAAK,cAAc,CAAC,UAAU;YAC5B,OAAO,UAAU,CAAC,WAAW,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC;QAC1D,KAAK,cAAc,CAAC,SAAS;YAC3B,OAAO,UAAU,CAAC,UAAU,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC;QACxD,KAAK,cAAc,CAAC,iBAAiB;YACnC,OAAO,QAAQ,CAAC,QAAQ,IAAI,UAAU,CAAC,aAAa,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC;QACxF,KAAK,cAAc,CAAC,aAAa;YAC/B,OAAO,UAAU,CAAC,aAAa,IAAI,UAAU,CAAC,iBAAiB;gBAC7D,CAAC,UAAU,CAAC,aAAa,CAAC;QAC9B,KAAK,cAAc,CAAC,kBAAkB;YACpC,OAAO,UAAU,CAAC,aAAa,IAAI,CAAC,UAAU,CAAC,kBAAkB,CAAC;QACpE,KAAK,cAAc,CAAC,WAAW;YAC7B,OAAO,UAAU,CAAC,kBAAkB,IAAI,QAAQ,CAAC,QAAQ,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC;QACvF;YACE,OAAO,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;KAC9B;AACH,CAAC,EACD,UAAC,UAAsB,EAAE,IAAoB,EAAE,QAAkB,IAAK,OAAA,IAAI,EAAJ,CAAI,EAC1E,CAAC,YAAY,EAAE,UAAU,CAAC,CAC3B,CAAC;AAEF,qCAAqC;AACrC,MAAM,CAAC,IAAM,6BAA6B,GAAG,cAAc,CACzD;IACE,UAAA,KAAK,IAAI,OAAA,cAAc,CAAC,KAAK,CAAC,EAArB,CAAqB;CAC/B,EACD,UAAC,QAAmB;IAClB,IAAM,UAAU,GAAG,QAAQ,CAAC,MAAM,CAAC,UAAA,OAAO,IAAI,OAAA,OAAO,CAAC,MAAM,KAAK,aAAa,CAAC,EAAE,EAAnC,CAAmC,CAAC,CAAC;IACnF,IAAM,oBAAoB,GAAG,UAAU,CAAC,MAAM,CAC5C,UAAA,IAAI,IAAI,OAAA,CAAC,CAAC,IAAI,CAAC,cAAc,EAArB,CAAqB,CAC9B,CAAC,MAAM,CAAC;IACT,OAAO,oBAAoB,KAAK,UAAU,CAAC,MAAM,CAAC;AACpD,CAAC,EACD,SAAS,EACT,CAAC,UAAU,CAAC,CACb,CAAC;AAEF,MAAM,CAAC,IAAM,+BAA+B,GAAG,cAAc,CAK3D;IACE,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,EAAE,EAAR,CAAQ;IACjB,UAAA,KAAK,IAAI,OAAA,KAAK,CAAC,QAAQ,EAAd,CAAc;CACxB,EACD,UAAC,EAAgB,EAAE,QAAkB;;IACnC,eAAe;IACf,IAAM,mBAAmB,GACvB,CAAC,QAAQ,CAAC,QAAQ;WACf,OAAA,EAAE,CAAC,IAAI,0CAAE,IAAI,MAAK,MAAM,CAAC,IAAI,CAAC;IAEnC,YAAY;IACZ,IAAM,WAAW,SAAG,EAAE,CAAC,IAAI,0CAAE,SAAS,CAAC;IACvC,IAAM,kBAAkB,GAAG,WAAW,KAAK,WAAW,CAAC,YAAY,CAAC;IAEpE,6BAA6B;IAC7B,IAAI,WAAW,EAAE;QACf,OAAO,kBAAkB,CAAC;KAC3B;IAED,uCAAuC;IACvC,OAAO,mBAAmB,CAAC;AAC7B,CAAC,EACD,SAAS,EACT,CAAC,IAAI,EAAE,UAAU,CAAC,CACnB,CAAC","sourcesContent":["import update from 'immutability-helper';\nimport { setUser, captureException } from '@sentry/browser';\nimport Cookies from 'js-cookie';\n\nimport { create } from '@src/lib/redux';\n\nimport {\n  Me,\n  StoreState,\n  ResourceStatus,\n  Preferences,\n  Onboarding,\n  Account,\n  AccountStatus,\n  OnboardingType,\n  Features,\n  TwoFactorAuthentication,\n  Resource,\n  MePlan,\n  MeStatusNew,\n} from '@src/types';\nimport { Coupon, CouponType } from '@src/types/billing';\nimport { MeBody } from '@src/api/me';\nimport { resourceOk } from '@src/lib/resource';\nimport { createSelector } from '@src/lib/selector';\nimport { selectAccounts } from '@src/ducks/accounts';\nimport { ErrorMessage } from '@src/api/base';\nimport { RightSidebarTab } from '@src/types/rightSidebar';\nimport { OnboardingSection } from '@src/lib/onboarding';\nimport { isElectron } from '@src/lib/electron';\nimport { enableUserDebug, disableUserDebug } from '@src/lib/db';\nimport moment from 'moment';\nimport { recordLog } from '@src/lib/log';\nimport { ExperimentsState } from '@src/lib/unleash-experiments';\n\nexport interface MeCreateMeta {\n  email: string;\n  password: string;\n  firstName?: string;\n  middleName?: string;\n  lastName?: string;\n  gender?: string;\n  preferences?: string;\n  platform?: string;\n  teamName?: string;\n  teamSize?: string;\n  position?: string;\n  phoneNumber?: string;\n  teamInviteNonce?: string;\n  teamInvitePayload?: string;\n  secret?: string;\n  type?: string;\n\n  // Product Source\n  unsubscriberSignUp?: boolean;\n\n  utmSource?: string;\n  utmCampaign?: string;\n  utmMedium?: string;\n\n  rewardfulReferral?: string;\n}\n\nexport const {\n  type: ME_CREATE,\n  action: meCreate,\n  reducer: meCreateReducer,\n} = create<MeCreateMeta, MeBody>('ME_CREATE', {\n  start: (state, meta) => ({ ...state,  signUpPending: true }),\n  success: (state, meta, payload) => ({ ...state, signUpPending: false }),\n  failure: (state, meta, error) => ({ ...state, signUpPending: false }),\n});\n\n// FETCH USER\nexport const {\n  type: ME_FETCH,\n  action: meFetch,\n  reducer: meFetchReducer,\n} = create<string, MeBody>('ME_FETCH', {\n  start: (state, meta) => {\n    return update(state, { me: { status: { $set: ResourceStatus.Loading } } });\n  },\n\n  success: (state, meta, payload) => {\n    let mePayload = payload.me;\n\n    // handle Sentry user identification\n    setUser({\n      id: mePayload.id,\n      email: mePayload.email,\n    });\n\n    const cookie = Cookies.get('referralProperties');\n    if (mePayload.referralRedeemed && cookie) {\n      Cookies.remove('referralProperties');\n    }\n\n    // get coupon -if any- from the localStorage\n    const coupon = localStorage.getItem(CouponType.Coupon);\n    if (coupon && meta !== CouponType.Remove) {\n      const parsedCoupon: Coupon = JSON.parse(coupon);\n      mePayload = { ...mePayload, coupon: parsedCoupon };\n    }\n    if (meta === CouponType.Remove) {\n      localStorage.removeItem(CouponType.Coupon);\n    }\n\n    // save to localstorage\n    localStorage.setItem('me', JSON.stringify(mePayload));\n    localStorage.setItem('lists', JSON.stringify(payload.lists));\n    localStorage.setItem('accounts', JSON.stringify(payload.accounts));\n    localStorage.setItem('devices', JSON.stringify(payload.devices));\n    localStorage.setItem('preferences', JSON.stringify(payload.preferences));\n\n    if (mePayload) {\n      try {\n        // boot intercom\n        (window as any).Intercom('boot', {\n          app_id: 'ppcj3myx',\n          user_id: mePayload.id,\n          email: mePayload.email,\n          user_hash: mePayload.intercomIdentity,\n          hide_default_launcher: true,\n        });\n      } catch (e) {\n        captureException(e);\n      }\n    }\n\n    // handle debugging\n    if (mePayload && mePayload.debugUntil && moment(mePayload.debugUntil).isAfter(moment())) {\n      enableUserDebug('', recordLog);\n    } else {\n      disableUserDebug();\n    }\n\n    // return updated state\n    return {\n      ...state,\n      me: resourceOk(mePayload),\n      lists: payload.lists,\n      accounts: payload.accounts,\n      preferences: payload.preferences,\n      devices: payload.devices,\n      tfaNeeded: false,\n    };\n  },\n\n  failure: (state, meta, error) => {\n    return update(state, {\n      me: {\n        status: { $set: ResourceStatus.Failure },\n        error: { $set: error },\n      },\n      tfaNeeded: {\n        $set: error.message === ErrorMessage.TwoFactorAuthNeeded,\n      },\n    });\n  },\n});\n\nexport const {\n  type: ME_EXPERIMENTS_FETCH,\n  action: meExperimentsFetch,\n  reducer: meExperimentsFetchReducer,\n} = create<string, ExperimentsState>('ME_EXPERIMENTS_FETCH', {\n  start: (state) => {\n    return update(state, {\n      me: {\n        data: {\n          experiments: {\n            $set: {\n              status: ResourceStatus.Loading,\n            },\n          },\n        },\n      },\n    });\n  },\n\n  success: (state, meta, payload) => {\n    return update(state, {\n      me: {\n        data: {\n          experiments: {\n            $merge: {\n              status: ResourceStatus.Ok,\n              ...payload,\n            },\n          },\n        },\n      },\n    });\n  },\n\n  failure: (state, meta, error) => {\n    return update(state, {\n      me: {\n        data: {\n          experiments: {\n            $set: {\n              status: ResourceStatus.Failure,\n              error,\n            },\n          },\n        },\n      },\n    });\n  },\n});\n\n// PATCH USER\n// TODO(SHIN): Figure out error cases for optimistic patches\nexport const {\n  type: ME_UPDATE,\n  action: meUpdate,\n  reducer: meUpdateReducer,\n} = create<Me, MeBody>('ME_PATCH', {\n  start: (state, meta) => {\n    return update(state, { me: { data: { $set: meta } } });\n  },\n\n  success: (state, meta, payload) => {\n    // return updated state\n    return {\n      ...state,\n      me: resourceOk(payload.me),\n    };\n  },\n\n  // TODO(SHIN): Handle state error\n  failure: (state, meta, error) => {\n    return state;\n  },\n});\n\nexport const {\n  type: ME_DELETE,\n  action: meDelete,\n  reducer: meDeleteReducer,\n} = create<null, null>('ME_DELETE', {});\n\nexport enum OnboardingVersion {\n  One = 'one',\n  Two = 'two',\n}\n\nexport const {\n  type: ONBOARDING_RESET,\n  action: onboardingReset,\n  reducer: onboardingResetReducer,\n} = create<OnboardingVersion, null>('ONBOARDING_RESET', {\n  start: (state, meta) => {\n    let onboarding = state.onboarding;\n    if (meta === OnboardingVersion.Two) {\n      onboarding = {\n        ...state.onboarding,\n        [OnboardingType.ExploreModal]: false,\n        [OnboardingType.ClaimCredit]: false,\n        steps: {\n          [OnboardingType.NextThread]: false,\n          [OnboardingType.PreviousThread]: false,\n          [OnboardingType.Archive]: false,\n          [OnboardingType.Undo]: false,\n          [OnboardingType.ReadLater]: false,\n          [OnboardingType.Block]: false,\n          [OnboardingType.CommandLater]: false,\n          [OnboardingType.SendLater]: false,\n          [OnboardingType.MessageTemplates]: false,\n          [OnboardingType.FollowUpReminder]: false,\n          [OnboardingType.SaveAsTemplate]: false,\n          [OnboardingType.MessageTemplates]: false,\n          [OnboardingType.ShareThread]: false,\n          [OnboardingType.Comment]: false,\n          [OnboardingType.ActivityFeed]: false,\n          [OnboardingType.Scheduling]: false,\n        },\n      };\n    } else {\n      onboarding = {\n        ...state.onboarding,\n        [OnboardingType.CreateDraft]: false,\n        [OnboardingType.SendMessage]: false,\n        [OnboardingType.ThreadDetailTracking]: false,\n        [OnboardingType.CreateComment]: false,\n        [OnboardingType.Scheduling]: false,\n        [OnboardingType.Sequences]: false,\n        [OnboardingType.InviteTeamMembers]: false,\n        [OnboardingType.CommandCenter]: false,\n        [OnboardingType.DownloadNativeApps]: false,\n        [OnboardingType.MentionsTab]: false,\n      };\n    }\n\n    localStorage.setItem('onboarding', JSON.stringify(onboarding));\n    return update(state, {\n      onboarding: {\n        $set: onboarding,\n      },\n      rightSidebar: {\n        tab: {\n          $set: meta === OnboardingVersion.Two\n            ? RightSidebarTab.Onboarding\n            : state.rightSidebar.tab,\n        },\n        collapsed: { threads: { $set: false } },\n      },\n    });\n  },\n});\n\nexport const {\n  type: ONBOARDING_FETCH,\n  action: onboardingFetch,\n  reducer: onboardingFetchReducer,\n} = create<null, Onboarding>('ONBOARDING_FETCH', {\n  success: (state, meta, payload) => {\n    localStorage.setItem('onboarding', JSON.stringify(payload));\n    const updatedState = update(state, {\n      onboarding: { $set: payload },\n    });\n    const showOnboardingTab = selectRsbOnboarding(updatedState) !== OnboardingType.Complete ||\n      !payload.exploreModal;\n\n    const rsbTab = showOnboardingTab\n      ? RightSidebarTab.Onboarding\n      : RightSidebarTab.Contact;\n\n    const collapsedState = rsbTab === RightSidebarTab.Onboarding\n      ? false\n      : state.rightSidebar.collapsed.threads;\n    return update(state, {\n      onboarding: {\n        $set: payload,\n      },\n      rightSidebar: {\n        tab: { $set: rsbTab },\n        collapsed: { threads: { $set: collapsedState } },\n      },\n    });\n  },\n});\n\nexport const {\n  type: ME_PHOTO_UPDATE,\n  action: mePhotoUpdate,\n  reducer: mePhotoUpdateReducer,\n} = create<File, Me>('ME_PHOTO_UPDATE', {});\n\nexport interface MeSignUpInfoMeta {\n  teamName?: string;\n  teamSize?: string;\n  position?: string;\n  phoneNumber?: string;\n}\n\nexport const {\n  type: ME_SIGN_UP_INFO_UPDATE,\n  action: meSignUpInfoUpdate,\n  reducer: meSignUpInfoUpdateReducer,\n} = create<MeSignUpInfoMeta, null>('ME_SIGN_UP_INFO_UPDATE', {});\n\nexport interface MeTfaSetMeta {\n  password: string;\n  phone: string;\n}\n\nexport const {\n  type: ME_TFA_SET,\n  action: meTfaSet,\n  reducer: meTfaSetReducer,\n} = create<MeTfaSetMeta, TwoFactorAuthentication>('ME_TFA_SET', {\n  success: (state, meta, payload) => {\n    return update(state, {\n      me: {\n        tfa: {\n          $set: payload,\n        },\n      },\n      tfaPasswordConfirmed: { $set: true },\n    });\n  },\n  failure: (state, meta, payload) => {\n    return update(state, {\n      tfaPasswordConfirmed: { $set: false },\n    });\n  },\n});\n\nexport const {\n  type: ME_TFA_UNSET,\n  action: meTfaUnset,\n  reducer: meTfaUnsetReducer,\n} = create<string, null>('ME_TFA_UNSET', {\n  success: (state, meta, payload) => {\n    return update(state, {\n      me: {\n        data: {\n          $unset: ['tfa'],\n        },\n      },\n      tfaPasswordConfirmed: { $set: false },\n    });\n  },\n});\n\nexport const {\n  type: ME_TFA_VERIFY,\n  action: meTfaVerify,\n  reducer: meTfaVerifyReducer,\n} = create<string, TwoFactorAuthentication>('ME_TFA_VERIFY', {\n  success: (state, meta, payload) => {\n    return update(state, {\n      me: {\n        data: {\n          tfa: {\n            $set: payload,\n          },\n        },\n      },\n    });\n  },\n});\n\nexport interface OnboardingPatchMeta {\n  type: Partial<Onboarding>;\n  skipped: boolean;\n}\n\nexport const {\n  type: ONBOARDING_PATCH,\n  action: onboardingPatch,\n  reducer: onboardingPatchReducer,\n} = create<OnboardingPatchMeta, Onboarding>('ONBOARDING_PATCH', {\n  start: (state, meta) => {\n\n    // TODO(SHIN): Could maybe abstract in component\n    // Prevent other onboarding steps if explore modal is showing\n    if (meta.type.sendMessage && !state.onboarding.exploreModal) {\n      return state;\n    }\n\n    // Force Onboarding tab if setting explore modal to true\n    const rsbTab = meta.type.exploreModal === true\n      ? RightSidebarTab.Onboarding\n      : state.rightSidebar.tab;\n\n    const updated = {\n      ...state.onboarding,\n      ...meta.type,\n      steps: {\n        ...state.onboarding.steps,\n        ...meta.type.steps,\n      },\n    };\n    localStorage.setItem('onboarding', JSON.stringify(updated));\n    return update(state, {\n      onboarding: {\n        $set: updated,\n      },\n      rightSidebar: {\n        tab: { $set: rsbTab },\n      },\n    });\n  },\n});\n\nexport const {\n  type: ONBOARDING_CREDIT_CLAIM,\n  action: onboardingCreditClaim,\n  reducer: onboardingCreditClaimReducer,\n} = create<Partial<Onboarding>, Onboarding>('ONBOARDING_CREDIT_CLAIM', {\n  start: (state, meta) => {\n    const updated = {\n      ...state.onboarding,\n      claimedCredit: true,\n    };\n    localStorage.setItem('onboarding', JSON.stringify(updated));\n    return update(state, {\n      onboarding: {\n        $set: updated,\n      },\n    });\n  },\n});\n\n// PATCH USER\n// TODO(SHIN): Figure out error cases for optimistic patches\nexport const {\n  type: PREFERENCES_UPDATE,\n  action: preferencesUpdate,\n  reducer: preferencesUpdateReducer,\n} = create<Preferences, MeBody>('PREFERENCES_UPDATE', {\n  start: (state, meta) => {\n    return update(state, { preferences: { $set: meta } });\n  },\n\n  success: (state, meta, payload) => {\n    // return updated state\n    return {\n      ...state,\n      me: resourceOk(payload.me),\n    };\n  },\n\n  // TODO(SHIN): Handle state error\n  failure: (state, meta, error) => {\n    return state;\n  },\n});\n\nexport default [\n  meFetchReducer,\n  meCreateReducer,\n  meUpdateReducer,\n  preferencesUpdateReducer,\n  onboardingFetchReducer,\n  onboardingPatchReducer,\n  onboardingCreditClaimReducer,\n  onboardingResetReducer,\n  meTfaSetReducer,\n  meTfaUnsetReducer,\n  meExperimentsFetchReducer,\n];\n\nexport function selectMe(state: StoreState): Me {\n  return state.me.data!;\n}\n\nexport function selectUserIsAdmin(state: StoreState): boolean {\n  return state.me.data && state.team.data\n    && state.team.data.admins.filter(id => id === state.me.data!.id).length > 0 || false;\n}\n\n// Identifies whether an onboarding tip should be shown\nexport const selectRsbOnboarding = createSelector<\n  null, Onboarding | OnboardingType | Features, OnboardingType | undefined\n>(\n  [\n    state => state.onboarding,\n    state => state.features,\n  ],\n  (onboarding: Onboarding, features: Features) => {\n    if (!onboarding.steps) {\n      return OnboardingType.Complete;\n    }\n\n    const options: Array<{ [key: string]: boolean }> = [\n      // Composing\n      {\n        [OnboardingType.SendMessage]: onboarding.sendMessage,\n      },\n      {\n        [OnboardingType.SendLater]: onboarding.steps.sendLater,\n      },\n      {\n        [OnboardingType.FollowUpReminder]: onboarding.steps.followUpReminder,\n      },\n      {\n        [OnboardingType.MessageTemplates]: onboarding.steps.messageTemplates,\n      },\n      {\n        [OnboardingType.SaveAsTemplate]: onboarding.steps.saveAsTemplate,\n      },\n\n      // Navigation\n      {\n        [OnboardingType.NextThread]: onboarding.steps.nextThread,\n      },\n      // Managing Email\n      {\n        [OnboardingType.Archive]: onboarding.steps.archive,\n      },\n      {\n        [OnboardingType.Undo]: onboarding.steps.undo,\n      },\n      {\n        [OnboardingType.ReadLater]: onboarding.steps.readLater,\n      },\n\n      // Power User\n      {\n        [OnboardingType.ShareThread]: onboarding.steps.shareThread,\n      },\n      {\n        [OnboardingType.Comment]: onboarding.steps.comment,\n      },\n      {\n        [OnboardingType.Scheduling]: onboarding.steps.scheduling,\n      },\n    ];\n\n    // Add download native option\n    if (!isElectron) {\n      options.push({ [OnboardingType.DownloadNativeApps]: onboarding.downloadNativeApps });\n    }\n\n    // Only show claim credit if option is available\n    if (onboarding.creditClaimable) {\n      options.push({\n        [OnboardingType.ClaimCredit]: onboarding.claimedCredit,\n      });\n    }\n\n    const filteredOptions = options\n      .filter(a => !Object.values(a)[0])\n      .map(a => Object.keys(a)[0] as OnboardingType);\n\n    if (!filteredOptions.length) {\n      return OnboardingType.Complete;\n    }\n    return filteredOptions[0];\n  },\n  (onboarding: Onboarding, features: Features) => 'rsb-onboarding',\n  ['onboarding', 'features'],\n);\n\n// Identifies whether an onboarding tip should be shown\nexport const selectShownOnboardingSections = createSelector<\n  null, Onboarding | OnboardingType | Features, OnboardingSection[]\n>(\n  [\n    state => state.onboarding,\n  ],\n  (onboarding: Onboarding) => {\n\n    const baseSettings = [\n      OnboardingSection.Composing,\n      OnboardingSection.NavigatingPolymail,\n      OnboardingSection.ManagingYourEmail,\n      OnboardingSection.PowerUser,\n    ];\n\n    if (!isElectron) {\n      baseSettings.push(OnboardingSection.DownloadNativeApps);\n    }\n\n    if (onboarding.creditClaimable) {\n      baseSettings.push(OnboardingSection.ClaimCredit);\n    }\n\n    return baseSettings;\n  },\n  (onboarding: Onboarding) => 'onboarding-sections',\n  ['onboarding', 'features'],\n);\n\n// Identifies whether an onboarding tip should be shown\nexport const selectAllOnboardingSteps = createSelector<\n  null, Onboarding | OnboardingType | Features, OnboardingType[]\n>(\n  [\n    state => state.onboarding,\n  ],\n  (onboarding: Onboarding) => {\n    const baseSettings = [\n      OnboardingType.SendMessage,\n      OnboardingType.SendLater,\n      OnboardingType.FollowUpReminder,\n      OnboardingType.MessageTemplates,\n      OnboardingType.SaveAsTemplate,\n      OnboardingType.NextThread,\n      OnboardingType.Archive,\n      OnboardingType.Undo,\n      OnboardingType.ReadLater,\n      OnboardingType.ShareThread,\n      OnboardingType.Comment,\n      OnboardingType.Scheduling,\n    ];\n\n    if (!isElectron) {\n      baseSettings.push(OnboardingType.DownloadNativeApps);\n    }\n\n    if (onboarding.creditClaimable) {\n      baseSettings.push(OnboardingType.ClaimCredit);\n    }\n\n    return baseSettings;\n  },\n  (onboarding: Onboarding) => 'all-onboarding-typesg',\n  ['onboarding', 'features'],\n);\n\n// Identifies whether an onboarding tip should be shown\nexport const selectOnboardingShow = createSelector<\n  OnboardingType, Onboarding|OnboardingType|Features, boolean\n>(\n  [\n    state => state.onboarding,\n    (state: StoreState, type: OnboardingType) => type,\n    state => state.features,\n  ],\n  (onboarding: Onboarding, type: OnboardingType, features: Features) => {\n    if (onboarding[type] === undefined) {\n      return false;\n    }\n\n    switch (type) {\n      case OnboardingType.CreateDraft:\n        return onboarding.exploreModal && !onboarding.createDraft;\n      case OnboardingType.SendMessage:\n        return onboarding.createDraft && !onboarding.sendMessage;\n      case OnboardingType.ThreadDetailTracking:\n        return !onboarding.threadDetailTracking;\n      case OnboardingType.CreateComment:\n        return onboarding.threadDetailTracking && features.comments && !onboarding.createComment;\n      case OnboardingType.Scheduling:\n        return onboarding.mentionsTab && !onboarding.scheduling;\n      case OnboardingType.Sequences:\n        return onboarding.scheduling && !onboarding.sequences;\n      case OnboardingType.InviteTeamMembers:\n        return features.comments && onboarding.createComment && !onboarding.inviteTeamMembers;\n      case OnboardingType.CommandCenter:\n        return onboarding.createComment && onboarding.inviteTeamMembers &&\n          !onboarding.commandCenter;\n      case OnboardingType.DownloadNativeApps:\n        return onboarding.commandCenter && !onboarding.downloadNativeApps;\n      case OnboardingType.MentionsTab:\n        return onboarding.downloadNativeApps && features.comments && !onboarding.mentionsTab;\n      default:\n        return !(onboarding[type]);\n    }\n  },\n  (onboarding: Onboarding, type: OnboardingType, features: Features) => type,\n  ['onboarding', 'features'],\n);\n\n// Identifies if user has been synced\nexport const selectUserInitialSyncFinished = createSelector<undefined, Account[], boolean>(\n  [\n    state => selectAccounts(state),\n  ],\n  (accounts: Account[]) => {\n    const accountsOk = accounts.filter(account => account.status === AccountStatus.Ok);\n    const syncedAccountsLength = accountsOk.filter(\n      each => !!each.mailInitSynced,\n    ).length;\n    return syncedAccountsLength === accountsOk.length;\n  },\n  undefined,\n  ['accounts'],\n);\n\nexport const selectShouldSeeTrialEndedBanner = createSelector<\n  undefined,\n  Resource<Me> | Features,\n  boolean\n>(\n  [\n    state => state.me,\n    state => state.features,\n  ],\n  (me: Resource<Me>, features: Features) => {\n    // legacy logic\n    const isExpiredStatusPlan =\n      !features.freeTier\n      && me.data?.plan === MePlan.Free;\n\n    // new logic\n    const meStatusNew = me.data?.statusNew;\n    const isExpiredStatusNew = meStatusNew === MeStatusNew.TrialExpired;\n\n    // statusNew takes precedence\n    if (meStatusNew) {\n      return isExpiredStatusNew;\n    }\n\n    // for legacy account without statusNew\n    return isExpiredStatusPlan;\n  },\n  undefined,\n  ['me', 'features'],\n);\n"]}]}