{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/html.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/html.ts","mtime":1675280254065},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgZm9yRWFjaCB9IGZyb20gJ2xvZGFzaCc7CmltcG9ydCBMUlUgZnJvbSAnbHJ1LWNhY2hlJzsKaW1wb3J0IHsgZ2V0Q29sb3JCcmlnaHRuZXNzLCBDb2xvckJyaWdodG5lc3MsIERBUktNT0RFX1BSSU1BUllfVEVYVF9DT0xPUiwgREVGQVVMVF9QUklNQVJZX1RFWFRfQ09MT1IsIEFaVVJFX0NPTE9SLCB9IGZyb20gJy4vY29sb3JzJzsKLy8gbGV0IEludGVybmFsRmFrZURPTTogSFRNTERvY3VtZW50OwpleHBvcnQgdmFyIEZha2VET00gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZygnJywgJ3RleHQvaHRtbCcpOwp9OwpleHBvcnQgdmFyIGV4dHJhY3RUZXh0ID0gZnVuY3Rpb24gKGh0bWwsIGxlbmd0aCkgewogICAgdmFyIGRvYyA9IEZha2VET00oKS5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGRvYy5pbm5lckhUTUwgPSBodG1sLnN1YnN0cigwLCAxMDAwMCk7CiAgICB2YXIgdGV4dCA9IGRvYy50ZXh0Q29udGVudCB8fCAnJzsKICAgIHJldHVybiB0ZXh0LnN1YnN0cigwLCBsZW5ndGgpOwp9Owp2YXIgc25pcHBldENhY2hlID0gbmV3IExSVSh7IG1heEFnZTogMTAwMCB9KTsKZXhwb3J0IHZhciBleHRyYWN0RHJhZnRTbmlwcGV0ID0gZnVuY3Rpb24gKGRyYWZ0KSB7CiAgICB2YXIga2V5ID0gZHJhZnQuaWQgKyBkcmFmdC51cGRhdGVkOwogICAgdmFyIHJlc3VsdCA9IHNuaXBwZXRDYWNoZS5nZXQoa2V5KTsKICAgIGlmIChyZXN1bHQpIHsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgdmFyIHZhbHVlID0gZXh0cmFjdERyYWZ0VGV4dChkcmFmdC5ib2R5KTsKICAgIHNuaXBwZXRDYWNoZS5zZXQoa2V5LCB2YWx1ZSk7CiAgICByZXR1cm4gdmFsdWU7Cn07CnZhciBleHRyYWN0RHJhZnRUZXh0ID0gZnVuY3Rpb24gKGh0bWwpIHsKICAgIHZhciBkb2MgPSBGYWtlRE9NKCkuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBkb2MuaW5uZXJIVE1MID0gaHRtbC5zdWJzdHIoMCwgMTAwMDApOwogICAgLy8gU2FuaXRpemUgb3V0IHNlbnQgZnJvbSBQb2x5bWFpbAogICAgdmFyIHNlbnRGcm9tUG9seW1haWwgPSBkb2MucXVlcnlTZWxlY3RvcignLnBtLXNmcCcpOwogICAgaWYgKHNlbnRGcm9tUG9seW1haWwgJiYgc2VudEZyb21Qb2x5bWFpbC5wYXJlbnRFbGVtZW50KSB7CiAgICAgICAgc2VudEZyb21Qb2x5bWFpbC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHNlbnRGcm9tUG9seW1haWwpOwogICAgfQogICAgdmFyIHRleHQgPSBkb2MudGV4dENvbnRlbnQgfHwgJyc7CiAgICByZXR1cm4gdGV4dC5zdWJzdHIoMCwgMTAwKTsKfTsKZXhwb3J0IHZhciBzYW5pdGl6ZSA9IGZ1bmN0aW9uIChodG1sLCBvcHRpb25zKSB7CiAgICB2YXIgYmxhY2tsaXN0ID0gWwogICAgICAgICdhcHBsZXQnLAogICAgICAgICdhdWRpbycsCiAgICAgICAgJ2Jhc2UnLAogICAgICAgICdlbWJlZCcsCiAgICAgICAgJ2lmcmFtZScsCiAgICAgICAgJ2xpbmsnLAogICAgICAgICdtZXRhJywKICAgICAgICAnb2JqZWN0JywKICAgICAgICAncGljdHVyZScsCiAgICAgICAgJ3NjcmlwdCcsCiAgICAgICAgJ3N2ZycsCiAgICAgICAgJ3RpdGxlJywKICAgICAgICAndmlkZW8nLAogICAgXTsKICAgIHZhciBkb2MgPSBGYWtlRE9NKCkuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBkb2MuaW5uZXJIVE1MID0gaHRtbDsKICAgIHZhciBzdHlsZSA9ICdjb2xvcjogIzQ0NDQ0NDsgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyNTUsIDIyMywgNTAsIDAuMjUpOyBib3JkZXItcmFkaXVzOiAycHg7JyArCiAgICAgICAgJ3BhZGRpbmc6IDFweCA0cHg7IGZvbnQtd2VpZ2h0OiA1MDA7IGN1cnNvcjogcG9pbnRlcjsnOwogICAgdmFyIG5vVmFyU3R5bGUgPSAnY29sb3I6ICNlNzRjM2M7IGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAyMjMsIDUwLCAwLjI1KTsgJwogICAgICAgICsgJ2JvcmRlci1yYWRpdXM6IDJweDsgcGFkZGluZzogMXB4IDRweDsgZm9udC13ZWlnaHQ6IDUwMDsgY3Vyc29yOiBwb2ludGVyOyc7CiAgICBBcnJheS5mcm9tKGRvYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpKQogICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChlbCkgewogICAgICAgIGlmIChibGFja2xpc3QuaW5kZXhPZihlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkpID4gLTEgJiYgZWwgJiYgZWwucGFyZW50Tm9kZSkgewogICAgICAgICAgICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZm9ybScpIHsKICAgICAgICAgICAgZWwucmVtb3ZlQXR0cmlidXRlKCdtZXRob2QnKTsKICAgICAgICAgICAgZWwucmVtb3ZlQXR0cmlidXRlKCdhY3Rpb24nKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZWwudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW1nJykgewogICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnN0cmlwSW1nVGFncykgewogICAgICAgICAgICAgICAgaWYgKGVsLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICBlbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnc3Jjc2V0Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGZvckVhY2goZWwuYXR0cmlidXRlcywgZnVuY3Rpb24gKGF0dHJpYnV0ZSkgewogICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZSAmJiBhdHRyaWJ1dGUubG9jYWxOYW1lICYmIGF0dHJpYnV0ZS5sb2NhbE5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2hyZWYnCiAgICAgICAgICAgICAgICAgICAgJiYgZWwuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZS5sb2NhbE5hbWUpLm1hdGNoKC9qYXZhc2NyaXB0Oi9pKSkgewogICAgICAgICAgICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnaHJlZicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZSAmJiBhdHRyaWJ1dGUubG9jYWxOYW1lICYmIGF0dHJpYnV0ZS5sb2NhbE5hbWUudG9Mb3dlckNhc2UoKS5tYXRjaCgvXm9uLykpIHsKICAgICAgICAgICAgICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoYXR0cmlidXRlLmxvY2FsTmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAvLyBzdHJpcCBvcmlnaW5hbCBzdHlsaW5nCiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdHJpcFN0eWxlKSB7CiAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7CiAgICAgICAgfQogICAgICAgIC8vIHJlcGxhY2Ugc3R5bGluZyBmb3IgcGxhY2Vob2xkZXJzCiAgICAgICAgaWYgKGVsLmNsYXNzTmFtZSA9PT0gJ2RhdGEtcG0tdmFyJykgewogICAgICAgICAgICBpZiAoISFlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtcG0tbm8tdmFyaWFibGUnKSkgewogICAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdzdHlsZScsIG5vVmFyU3R5bGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZWwuc2V0QXR0cmlidXRlKCdzdHlsZScsIHN0eWxlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGRvYy5pbm5lckhUTUw7Cn07Ci8vIFJlbW92ZXMgYW55IHRyYWNraW5nIHBpeGVscwpleHBvcnQgdmFyIHJlbW92ZVRyYWNraW5nUGl4ZWxzID0gZnVuY3Rpb24gKGh0bWwpIHsKICAgIHZhciBkb2MgPSBGYWtlRE9NKCkuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBkb2MuaW5uZXJIVE1MID0gaHRtbDsKICAgIHZhciBlbGVtZW50cyA9IGRvYy5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1wbS10cmFja2luZ10nKTsKICAgIEFycmF5LmZyb20oZWxlbWVudHMpLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICB2YXIgcGFyZW50ID0gZWxlbWVudC5wYXJlbnRFbGVtZW50OwogICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQpOwogICAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGRvYy5pbm5lckhUTUw7Cn07CmV4cG9ydCB2YXIgcHJvY2Vzc0RhcmtNb2RlQ2hhbmdlcyA9IGZ1bmN0aW9uIChjb250YWluZXIpIHsKICAgIHZhciBzdHlsZXMgPSBjb250YWluZXIucXVlcnlTZWxlY3Rvcignc3R5bGUnKTsKICAgIC8vIERvIG5vdCBoYW5kbGUgaWYgb3V0c2lkZSBzdHlsZSBjb2xvciBoYWQgYmVlbiBzZXQKICAgIHZhciBjb2xvck1hdGNoID0gc3R5bGVzICYmIHN0eWxlcy5pbm5lckhUTUwubWF0Y2goL1tcc1x7O11jb2xvcjovKTsKICAgIHZhciBiZ0NvbG9yTWF0Y2ggPSBzdHlsZXMgJiYgc3R5bGVzLmlubmVySFRNTC5tYXRjaCgvW1xzXHs7XWJhY2tncm91bmQtY29sb3I6Lyk7CiAgICBpZiAoY29sb3JNYXRjaCAmJiBiZ0NvbG9yTWF0Y2gpIHsKICAgICAgICBpZiAoY29udGFpbmVyLmZpcnN0RWxlbWVudENoaWxkKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5maXJzdEVsZW1lbnRDaGlsZC5jbGFzc05hbWUgPSBjb250YWluZXIuZmlyc3RFbGVtZW50Q2hpbGQuY2xhc3NOYW1lICsgJyBwbS1saWdodCc7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjb250YWluZXI7CiAgICB9CiAgICB2YXIgY29sb3JFbGVtZW50cyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdbc3R5bGVdLFtjb2xvcl0sW2JnY29sb3JdLGZvbnQnKTsKICAgIGNvbG9yRWxlbWVudHMgPT09IG51bGwgfHwgY29sb3JFbGVtZW50cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29sb3JFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgdmFyIF9hLCBfYjsKICAgICAgICB2YXIgY29sb3IgPSBlLmdldEF0dHJpYnV0ZSgnY29sb3InKSB8fCBlLnN0eWxlLmNvbG9yIHx8IG51bGw7CiAgICAgICAgdmFyIGFuY2VzdG9yVGV4dENvbG9yID0gKChfYSA9IGUucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmdldEF0dHJpYnV0ZSgnY29sb3InKSkgfHwgKChfYiA9IGUucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnN0eWxlLmNvbG9yKTsKICAgICAgICAvLyBSZW1vdmUgYmFja2dyb3VuZCBjb2xvciBvZiBwYXJhZ3JhcGggdGFncwogICAgICAgIGlmIChbJ1AnLCAnU1BBTicsICdQUkUnXS5pbmRleE9mKGUudGFnTmFtZSkgPiAtMSkgewogICAgICAgICAgICBlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICcnOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChlLnN0eWxlLmJhY2tncm91bmRDb2xvciAmJiBjb2xvcikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIElkZW50aWZ5IGJhc2UgdmFsdWVzCiAgICAgICAgdmFyIHBhcmVudCA9IGUucGFyZW50RWxlbWVudDsKICAgICAgICB2YXIgZm91bmRCYWNrZ3JvdW5kID0gbnVsbDsKICAgICAgICB2YXIgdHJhbnNwYXJlbmN5Q2hlY2tlcjsKICAgICAgICB0cmFuc3BhcmVuY3lDaGVja2VyID0gKHBhcmVudCA9PT0gbnVsbCB8fCBwYXJlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBhcmVudC5nZXRBdHRyaWJ1dGUoJ2JnY29sb3InKSkgfHwgKHBhcmVudCA9PT0gbnVsbCB8fCBwYXJlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBhcmVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpOwogICAgICAgIGlmICh0cmFuc3BhcmVuY3lDaGVja2VyICYmIHRyYW5zcGFyZW5jeUNoZWNrZXIgPT09ICd0cmFuc3BhcmVudCcpIHsKICAgICAgICAgICAgaWYgKGZvdW5kQmFja2dyb3VuZCA9PT0gJ3RyYW5zcGFyZW50JykgewogICAgICAgICAgICAgICAgcGFyZW50ID09PSBudWxsIHx8IHBhcmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyZW50LnJlbW92ZUF0dHJpYnV0ZSgnYmdjb2xvcicpOwogICAgICAgICAgICAgICAgaWYgKHBhcmVudCA9PT0gbnVsbCB8fCBwYXJlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBhcmVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJhbnNwYXJlbmN5Q2hlY2tlciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBmb3VuZEJhY2tncm91bmQgPSB0cmFuc3BhcmVuY3lDaGVja2VyOwogICAgICAgIH0KICAgICAgICBpZiAoIXBhcmVudCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIFRyYXZlcnNlIHVwIHVwbnRpbCB3ZSBmaW5kIGEgYmFja2dyb3VuZCBjb2xvcgogICAgICAgIHdoaWxlIChwYXJlbnQgJiYgIWZvdW5kQmFja2dyb3VuZCkgewogICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50RWxlbWVudDsKICAgICAgICAgICAgdHJhbnNwYXJlbmN5Q2hlY2tlciA9IChwYXJlbnQgPT09IG51bGwgfHwgcGFyZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJlbnQuZ2V0QXR0cmlidXRlKCdiZ2NvbG9yJykpIHx8IChwYXJlbnQgPT09IG51bGwgfHwgcGFyZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJlbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yKTsKICAgICAgICAgICAgaWYgKHRyYW5zcGFyZW5jeUNoZWNrZXIgJiYgdHJhbnNwYXJlbmN5Q2hlY2tlciA9PT0gJ3RyYW5zcGFyZW50JykgewogICAgICAgICAgICAgICAgcGFyZW50ID09PSBudWxsIHx8IHBhcmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyZW50LnJlbW92ZUF0dHJpYnV0ZSgnYmdjb2xvcicpOwogICAgICAgICAgICAgICAgaWYgKHBhcmVudCA9PT0gbnVsbCB8fCBwYXJlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBhcmVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpIHsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0cmFuc3BhcmVuY3lDaGVja2VyID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGZvdW5kQmFja2dyb3VuZCA9IHRyYW5zcGFyZW5jeUNoZWNrZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYW5jZXN0b3JUZXh0Q29sb3IgPSAocGFyZW50ID09PSBudWxsIHx8IHBhcmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyZW50LmdldEF0dHJpYnV0ZSgnY29sb3InKSkgfHwgKHBhcmVudCA9PT0gbnVsbCB8fCBwYXJlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBhcmVudC5zdHlsZS5jb2xvcik7CiAgICAgICAgfQogICAgICAgIC8vIERldGVybWluZSBob3cgd2Ugd2FudCB0byBhY3QgYmFzZWQgb2ZmIGJnIGV4aXN0ZW5jZQogICAgICAgIGlmICghIWZvdW5kQmFja2dyb3VuZCkgewogICAgICAgICAgICB2YXIgYmdDb2xvckJyaWdodG5lc3MgPSBnZXRDb2xvckJyaWdodG5lc3MoZm91bmRCYWNrZ3JvdW5kKTsKICAgICAgICAgICAgdmFyIHRleHRDb2xvckJyaWdodG5lc3MgPSBnZXRDb2xvckJyaWdodG5lc3MoY29sb3IpOwogICAgICAgICAgICAvLyBJZ25vcmUgYW5jaG9yIHRhZ3MKICAgICAgICAgICAgaWYgKGUudGFnTmFtZSA9PT0gJ0EnKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gV2hlbiBsaWdodCBiYWNrZ3JvdW5kIGFuZCBubyBkZWZpbmVkIGNvbG9yLCBzZXQgdG8gZGFyayBjb2xvcgogICAgICAgICAgICB2YXIgbGlnaHRCYWNrZ3JvdW5kID0gYmdDb2xvckJyaWdodG5lc3MgPT09IENvbG9yQnJpZ2h0bmVzcy5MaWdodDsKICAgICAgICAgICAgdmFyIG5vQW5jZXN0b3JUZXh0Q29sb3IgPSAhYW5jZXN0b3JUZXh0Q29sb3I7CiAgICAgICAgICAgIHZhciB1bmtub3duVGV4dENvbG9yID0gdGV4dENvbG9yQnJpZ2h0bmVzcyA9PT0gQ29sb3JCcmlnaHRuZXNzLlVua25vd247CiAgICAgICAgICAgIGlmIChsaWdodEJhY2tncm91bmQgJiYgbm9BbmNlc3RvclRleHRDb2xvciAmJiB1bmtub3duVGV4dENvbG9yKSB7CiAgICAgICAgICAgICAgICBlLnN0eWxlLmNvbG9yID0gREVGQVVMVF9QUklNQVJZX1RFWFRfQ09MT1I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoZm91bmRCYWNrZ3JvdW5kID09PSAndHJhbnNwYXJlbnQnKSB7CiAgICAgICAgICAgICAgICBlLnN0eWxlLmNvbG9yID0gREVGQVVMVF9QUklNQVJZX1RFWFRfQ09MT1I7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIFdoZW4gY29sb3IgaXMgZGFyayBhbmQgbm8gYmFja2dyb3VuZCBjb2xvciBvbiBhbmNlc3RvciBzZXQgdG8gbGlnaHQKICAgICAgICAgICAgdmFyIGNvbG9yQnJpZ2h0bmVzcyA9IGdldENvbG9yQnJpZ2h0bmVzcyhjb2xvcik7CiAgICAgICAgICAgIGlmIChjb2xvckJyaWdodG5lc3MgPT09IENvbG9yQnJpZ2h0bmVzcy5EYXJrKSB7CiAgICAgICAgICAgICAgICBlLnN0eWxlLmNvbG9yID0gZS50YWdOYW1lID09PSAnQScKICAgICAgICAgICAgICAgICAgICA/IEFaVVJFX0NPTE9SCiAgICAgICAgICAgICAgICAgICAgOiBEQVJLTU9ERV9QUklNQVJZX1RFWFRfQ09MT1I7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKICAgIHJldHVybiBjb250YWluZXI7Cn07Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/html.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/html.ts"],"names":[],"mappings":"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","sourcesContent":["import { forEach } from 'lodash';\nimport { Draft } from '@src/types';\nimport LRU from 'lru-cache';\nimport {\n  getColorBrightness, ColorBrightness,\n  DARKMODE_PRIMARY_TEXT_COLOR, DEFAULT_PRIMARY_TEXT_COLOR, AZURE_COLOR,\n} from './colors';\n\nexport interface Option {\n  stripStyle: boolean;\n  stripImgTags: boolean;\n}\n\nexport interface AnchorElement {\n  value: string;\n  href: string;\n}\n\n// let InternalFakeDOM: HTMLDocument;\nexport const FakeDOM = () => {\n  return new DOMParser().parseFromString('', 'text/html');\n};\n\nexport const extractText = (html: string, length: number): string => {\n  const doc = FakeDOM().createElement('div');\n  doc.innerHTML = html.substr(0, 10000);\n  const text = doc.textContent || '';\n  return text.substr(0, length);\n};\n\nconst snippetCache: LRU<string, string> = new LRU({ maxAge: 1000 });\nexport const extractDraftSnippet = (draft: Draft): string => {\n  const key = draft.id + draft.updated;\n  const result = snippetCache.get(key);\n  if (result) {\n    return result;\n  }\n  const value = extractDraftText(draft.body);\n  snippetCache.set(key, value);\n  return value;\n};\n\nconst extractDraftText = (html: string): string => {\n  const doc = FakeDOM().createElement('div');\n  doc.innerHTML = html.substr(0, 10000);\n\n  // Sanitize out sent from Polymail\n  const sentFromPolymail = doc.querySelector('.pm-sfp');\n  if (sentFromPolymail && sentFromPolymail.parentElement) {\n    sentFromPolymail.parentElement.removeChild(sentFromPolymail);\n  }\n\n  const text = doc.textContent || '';\n  return text.substr(0, 100);\n};\n\nexport const sanitize = (html: string, options?: Partial<Option>): string => {\n  const blacklist = [\n    'applet',\n    'audio',\n    'base',\n    'embed',\n    'iframe',\n    'link',\n    'meta',\n    'object',\n    'picture',\n    'script',\n    'svg',\n    'title',\n    'video',\n  ];\n\n  const doc = FakeDOM().createElement('div');\n  doc.innerHTML = html;\n  const style = 'color: #444444; background-color: rgba(255, 223, 50, 0.25); border-radius: 2px;' +\n    'padding: 1px 4px; font-weight: 500; cursor: pointer;';\n  const noVarStyle = 'color: #e74c3c; background-color: rgba(255, 223, 50, 0.25); '\n  + 'border-radius: 2px; padding: 1px 4px; font-weight: 500; cursor: pointer;';\n\n  Array.from(doc.getElementsByTagName('*'))\n    .forEach((el) => {\n      if (blacklist.indexOf(el.tagName.toLowerCase()) > -1 && el && el.parentNode) {\n        el.parentNode.removeChild(el);\n      } else if (el.tagName.toLowerCase() === 'form') {\n        el.removeAttribute('method');\n        el.removeAttribute('action');\n      } else if (el.tagName.toLowerCase() === 'img') {\n        if (options && options.stripImgTags) {\n          if (el.parentNode) {\n            el.parentNode.removeChild(el);\n          }\n        } else {\n          el.removeAttribute('srcset');\n        }\n      } else {\n        forEach(el.attributes, (attribute) => {\n          if (attribute && attribute.localName && attribute.localName.toLowerCase() === 'href'\n            && el.getAttribute(attribute.localName)!.match(/javascript:/i)) {\n            el.removeAttribute('href');\n          }\n\n          if (attribute && attribute.localName && attribute.localName.toLowerCase().match(/^on/)) {\n            el.removeAttribute(attribute.localName);\n          }\n        });\n      }\n\n      // strip original styling\n      if (options && options.stripStyle) {\n        el.setAttribute('style', '');\n      }\n\n      // replace styling for placeholders\n      if (el.className === 'data-pm-var') {\n        if (!!el.getAttribute('data-pm-no-variable')) {\n          el.setAttribute('style', noVarStyle);\n        } else {\n          el.setAttribute('style', style);\n        }\n      }\n    });\n\n  return doc.innerHTML;\n};\n\n// Removes any tracking pixels\nexport const removeTrackingPixels = (html: string) => {\n  const doc = FakeDOM().createElement('div');\n  doc.innerHTML = html;\n  const elements = doc.querySelectorAll('[data-pm-tracking]');\n  Array.from(elements).forEach((element) => {\n    const parent = element.parentElement;\n    if (parent) {\n      parent.removeChild(element);\n    }\n  });\n\n  return doc.innerHTML;\n};\n\nexport const processDarkModeChanges = (container: HTMLDivElement): HTMLDivElement => {\n  const styles: HTMLStyleElement|null = container.querySelector('style');\n\n  // Do not handle if outside style color had been set\n  const colorMatch = styles && styles.innerHTML.match(/[\\s\\{;]color:/);\n  const bgColorMatch = styles && styles.innerHTML.match(/[\\s\\{;]background-color:/);\n  if (colorMatch && bgColorMatch) {\n    if (container.firstElementChild) {\n      container.firstElementChild.className = container.firstElementChild.className + ' pm-light';\n    }\n    return container;\n  }\n\n  const colorElements = container.querySelectorAll('[style],[color],[bgcolor],font');\n  colorElements?.forEach((e: HTMLElement) => {\n    const color: string | null | undefined = e.getAttribute('color') || e.style.color || null;\n    let ancestorTextColor: string | null | undefined = e.parentElement?.getAttribute('color') ||\n      e.parentElement?.style.color;\n\n    // Remove background color of paragraph tags\n    if (['P', 'SPAN', 'PRE'].indexOf(e.tagName) > -1) {\n      e.style.backgroundColor = '';\n    } else if (e.style.backgroundColor && color) {\n      return;\n    }\n\n    // Identify base values\n    let parent = e.parentElement;\n    let foundBackground: string|null|undefined = null;\n    let transparencyChecker: string|null|undefined;\n    transparencyChecker = parent?.getAttribute('bgcolor') || parent?.style.backgroundColor;\n    if (transparencyChecker && transparencyChecker === 'transparent') {\n      if (foundBackground === 'transparent') {\n        parent?.removeAttribute('bgcolor');\n        if (parent?.style.backgroundColor) {\n          parent.style.backgroundColor = '';\n        }\n      }\n      transparencyChecker = null;\n    } else {\n      foundBackground = transparencyChecker;\n    }\n    if (!parent) {\n      return;\n    }\n\n    // Traverse up upntil we find a background color\n    while (parent && !foundBackground) {\n      parent = parent.parentElement;\n      transparencyChecker = parent?.getAttribute('bgcolor') || parent?.style.backgroundColor;\n      if (transparencyChecker && transparencyChecker === 'transparent') {\n        parent?.removeAttribute('bgcolor');\n        if (parent?.style.backgroundColor) {\n          parent.style.backgroundColor = '';\n        }\n        transparencyChecker = null;\n      } else {\n        foundBackground = transparencyChecker;\n      }\n\n      ancestorTextColor = parent?.getAttribute('color') || parent?.style.color;\n    }\n\n    // Determine how we want to act based off bg existence\n    if (!!foundBackground) {\n      const bgColorBrightness = getColorBrightness(foundBackground);\n      const textColorBrightness = getColorBrightness(color);\n\n      // Ignore anchor tags\n      if (e.tagName === 'A') {\n        return;\n      }\n\n      // When light background and no defined color, set to dark color\n      const lightBackground = bgColorBrightness === ColorBrightness.Light;\n      const noAncestorTextColor = !ancestorTextColor;\n      const unknownTextColor = textColorBrightness === ColorBrightness.Unknown;\n      if (lightBackground && noAncestorTextColor && unknownTextColor) {\n        e.style.color = DEFAULT_PRIMARY_TEXT_COLOR;\n      } else if (foundBackground === 'transparent') {\n        e.style.color = DEFAULT_PRIMARY_TEXT_COLOR;\n      }\n\n    } else {\n\n      // When color is dark and no background color on ancestor set to light\n      const colorBrightness = getColorBrightness(color);\n      if (colorBrightness === ColorBrightness.Dark) {\n        e.style.color = e.tagName === 'A'\n          ? AZURE_COLOR\n          : DARKMODE_PRIMARY_TEXT_COLOR;\n      }\n    }\n  });\n\n  return container;\n};\n"]}]}