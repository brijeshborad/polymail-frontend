{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/sequenceStages.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/sequenceStages.ts","mtime":1675280254058},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fc3ByZWFkQXJyYXlzID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5cykgfHwgZnVuY3Rpb24gKCkgewogICAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSBzICs9IGFyZ3VtZW50c1tpXS5sZW5ndGg7CiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspCiAgICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspCiAgICAgICAgICAgIHJba10gPSBhW2pdOwogICAgcmV0dXJuIHI7Cn07CmltcG9ydCB7IEFjdGlvblN0YXR1cyB9IGZyb20gJ0BzcmMvdHlwZXMnOwppbXBvcnQgeyBTZXF1ZW5jZVRhYiwgU2VxdWVuY2VTdGFnZVJlY2lwaWVudEZpbHRlciB9IGZyb20gJ0BzcmMvdHlwZXMvc2VxdWVuY2VzJzsKaW1wb3J0IHsgU0VRVUVOQ0VfU1RBR0VfTElTVCwgc2VxdWVuY2VTdGFnZUxpc3QsIHNlcXVlbmNlU3RhZ2VEZWxldGUsIFNFUVVFTkNFX1NUQUdFX1VQREFURSwgU0VRVUVOQ0VfU1RBR0VfREVMRVRFLCBTRVFVRU5DRV9TVEFHRV9DUkVBVEUsIHNlcXVlbmNlU3RhZ2VDcmVhdGUsIHNlcXVlbmNlU3RhZ2VVcGRhdGUsIHNlcXVlbmNlU3RhZ2VTZWxlY3QsIFNFUVVFTkNFX1NUQUdFX0RVUExJQ0FURSwgc2VxdWVuY2VTdGFnZUR1cGxpY2F0ZSwgfSBmcm9tICdAc3JjL2R1Y2tzL3NlcXVlbmNlU3RhZ2VzJzsKaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyB0b2FzdFNldCB9IGZyb20gJ0BzcmMvZHVja3MvdG9hc3RzJzsKaW1wb3J0IHsgc2VxdWVuY2VTdGFnZUluc3RhbmNlTGlzdCwgc2VxdWVuY2VTdGFnZUluc3RhbmNlQ3JlYXRlLCB9IGZyb20gJ0BzcmMvZHVja3Mvc2VxdWVuY2VTdGFnZUluc3RhbmNlcyc7CmltcG9ydCB7IExPQ0FUSU9OX0NIQU5HRSwgcHVzaCB9IGZyb20gJ3JlYWN0LXJvdXRlci1yZWR1eCc7CmltcG9ydCB7IHNlcXVlbmNlVGFiU2VsZWN0IH0gZnJvbSAnQHNyYy9kdWNrcy9zZXF1ZW5jZXMnOwppbXBvcnQgeyBzZXF1ZW5jZVN0YWdlUmVjaXBpZW50TGlzdCB9IGZyb20gJ0BzcmMvZHVja3Mvc2VxdWVuY2VTdGFnZVJlY2lwaWVudHMnOwppbXBvcnQgeyBjcmVhdGVTZXF1ZW5jZVN0YWdlSW5zdGFuY2UgfSBmcm9tICdAc3JjL21vY2tzL3NlcXVlbmNlcyc7CmltcG9ydCB7IHZhbHVlcyB9IGZyb20gJ2xvZGFzaCc7CmltcG9ydCB7IGdldFF1ZXJ5VmFyaWFibGUgfSBmcm9tICdAc3JjL2xpYi9xdWVyeSc7CnZhciBsb2NhdGlvbkNoYW5nZVNlbGVjdFNlcXVlbmNlU3RhZ2UgPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUsIGRlcHMpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShMT0NBVElPTl9DSEFOR0UpCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgdmFyIHBhdGggPSBhY3Rpb24ucGF5bG9hZC5wYXRobmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIHZhciBzcGxpdCA9IHBhdGguc3BsaXQoJy8nKTsKICAgICAgICByZXR1cm4gcGF0aC5zdGFydHNXaXRoKCcvc2VxdWVuY2VzJykgJiYgc3BsaXQubGVuZ3RoID4gNDsKICAgIH0pCiAgICAgICAgLmRlYm91bmNlVGltZSgyMDAsIGRlcHMuc2NoZWR1bGVyKQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICB2YXIgcGF0aCA9IGFjdGlvbi5wYXlsb2FkLnBhdGhuYW1lOwogICAgICAgIHZhciBzcGxpdCA9IHBhdGguc3BsaXQoJy8nKTsKICAgICAgICB2YXIgZmlsdGVyID0gZ2V0UXVlcnlWYXJpYWJsZSgnZmlsdGVyJywgYWN0aW9uLnBheWxvYWQuc2VhcmNoKTsKICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5tZXJnZShPYnNlcnZhYmxlLm9mKHNlcXVlbmNlVGFiU2VsZWN0KHNwbGl0WzVdICYmIHNwbGl0WzVdLnRvTG93ZXJDYXNlKCkgPT09ICdyZWNpcGllbnRzJyA/CiAgICAgICAgICAgIFNlcXVlbmNlVGFiLlJlY2lwaWVudHMgOiBTZXF1ZW5jZVRhYi5NZXNzYWdlKSksIE9ic2VydmFibGUub2Yoc2VxdWVuY2VTdGFnZVNlbGVjdChzcGxpdFs0XSkpLCBPYnNlcnZhYmxlLm9mKHNlcXVlbmNlU3RhZ2VJbnN0YW5jZUxpc3QoewogICAgICAgICAgICBzZXF1ZW5jZTogc3BsaXRbMl0sCiAgICAgICAgICAgIHN0YWdlOiBzcGxpdFs0XSwKICAgICAgICB9KSksIE9ic2VydmFibGUub2Yoc2VxdWVuY2VTdGFnZVJlY2lwaWVudExpc3QoewogICAgICAgICAgICBzZXF1ZW5jZTogc3BsaXRbMl0sCiAgICAgICAgICAgIHN0YWdlOiBzcGxpdFs0XSwKICAgICAgICAgICAgZmlsdGVyOiBmaWx0ZXIgPwogICAgICAgICAgICAgICAgZmlsdGVyLnRvTG93ZXJDYXNlKCkKICAgICAgICAgICAgICAgIDogU2VxdWVuY2VTdGFnZVJlY2lwaWVudEZpbHRlci5TZW50LAogICAgICAgIH0pKSk7CiAgICB9KTsKfTsKdmFyIHNlcXVlbmNlU3RhZ2VMaXN0RXBpYyA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKFNFUVVFTkNFX1NUQUdFX0xJU1QpCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWN0aW9uKSB7IHJldHVybiBhY3Rpb24uc3RhdHVzID09PSBBY3Rpb25TdGF0dXMuU3RhcnQ7IH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBkZXBzLnNlcXVlbmNlU3RhZ2VzLmxpc3QoYWN0aW9uLm1ldGEpCiAgICAgICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UuYXBwbHkoT2JzZXJ2YWJsZSwgX19zcHJlYWRBcnJheXMoW09ic2VydmFibGUub2Yoc2VxdWVuY2VTdGFnZUxpc3QoYWN0aW9uLm1ldGEsIHJlc3VsdCkpXSwgcmVzdWx0Lm1hcChmdW5jdGlvbiAoc3RhZ2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKHNlcXVlbmNlU3RhZ2VJbnN0YW5jZUxpc3QoeyBzZXF1ZW5jZTogc3RhZ2Uuc2VxdWVuY2UsIHN0YWdlOiBzdGFnZS5pZCB9KSk7CiAgICAgICAgICAgIH0pKSk7CiAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKHNlcXVlbmNlU3RhZ2VMaXN0KGFjdGlvbi5tZXRhLCBlKSk7IH0pOwogICAgfSk7Cn07CnZhciBzZXF1ZW5jZVN0YWdlQ3JlYXRlRXBpYyA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKFNFUVVFTkNFX1NUQUdFX0NSRUFURSkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIGRlcHMuc2VxdWVuY2VTdGFnZXMuY3JlYXRlKGFjdGlvbi5tZXRhKQogICAgICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIHZhciBzdGFnZXMgPSBzdG9yZS5nZXRTdGF0ZSgpLnNlcXVlbmNlU3RhZ2VzW3Jlc3VsdC5zZXF1ZW5jZV07CiAgICAgICAgICAgIHZhciBzdWJqZWN0OwogICAgICAgICAgICBpZiAocmVzdWx0Lm9yZGVyID4gMSAmJiBzdGFnZXMpIHsKICAgICAgICAgICAgICAgIHZhciBmaXJzdFN0YWdlID0gdmFsdWVzKHN0YWdlcykKICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLmRhdGEgJiYgcy5kYXRhLm9yZGVyID09PSAxOyB9KQogICAgICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHMpIHsgcmV0dXJuIHMuZGF0YTsgfSkgfHwgW107CiAgICAgICAgICAgICAgICBpZiAoZmlyc3RTdGFnZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2VzID0gc3RvcmUKICAgICAgICAgICAgICAgICAgICAgICAgLmdldFN0YXRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgLnNlcXVlbmNlU3RhZ2VJbnN0YW5jZXNbcmVzdWx0LnNlcXVlbmNlICsgZmlyc3RTdGFnZVswXS5pZF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RhbmNlcykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5zdGFuY2UgPSB2YWx1ZXMoaW5zdGFuY2VzKS5maWx0ZXIoZnVuY3Rpb24gKGkpIHsgcmV0dXJuICEhaS5kYXRhOyB9KS5tYXAoZnVuY3Rpb24gKGkpIHsgcmV0dXJuIGkuZGF0YTsgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3QgPSBpbnN0YW5jZS5sZW5ndGggPyBpbnN0YW5jZVswXS5zdWJqZWN0IDogJyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBhY3Rpb25zID0gWwogICAgICAgICAgICAgICAgT2JzZXJ2YWJsZS5vZihzZXF1ZW5jZVN0YWdlQ3JlYXRlKGFjdGlvbi5tZXRhLCByZXN1bHQpKSwKICAgICAgICAgICAgICAgIE9ic2VydmFibGUub2Yoc2VxdWVuY2VTdGFnZUluc3RhbmNlQ3JlYXRlKGNyZWF0ZVNlcXVlbmNlU3RhZ2VJbnN0YW5jZSh7CiAgICAgICAgICAgICAgICAgICAgc3RhZ2U6IHJlc3VsdC5pZCwKICAgICAgICAgICAgICAgICAgICBzZXF1ZW5jZTogcmVzdWx0LnNlcXVlbmNlLAogICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6IHJlc3VsdC5vcmRlciA+IDEgJiYgc3ViamVjdCA/ICJSZToiICsgc3ViamVjdCA6ICcoTm8gU3ViamVjdCknLAogICAgICAgICAgICAgICAgICAgIGJvZHk6ICc8ZGl2PkhpLDxicj48YnI+PC9kaXY+JywKICAgICAgICAgICAgICAgIH0pKSksCiAgICAgICAgICAgIF07CiAgICAgICAgICAgIGlmIChhY3Rpb24ubWV0YS5uYXZpZ2F0ZVRvKSB7CiAgICAgICAgICAgICAgICBhY3Rpb25zLnB1c2goT2JzZXJ2YWJsZS5vZihwdXNoKCIvc2VxdWVuY2VzLyIgKyByZXN1bHQuc2VxdWVuY2UgKyAiL3N0YWdlcy8iICsgcmVzdWx0LmlkKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmNvbmNhdC5hcHBseShPYnNlcnZhYmxlLCBhY3Rpb25zKTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZih0b2FzdFNldChlKSksIE9ic2VydmFibGUub2Yoc2VxdWVuY2VTdGFnZUNyZWF0ZShhY3Rpb24ubWV0YSwgZSkpKTsgfSk7CiAgICB9KTsKfTsKdmFyIHNlcXVlbmNlU3RhZ2VVcGRhdGVFcGljID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoU0VRVUVOQ0VfU1RBR0VfVVBEQVRFKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5zZXF1ZW5jZVN0YWdlcy51cGRhdGUoYWN0aW9uLm1ldGEpCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHJlc3VsdCkgeyByZXR1cm4gc2VxdWVuY2VTdGFnZVVwZGF0ZShhY3Rpb24ubWV0YSwgcmVzdWx0KTsgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKE9ic2VydmFibGUub2YodG9hc3RTZXQoZSkpLCBPYnNlcnZhYmxlLm9mKHNlcXVlbmNlU3RhZ2VVcGRhdGUoYWN0aW9uLm1ldGEsIGUpKSk7IH0pOwogICAgfSk7Cn07CnZhciBzZXF1ZW5jZVN0YWdlRGVsZXRlRXBpYyA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKFNFUVVFTkNFX1NUQUdFX0RFTEVURSkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIGRlcHMuc2VxdWVuY2VTdGFnZXMuZGVsZXRlKGFjdGlvbi5tZXRhKQogICAgICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmNvbmNhdChPYnNlcnZhYmxlLm9mKHNlcXVlbmNlU3RhZ2VEZWxldGUoYWN0aW9uLm1ldGEsIG51bGwpKSwgT2JzZXJ2YWJsZS5vZihzZXF1ZW5jZVN0YWdlTGlzdChhY3Rpb24ubWV0YS5zZXF1ZW5jZSkpKTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgLy8gaGFuZGxlIDQwNCBhcyBjb21wbGV0aW9uCiAgICAgICAgICAgIGlmIChlICYmIGUuY29kZSA9PT0gNDA0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihzZXF1ZW5jZVN0YWdlRGVsZXRlKGFjdGlvbi5tZXRhLCBudWxsKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZih0b2FzdFNldChlKSksIE9ic2VydmFibGUub2Yoc2VxdWVuY2VTdGFnZURlbGV0ZShhY3Rpb24ubWV0YSwgZSkpKTsgfSk7CiAgICB9KTsKfTsKdmFyIHNlcXVlbmNlU3RhZ2VEdXBsaWNhdGVFcGljID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoU0VRVUVOQ0VfU1RBR0VfRFVQTElDQVRFKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5zZXF1ZW5jZVN0YWdlcy5kdXBsaWNhdGUoYWN0aW9uLm1ldGEuc2VxdWVuY2UsIGFjdGlvbi5tZXRhLmlkKQogICAgICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAocmVzdWx0cykgewogICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5jb25jYXQoT2JzZXJ2YWJsZS5vZihzZXF1ZW5jZVN0YWdlRHVwbGljYXRlKGFjdGlvbi5tZXRhLCByZXN1bHRzKSksIE9ic2VydmFibGUub2Yoc2VxdWVuY2VTdGFnZUxpc3QoYWN0aW9uLm1ldGEuc2VxdWVuY2UpKSk7CiAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKHRvYXN0U2V0KGUpKTsgfSk7CiAgICB9KTsKfTsKZXhwb3J0IGRlZmF1bHQgWwogICAgbG9jYXRpb25DaGFuZ2VTZWxlY3RTZXF1ZW5jZVN0YWdlLAogICAgc2VxdWVuY2VTdGFnZUxpc3RFcGljLAogICAgc2VxdWVuY2VTdGFnZUNyZWF0ZUVwaWMsCiAgICBzZXF1ZW5jZVN0YWdlRGVsZXRlRXBpYywKICAgIHNlcXVlbmNlU3RhZ2VVcGRhdGVFcGljLAogICAgc2VxdWVuY2VTdGFnZUR1cGxpY2F0ZUVwaWMsCl07Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/sequenceStages.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/sequenceStages.ts"],"names":[],"mappings":"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","sourcesContent":["import { ActionStatus, Action, StoreState } from '@src/types';\nimport { SequenceStage, SequenceTab, SequenceStageRecipientFilter } from '@src/types/sequences';\nimport { Epic } from 'redux-observable';\nimport { Deps } from '@src/lib/epic';\nimport {\n  SEQUENCE_STAGE_LIST, sequenceStageList, sequenceStageDelete,\n  SEQUENCE_STAGE_UPDATE, SEQUENCE_STAGE_DELETE,\n  SEQUENCE_STAGE_CREATE, sequenceStageCreate,\n  sequenceStageUpdate, sequenceStageSelect,\n  SequenceStageCreateMeta, SequenceStageUpdateMeta,\n  SEQUENCE_STAGE_DUPLICATE, sequenceStageDuplicate,\n } from '@src/ducks/sequenceStages';\nimport { Observable } from 'rxjs';\nimport { ApiError } from '@src/api/base';\nimport { toastSet } from '@src/ducks/toasts';\nimport {\n  sequenceStageInstanceList, sequenceStageInstanceCreate, SequenceStageInstanceCreateMeta,\n} from '@src/ducks/sequenceStageInstances';\nimport { LOCATION_CHANGE, LocationChangeAction, push, RouterAction } from 'react-router-redux';\nimport { sequenceTabSelect } from '@src/ducks/sequences';\nimport { sequenceStageRecipientList } from '@src/ducks/sequenceStageRecipients';\nimport { createSequenceStageInstance } from '@src/mocks/sequences';\nimport { values } from 'lodash';\nimport { getQueryVariable } from '@src/lib/query';\n\nconst locationChangeSelectSequenceStage: Epic<Action<any, any>, StoreState, Deps> =\n  (action$, store, deps) =>\n    action$.ofType(LOCATION_CHANGE)\n      .filter((action) => {\n        const path = ((action as any) as LocationChangeAction).payload.pathname.toLowerCase();\n        const split = path.split('/');\n\n        return path.startsWith('/sequences') && split.length > 4;\n      })\n      .debounceTime(200, deps.scheduler)\n      .flatMap((action) => {\n        const path = ((action as any) as LocationChangeAction).payload.pathname;\n        const split = path.split('/');\n        const filter = getQueryVariable(\n          'filter',\n          ((action as any) as LocationChangeAction).payload.search,\n        );\n\n        return Observable.merge(\n          Observable.of(sequenceTabSelect(\n            split[5] && split[5].toLowerCase() === 'recipients' ?\n              SequenceTab.Recipients : SequenceTab.Message,\n          )),\n          Observable.of(sequenceStageSelect(split[4])),\n          Observable.of(sequenceStageInstanceList({\n            sequence: split[2],\n            stage: split[4],\n          })),\n          Observable.of(sequenceStageRecipientList({\n            sequence: split[2],\n            stage: split[4],\n            filter: filter ?\n              filter.toLowerCase() as SequenceStageRecipientFilter\n              : SequenceStageRecipientFilter.Sent,\n          })),\n        );\n      });\n\nconst sequenceStageListEpic: Epic<Action<any, any>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(SEQUENCE_STAGE_LIST)\n      .filter((action: Action<string, SequenceStage[]>) => action.status === ActionStatus.Start)\n      .flatMap(action =>\n        deps.sequenceStages.list(action.meta)\n          .flatMap(result =>\n            Observable.merge(\n              Observable.of(sequenceStageList(action.meta, result)),\n              ...result.map(stage =>\n                Observable.of(sequenceStageInstanceList(\n                  { sequence: stage.sequence, stage: stage.id },\n                )),\n              ),\n            ))\n          .catch((e: Error) => Observable.of(sequenceStageList(action.meta, e))),\n    );\n\nconst sequenceStageCreateEpic: Epic<Action<\n  SequenceStageCreateMeta | Error | null | SequenceStageInstanceCreateMeta,\n  SequenceStage | null | SequenceStageInstanceCreateMeta\n>|RouterAction, StoreState, Deps> = (action$, store, deps) =>\n    action$.ofType(SEQUENCE_STAGE_CREATE)\n      .filter((action: Action<any, any>) => action.status === ActionStatus.Start)\n      .flatMap((action: Action<SequenceStageCreateMeta, SequenceStage>) =>\n        deps.sequenceStages.create(action.meta)\n          .flatMap((result) => {\n            const stages = store.getState().sequenceStages[result.sequence];\n            let subject;\n            if (result.order > 1 && stages) {\n              const firstStage = values(stages)\n                .filter(s => s.data && s.data.order === 1)\n                .map(s => s.data!) || [];\n              if (firstStage.length) {\n                const instances = store\n                  .getState()\n                  .sequenceStageInstances[result.sequence + firstStage[0].id];\n                if (instances) {\n                  const instance = values(instances).filter(i => !!i.data).map(i => i.data!);\n                  subject = instance.length ? instance[0].subject : '';\n                }\n              }\n            }\n\n            const actions: Array<Observable<Action<any, any>|RouterAction>> = [\n              Observable.of(sequenceStageCreate(action.meta, result)),\n              Observable.of(sequenceStageInstanceCreate(createSequenceStageInstance({\n                stage: result.id,\n                sequence: result.sequence,\n                subject: result.order > 1 && subject ? `Re:${subject}` : '(No Subject)',\n                body: '<div>Hi,<br><br></div>',\n              }))),\n            ];\n\n            if (action.meta.navigateTo) {\n              actions.push(\n                Observable.of(push(`/sequences/${result.sequence}/stages/${result.id}`)),\n              );\n            }\n\n            return Observable.concat(...actions);\n          })\n          .catch((e: Error) => Observable.merge(\n            Observable.of(toastSet(e)),\n            Observable.of(sequenceStageCreate(action.meta, e)),\n          )),\n    );\n\nconst sequenceStageUpdateEpic: Epic<\n  Action<SequenceStageUpdateMeta | Error | null, SequenceStage | null>, StoreState, Deps\n  > = (action$, store, deps) =>\n    action$.ofType(SEQUENCE_STAGE_UPDATE)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<SequenceStage, SequenceStage>) =>\n        deps.sequenceStages.update(action.meta)\n          .map(result => sequenceStageUpdate(action.meta, result))\n          .catch((e: Error) => Observable.merge(\n            Observable.of(toastSet(e)),\n            Observable.of(sequenceStageUpdate(action.meta, e)),\n          )),\n    );\n\nconst sequenceStageDeleteEpic: Epic<\n  Action<any, any>, StoreState, Deps\n  > = (action$, store, deps) =>\n    action$.ofType(SEQUENCE_STAGE_DELETE)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<SequenceStage, null>) =>\n        deps.sequenceStages.delete(action.meta)\n          .flatMap(result =>\n            Observable.concat(\n              Observable.of(sequenceStageDelete(action.meta, null)),\n              Observable.of(sequenceStageList(action.meta.sequence)),\n            ))\n          .catch((e) => {\n            // handle 404 as completion\n            if (e as ApiError && e.code === 404) {\n              return Observable.of(sequenceStageDelete(action.meta, null));\n            }\n\n            throw e;\n          })\n          .catch((e: Error) => Observable.merge(\n            Observable.of(toastSet(e)),\n            Observable.of(sequenceStageDelete(action.meta, e)),\n          )),\n    );\n\nconst sequenceStageDuplicateEpic: Epic<Action<\n  SequenceStage|Error|null|string, SequenceStage|null|SequenceStage[]\n>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(SEQUENCE_STAGE_DUPLICATE)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap((action: Action<SequenceStage, SequenceStage>) =>\n        deps.sequenceStages.duplicate(\n          action.meta.sequence,\n          action.meta.id,\n        )\n          .flatMap(results =>\n            Observable.concat(\n              Observable.of(sequenceStageDuplicate(action.meta, results)),\n              Observable.of(sequenceStageList(action.meta.sequence)),\n            ),\n          )\n          .catch(e => Observable.of(toastSet(e))),\n      );\n\nexport default [\n  locationChangeSelectSequenceStage,\n  sequenceStageListEpic,\n  sequenceStageCreateEpic,\n  sequenceStageDeleteEpic,\n  sequenceStageUpdateEpic,\n  sequenceStageDuplicateEpic,\n];\n"]}]}