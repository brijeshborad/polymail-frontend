{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/sequenceStageRecipients.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/sequenceStageRecipients.ts","mtime":1675280254058},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgQWN0aW9uU3RhdHVzIH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJzsKaW1wb3J0IHsgU0VRVUVOQ0VfU1RBR0VfUkVDSVBJRU5UX0xJU1QsIHNlcXVlbmNlU3RhZ2VSZWNpcGllbnRMaXN0LCBTRVFVRU5DRV9TVEFHRV9SRUNJUElFTlRfVVBEQVRFLCBzZXF1ZW5jZVN0YWdlUmVjaXBpZW50VXBkYXRlLCB9IGZyb20gJ0BzcmMvZHVja3Mvc2VxdWVuY2VTdGFnZVJlY2lwaWVudHMnOwppbXBvcnQgeyBjb21wdXRlU2VxdWVuY2VTdGFnZVJlY2lwaWVudCB9IGZyb20gJ0BzcmMvbGliL21vZGVscy9zZXF1ZW5jZVN0YWdlUmVjaXBpZW50cyc7CnZhciBzZXF1ZW5jZVN0YWdlUmVjaXBpZW50TGlzdEVwaWMgPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUsIGRlcHMpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShTRVFVRU5DRV9TVEFHRV9SRUNJUElFTlRfTElTVCkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIGRlcHMuc2VxdWVuY2VTdGFnZVJlY2lwaWVudHMubGlzdChhY3Rpb24ubWV0YSkKICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAocmVzdWx0KSB7IHJldHVybiBzZXF1ZW5jZVN0YWdlUmVjaXBpZW50TGlzdChhY3Rpb24ubWV0YSwgcmVzdWx0KTsgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKHNlcXVlbmNlU3RhZ2VSZWNpcGllbnRMaXN0KGFjdGlvbi5tZXRhLCBlKSk7IH0pOwogICAgfSk7Cn07Ci8vIHRoaXMgZXBpYyB1cGRhdGVzIHRoZSBjb3JyZXNwb25kaW5nIHNlcXVlbmNlUmVjaXBpZW50cyBhbmQgdGh1cyB0aGUgY29tcHV0ZWQgcHJvcGVydHkKLy8gc2VxdWVuY2VTdGFnZVJlY2lwaWVudCBpcyBkZXJpdmVkIGZyb20uCnZhciBzZXF1ZW5jZVN0YWdlUmVjaXBpZW50VXBkYXRlRXBpYyA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKFNFUVVFTkNFX1NUQUdFX1JFQ0lQSUVOVF9VUERBVEUpCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgdmFyIHN0YXRlID0gc3RvcmUuZ2V0U3RhdGUoKTsKICAgICAgICB2YXIgbWV0YSA9IGFjdGlvbi5tZXRhOwogICAgICAgIHZhciByZWNpcGllbnRzID0gc3RhdGUuc2VxdWVuY2VTdGFnZVJlY2lwaWVudHNbbWV0YS5zZXF1ZW5jZSArIG1ldGEuc3RhZ2VdICYmCiAgICAgICAgICAgIHN0YXRlLnNlcXVlbmNlU3RhZ2VSZWNpcGllbnRzW21ldGEuc2VxdWVuY2UgKyBtZXRhLnN0YWdlXS5kYXRhOwogICAgICAgIGlmICghcmVjaXBpZW50cykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHZhciByZWNpcGllbnQgPSByZWNpcGllbnRzLmZpbmQoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHIuaWQgPT09IG1ldGEuaWQ7IH0pOwogICAgICAgIHJldHVybiBhY3Rpb24uc3RhdHVzID09PSBBY3Rpb25TdGF0dXMuU3RhcnQgJiYgISFyZWNpcGllbnQ7CiAgICB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gZGVwcy5zZXF1ZW5jZVJlY2lwaWVudHMudXBkYXRlKHsKICAgICAgICAgICAgc2VxdWVuY2U6IGFjdGlvbi5tZXRhLnNlcXVlbmNlLAogICAgICAgICAgICBpZDogYWN0aW9uLm1ldGEuaWQsCiAgICAgICAgICAgIHBhdXNlZDogYWN0aW9uLm1ldGEucGF1c2VkLAogICAgICAgIH0pCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gc2VxdWVuY2VTdGFnZVJlY2lwaWVudFVwZGF0ZShhY3Rpb24ubWV0YSwgY29tcHV0ZVNlcXVlbmNlU3RhZ2VSZWNpcGllbnQoYWN0aW9uLm1ldGEsIHJlc3VsdCkpOwogICAgICAgIH0pOwogICAgfSk7Cn07CmV4cG9ydCBkZWZhdWx0IFsKICAgIHNlcXVlbmNlU3RhZ2VSZWNpcGllbnRMaXN0RXBpYywKICAgIHNlcXVlbmNlU3RhZ2VSZWNpcGllbnRVcGRhdGVFcGljLApdOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/sequenceStageRecipients.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/sequenceStageRecipients.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,YAAY,EAAsB,MAAM,YAAY,CAAC;AAG9D,OAAO,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AAClC,OAAO,EACL,6BAA6B,EAC7B,0BAA0B,EAC1B,+BAA+B,EAC/B,4BAA4B,GAC7B,MAAM,oCAAoC,CAAC;AAE5C,OAAO,EAAE,6BAA6B,EAAE,MAAM,yCAAyC,CAAC;AAExF,IAAM,8BAA8B,GAChC,UAAC,OAAO,EAAE,KAAK,EAAE,IAAI;IACrB,OAAA,OAAO,CAAC,MAAM,CAAC,6BAA6B,CAAC;SAC1C,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,MAAM,KAAK,YAAY,CAAC,KAAK,EAApC,CAAoC,CAAC;SACtD,OAAO,CAAC,UAAA,MAAM;QACb,OAAA,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;aAC3C,GAAG,CAAC,UAAA,MAAM,IAAI,OAAA,0BAA0B,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,EAA/C,CAA+C,CAAC;aAC9D,KAAK,CAAC,UAAC,CAAQ,IAAK,OAAA,UAAU,CAAC,EAAE,CAAC,0BAA0B,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,EAAzD,CAAyD,CAAC;IAFjF,CAEiF,CACpF;AAND,CAMC,CAAC;AAEN,wFAAwF;AACxF,0CAA0C;AAC1C,IAAM,gCAAgC,GAGlC,UAAC,OAAO,EAAE,KAAK,EAAE,IAAI;IACrB,OAAA,OAAO,CAAC,MAAM,CAAC,+BAA+B,CAAC;SAC5C,MAAM,CAAC,UAAC,MAAM;QACb,IAAM,KAAK,GAAG,KAAK,CAAC,QAAQ,EAAE,CAAC;QACvB,IAAA,kBAAI,CAAY;QACxB,IAAM,UAAU,GAAG,KAAK,CAAC,uBAAuB,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC;YAC1E,KAAK,CAAC,uBAAuB,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC;QAEjE,IAAI,CAAC,UAAU,EAAE;YACf,OAAO,KAAK,CAAC;SACd;QAED,IAAM,SAAS,GAAG,UAAU,CAAC,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,EAAhB,CAAgB,CAAC,CAAC;QAEzD,OAAO,MAAM,CAAC,MAAM,KAAK,YAAY,CAAC,KAAK,IAAI,CAAC,CAAC,SAAS,CAAC;IAC7D,CAAC,CAAC;SACD,OAAO,CAAC,UAAA,MAAM;QACb,OAAA,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC;YAC7B,QAAQ,EAAE,MAAM,CAAC,IAAI,CAAC,QAAQ;YAC9B,EAAE,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE;YAClB,MAAM,EAAE,MAAM,CAAC,IAAI,CAAC,MAAM;SAC3B,CAAC;aACD,GAAG,CAAC,UAAA,MAAM;YACT,OAAA,4BAA4B,CAC1B,MAAM,CAAC,IAAI,EAAE,6BAA6B,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,CAChE;QAFD,CAEC,CACF;IATD,CASC,CACF;AA1BH,CA0BG,CAAC;AAER,eAAe;IACb,8BAA8B;IAC9B,gCAAgC;CACjC,CAAC","sourcesContent":["import { ActionStatus, Action, StoreState } from '@src/types';\nimport { Epic } from 'redux-observable';\nimport { Deps } from '@src/lib/epic';\nimport { Observable } from 'rxjs';\nimport {\n  SEQUENCE_STAGE_RECIPIENT_LIST,\n  sequenceStageRecipientList,\n  SEQUENCE_STAGE_RECIPIENT_UPDATE,\n  sequenceStageRecipientUpdate,\n} from '@src/ducks/sequenceStageRecipients';\nimport { SequenceStageRecipient } from '@src/types/sequences';\nimport { computeSequenceStageRecipient } from '@src/lib/models/sequenceStageRecipients';\n\nconst sequenceStageRecipientListEpic: Epic<Action<any, any>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(SEQUENCE_STAGE_RECIPIENT_LIST)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap(action =>\n        deps.sequenceStageRecipients.list(action.meta)\n          .map(result => sequenceStageRecipientList(action.meta, result))\n          .catch((e: Error) => Observable.of(sequenceStageRecipientList(action.meta, e))),\n    );\n\n// this epic updates the corresponding sequenceRecipients and thus the computed property\n// sequenceStageRecipient is derived from.\nconst sequenceStageRecipientUpdateEpic: Epic<Action<\n  SequenceStageRecipient, SequenceStageRecipient\n>, StoreState, Deps>\n  = (action$, store, deps) =>\n    action$.ofType(SEQUENCE_STAGE_RECIPIENT_UPDATE)\n      .filter((action) => {\n        const state = store.getState();\n        const { meta } = action;\n        const recipients = state.sequenceStageRecipients[meta.sequence + meta.stage] &&\n          state.sequenceStageRecipients[meta.sequence + meta.stage].data;\n\n        if (!recipients) {\n          return false;\n        }\n\n        const recipient = recipients.find(r => r.id === meta.id);\n\n        return action.status === ActionStatus.Start && !!recipient;\n      })\n      .flatMap(action =>\n        deps.sequenceRecipients.update({\n          sequence: action.meta.sequence,\n          id: action.meta.id,\n          paused: action.meta.paused,\n        })\n        .map(result =>\n          sequenceStageRecipientUpdate(\n            action.meta, computeSequenceStageRecipient(action.meta, result),\n          ),\n        ),\n      );\n\nexport default [\n  sequenceStageRecipientListEpic,\n  sequenceStageRecipientUpdateEpic,\n];\n"]}]}