{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/components/TrackingPopover.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/components/TrackingPopover.tsx","mtime":1675280254118},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnOwppbXBvcnQgeyBmb3JFYWNoLCBvcmRlckJ5IH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IFRyYWNrQ2VsbCBmcm9tICdAc3JjL2NvbXBvbmVudHMvQ2VsbHMvVHJhY2tDZWxsJzsKaW1wb3J0IFBvcG92ZXIgZnJvbSAnQHNyYy9jb21wb25lbnRzL1BvcG92ZXIvUG9wb3Zlcic7CmltcG9ydCBTcGlubmVyIGZyb20gJ0BzcmMvY29tcG9uZW50cy9JY29ucy9TcGlubmVyLnN2Zyc7CmltcG9ydCAnLi9UcmFja2luZ1BvcG92ZXIuc2Nzcyc7CmltcG9ydCBVcGdyYWRlUHJvbXB0IGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL1VwZ3JhZGVQcm9tcHQvVXBncmFkZVByb21wdCc7CnZhciBUcmFja2luZ1BvcG92ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoVHJhY2tpbmdQb3BvdmVyLCBfc3VwZXIpOwogICAgZnVuY3Rpb24gVHJhY2tpbmdQb3BvdmVyKHByb3BzKSB7CiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKICAgICAgICBfdGhpcy5nZXRBY3Rpb25BcnJheSA9IGZ1bmN0aW9uIChhY3Rpb25zT2JqKSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25zID0gW107CiAgICAgICAgICAgIGZvckVhY2goYWN0aW9uc09iaiwgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICAgICAgICAgIHZhbHVlLmZvckVhY2goZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9ucy5wdXNoKHsgZW1haWw6IGtleSwgYWN0aW9uOiBhY3Rpb24gfSk7IH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG9yZGVyQnkoYWN0aW9ucywgZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLmFjdGlvbi5kYXRlOyB9LCAnZGVzYycpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuc2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMucG9wb3Zlci5zaG93KCk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5wb3BvdmVyLmhpZGUoKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVJlZiA9IGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgX3RoaXMucG9wb3ZlciA9IHJlZjsKICAgICAgICB9OwogICAgICAgIF90aGlzLnN0YXRlID0geyBhY3Rpb25zOiBwcm9wcy50cmFjayAmJiBfdGhpcy5nZXRBY3Rpb25BcnJheShwcm9wcy50cmFjay5hY3Rpb25zKSB8fCBbXSB9OwogICAgICAgIHJldHVybiBfdGhpczsKICAgIH0KICAgIFRyYWNraW5nUG9wb3Zlci5wcm90b3R5cGUuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgPSBmdW5jdGlvbiAobmV4dFByb3BzKSB7CiAgICAgICAgaWYgKG5leHRQcm9wcy50cmFjayAmJiBuZXh0UHJvcHMudHJhY2sgIT09IHRoaXMucHJvcHMudHJhY2spIHsKICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBhY3Rpb25zOiB0aGlzLmdldEFjdGlvbkFycmF5KG5leHRQcm9wcy50cmFjay5hY3Rpb25zKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKICAgIFRyYWNraW5nUG9wb3Zlci5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfYSA9IHRoaXMucHJvcHMsIHRyYWNrID0gX2EudHJhY2ssIHBlbmRpbmcgPSBfYS5wZW5kaW5nLCBmZWF0dXJlcyA9IF9hLmZlYXR1cmVzLCBmcm9tVGhyZWFkID0gX2EuZnJvbVRocmVhZDsKICAgICAgICB2YXIgYWN0aW9ucyA9IHRoaXMuc3RhdGUuYWN0aW9uczsKICAgICAgICB2YXIgVHJhY2tDZWxsQ29ubmVjdCA9IFRyYWNrQ2VsbDsKICAgICAgICB2YXIgc2hvd1VwZ3JhZGVQcm9tcHQgPSAhZmVhdHVyZXMudHJhY2tSZWNpcGllbnRzOwogICAgICAgIHZhciBtZXNzYWdlRGVzY3JpcHRpb24gPSBmcm9tVGhyZWFkCiAgICAgICAgICAgID8gJ1lvdXIgbGFzdCBtZXNzYWdlJwogICAgICAgICAgICA6ICdUaGlzIG1lc3NhZ2UnOwogICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChQb3BvdmVyLCB7IGNsYXNzTmFtZTogY2xhc3NuYW1lcygndHJhY2tpbmctcG9wb3ZlcicsIHsKICAgICAgICAgICAgICAgICdzaG91bGQtdXBncmFkZSc6IHNob3dVcGdyYWRlUHJvbXB0LAogICAgICAgICAgICB9KSwgcmVmOiB0aGlzLmhhbmRsZVJlZiB9LAogICAgICAgICAgICAhcGVuZGluZyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImNvdW50IiB9LAogICAgICAgICAgICAgICAgdHJhY2sgJiYgYWN0aW9ucy5sZW5ndGggPiAwICYmIChtZXNzYWdlRGVzY3JpcHRpb24gKyAiIHdhcyByZWFkICIgKyBhY3Rpb25zLmxlbmd0aCArICIgdGltZSIgKwogICAgICAgICAgICAgICAgICAgIChhY3Rpb25zLmxlbmd0aCA9PT0gMSA/ICcnIDogJ3MnKSksCiAgICAgICAgICAgICAgICBhY3Rpb25zLmxlbmd0aCA9PT0gMCAmJiAnTm8gb25lXCdzIHJlYWQgeW91ciBsYXN0IGVtYWlsIHlldC4nKSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJtYWluIiB9LAogICAgICAgICAgICAgICAgcGVuZGluZyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFNwaW5uZXIsIHsgY2xhc3NOYW1lOiAibG9hZGVyIiB9KSwKICAgICAgICAgICAgICAgICFwZW5kaW5nICYmIHRyYWNrICYmIGFjdGlvbnMubWFwKGZ1bmN0aW9uIChhY3Rpb24sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVHJhY2tDZWxsQ29ubmVjdCwgeyBrZXk6IGluZGV4LCB0cmFja0FjdGlvbjogYWN0aW9uLmFjdGlvbiwgZW1haWw6IGFjdGlvbi5lbWFpbCB9KTsKICAgICAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgc2hvd1VwZ3JhZGVQcm9tcHQgJiYgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ1cGdyYWRlLWNvbnRhaW5lciIgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVXBncmFkZVByb21wdCwgeyB0aXRsZTogIkVtYWlsIHRyYWNraW5nIGhpc3RvcnkiLCBkZXNjcmlwdGlvbjogIlRvIHZpZXcgdGhpcyBtZXNzYWdlXHUyMDE5cyBmdWxsIHRyYWNraW5nIGFjdGl2aXR5LCB1cGdyYWRlIHRvIGEgcGFpZCBwbGFuLiIgfSkpKSk7CiAgICB9OwogICAgcmV0dXJuIFRyYWNraW5nUG9wb3ZlcjsKfShSZWFjdC5QdXJlQ29tcG9uZW50KSk7CmV4cG9ydCBkZWZhdWx0IFRyYWNraW5nUG9wb3ZlcjsK"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/components/TrackingPopover.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Threads/components/TrackingPopover.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport classnames from 'classnames';\nimport { forEach, orderBy } from 'lodash';\nimport { Track, TrackAction, Features } from '@src/types';\nimport TrackCell from '@src/components/Cells/TrackCell';\nimport Popover from '@src/components/Popover/Popover';\nimport Spinner from '@src/components/Icons/Spinner.svg';\nimport './TrackingPopover.scss';\nimport UpgradePrompt from '@src/components/Base/UpgradePrompt/UpgradePrompt';\n\ninterface Props {\n  track?: Track;\n  pending: boolean;\n  features: Features;\n\n  fromThread?: boolean;\n}\n\ninterface Action {\n  email: string;\n  action: TrackAction;\n}\n\ninterface State {\n  actions: Action[];\n}\n\nclass TrackingPopover extends React.PureComponent<Props, State> {\n  private popover: Popover;\n\n  constructor(props: Props) {\n    super();\n\n    this.state =  { actions: props.track && this.getActionArray(props.track.actions) || [] };\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n    if (nextProps.track && nextProps.track !== this.props.track) {\n      this.setState({\n        actions: this.getActionArray(nextProps.track.actions),\n      });\n    }\n  }\n\n  getActionArray = (actionsObj: { [email: string]: TrackAction[] }) => {\n    const actions: Action[] = [];\n\n    forEach(actionsObj, (value: TrackAction[], key: string) => {\n      value.forEach(action => actions.push({ email: key, action }));\n    });\n\n    return orderBy(actions, action => action.action.date, 'desc');\n  }\n\n  show = () => {\n    this.popover.show();\n  }\n\n  hide = () => {\n    this.popover.hide();\n  }\n\n  handleRef = (ref: Popover) => {\n    this.popover = ref;\n  }\n\n  render() {\n    const { track, pending, features, fromThread } = this.props;\n    const { actions } = this.state;\n    const TrackCellConnect = TrackCell as any;\n    const showUpgradePrompt = !features.trackRecipients;\n    const messageDescription = fromThread\n      ? 'Your last message'\n      : 'This message';\n\n    return (\n      <Popover\n        className={classnames('tracking-popover', {\n          'should-upgrade': showUpgradePrompt,\n        })}\n        ref={this.handleRef}\n      >\n        {!pending && <div className=\"count\">\n          {track && actions.length > 0 && (`${messageDescription} was read ${actions.length} time` +\n            (actions.length === 1 ? '' : 's'))}\n          {actions.length === 0 && 'No one\\'s read your last email yet.'}\n        </div>}\n        <div className=\"main\">\n          {pending && <Spinner className=\"loader\" />}\n          {!pending && track && actions.map((action: Action, index: number) =>\n            <TrackCellConnect\n              key={index}\n              trackAction={action.action}\n              email={action.email}\n            />,\n          )}\n        </div>\n        {showUpgradePrompt && <div className=\"upgrade-container\">\n          <UpgradePrompt\n            title=\"Email tracking history\"\n            description=\"To view this messageâ€™s full tracking activity, upgrade to a paid plan.\"\n          />\n        </div>}\n      </Popover>\n    );\n  }\n}\n\nexport default TrackingPopover;\n"]}]}