{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/api/drafts.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/api/drafts.ts","mtime":1675280253979},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgewogICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHsKICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKQogICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfTsKICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9OwppbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsKaW1wb3J0IHsganNvblJlcXVlc3QsIGJsYW5rUmVxdWVzdCB9IGZyb20gJy4vYmFzZSc7CmltcG9ydCB7IGRlZmF1bHREcmFmdCwgZ2VuZXJhdGVPcHRpbWlzdGljU2VuZE1ldGEsIH0gZnJvbSAnQHNyYy9saWIvZHJhZnQnOwppbXBvcnQgeyBjcmVhdGVEcmFmdCB9IGZyb20gJ0BzcmMvbW9ja3MvZHJhZnRzJzsKaW1wb3J0IHsgY3JlYXRlQXR0YWNobWVudCB9IGZyb20gJ0BzcmMvbW9ja3MvYXR0YWNobWVudHMnOwppbXBvcnQgeyBDbG91ZEZpbGVDbGllbnQgfSBmcm9tICdAc3JjL2FwaS9jbG91ZEZpbGUnOwppbXBvcnQgeyBub3cgfSBmcm9tICdAc3JjL2xpYi9kYXRldGltZSc7CnZhciBEcmFmdENsaWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIERyYWZ0Q2xpZW50KCkgewogICAgfQogICAgRHJhZnRDbGllbnQucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChpZCkgewogICAgICAgIHJldHVybiBqc29uUmVxdWVzdCh7CiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgIHJvdXRlOiAiL3YxL2RyYWZ0cy8iICsgZW5jb2RlVVJJQ29tcG9uZW50KGlkKSwKICAgICAgICB9KQogICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChkcmFmdCkgeyByZXR1cm4gZGVmYXVsdERyYWZ0KGRyYWZ0KTsgfSk7CiAgICB9OwogICAgRHJhZnRDbGllbnQucHJvdG90eXBlLmxpc3QgPSBmdW5jdGlvbiAoZnJvbSkgewogICAgICAgIHJldHVybiBqc29uUmVxdWVzdCh7CiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgIHJvdXRlOiBmcm9tID8gIi92MS9kcmFmdHM/ZnJvbT0iICsgZnJvbSA6ICcvdjEvZHJhZnRzJywKICAgICAgICB9KQogICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChkcmFmdHMpIHsgcmV0dXJuIGRyYWZ0cy5tYXAoZnVuY3Rpb24gKGRyYWZ0KSB7IHJldHVybiBkZWZhdWx0RHJhZnQoZHJhZnQpOyB9KTsgfSk7CiAgICB9OwogICAgRHJhZnRDbGllbnQucHJvdG90eXBlLmxpc3RJbmNyID0gZnVuY3Rpb24gKHRvKSB7CiAgICAgICAgcmV0dXJuIGpzb25SZXF1ZXN0KHsKICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgcm91dGU6IHRvID8gIi92MS9kcmFmdHM/dG89IiArIHRvIDogJy92MS9kcmFmdHMnLAogICAgICAgIH0pCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGRyYWZ0cykgeyByZXR1cm4gZHJhZnRzLm1hcChmdW5jdGlvbiAoZHJhZnQpIHsgcmV0dXJuIGRlZmF1bHREcmFmdChkcmFmdCk7IH0pOyB9KTsKICAgIH07CiAgICBEcmFmdENsaWVudC5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKGRyYWZ0KSB7CiAgICAgICAgcmV0dXJuIGpzb25SZXF1ZXN0KHsKICAgICAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLAogICAgICAgICAgICByb3V0ZTogIi92MS9kcmFmdHMvIiArIGRyYWZ0LmlkLAogICAgICAgICAgICBib2R5OiBkcmFmdCwKICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKG5ld0RyYWZ0KSB7IHJldHVybiBkZWZhdWx0RHJhZnQobmV3RHJhZnQpOyB9KTsKICAgIH07CiAgICBEcmFmdENsaWVudC5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKGRyYWZ0KSB7CiAgICAgICAgcmV0dXJuIGpzb25SZXF1ZXN0KHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIHJvdXRlOiAiL3YxL2RyYWZ0cyIsCiAgICAgICAgICAgIGJvZHk6IGRyYWZ0LAogICAgICAgIH0pLm1hcChmdW5jdGlvbiAobmV3RHJhZnQpIHsgcmV0dXJuIGRlZmF1bHREcmFmdChuZXdEcmFmdCk7IH0pOwogICAgfTsKICAgIERyYWZ0Q2xpZW50LnByb3RvdHlwZS5kZWxldGUgPSBmdW5jdGlvbiAoZHJhZnQpIHsKICAgICAgICByZXR1cm4gYmxhbmtSZXF1ZXN0KHsKICAgICAgICAgICAgbWV0aG9kOiAnREVMRVRFJywKICAgICAgICAgICAgcm91dGU6ICIvdjEvZHJhZnRzLyIgKyBkcmFmdCwKICAgICAgICB9KTsKICAgIH07CiAgICBEcmFmdENsaWVudC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uIChtZXRhKSB7CiAgICAgICAgdmFyIGJvZHkgPSB7fTsKICAgICAgICBpZiAobWV0YS5kZWxheSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGJvZHkuZGVsYXkgPSBtZXRhLmRlbGF5OwogICAgICAgIH0KICAgICAgICBpZiAobWV0YS5zY2hlZHVsZWQpIHsKICAgICAgICAgICAgYm9keS5zY2hlZHVsZWQgPSBtb21lbnQobWV0YS5zY2hlZHVsZWQpLnRvSVNPU3RyaW5nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBqc29uUmVxdWVzdCh7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICByb3V0ZTogIi92Mi9kcmFmdHMvIiArIG1ldGEuZHJhZnQuaWQgKyAiL3NlbmQiLAogICAgICAgICAgICBib2R5OiBib2R5LAogICAgICAgIH0pLm1hcChmdW5jdGlvbiAobmV3RHJhZnQpIHsgcmV0dXJuIGRlZmF1bHREcmFmdChuZXdEcmFmdCk7IH0pOwogICAgfTsKICAgIERyYWZ0Q2xpZW50LnByb3RvdHlwZS51bmRvU2VuZCA9IGZ1bmN0aW9uIChkcmFmdCkgewogICAgICAgIHJldHVybiBqc29uUmVxdWVzdCh7CiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICByb3V0ZTogIi92MS9kcmFmdHMvIiArIGRyYWZ0LmlkICsgIi9jYW5jZWxTZW5kIiwKICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKHJldHJpZXZlZCkgeyByZXR1cm4gZGVmYXVsdERyYWZ0KHJldHJpZXZlZCk7IH0pOwogICAgfTsKICAgIERyYWZ0Q2xpZW50LnByb3RvdHlwZS51cGxvYWRBdHRhY2htZW50ID0gZnVuY3Rpb24gKGRyYWZ0LCBhdHRhY2htZW50LCBmaWxlLCBpbmxpbmUsIGNsb3VkKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDbG91ZEZpbGVDbGllbnQoKS51cGxvYWRXaXRoUHJvZ3Jlc3MoZmlsZSkKICAgICAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBmID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoZik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGpzb25SZXF1ZXN0KHsKICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgcm91dGU6ICIvdjEvZHJhZnRzLyIgKyBkcmFmdCArICIvYXR0YWNobWVudHMiLAogICAgICAgICAgICAgICAgYm9keTogX19hc3NpZ24oX19hc3NpZ24oeyBpZDogYXR0YWNobWVudCwgZmlsZW5hbWU6IGZpbGUubmFtZSB9LCBmKSwgeyBpbmxpbmU6IGlubGluZSwKICAgICAgICAgICAgICAgICAgICBjbG91ZDogY2xvdWQgfSksCiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfTsKICAgIERyYWZ0Q2xpZW50LnByb3RvdHlwZS51cGxvYWRUZW1wbGF0ZUF0dGFjaG1lbnQgPSBmdW5jdGlvbiAoZHJhZnQsIGF0dGFjaG1lbnQpIHsKICAgICAgICByZXR1cm4ganNvblJlcXVlc3QoewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgcm91dGU6ICIvdjEvZHJhZnRzLyIgKyBkcmFmdCArICIvYXR0YWNobWVudHMiLAogICAgICAgICAgICBib2R5OiBhdHRhY2htZW50LAogICAgICAgIH0pOwogICAgfTsKICAgIERyYWZ0Q2xpZW50LnByb3RvdHlwZS5yZW1vdmVBdHRhY2htZW50ID0gZnVuY3Rpb24gKGRyYWZ0LCBhdHRhY2htZW50KSB7CiAgICAgICAgcmV0dXJuIGJsYW5rUmVxdWVzdCh7CiAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsCiAgICAgICAgICAgIHJvdXRlOiAiL3YxL2RyYWZ0cy8iICsgZHJhZnQgKyAiL2F0dGFjaG1lbnRzLyIgKyBhdHRhY2htZW50LAogICAgICAgIH0pOwogICAgfTsKICAgIERyYWZ0Q2xpZW50LnByb3RvdHlwZS5hcHBseUZvcndhcmRBdHRhY2htZW50cyA9IGZ1bmN0aW9uIChkcmFmdCwgdGhyZWFkLCBtZXNzYWdlLCBhY2NvdW50KSB7CiAgICAgICAgcmV0dXJuIGpzb25SZXF1ZXN0KHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIHJvdXRlOiAiL3YyL2RyYWZ0cy8iICsgZHJhZnQgKyAiL2F0dGFjaG1lbnRzL2FwcGVuZCIsCiAgICAgICAgICAgIGJvZHk6ICh7IHRocmVhZDogdGhyZWFkLCBtZXNzYWdlOiBtZXNzYWdlLCBhY2NvdW50OiBhY2NvdW50IH0pLAogICAgICAgIH0pOwogICAgfTsKICAgIERyYWZ0Q2xpZW50LnByb3RvdHlwZS5zZW5kTm93ID0gZnVuY3Rpb24gKGRyYWZ0KSB7CiAgICAgICAgcmV0dXJuIGpzb25SZXF1ZXN0KHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIHJvdXRlOiAiL3YxL2RyYWZ0cy8iICsgZHJhZnQgKyAiL3NlbmROb3ciLAogICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZCkgeyByZXR1cm4gZGVmYXVsdERyYWZ0KGQpOyB9KTsKICAgIH07CiAgICBEcmFmdENsaWVudC5wcm90b3R5cGUuZ2VuZXJhdGVPcHRpbWlzdGljID0gZnVuY3Rpb24gKG1ldGEsIGF0dGFjaG1lbnRzKSB7CiAgICAgICAgcmV0dXJuIGdlbmVyYXRlT3B0aW1pc3RpY1NlbmRNZXRhKG1ldGEsIGF0dGFjaG1lbnRzKTsKICAgIH07CiAgICByZXR1cm4gRHJhZnRDbGllbnQ7Cn0oKSk7CmV4cG9ydCB7IERyYWZ0Q2xpZW50IH07CmV4cG9ydCBmdW5jdGlvbiBtb2NrRHJhZnRDbGllbnQoKSB7CiAgICByZXR1cm4gewogICAgICAgIGdldDogZnVuY3Rpb24gKGlkKSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKGNyZWF0ZURyYWZ0KGlkKSk7IH0sCiAgICAgICAgbGlzdDogZnVuY3Rpb24gKGZyb20pIHsgcmV0dXJuIE9ic2VydmFibGUub2YoW10pOyB9LAogICAgICAgIGxpc3RJbmNyOiBmdW5jdGlvbiAodG8pIHsgcmV0dXJuIE9ic2VydmFibGUub2YoW10pOyB9LAogICAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKGRyYWZ0KSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKGRyYWZ0KTsgfSwKICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uIChkcmFmdCkgeyByZXR1cm4gT2JzZXJ2YWJsZS5vZihkcmFmdCk7IH0sCiAgICAgICAgZGVsZXRlOiBmdW5jdGlvbiAoZHJhZnQpIHsgcmV0dXJuIE9ic2VydmFibGUub2YobnVsbCk7IH0sCiAgICAgICAgc2VuZDogZnVuY3Rpb24gKG1ldGEpIHsgcmV0dXJuIE9ic2VydmFibGUub2YobWV0YS5kcmFmdCk7IH0sCiAgICAgICAgdXBsb2FkQXR0YWNobWVudDogZnVuY3Rpb24gKGRyYWZ0LCBhdHRhY2htZW50LCBmaWxlLCBpbmxpbmUsIGNsb3VkKSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKGNyZWF0ZUF0dGFjaG1lbnQoKSk7IH0sCiAgICAgICAgdXBsb2FkVGVtcGxhdGVBdHRhY2htZW50OiBmdW5jdGlvbiAoZHJhZnQsIGF0dGFjaG1lbnQpIHsgcmV0dXJuIE9ic2VydmFibGUub2YoYXR0YWNobWVudCk7IH0sCiAgICAgICAgcmVtb3ZlQXR0YWNobWVudDogZnVuY3Rpb24gKGRyYWZ0LCBhdHRhY2htZW50KSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKG51bGwpOyB9LAogICAgICAgIGFwcGx5Rm9yd2FyZEF0dGFjaG1lbnRzOiBmdW5jdGlvbiAoZHJhZnQsIHRocmVhZCwgbWVzc2FnZSwgYWNjb3VudCkgeyByZXR1cm4gT2JzZXJ2YWJsZS5vZihbXSk7IH0sCiAgICAgICAgc2VuZE5vdzogZnVuY3Rpb24gKGRyYWZ0KSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKGNyZWF0ZURyYWZ0KCkpOyB9LAogICAgICAgIGdlbmVyYXRlT3B0aW1pc3RpYzogZnVuY3Rpb24gKG0sIGEpIHsKICAgICAgICAgICAgdmFyIG9wdGltaXN0aWMgPSAoX19hc3NpZ24oe30sIGdlbmVyYXRlT3B0aW1pc3RpY1NlbmRNZXRhKG0sIGEpKSk7CiAgICAgICAgICAgIHJldHVybiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgb3B0aW1pc3RpYyksIHsgbWV0YTogX19hc3NpZ24oX19hc3NpZ24oe30sIG9wdGltaXN0aWMubWV0YSksIHsgZHJhZnQ6IF9fYXNzaWduKF9fYXNzaWduKHt9LCBvcHRpbWlzdGljLm1ldGEuZHJhZnQpLCB7IGNhbmNlbEJ5OiBub3coKS50b0RhdGUoKSwgY2FuY2VsQnlUdGw6IDMwMDAwIH0pIH0pIH0pOwogICAgICAgIH0sCiAgICB9Owp9Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/api/drafts.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/api/drafts.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable } from 'rxjs';\nimport moment from 'moment';\n\nimport { Draft, Attachment } from '@src/types';\nimport { jsonRequest, blankRequest } from './base';\nimport {\n  defaultDraft,\n  generateOptimisticSendMeta,\n} from '@src/lib/draft';\nimport { createDraft } from '@src/mocks/drafts';\nimport { createAttachment } from '@src/mocks/attachments';\nimport { CloudFileClient } from '@src/api/cloudFile';\nimport { DraftSendMeta, DraftSendOptimisticMeta } from '@src/ducks/drafts';\nimport { now } from '@src/lib/datetime';\n\ntype DraftAPISendMeta = Pick<DraftSendMeta, 'delay' | 'draft' | 'scheduled' >;\nexport interface DraftAPI {\n  get(id: string): Observable<Draft>;\n  list(from?: string): Observable<Draft[]>;\n  listIncr(to?: string): Observable<Draft[]>;\n  update(draft: Draft): Observable<Draft>;\n  create(draft: Draft): Observable<Draft>;\n  delete(draft: string): Observable<null>;\n  send(draft: DraftAPISendMeta, delay?: number): Observable<Draft>;\n  uploadAttachment(\n    draft: string,\n    attachment: string,\n    file: File,\n    inline: boolean,\n    cloud: boolean,\n  ): Observable<Attachment|number>;\n  uploadTemplateAttachment(draft: string, attachment: Attachment): Observable<Attachment>;\n  removeAttachment(draft: string, attachment: string): Observable<null>;\n  applyForwardAttachments(\n    draft: string,\n    thread: string,\n    message: string,\n    account: string,\n  ): Observable<Attachment[]>;\n  sendNow(draft: string): Observable<Draft>;\n  generateOptimistic(draft: DraftSendMeta, attachments: Attachment[]): DraftSendOptimisticMeta;\n}\n\nexport class DraftClient implements DraftAPI {\n  get(id: string): Observable<Draft> {\n    return jsonRequest({\n      method: 'GET',\n      route: `/v1/drafts/${encodeURIComponent(id)}`,\n    })\n    .map(draft => defaultDraft(draft));\n  }\n\n  list(from?: string): Observable<Draft[]> {\n    return jsonRequest({\n      method: 'GET',\n      route: from ? `/v1/drafts?from=${from}` : '/v1/drafts',\n    })\n    .map((drafts: Draft[]) => drafts.map(draft => defaultDraft(draft)));\n  }\n\n  listIncr(to?: string): Observable<Draft[]> {\n    return jsonRequest({\n      method: 'GET',\n      route: to ? `/v1/drafts?to=${to}` : '/v1/drafts',\n    })\n    .map((drafts: Draft[]) => drafts.map(draft => defaultDraft(draft)));\n  }\n\n  update(draft: Draft): Observable<Draft> {\n    return jsonRequest({\n      method: 'PATCH',\n      route: `/v1/drafts/${draft.id}`,\n      body: draft,\n    }).map(newDraft => defaultDraft(newDraft));\n  }\n\n  create(draft: Draft): Observable<Draft> {\n    return jsonRequest({\n      method: 'POST',\n      route: `/v1/drafts`,\n      body: draft,\n    }).map(newDraft => defaultDraft(newDraft));\n  }\n\n  delete(draft: string): Observable<null> {\n    return blankRequest({\n      method: 'DELETE',\n      route: `/v1/drafts/${draft}`,\n    });\n  }\n\n  send(meta: DraftAPISendMeta): Observable<Draft> {\n    interface Body {\n      delay?: number;\n      scheduled?: string;\n    }\n    const body: Body = {};\n    if (meta.delay !== undefined) {\n      body.delay = meta.delay;\n    }\n\n    if (meta.scheduled) {\n      body.scheduled = moment(meta.scheduled).toISOString();\n    }\n\n    return jsonRequest({\n      method: 'POST',\n      route: `/v2/drafts/${meta.draft.id}/send`,\n      body,\n    }).map(newDraft => defaultDraft(newDraft));\n  }\n\n  undoSend(draft: Draft): Observable<Draft> {\n    return jsonRequest({\n      method: 'POST',\n      route: `/v1/drafts/${draft.id}/cancelSend`,\n    }).map(retrieved => defaultDraft(retrieved));\n  }\n\n  uploadAttachment(\n    draft: string,\n    attachment: string,\n    file: File,\n    inline: boolean,\n    cloud: boolean,\n  ): Observable<Attachment|number> {\n    return new CloudFileClient().uploadWithProgress(file)\n      .flatMap((f) => {\n        if (typeof f === 'number') {\n          return Observable.of(f);\n        }\n\n        return jsonRequest({\n          method: 'POST',\n          route: `/v1/drafts/${draft}/attachments`,\n          body: {\n            id: attachment,\n            filename: file.name,\n            ...f,\n            inline,\n            cloud,\n          },\n        });\n      },\n    );\n  }\n\n  uploadTemplateAttachment(\n    draft: string,\n    attachment: Attachment,\n  ): Observable<Attachment> {\n    return jsonRequest({\n      method: 'POST',\n      route: `/v1/drafts/${draft}/attachments`,\n      body: attachment,\n    });\n  }\n\n  removeAttachment(draft: string, attachment: string): Observable<null> {\n    return blankRequest({\n      method: 'DELETE',\n      route: `/v1/drafts/${draft}/attachments/${attachment}`,\n    });\n  }\n\n  applyForwardAttachments(\n    draft: string,\n    thread: string,\n    message: string,\n    account: string,\n  ): Observable<Attachment[]> {\n    return jsonRequest({\n      method: 'POST',\n      route: `/v2/drafts/${draft}/attachments/append`,\n      body: ({ thread, message, account }),\n    });\n  }\n\n  sendNow(\n    draft: string,\n  ): Observable<Draft> {\n    return jsonRequest({\n      method: 'POST',\n      route: `/v1/drafts/${draft}/sendNow`,\n    }).map(d => defaultDraft(d));\n  }\n\n  generateOptimistic(\n    meta: DraftSendMeta,\n    attachments: Attachment[],\n  ): DraftSendOptimisticMeta {\n    return generateOptimisticSendMeta(meta, attachments);\n  }\n}\n\nexport function mockDraftClient(): DraftAPI {\n  return {\n    get: (id: string) => Observable.of(createDraft(id)),\n    list: (from?: string) => Observable.of([]),\n    listIncr: (to?: string) => Observable.of([]),\n    update: (draft: Draft) => Observable.of(draft),\n    create: (draft: Draft) => Observable.of(draft),\n    delete: (draft: string) => Observable.of(null),\n    send: (meta: DraftAPISendMeta) => Observable.of(meta.draft),\n    uploadAttachment: (\n      draft: string,\n      attachment: string,\n      file: File,\n      inline: boolean,\n      cloud: boolean,\n    ) => Observable.of(createAttachment()),\n    uploadTemplateAttachment: (\n      draft: string,\n      attachment: Attachment,\n    ) => Observable.of(attachment),\n    removeAttachment: (draft: string, attachment: string) => Observable.of(null),\n    applyForwardAttachments: (\n      draft: string,\n      thread: string,\n      message: string,\n      account: string,\n    ) => Observable.of([]),\n    sendNow: draft => Observable.of(createDraft()),\n    generateOptimistic: (m, a) => {\n      const optimistic = ({\n        ...generateOptimisticSendMeta(m, a),\n      });\n\n      return {\n        ...optimistic,\n        meta: {\n          ...optimistic.meta,\n          draft: {\n            ...optimistic.meta.draft,\n            cancelBy: now().toDate(),\n            cancelByTtl: 30000,\n          },\n        },\n      };\n    },\n  };\n}\n"]}]}