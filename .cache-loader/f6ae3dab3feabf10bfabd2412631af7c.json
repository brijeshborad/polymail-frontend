{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/ActionDispatcher.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/ActionDispatcher.ts","mtime":1675280254060},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJzsKaW1wb3J0IHsgVEhSRUFEX1VQREFURSwgVEhSRUFEX1NJTkdMRSwgVEhSRUFEX0RFTEVURSwgVEhSRUFEX0xJU1QsIFRIUkVBRFNfU0VBUkNILCBUSFJFQURfTU9WRV9VTkRPLCB9IGZyb20gJ0BzcmMvZHVja3MvdGhyZWFkcyc7CmltcG9ydCB7IERSQUZUX0RFTEVURSwgRFJBRlRfQ1JFQVRFLCBEUkFGVF9VUERBVEUsIERSQUZUX0xJU1QsIERSQUZUX1NFTkQsIERSQUZUX1NFTkRfVU5ETywgfSBmcm9tICdAc3JjL2R1Y2tzL2RyYWZ0cyc7CmltcG9ydCB7IGNvbXB1dGVUaHJlYWQgfSBmcm9tICdAc3JjL2xpYi90aHJlYWQnOwppbXBvcnQgeyBBY3Rpb25TdGF0dXMsIEhpc3RvcnlPYmplY3QgfSBmcm9tICdAc3JjL3R5cGVzJzsKZXhwb3J0IHZhciBBY3Rpb25EaXNwYXRjaGVyVHlwZTsKKGZ1bmN0aW9uIChBY3Rpb25EaXNwYXRjaGVyVHlwZSkgewogICAgQWN0aW9uRGlzcGF0Y2hlclR5cGVbIlNpbmdsZSJdID0gInNpbmdsZSI7CiAgICBBY3Rpb25EaXNwYXRjaGVyVHlwZVsiVXBkYXRlZCJdID0gInVwZGF0ZWQiOwogICAgQWN0aW9uRGlzcGF0Y2hlclR5cGVbIkRlbGV0ZWQiXSA9ICJkZWxldGVkIjsKICAgIEFjdGlvbkRpc3BhdGNoZXJUeXBlWyJCYXRjaCJdID0gImJhdGNoIjsKICAgIEFjdGlvbkRpc3BhdGNoZXJUeXBlWyJVbmRvIl0gPSAidW5kbyI7Cn0pKEFjdGlvbkRpc3BhdGNoZXJUeXBlIHx8IChBY3Rpb25EaXNwYXRjaGVyVHlwZSA9IHt9KSk7Ci8vIEFjdGlvbkRpc3BhdGNoZXIgZW1pdHMgYWN0aW9ucyB0aGF0IGNhbiBiZSBzdWJzY3JpYmVkIHRvIGJ5IGNvbXBvbmVudHMKdmFyIEFjdGlvbkRpc3BhdGNoZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoQWN0aW9uRGlzcGF0Y2hlciwgX3N1cGVyKTsKICAgIGZ1bmN0aW9uIEFjdGlvbkRpc3BhdGNoZXIoKSB7CiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwogICAgfQogICAgcmV0dXJuIEFjdGlvbkRpc3BhdGNoZXI7Cn0oU3ViamVjdCkpOwp2YXIgYWN0aW9uRGlzcGF0Y2hlciA9IG5ldyBBY3Rpb25EaXNwYXRjaGVyKCk7Ci8vIGdldERiIHJldHVybnMgdGhlIGRiIGluc3RhbmNlLCB3aGljaCBtYXkgYmUgdW5kZWZpbmVkCmV4cG9ydCBmdW5jdGlvbiBnZXRBY3Rpb25zKCkgewogICAgcmV0dXJuIGFjdGlvbkRpc3BhdGNoZXI7Cn0KLy8gQWN0aW9uRGlzcGF0Y2hlciBNaWRkbGV3YXJlIHdpbGwgY2F0Y2ggYWN0aW9ucyB0aGF0IHdlIGRvbnQgd2FudCByZWR1eCB0byBoYW5kbGUKLy8gYW5kIHBhc3MgdGhlbSB0byBjb21wb25lbnRzIHRoYXQgc3Vic2NyaWJlIGRpcmVjdGx5CmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBY3Rpb25EaXNwYXRjaGVyTWlkZGxld2FyZSgpIHsKICAgIHJldHVybiBmdW5jdGlvbiAoYXBpKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChuZXh0KSB7CiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgc3RhcnQgY2FzZXMKICAgICAgICAgICAgICAgIGlmIChhY3Rpb24uc3RhdHVzID09PSBBY3Rpb25TdGF0dXMuU3RhcnQpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEhSRUFEX0RFTEVURToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEFjdGlvbnMoKS5uZXh0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYWN0aW9uLm1ldGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uRGlzcGF0Y2hlclR5cGUuRGVsZXRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGU6IEhpc3RvcnlPYmplY3QuVGhyZWFkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBEUkFGVF9ERUxFVEU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRBY3Rpb25zKCkubmV4dCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGFjdGlvbi5tZXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IEFjdGlvbkRpc3BhdGNoZXJUeXBlLkRlbGV0ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlOiBIaXN0b3J5T2JqZWN0LkRyYWZ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUSFJFQURfU0lOR0xFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRocmVhZCA9IGFjdGlvbi5tZXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aW9ucygpLm5leHQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0aHJlYWQuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6IGNvbXB1dGVUaHJlYWQodGhyZWFkKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBBY3Rpb25EaXNwYXRjaGVyVHlwZS5TaW5nbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlOiBIaXN0b3J5T2JqZWN0LlRocmVhZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRFJBRlRfQ1JFQVRFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aW9ucygpLm5leHQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhY3Rpb24ubWV0YS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZTogYWN0aW9uLm1ldGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uRGlzcGF0Y2hlclR5cGUuU2luZ2xlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZTogSGlzdG9yeU9iamVjdC5EcmFmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEhSRUFEX1VQREFURToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21taXQgPSBhY3Rpb24ubWV0YTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEFjdGlvbnMoKS5uZXh0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogY29tbWl0LnJlc291cmNlSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uRGlzcGF0Y2hlclR5cGUuVXBkYXRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21taXQ6IGNvbW1pdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGU6IEhpc3RvcnlPYmplY3QuVGhyZWFkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBzdWNjZXNzIGNhc2VzCiAgICAgICAgICAgICAgICBpZiAoYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgVEhSRUFEX01PVkVfVU5ETzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEFjdGlvbnMoKS5uZXh0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogYWN0aW9uLnBheWxvYWQuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6IGFjdGlvbi5wYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IEFjdGlvbkRpc3BhdGNoZXJUeXBlLlVuZG8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlOiBIaXN0b3J5T2JqZWN0LlRocmVhZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRFJBRlRfU0VORF9VTkRPOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIGRyYWZ0IGJhY2sgdG8gZGF0YXNvdXJjZSB3aGVuIHN1Y2Nlc3NmdWwgdW5kbyBzZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRBY3Rpb25zKCkubmV4dCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGFjdGlvbi5tZXRhLmlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlOiBhY3Rpb24ucGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBBY3Rpb25EaXNwYXRjaGVyVHlwZS5TaW5nbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlOiBIaXN0b3J5T2JqZWN0LkRyYWZ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBEUkFGVF9TRU5EOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aW9ucygpLm5leHQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhY3Rpb24ubWV0YS5kcmFmdC5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZTogYWN0aW9uLm1ldGEuZHJhZnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uRGlzcGF0Y2hlclR5cGUuU2luZ2xlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZTogSGlzdG9yeU9iamVjdC5EcmFmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRFJBRlRfVVBEQVRFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aW9ucygpLm5leHQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhY3Rpb24ubWV0YS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZTogYWN0aW9uLm1ldGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uRGlzcGF0Y2hlclR5cGUuU2luZ2xlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZTogSGlzdG9yeU9iamVjdC5EcmFmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRFJBRlRfREVMRVRFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aW9ucygpLm5leHQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhY3Rpb24ucGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBBY3Rpb25EaXNwYXRjaGVyVHlwZS5EZWxldGVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZTogSGlzdG9yeU9iamVjdC5EcmFmdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVsZXRlIHRocmVhZCBvcHRpbWlzdGljIGlkIGNvbnN0cnVjdGVkIGZyb20gZHJhZnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEFjdGlvbnMoKS5uZXh0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogIjwiICsgYWN0aW9uLnBheWxvYWQgKyAiQHBvbHltYWlsLmlvPiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uRGlzcGF0Y2hlclR5cGUuRGVsZXRlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGU6IEhpc3RvcnlPYmplY3QuVGhyZWFkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUSFJFQURfREVMRVRFOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aW9ucygpLm5leHQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBhY3Rpb24ubWV0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBBY3Rpb25EaXNwYXRjaGVyVHlwZS5EZWxldGVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZTogSGlzdG9yeU9iamVjdC5UaHJlYWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERSQUZUX0xJU1Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRBY3Rpb25zKCkubmV4dCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uRGlzcGF0Y2hlclR5cGUuQmF0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzOiBhY3Rpb24ucGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGU6IEhpc3RvcnlPYmplY3QuRHJhZnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFRIUkVBRFNfU0VBUkNIOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aW9ucygpLm5leHQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IEFjdGlvbkRpc3BhdGNoZXJUeXBlLkJhdGNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlczogYWN0aW9uLnBheWxvYWQudGhyZWFkcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGU6IEhpc3RvcnlPYmplY3QuVGhyZWFkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBUSFJFQURfTElTVDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEFjdGlvbnMoKS5uZXh0KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBBY3Rpb25EaXNwYXRjaGVyVHlwZS5CYXRjaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXM6IGFjdGlvbi5wYXlsb2FkLnRocmVhZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlOiBIaXN0b3J5T2JqZWN0LlRocmVhZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dChhY3Rpb24pOwogICAgICAgICAgICB9OwogICAgICAgIH07CiAgICB9Owp9CmV4cG9ydCBkZWZhdWx0IEFjdGlvbkRpc3BhdGNoZXI7Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/ActionDispatcher.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/ActionDispatcher.ts"],"names":[],"mappings":"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","sourcesContent":["import { Subject } from 'rxjs';\nimport { Dispatch, Middleware, MiddlewareAPI } from 'redux';\nimport {\n  THREAD_UPDATE,\n  THREAD_SINGLE,\n  THREAD_DELETE,\n  THREAD_LIST,\n  THREADS_SEARCH,\n  THREAD_MOVE_UNDO,\n} from '@src/ducks/threads';\nimport {\n  DRAFT_DELETE, DRAFT_CREATE,\n  DRAFT_UPDATE, DRAFT_LIST,\n  DRAFT_SEND,\n  DRAFT_SEND_UNDO,\n} from '@src/ducks/drafts';\nimport { computeThread } from '@src/lib/thread';\n\nimport { StoreState, Commit, ActionStatus, Thread, Draft, HistoryObject } from '@src/types';\n\nexport enum ActionDispatcherType {\n  Single = 'single',\n  Updated = 'updated',\n  Deleted = 'deleted',\n  Batch = 'batch',\n  Undo = 'undo',\n}\n\nexport interface ActionDispatcherEvent {\n  id?: string;\n  type: ActionDispatcherType;\n  resourceType: HistoryObject;\n  resource?: Thread|Draft;\n  commit?: Commit;\n  resources?: Thread[]|Draft[];\n}\n\n// ActionDispatcher emits actions that can be subscribed to by components\nclass ActionDispatcher extends Subject<ActionDispatcherEvent> {}\n\nconst actionDispatcher = new ActionDispatcher();\n\n// getDb returns the db instance, which may be undefined\nexport function getActions(): ActionDispatcher {\n  return actionDispatcher;\n}\n\n// ActionDispatcher Middleware will catch actions that we dont want redux to handle\n// and pass them to components that subscribe directly\nexport function createActionDispatcherMiddleware(): Middleware {\n  return (api: MiddlewareAPI<any>) =>\n    (next: Dispatch<StoreState>) =>\n      (action: any): any => {\n\n        // Handle start cases\n        if (action.status === ActionStatus.Start) {\n          switch (action.type) {\n            case THREAD_DELETE:\n              getActions().next({\n                id: action.meta,\n                type: ActionDispatcherType.Deleted,\n                resourceType: HistoryObject.Thread,\n              });\n              break;\n            case DRAFT_DELETE:\n              getActions().next({\n                id: action.meta,\n                type: ActionDispatcherType.Deleted,\n                resourceType: HistoryObject.Draft,\n              });\n              break;\n            case THREAD_SINGLE:\n              const thread: Thread = action.meta;\n              getActions().next({\n                id: thread.id,\n                resource: computeThread(thread),\n                type: ActionDispatcherType.Single,\n                resourceType: HistoryObject.Thread,\n              });\n              break;\n            case DRAFT_CREATE:\n              getActions().next({\n                id: action.meta.id,\n                resource: action.meta,\n                type: ActionDispatcherType.Single,\n                resourceType: HistoryObject.Draft,\n              });\n              break;\n\n            case THREAD_UPDATE:\n              const commit: Commit = action.meta;\n              getActions().next({\n                id: commit.resourceId,\n                type: ActionDispatcherType.Updated,\n                commit,\n                resourceType: HistoryObject.Thread,\n              });\n              break;\n\n            default:\n              break;\n          }\n        }\n\n        // Handle success cases\n        if (action.status === ActionStatus.Success) {\n          switch (action.type) {\n            case THREAD_MOVE_UNDO:\n              getActions().next({\n                id: action.payload.id,\n                resource: action.payload,\n                type: ActionDispatcherType.Undo,\n                resourceType: HistoryObject.Thread,\n              });\n              break;\n            case DRAFT_SEND_UNDO:\n              // Return draft back to datasource when successful undo send\n              getActions().next({\n                id: action.meta.id,\n                resource: action.payload,\n                type: ActionDispatcherType.Single,\n                resourceType: HistoryObject.Draft,\n              });\n              break;\n            case DRAFT_SEND:\n              getActions().next({\n                id: action.meta.draft.id,\n                resource: action.meta.draft,\n                type: ActionDispatcherType.Single,\n                resourceType: HistoryObject.Draft,\n              });\n              break;\n\n            case DRAFT_UPDATE:\n              getActions().next({\n                id: action.meta.id,\n                resource: action.meta,\n                type: ActionDispatcherType.Single,\n                resourceType: HistoryObject.Draft,\n              });\n              break;\n\n            case DRAFT_DELETE:\n              getActions().next({\n                id: action.payload,\n                type: ActionDispatcherType.Deleted,\n                resourceType: HistoryObject.Draft,\n              });\n\n              // Delete thread optimistic id constructed from draft\n              getActions().next({\n                id: `<${action.payload}@polymail.io>`,\n                type: ActionDispatcherType.Deleted,\n                resourceType: HistoryObject.Thread,\n              });\n              break;\n            case THREAD_DELETE:\n              getActions().next({\n                id: action.meta,\n                type: ActionDispatcherType.Deleted,\n                resourceType: HistoryObject.Thread,\n              });\n              break;\n            case DRAFT_LIST:\n              getActions().next({\n                type: ActionDispatcherType.Batch,\n                resources: action.payload,\n                resourceType: HistoryObject.Draft,\n              });\n              break;\n            case THREADS_SEARCH:\n              getActions().next({\n                type: ActionDispatcherType.Batch,\n                resources: action.payload.threads,\n                resourceType: HistoryObject.Thread,\n              });\n              break;\n            case THREAD_LIST:\n              getActions().next({\n                type: ActionDispatcherType.Batch,\n                resources: action.payload.threads,\n                resourceType: HistoryObject.Thread,\n              });\n              break;\n\n            default:\n              break;\n          }\n        }\n        return next(action);\n      };\n}\n\nexport default ActionDispatcher;\n"]}]}