{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/sync/MessageBodiesIncrSync.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/sync/MessageBodiesIncrSync.ts","mtime":1675280254125},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CmltcG9ydCBDYWNoZSwgeyBTdG9yZXMgfSBmcm9tICdAc3JjL2xpYi9kYic7CmltcG9ydCB7IE1lc3NhZ2VCb2RpZXNDbGllbnQgfSBmcm9tICdAc3JjL2FwaS9tZXNzYWdlQm9kaWVzJzsKaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBBUElTeW5jIH0gZnJvbSAnLi9BUElTeW5jJzsKaW1wb3J0IHsgc2F2ZUJvZGllcywgfSBmcm9tICdAc3JjL2xpYi9zZWFyY2hEYic7CmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JzsKZXhwb3J0IHZhciBsaXN0TWVzc2FnZUJvZGllc1BhZ2VTaXplID0gMjUwOwp2YXIgTWVzc2FnZUJvZGllc0luY3JTeW5jID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgX19leHRlbmRzKE1lc3NhZ2VCb2RpZXNJbmNyU3luYywgX3N1cGVyKTsKICAgIGZ1bmN0aW9uIE1lc3NhZ2VCb2RpZXNJbmNyU3luYyhhcGkpIHsKICAgICAgICBpZiAoYXBpID09PSB2b2lkIDApIHsgYXBpID0gbmV3IE1lc3NhZ2VCb2RpZXNDbGllbnQoKTsgfQogICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsICdNZXNzYWdlQm9kaWVzSW5jclN5bmMtJywgU3RvcmVzLk1lc3NhZ2VCb2RpZXMsIHRydWUpIHx8IHRoaXM7CiAgICAgICAgX3RoaXMuYXBpID0gYXBpOwogICAgICAgIHJldHVybiBfdGhpczsKICAgIH0KICAgIE1lc3NhZ2VCb2RpZXNJbmNyU3luYy5wcm90b3R5cGUuc2F2ZUNhY2hlID0gZnVuY3Rpb24gKGJvZGllcykgewogICAgICAgIHJldHVybiBDYWNoZS5sb2FkKHRoaXMuc3RvcmVOYW1lLCBib2RpZXMpCiAgICAgICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNhdmVCb2RpZXMoYm9kaWVzKTsgfSk7CiAgICB9OwogICAgTWVzc2FnZUJvZGllc0luY3JTeW5jLnByb3RvdHlwZS5iZWZvcmVGaXJzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihudWxsKTsKICAgIH07CiAgICBNZXNzYWdlQm9kaWVzSW5jclN5bmMucHJvdG90eXBlLmZldGNoTmV4dFBhZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuYXBpLmxpc3RJbmNyKHRoaXMub2Zmc2V0KTsKICAgIH07CiAgICBNZXNzYWdlQm9kaWVzSW5jclN5bmMucHJvdG90eXBlLm5leHRQYWdlT2Zmc2V0ID0gZnVuY3Rpb24gKG1vZGVscykgewogICAgICAgIHJldHVybiBtb21lbnQobW9kZWxzWzBdLnVwZGF0ZWQpLnRvSVNPU3RyaW5nKCk7CiAgICB9OwogICAgTWVzc2FnZUJvZGllc0luY3JTeW5jLnByb3RvdHlwZS5pc0NvbXBsZXRlZCA9IGZ1bmN0aW9uIChtb2RlbHMpIHsKICAgICAgICByZXR1cm4gIW1vZGVscy5sZW5ndGg7CiAgICB9OwogICAgcmV0dXJuIE1lc3NhZ2VCb2RpZXNJbmNyU3luYzsKfShBUElTeW5jKSk7CmV4cG9ydCB7IE1lc3NhZ2VCb2RpZXNJbmNyU3luYyB9OwpleHBvcnQgZGVmYXVsdCBNZXNzYWdlQm9kaWVzSW5jclN5bmM7Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/sync/MessageBodiesIncrSync.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/worker/sync/MessageBodiesIncrSync.ts"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,OAAO,KAAK,EAAE,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AAE5C,OAAO,EAAoB,mBAAmB,EAAE,MAAM,wBAAwB,CAAC;AAC/E,OAAO,EAAE,UAAU,EAAE,MAAM,MAAM,CAAC;AAClC,OAAO,EAAE,OAAO,EAAE,MAAM,WAAW,CAAC;AACpC,OAAO,EACL,UAAU,GACX,MAAM,mBAAmB,CAAC;AAC3B,OAAO,MAAM,MAAM,QAAQ,CAAC;AAE5B,MAAM,CAAC,IAAM,yBAAyB,GAAG,GAAG,CAAC;AAE7C;IAA2C,yCAAoB;IAO7D,+BAAY,GAAiD;QAAjD,oBAAA,EAAA,UAA4B,mBAAmB,EAAE;QAA7D,YACE,kBAAM,wBAAwB,EAAE,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC,SAE5D;QADC,KAAI,CAAC,GAAG,GAAG,GAAG,CAAC;;IACjB,CAAC;IAES,yCAAS,GAAnB,UAAoB,MAAqB;QACvC,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC;aACtC,OAAO,CAAC,cAAM,OAAA,UAAU,CAAC,MAAM,CAAC,EAAlB,CAAkB,CAAC,CAAC;IACvC,CAAC;IAES,2CAAW,GAArB;QACE,OAAO,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;IAC7B,CAAC;IAES,6CAAa,GAAvB;QACE,OAAO,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACxC,CAAC;IAES,8CAAc,GAAxB,UAAyB,MAAqB;QAC5C,OAAO,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC;IACjD,CAAC;IAES,2CAAW,GAArB,UAAsB,MAAqB;QACzC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC;IACxB,CAAC;IACH,4BAAC;AAAD,CAAC,AAhCD,CAA2C,OAAO,GAgCjD;;AAED,eAAe,qBAAqB,CAAC","sourcesContent":["import Cache, { Stores } from '@src/lib/db';\nimport { MessageBody } from '@src/types';\nimport { MessageBodiesAPI, MessageBodiesClient } from '@src/api/messageBodies';\nimport { Observable } from 'rxjs';\nimport { APISync } from './APISync';\nimport {\n  saveBodies,\n} from '@src/lib/searchDb';\nimport moment from 'moment';\n\nexport const listMessageBodiesPageSize = 250;\n\nexport class MessageBodiesIncrSync extends APISync<MessageBody> {\n\n  // State\n  account: string;\n\n  private api: MessageBodiesAPI;\n\n  constructor(api: MessageBodiesAPI = new MessageBodiesClient()) {\n    super('MessageBodiesIncrSync-', Stores.MessageBodies, true);\n    this.api = api;\n  }\n\n  protected saveCache(bodies: MessageBody[]): Observable<any> {\n    return Cache.load(this.storeName, bodies)\n      .flatMap(() => saveBodies(bodies));\n  }\n\n  protected beforeFirst(): Observable<null> {\n    return Observable.of(null);\n  }\n\n  protected fetchNextPage(): Observable<MessageBody[]> {\n    return this.api.listIncr(this.offset);\n  }\n\n  protected nextPageOffset(models: MessageBody[]): string {\n    return moment(models[0].updated).toISOString();\n  }\n\n  protected isCompleted(models: MessageBody[]): boolean {\n    return !models.length;\n  }\n}\n\nexport default MessageBodiesIncrSync;\n"]}]}