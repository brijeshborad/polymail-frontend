{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/components/Composer/components/CommentEditor/CommentEditor.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/components/Composer/components/CommentEditor/CommentEditor.tsx","mtime":1675280254041},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHsKICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7CiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkKICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgIH07CiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfTsKaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JzsKaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7CmltcG9ydCBkcmFmdFRvSHRtbCBmcm9tICdkcmFmdGpzLXRvLWh0bWwnOwppbXBvcnQgeyBjb252ZXJ0VG9SYXcsIEVkaXRvciwgRWRpdG9yU3RhdGUsIE1vZGlmaWVyLCBDb21wb3NpdGVEZWNvcmF0b3IsIGdldERlZmF1bHRLZXlCaW5kaW5nLCB9IGZyb20gJ2RyYWZ0LWpzJzsKaW1wb3J0ICcuL0NvbW1lbnRFZGl0b3Iuc2Nzcyc7CmltcG9ydCB7IEtleUNvZGUgfSBmcm9tICdAc3JjL3R5cGVzJzsKaW1wb3J0IFRlYW1NZW1iZXJQb3BvdmVyLCB7IFRlYW1NZW1iZXJQb3BvdmVySXRlbVR5cGUsIH0gZnJvbSAnLi9UZWFtTWVtYmVyUG9wb3Zlci9UZWFtTWVtYmVyUG9wb3Zlcic7CmltcG9ydCBNZW50aW9uVG9rZW4gZnJvbSAnLi9NZW50aW9uVG9rZW4nOwppbXBvcnQgeyBkZWJvdW5jZSwgaXNFcXVhbCwgdmFsdWVzLCBjbG9uZURlZXAsIHRocm90dGxlIH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IE1lbnRpb25zIGZyb20gJ0BzcmMvY29tcG9uZW50cy9JY29ucy9NZW50aW9ucy5zdmcnOwppbXBvcnQgeyBGYWtlRE9NIH0gZnJvbSAnQHNyYy9saWIvaHRtbCc7CmltcG9ydCBVcGxvYWRCdXR0b24gZnJvbSAnQHNyYy9jb21wb25lbnRzL0Jhc2UvVXBsb2FkQnV0dG9uJzsKaW1wb3J0IHsgbW9uZ29JZCB9IGZyb20gJ0BzcmMvbGliL2NyeXB0JzsKaW1wb3J0IEF0dGFjaG1lbnRDZWxsIGZyb20gJ0BzcmMvY29tcG9uZW50cy9Db21wb3NlL0F0dGFjaG1lbnRzL0F0dGFjaG1lbnRDZWxsJzsKaW1wb3J0IHsgZmlsZW5hbWVJY29uVXJsIH0gZnJvbSAnQHNyYy9saWIvYXR0YWNobWVudCc7CmltcG9ydCBGaWxlRHJvcFpvbmUgZnJvbSAnQHNyYy9jb21wb25lbnRzL0NvbXBvc2UvRmlsZURyb3Bab25lJzsKaW1wb3J0IHsgaXNFbWFpbCB9IGZyb20gJ0BzcmMvbGliL3NlYXJjaCc7CmltcG9ydCBDb21tZW50Q29uZmlybWF0aW9uUG9wb3ZlciBmcm9tICcuL0NvbW1lbnRDb25maXJtYXRpb25Qb3BvdmVyJzsKaW1wb3J0IHsgUElOR19JTlRFUlZBTCB9IGZyb20gJ0BzcmMvZHVja3Mvc2hhcmVkVGhyZWFkcyc7CmltcG9ydCB7IFNoYXJlZFRocmVhZEFjdGl2aXR5VHlwZSB9IGZyb20gJ0BzcmMvdHlwZXMvc2hhcmVkVGhyZWFkcyc7CmltcG9ydCB7IENsb3VkRmlsZUNsaWVudCB9IGZyb20gJ0BzcmMvYXBpL2Nsb3VkRmlsZSc7CmltcG9ydCBDb25maXJtIGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL0NvbmZpcm0nOwppbXBvcnQgeyB1cGxvYWRFcnJvck1lc3NhZ2UgfSBmcm9tICdAc3JjL2xpYi9maWxlcyc7CmltcG9ydCB7IEFtcGxpdHVkZUV2ZW50cywgbG9nQW1wbGl0dWRlRXZlbnQgfSBmcm9tICdAc3JjL2xpYi9hbXBsaXR1ZGUtYW5hbHl0aWNzJzsKdmFyIENvbW1lbnRFZGl0b3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoQ29tbWVudEVkaXRvciwgX3N1cGVyKTsKICAgIGZ1bmN0aW9uIENvbW1lbnRFZGl0b3IocHJvcHMpIHsKICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpczsKICAgICAgICBfdGhpcy5nZXRNYXRjaGVkVGVhbU1lbWJlclBvcG92ZXJJdGVtID0gZnVuY3Rpb24gKHRlYW1NZW1iZXJzLCBjb250YWN0cywgcXVlcnkpIHsKICAgICAgICAgICAgaWYgKHF1ZXJ5ID09PSB2b2lkIDApIHsgcXVlcnkgPSAnJzsgfQogICAgICAgICAgICB2YXIgbG93ZXJjYXNlUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICB2YXIgbWF0Y2hlZFRlYW1NZW1iZXJzID0gdGVhbU1lbWJlcnMKICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHRtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdG0uZmlyc3ROYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChsb3dlcmNhc2VRdWVyeSkgfHwKICAgICAgICAgICAgICAgICAgICB0bS5sYXN0TmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgobG93ZXJjYXNlUXVlcnkpIHx8CiAgICAgICAgICAgICAgICAgICAgdG0uZW1haWwudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKGxvd2VyY2FzZVF1ZXJ5KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHRtKSB7IHJldHVybiAoewogICAgICAgICAgICAgICAgcGhvdG9Vcmw6IHRtLnBob3RvVXJsLAogICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0bS5maXJzdE5hbWUsCiAgICAgICAgICAgICAgICBsYXN0TmFtZTogdG0ubGFzdE5hbWUsCiAgICAgICAgICAgICAgICBlbWFpbDogdG0uZW1haWwsCiAgICAgICAgICAgICAgICBpZDogdG0uaWQsCiAgICAgICAgICAgICAgICB0eXBlOiBUZWFtTWVtYmVyUG9wb3Zlckl0ZW1UeXBlLlRlYW1NZW1iZXIsCiAgICAgICAgICAgIH0pOyB9KTsKICAgICAgICAgICAgdmFyIHRlYW1NZW1iZXJFbWFpbHMgPSB0ZWFtTWVtYmVycy5tYXAoZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHQuZW1haWwudG9Mb3dlckNhc2UoKTsgfSk7CiAgICAgICAgICAgIHZhciBtYXRjaGVkQ29udGFjdHMgPSBjb250YWN0cwogICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYykgewogICAgICAgICAgICAgICAgcmV0dXJuIHRlYW1NZW1iZXJFbWFpbHMuaW5kZXhPZihjLmVtYWlsLnRvTG93ZXJDYXNlKCkpID09PSAtMSAmJgogICAgICAgICAgICAgICAgICAgIChjLmdpdmVuTmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgobG93ZXJjYXNlUXVlcnkpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZmFtaWx5TmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgobG93ZXJjYXNlUXVlcnkpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIGMuZW1haWwudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKGxvd2VyY2FzZVF1ZXJ5KSk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChjKSB7IHJldHVybiAoewogICAgICAgICAgICAgICAgcGhvdG9Vcmw6IGMucGhvdG9VcmwsCiAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IGMuZ2l2ZW5OYW1lLAogICAgICAgICAgICAgICAgbGFzdE5hbWU6IGMuZmFtaWx5TmFtZSwKICAgICAgICAgICAgICAgIGVtYWlsOiBjLmVtYWlsLAogICAgICAgICAgICAgICAgaWQ6IGMuaWQsCiAgICAgICAgICAgICAgICB0eXBlOiBUZWFtTWVtYmVyUG9wb3Zlckl0ZW1UeXBlLkNvbnRhY3QsCiAgICAgICAgICAgIH0pOyB9KTsKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZWRUZWFtTWVtYmVycy5jb25jYXQobWF0Y2hlZENvbnRhY3RzKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUNsaWNrID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIGVkaXRvclN0YXRlID0gX3RoaXMuc3RhdGUuZWRpdG9yU3RhdGU7CiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIGlmICghZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKS5nZXRQbGFpblRleHQoKSkgewogICAgICAgICAgICAgICAgX3RoaXMuZWRpdG9yLmZvY3VzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUJsdXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZm9jdXNlZDogZmFsc2UgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5mb2N1cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKF90aGlzLmVkaXRvcikgewogICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KF90aGlzLnRpbWVvdXQpOwogICAgICAgICAgICAgICAgX3RoaXMudGltZW91dCA9IGdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yU3RhdGUgPSBfdGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZTsKICAgICAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZSA9IEVkaXRvclN0YXRlLm1vdmVGb2N1c1RvRW5kKGVkaXRvclN0YXRlKTsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlOiBlZGl0b3JTdGF0ZSwKICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5oYW5kbGVGb2N1cygpOyB9KTsKICAgICAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVGb2N1cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMuc3RhdGUsIG1hdGNoZWRUZWFtTWVtYmVycyA9IF9hLm1hdGNoZWRUZWFtTWVtYmVycywgcXVlcnkgPSBfYS5xdWVyeTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBmb2N1c2VkOiB0cnVlIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmIChxdWVyeSAhPT0gdW5kZWZpbmVkICYmIG1hdGNoZWRUZWFtTWVtYmVycy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyU2hvd0RlYm91bmNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoX3RoaXMucHJvcHMub25Gb2N1cykgewogICAgICAgICAgICAgICAgX3RoaXMucHJvcHMub25Gb2N1cygpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVFZGl0b3JDaGFuZ2UgPSBmdW5jdGlvbiAoZWRpdG9yU3RhdGUpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIHRlYW1NZW1iZXJzID0gX2EudGVhbU1lbWJlcnMsIGNvbnRhY3RzID0gX2EuY29udGFjdHM7CiAgICAgICAgICAgIHZhciBibG9jayA9IGVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkuZ2V0TGFzdEJsb2NrKCk7CiAgICAgICAgICAgIHZhciB0ZXh0ID0gYmxvY2suZ2V0VGV4dCgpOwogICAgICAgICAgICB2YXIgb2xkVGV4dCA9IF90aGlzLnN0YXRlLmVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkuZ2V0TGFzdEJsb2NrKCkuZ2V0VGV4dCgpOwogICAgICAgICAgICB2YXIgc2FtZVRleHQgPSB0ZXh0ID09PSBvbGRUZXh0OwogICAgICAgICAgICB2YXIgcXVlcnk7CiAgICAgICAgICAgIHZhciBzZWxlY3Rpb25TdGF0ZSA9IGVkaXRvclN0YXRlLmdldFNlbGVjdGlvbigpOwogICAgICAgICAgICB2YXIgc3RhcnQgPSBzZWxlY3Rpb25TdGF0ZS5nZXRTdGFydE9mZnNldCgpIC0gMTsKICAgICAgICAgICAgd2hpbGUgKCh0ZXh0LmNoYXJBdChzdGFydCkgIT09ICdAJyAmJiAhdGV4dC5jaGFyQXQoc3RhcnQpLm1hdGNoKC9ccy8pKSAmJiBzdGFydCA+IDApIHsKICAgICAgICAgICAgICAgIHN0YXJ0IC09IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRleHQuY2hhckF0KHN0YXJ0KSA9PT0gJ0AnKSB7CiAgICAgICAgICAgICAgICB2YXIgZW5kID0gc3RhcnQ7CiAgICAgICAgICAgICAgICBxdWVyeSA9ICcnOwogICAgICAgICAgICAgICAgd2hpbGUgKCF0ZXh0LmNoYXJBdChlbmQpLm1hdGNoKC9ccy8pICYmIGVuZCA8IHRleHQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZW5kICs9IDE7CiAgICAgICAgICAgICAgICAgICAgcXVlcnkgKz0gdGV4dC5jaGFyQXQoZW5kKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocXVlcnkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcXVlcnkgPSBxdWVyeS50cmltKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIG1hdGNoZWRUZWFtTWVtYmVycyA9IF90aGlzLmdldE1hdGNoZWRUZWFtTWVtYmVyUG9wb3Zlckl0ZW0odGVhbU1lbWJlcnMsIGNvbnRhY3RzLCBxdWVyeSk7CiAgICAgICAgICAgIGlmIChtYXRjaGVkVGVhbU1lbWJlcnMubGVuZ3RoICYmICFzYW1lVGV4dCAmJiBxdWVyeSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyU2hvd0RlYm91bmNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoX3RoaXMuc3RhdGUucG9wb3ZlclNob3duKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyU2hvd0RlYm91bmNlLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgX3RoaXMucG9wb3Zlci5oaWRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRleHQpIHsKICAgICAgICAgICAgICAgIF90aGlzLnJlY29yZFR5cGluZygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlOiBlZGl0b3JTdGF0ZSwKICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICAgIG1hdGNoZWRUZWFtTWVtYmVyczogbWF0Y2hlZFRlYW1NZW1iZXJzLAogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBpZiAoZWRpdG9yU3RhdGUuZ2V0U2VsZWN0aW9uKCkuZ2V0SGFzRm9jdXMoKSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLmVkaXRvci5mb2N1cygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVJlZiA9IGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgX3RoaXMucG9wb3ZlciA9IHJlZjsKICAgICAgICB9OwogICAgICAgIF90aGlzLmdldE5hbWUgPSBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBpZiAoaXRlbS5maXJzdE5hbWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoaXRlbS5maXJzdE5hbWUgKyAiICIgKyBpdGVtLmxhc3ROYW1lKS50cmltKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZW1haWw7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVTdHJhdGVneSA9IGZ1bmN0aW9uIChjb250ZW50QmxvY2ssIGNhbGxiYWNrLCBjb250ZW50U3RhdGUpIHsKICAgICAgICAgICAgY29udGVudEJsb2NrLmZpbmRFbnRpdHlSYW5nZXMoZnVuY3Rpb24gKGNoYXJhY3RlcikgewogICAgICAgICAgICAgICAgdmFyIGVudGl0eUtleSA9IGNoYXJhY3Rlci5nZXRFbnRpdHkoKTsKICAgICAgICAgICAgICAgIGlmIChlbnRpdHlLZXkgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY29udGVudFN0YXRlLmdldEVudGl0eShlbnRpdHlLZXkpLmdldFR5cGUoKSA9PT0gJ01FTlRJT04nOwogICAgICAgICAgICB9LCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5pbnNlcnRTcGFjZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNwYWNlQ2hhcmFjdGVyID0gJyAnOwogICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gX3RoaXMuc3RhdGUuZWRpdG9yU3RhdGU7CiAgICAgICAgICAgIHZhciBuZXdDb250ZW50U3RhdGUgPSBNb2RpZmllci5yZXBsYWNlVGV4dChjdXJyZW50U3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKSwgY3VycmVudFN0YXRlLmdldFNlbGVjdGlvbigpLCBzcGFjZUNoYXJhY3Rlcik7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlOiBFZGl0b3JTdGF0ZS5wdXNoKGN1cnJlbnRTdGF0ZSwgbmV3Q29udGVudFN0YXRlLCAnaW5zZXJ0LWNoYXJhY3RlcnMnKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVTZWxlY3QgPSBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICB2YXIgZWRpdG9yU3RhdGUgPSBfdGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZTsKICAgICAgICAgICAgdmFyIHRleHQgPSBlZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpLmdldExhc3RCbG9jaygpLmdldFRleHQoKTsKICAgICAgICAgICAgdmFyIHNlbGVjdGlvblN0YXRlID0gZWRpdG9yU3RhdGUuZ2V0U2VsZWN0aW9uKCk7CiAgICAgICAgICAgIHZhciBzdGFydCA9IHNlbGVjdGlvblN0YXRlLmdldFN0YXJ0T2Zmc2V0KCk7CiAgICAgICAgICAgIHZhciBlbmQgPSBzZWxlY3Rpb25TdGF0ZS5nZXRFbmRPZmZzZXQoKTsKICAgICAgICAgICAgd2hpbGUgKHRleHQuY2hhckF0KHN0YXJ0KSAhPT0gJ0AnICYmIHN0YXJ0ID4gMCkgewogICAgICAgICAgICAgICAgc3RhcnQgLT0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxlY3Rpb25TdGF0ZSA9IHNlbGVjdGlvblN0YXRlLm1lcmdlKHsKICAgICAgICAgICAgICAgIGFuY2hvck9mZnNldDogc3RhcnQsCiAgICAgICAgICAgICAgICBmb2N1c09mZnNldDogZW5kLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGNvbnRlbnRTdGF0ZSA9IGVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkuY3JlYXRlRW50aXR5KCdNRU5USU9OJywgJ0lNTVVUQUJMRScsIHsKICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnR5cGUgPT09IFRlYW1NZW1iZXJQb3BvdmVySXRlbVR5cGUuVGVhbU1lbWJlciA/IGl0ZW0uaWQgOiBpdGVtLmVtYWlsLAogICAgICAgICAgICAgICAgaWQ6IGl0ZW0uaWQsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb250ZW50U3RhdGUgPSBNb2RpZmllci5yZXBsYWNlVGV4dChlZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpLCBzZWxlY3Rpb25TdGF0ZSwgIkAiICsgX3RoaXMuZ2V0TmFtZShpdGVtKSwgdW5kZWZpbmVkLCBjb250ZW50U3RhdGUuZ2V0TGFzdENyZWF0ZWRFbnRpdHlLZXkoKSk7CiAgICAgICAgICAgIGVkaXRvclN0YXRlID0gRWRpdG9yU3RhdGUucHVzaChlZGl0b3JTdGF0ZSwgY29udGVudFN0YXRlLCAnYXBwbHktZW50aXR5Jyk7CiAgICAgICAgICAgIGVkaXRvclN0YXRlID0gRWRpdG9yU3RhdGUuc2V0KGVkaXRvclN0YXRlLCB7IGRlY29yYXRvcjogX3RoaXMuY29tcG9zaXRlRGVjb3JhdG9yIH0pOwogICAgICAgICAgICBfdGhpcy5wb3BvdmVyU2hvd0RlYm91bmNlLmNhbmNlbCgpOwogICAgICAgICAgICBfdGhpcy5wb3BvdmVyLmhpZGUoKTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgZWRpdG9yU3RhdGU6IGVkaXRvclN0YXRlLAogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5lZGl0b3IuZm9jdXMoKTsKICAgICAgICAgICAgICAgIF90aGlzLmluc2VydFNwYWNlKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlRWRpdG9yUmVmID0gZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICBfdGhpcy5lZGl0b3IgPSByZWY7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5hdE1lbnRpb24gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUucXVlcnkgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgdmFyIGVkaXRvclN0YXRlID0gX3RoaXMuc3RhdGUuZWRpdG9yU3RhdGU7CiAgICAgICAgICAgIHZhciB0ZXh0ID0gZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKS5nZXRQbGFpblRleHQoKTsKICAgICAgICAgICAgdmFyIGluc2VydCA9ICdAJzsKICAgICAgICAgICAgaWYgKHRleHQgJiYgIXRleHQuZW5kc1dpdGgoJyAnKSkgewogICAgICAgICAgICAgICAgaW5zZXJ0ID0gJyBAJzsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgY29udGVudFN0YXRlID0gTW9kaWZpZXIuaW5zZXJ0VGV4dChlZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpLCBlZGl0b3JTdGF0ZS5nZXRTZWxlY3Rpb24oKSwgaW5zZXJ0KTsKICAgICAgICAgICAgdmFyIG5ld0VkaXRvclN0YXRlID0gRWRpdG9yU3RhdGUucHVzaChlZGl0b3JTdGF0ZSwgY29udGVudFN0YXRlLCAnaW5zZXJ0LWNoYXJhY3RlcnMnKTsKICAgICAgICAgICAgbmV3RWRpdG9yU3RhdGUgPSBFZGl0b3JTdGF0ZS5zZXQobmV3RWRpdG9yU3RhdGUsIHsgZGVjb3JhdG9yOiBfdGhpcy5jb21wb3NpdGVEZWNvcmF0b3IgfSk7CiAgICAgICAgICAgIF90aGlzLmVkaXRvci5mb2N1cygpOwogICAgICAgICAgICBfdGhpcy5wb3BvdmVyU2hvd0RlYm91bmNlKCk7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlOiBuZXdFZGl0b3JTdGF0ZSwKICAgICAgICAgICAgICAgIHF1ZXJ5OiAnJywKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVLZXlCaW5kaW5nID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgS2V5Q29kZS5FbnRlcjoKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUucG9wb3ZlclNob3duKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnc2VsZWN0LW1lbWJlcic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5vdXRzaWRlTWVudGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnY29tbWVudC1jb25maXJtJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFlLnNoaWZ0S2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnY29tbWVudCc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBLZXlDb2RlLkVzYzogewogICAgICAgICAgICAgICAgICAgIHZhciBoYW5kbGVkID0gX3RoaXMuaGFuZGxlRXNjYXBlKGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAncG0tZXNjYXBlJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGUuVXA6IHsKICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlZCA9IF90aGlzLmhhbmRsZVVwQXJyb3coZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdwbS11cC1hcnJvdyc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2FzZSBLZXlDb2RlLkRvd246IHsKICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlZCA9IF90aGlzLmhhbmRsZURvd25BcnJvdyhlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZGxlZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3BtLWRvd24tYXJyb3cnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgS2V5Q29kZS5UYWI6IHsKICAgICAgICAgICAgICAgICAgICB2YXIgaGFuZGxlZCA9IF90aGlzLmhhbmRsZVRhYihlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZGxlZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3BtLXRhYic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZ2V0RGVmYXVsdEtleUJpbmRpbmcoZSk7CiAgICAgICAgfTsKICAgICAgICAvLyBUT0RPKFNISU4pOiBVcGRhdGUgd2hlbiBjb21tZW50IGF0dGFjaG1lbnRzIGFyZSBhYnN0cmFjdGVkIHRvIHJlZHV4IHN0YXRlCiAgICAgICAgX3RoaXMuaGFuZGxlS2V5Q29tbWFuZCA9IGZ1bmN0aW9uIChjb21tYW5kKSB7CiAgICAgICAgICAgIHZhciBjb21tZW50ID0gX3RoaXMucHJvcHMuY29tbWVudDsKICAgICAgICAgICAgaWYgKGNvbW1hbmQgPT09ICdjb21tZW50JykgewogICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBfdGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpOwogICAgICAgICAgICAgICAgLy8gcmVuZGVyIGVtcHR5CiAgICAgICAgICAgICAgICBpZiAoIWNvbnRlbnQuZ2V0UGxhaW5UZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ25vdC1oYW5kbGVkJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciBodG1sID0gZHJhZnRUb0h0bWwoY29udmVydFRvUmF3KGNvbnRlbnQpKTsKICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBGYWtlRE9NKCkuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKICAgICAgICAgICAgICAgIHZhciBtZW50aW9ucyA9IGNvbnRhaW5lci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd3eXNpd3lnLW1lbnRpb24nKTsKICAgICAgICAgICAgICAgIHZhciBzcGFuXzE7CiAgICAgICAgICAgICAgICB2YXIgaWRlbnRpZmllcl8xOwogICAgICAgICAgICAgICAgdmFyIG91dHNpZGVNZW50aW9uc18xID0gW107CiAgICAgICAgICAgICAgICBsb2dBbXBsaXR1ZGVFdmVudChBbXBsaXR1ZGVFdmVudHMuQ29tbWVudE9uRW1haWwpOwogICAgICAgICAgICAgICAgaWYgKG1lbnRpb25zLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIGxvZ0FtcGxpdHVkZUV2ZW50KEFtcGxpdHVkZUV2ZW50cy5NZW50aW9uVGVhbU9uRW1haWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQXJyYXkuZnJvbShtZW50aW9ucykuZm9yRWFjaChmdW5jdGlvbiAobSkgewogICAgICAgICAgICAgICAgICAgIHNwYW5fMSA9IEZha2VET00oKS5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICAgICAgaWRlbnRpZmllcl8xID0gbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmFsdWUnKTsKICAgICAgICAgICAgICAgICAgICBzcGFuXzEuaW5uZXJIVE1MID0gbS5pbm5lckhUTUw7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlkZW50aWZpZXJfMSAmJiBpc0VtYWlsKGlkZW50aWZpZXJfMSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3Bhbl8xLnNldEF0dHJpYnV0ZSgnZGF0YS1wbS1lbWFpbCcsIGlkZW50aWZpZXJfMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHNpZGVNZW50aW9uc18xLnB1c2goaWRlbnRpZmllcl8xKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaWRlbnRpZmllcl8xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwYW5fMS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcG0tdXNlcicsIGlkZW50aWZpZXJfMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChtLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChzcGFuXzEsIG0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYgKG91dHNpZGVNZW50aW9uc18xLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0c2lkZU1lbnRpb25zOiBvdXRzaWRlTWVudGlvbnNfMSwKICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogY29udGFpbmVyLmlubmVySFRNTCwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2hhbmRsZWQnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gVE9ETyhTSElOKTogVXBkYXRlIHdoZW4gY29tbWVudCBhdHRhY2htZW50cyBhcmUgYWJzdHJhY3RlZCB0byByZWR1eCBzdGF0ZQogICAgICAgICAgICAgICAgdmFyIGF0dGFjaG1lbnRzID0gdmFsdWVzKF90aGlzLnN0YXRlLmF0dGFjaG1lbnRzKTsKICAgICAgICAgICAgICAgIGNvbW1lbnQoY29udGFpbmVyLmlubmVySFRNTCwgYXR0YWNobWVudHMpOwogICAgICAgICAgICAgICAgaWYgKGF0dGFjaG1lbnRzLmZpbHRlcihmdW5jdGlvbiAoYXR0YWNobWVudCkgeyByZXR1cm4gYXR0YWNobWVudC5wcm9ncmVzcyA8IDE7IH0pLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2hhbmRsZWQnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlOiBFZGl0b3JTdGF0ZS5jcmVhdGVFbXB0eSgpLAogICAgICAgICAgICAgICAgICAgIGZvY3VzZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRzOiB7fSwKICAgICAgICAgICAgICAgIH0sIF90aGlzLmVkaXRvci5ibHVyKTsKICAgICAgICAgICAgICAgIHJldHVybiAnaGFuZGxlZCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvbW1hbmQgPT09ICdjb21tZW50LWNvbmZpcm0nKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVDb25maXJtKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gJ2hhbmRsZWQnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb21tYW5kID09PSAnc2VsZWN0LW1lbWJlcicpIHsKICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXIuc2VsZWN0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gJ2hhbmRsZWQnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEhhbmRsZSBjdXN0b20ga2V5IGNvbW1hbmRzCiAgICAgICAgICAgIHN3aXRjaCAoY29tbWFuZCkgewogICAgICAgICAgICAgICAgY2FzZSAncG0tdGFiJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3BtLXVwLWFycm93JzoKICAgICAgICAgICAgICAgIGNhc2UgJ3BtLWRvd24tYXJyb3cnOgogICAgICAgICAgICAgICAgY2FzZSAncG0tZXNjYXBlJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ2hhbmRsZWQnOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJ25vdC1oYW5kbGVkJzsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUNvbmZpcm0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjb21tZW50ID0gX3RoaXMucHJvcHMuY29tbWVudDsKICAgICAgICAgICAgdmFyIGJvZHkgPSBfdGhpcy5zdGF0ZS5ib2R5OwogICAgICAgICAgICB2YXIgYXR0YWNobWVudHMgPSB2YWx1ZXMoX3RoaXMuc3RhdGUuYXR0YWNobWVudHMpOwogICAgICAgICAgICBpZiAoIWJvZHkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb21tZW50KGJvZHksIGF0dGFjaG1lbnRzKTsKICAgICAgICAgICAgaWYgKGF0dGFjaG1lbnRzLmZpbHRlcihmdW5jdGlvbiAoYXR0YWNobWVudCkgeyByZXR1cm4gYXR0YWNobWVudC5wcm9ncmVzcyA8IDE7IH0pLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBlZGl0b3JTdGF0ZTogRWRpdG9yU3RhdGUuY3JlYXRlRW1wdHkoKSwKICAgICAgICAgICAgICAgIGZvY3VzZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgYXR0YWNobWVudHM6IHt9LAogICAgICAgICAgICAgICAgb3V0c2lkZU1lbnRpb25zOiBbXSwKICAgICAgICAgICAgfSwgX3RoaXMuZWRpdG9yLmJsdXIpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQ2FuY2VsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBvdXRzaWRlTWVudGlvbnM6IFtdLAogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVRhYiA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5wb3BvdmVyU2hvd24gJiYgX3RoaXMucG9wb3ZlcikgewogICAgICAgICAgICAgICAgX3RoaXMucG9wb3Zlci5zZWxlY3QoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVVwQXJyb3cgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgcG9wb3ZlclNob3duID0gX3RoaXMuc3RhdGUucG9wb3ZlclNob3duOwogICAgICAgICAgICBpZiAocG9wb3ZlclNob3duKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLnVwQXJyb3coKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZURvd25BcnJvdyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBwb3BvdmVyU2hvd24gPSBfdGhpcy5zdGF0ZS5wb3BvdmVyU2hvd247CiAgICAgICAgICAgIGlmIChwb3BvdmVyU2hvd24pIHsKICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXIuZG93bkFycm93KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVFc2NhcGUgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoX3RoaXMucG9wb3ZlciAmJiBfdGhpcy5zdGF0ZS5wb3BvdmVyU2hvd24pIHsKICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXJTaG93RGVib3VuY2UuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLmhpZGUoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5vdXRzaWRlTWVudGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVDYW5jZWwoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEhhbmRsZSByZWZvY3VzaW5nIHRvIGluZmluaXRlIHRocmVhZCBsaXN0CiAgICAgICAgICAgIC8vIEhBQ0soU0hJTik6IE5lZWQgdG8gcmVmb2N1cyBtYW51YWxseSB1c2luZyBET00gc2luY2Ugbm8gcHJvcHMgY2hhbmdlcwogICAgICAgICAgICB2YXIgdGhyZWFkTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2luZmluaXRlLXRocmVhZC1saXN0Jyk7CiAgICAgICAgICAgIF90aGlzLmVkaXRvci5ibHVyKCk7CiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gdGhyZWFkTGlzdFswXTsKICAgICAgICAgICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSB7CiAgICAgICAgICAgICAgICBlbGVtZW50LmZvY3VzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVQb3BvdmVyU2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBwb3BvdmVyU2hvd246IHRydWUgfSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuZWRpdG9yLmZvY3VzKCk7IH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlUG9wb3ZlckhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgcG9wb3ZlclNob3duOiBmYWxzZSB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wcm9wcy5jbGVhckNvbnRhY3RUeXBlYWhlYWQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVBdHRhY2htZW50UmVtb3ZlID0gZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgIHZhciBhdHRhY2htZW50cyA9IGNsb25lRGVlcChfdGhpcy5zdGF0ZS5hdHRhY2htZW50cyk7CiAgICAgICAgICAgIGRlbGV0ZSBhdHRhY2htZW50c1tpZF07CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRzOiBhdHRhY2htZW50cywKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVBdHRhY2htZW50cyA9IGZ1bmN0aW9uIChmaWxlcykgewogICAgICAgICAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICAgICAgICB2YXIgX2E7CiAgICAgICAgICAgICAgICB2YXIgaWQgPSBtb25nb0lkKCk7CiAgICAgICAgICAgICAgICB2YXIgYXR0YWNobWVudCA9IHsKICAgICAgICAgICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgICAgICAgICAgZmlsZW5hbWU6IGZpbGUubmFtZSwKICAgICAgICAgICAgICAgICAgICBsZW5ndGg6IGZpbGUuc2l6ZSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLAogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWQ6IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgICAgICAgdHlwZTogZmlsZS50eXBlLAogICAgICAgICAgICAgICAgICAgIGNsb3VkRmlsZTogJycsCiAgICAgICAgICAgICAgICAgICAgY2xvdWRVcmw6ICcnLAogICAgICAgICAgICAgICAgICAgIGNsb3VkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBpbmxpbmU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzOiAwLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50czogX19hc3NpZ24oX19hc3NpZ24oe30sIF90aGlzLnN0YXRlLmF0dGFjaG1lbnRzKSwgKF9hID0ge30sIF9hW2F0dGFjaG1lbnQuaWRdID0gYXR0YWNobWVudCwgX2EpKSwKICAgICAgICAgICAgICAgICAgICBkcm9wem9uZUFjdGl2ZTogZmFsc2UsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIG5ldyBDbG91ZEZpbGVDbGllbnQoKQogICAgICAgICAgICAgICAgICAgIC51cGxvYWRXaXRoUHJvZ3Jlc3MoZmlsZSkKICAgICAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKHsKICAgICAgICAgICAgICAgICAgICBuZXh0OiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9hLCBfYjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50czogX19hc3NpZ24oX19hc3NpZ24oe30sIF90aGlzLnN0YXRlLmF0dGFjaG1lbnRzKSwgKF9hID0ge30sIF9hW2F0dGFjaG1lbnQuaWRdID0gX19hc3NpZ24oX19hc3NpZ24oe30sIGF0dGFjaG1lbnQpLCB7IHByb2dyZXNzOiB2YWx1ZSB9KSwgX2EpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRzOiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgX3RoaXMuc3RhdGUuYXR0YWNobWVudHMpLCAoX2IgPSB7fSwgX2JbYXR0YWNobWVudC5pZF0gPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgYXR0YWNobWVudCksIHsgY2xvdWRGaWxlOiB2YWx1ZS5jbG91ZEZpbGUsIGNsb3VkVXJsOiB2YWx1ZS5jbG91ZFVybCwgcHJvZ3Jlc3M6IDEgfSksIF9iKSksCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAvLyBEcm9wWm9uZSBoYW5kbGVycwogICAgICAgIF90aGlzLmhhbmRsZURyYWdFbnRlciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzLmluZGV4T2YoJ0ZpbGVzJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGRyb3B6b25lQWN0aXZlOiB0cnVlIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVEcmFnTGVhdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZHJvcHpvbmVBY3RpdmU6IGZhbHNlIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlRGlyZWN0b3J5RHJvcEVycm9yID0gZnVuY3Rpb24gKGIpIHsKICAgICAgICAgICAgdmFyIGNvbmZpcm1Qcm9wcyA9IHsKICAgICAgICAgICAgICAgIHRpdGxlOiAnRXJyb3IgYXR0YWNoaW5nIGZpbGUnLAogICAgICAgICAgICAgICAgbWVzc2FnZTogdXBsb2FkRXJyb3JNZXNzYWdlKGIpLAogICAgICAgICAgICAgICAgY29uZmlybUNvcHk6ICdPaycsCiAgICAgICAgICAgICAgICBvbkNvbmZpcm06IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbmZpcm1Qcm9wczogdW5kZWZpbmVkIH0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IGNvbmZpcm1Qcm9wcywgZHJvcHpvbmVBY3RpdmU6IGZhbHNlIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuY29tcG9zaXRlRGVjb3JhdG9yID0gbmV3IENvbXBvc2l0ZURlY29yYXRvcihbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN0cmF0ZWd5OiBfdGhpcy5oYW5kbGVTdHJhdGVneSwKICAgICAgICAgICAgICAgIGNvbXBvbmVudDogTWVudGlvblRva2VuLAogICAgICAgICAgICB9LAogICAgICAgIF0pOwogICAgICAgIF90aGlzLnBvcG92ZXJTaG93RGVib3VuY2UgPSBkZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5wb3BvdmVyKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLnNob3coKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIDEwMCk7CiAgICAgICAgX3RoaXMucmVjb3JkVHlwaW5nID0gdGhyb3R0bGUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgc2hhcmVkVGhyZWFkID0gX2Euc2hhcmVkVGhyZWFkLCBjcmVhdGVTaGFyZWRUaHJlYWRBY3Rpdml0eSA9IF9hLmNyZWF0ZVNoYXJlZFRocmVhZEFjdGl2aXR5OwogICAgICAgICAgICBpZiAoc2hhcmVkVGhyZWFkKSB7CiAgICAgICAgICAgICAgICBjcmVhdGVTaGFyZWRUaHJlYWRBY3Rpdml0eSh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogU2hhcmVkVGhyZWFkQWN0aXZpdHlUeXBlLkNvbW1lbnQsCiAgICAgICAgICAgICAgICAgICAgc2hhcmVkVGhyZWFkOiBzaGFyZWRUaHJlYWQsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIFBJTkdfSU5URVJWQUwpOwogICAgICAgIF90aGlzLnN0YXRlID0gewogICAgICAgICAgICBlZGl0b3JTdGF0ZTogRWRpdG9yU3RhdGUuY3JlYXRlRW1wdHkoKSwKICAgICAgICAgICAgZm9jdXNlZDogZmFsc2UsCiAgICAgICAgICAgIG1hdGNoZWRUZWFtTWVtYmVyczogW10sCiAgICAgICAgICAgIHBvcG92ZXJTaG93bjogZmFsc2UsCiAgICAgICAgICAgIGF0dGFjaG1lbnRzOiB7fSwKICAgICAgICAgICAgZHJvcHpvbmVBY3RpdmU6IGZhbHNlLAogICAgICAgICAgICBvdXRzaWRlTWVudGlvbnM6IFtdLAogICAgICAgIH07CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgfQogICAgQ29tbWVudEVkaXRvci5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9hID0gdGhpcy5wcm9wcywgZG9tYWlucyA9IF9hLmRvbWFpbnMsIGNvbnRhY3RUeXBlYWhlYWQgPSBfYS5jb250YWN0VHlwZWFoZWFkOwogICAgICAgIGlmICh0aGlzLnN0YXRlLmZvY3VzZWQpIHsKICAgICAgICAgICAgY29udGFjdFR5cGVhaGVhZChkb21haW5zKTsKICAgICAgICB9CiAgICB9OwogICAgQ29tbWVudEVkaXRvci5wcm90b3R5cGUuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgPSBmdW5jdGlvbiAobmV4dFByb3BzLCBuZXh0U3RhdGUpIHsKICAgICAgICB2YXIgcXVlcnkgPSB0aGlzLnN0YXRlLnF1ZXJ5OwogICAgICAgIHZhciByZWZyZXNoID0gZmFsc2U7CiAgICAgICAgLy8gRG8gbm90aGluZyBmb3IgdXBkYXRlcyBpZiBub3QgZm9jdXNlZAogICAgICAgIGlmICghdGhpcy5zdGF0ZS5mb2N1c2VkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCFpc0VxdWFsKHRoaXMucHJvcHMudGVhbU1lbWJlcnMsIG5leHRQcm9wcy50ZWFtTWVtYmVycykpIHsKICAgICAgICAgICAgcmVmcmVzaCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChuZXh0UHJvcHMuY29udGFjdHMubGVuZ3RoID4gdGhpcy5wcm9wcy5jb250YWN0cy5sZW5ndGgpIHsKICAgICAgICAgICAgcmVmcmVzaCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIC8vIFVwZGF0ZSB0eXBlYWhlYWQgY29udGFjdHMgZnJvbSBjaGFuZ2UgaW4gcXVlcnkKICAgICAgICBpZiAodGhpcy5zdGF0ZS5xdWVyeSAhPT0gbmV4dFN0YXRlLnF1ZXJ5KSB7CiAgICAgICAgICAgIHRoaXMucHJvcHMuY29udGFjdFR5cGVhaGVhZCh0aGlzLnByb3BzLmRvbWFpbnMpOwogICAgICAgIH0KICAgICAgICBpZiAocmVmcmVzaCkgewogICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIG1hdGNoZWRUZWFtTWVtYmVyczogdGhpcy5nZXRNYXRjaGVkVGVhbU1lbWJlclBvcG92ZXJJdGVtKG5leHRQcm9wcy50ZWFtTWVtYmVycywgbmV4dFByb3BzLmNvbnRhY3RzLCBxdWVyeSksCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07CiAgICBDb21tZW50RWRpdG9yLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLnBvcG92ZXJTaG93RGVib3VuY2UuY2FuY2VsKCk7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7CiAgICB9OwogICAgLy8gVE9ETyhTSElOKTogUGVyZm9ybWFuY2UgSG90Zml4OiBJZGVudGlmeSBiZXR0ZXIgY29uZGl0aW9uYWwgc2hvd2luZyBvZiB0ZWFtIHBvcG92ZXIKICAgIENvbW1lbnRFZGl0b3IucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBfYSA9IHRoaXMuc3RhdGUsIGVkaXRvclN0YXRlID0gX2EuZWRpdG9yU3RhdGUsIG1hdGNoZWRUZWFtTWVtYmVycyA9IF9hLm1hdGNoZWRUZWFtTWVtYmVycywgYXR0YWNobWVudHMgPSBfYS5hdHRhY2htZW50cywgZm9jdXNlZCA9IF9hLmZvY3VzZWQsIGRyb3B6b25lQWN0aXZlID0gX2EuZHJvcHpvbmVBY3RpdmUsIG91dHNpZGVNZW50aW9ucyA9IF9hLm91dHNpZGVNZW50aW9ucywgY29uZmlybVByb3BzID0gX2EuY29uZmlybVByb3BzOwogICAgICAgIHZhciBfYiA9IHRoaXMucHJvcHMsIHRlYW1NZW1iZXJzID0gX2IudGVhbU1lbWJlcnMsIHBsYWNlaG9sZGVyT3ZlcnJpZGUgPSBfYi5wbGFjZWhvbGRlck92ZXJyaWRlOwogICAgICAgIHZhciBpc0VtcHR5ID0gISFlZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpLmdldFBsYWluVGV4dCgpOwogICAgICAgIHZhciBhdHRhY2htZW50c0FycmF5ID0gISFhdHRhY2htZW50cyAmJiB2YWx1ZXMoYXR0YWNobWVudHMpOwogICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6IGNsYXNzbmFtZXMoJ2NvbW1lbnQtZWRpdG9yJywgewogICAgICAgICAgICAgICAgJ2hpZGUtcGxhY2Vob2xkZXInOiBpc0VtcHR5LAogICAgICAgICAgICB9KSwgb25DbGljazogdGhpcy5oYW5kbGVDbGljaywgb25EcmFnRW50ZXI6IHRoaXMuaGFuZGxlRHJhZ0VudGVyIH0sCiAgICAgICAgICAgIGNvbmZpcm1Qcm9wcyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KENvbmZpcm0sIF9fYXNzaWduKHt9LCBjb25maXJtUHJvcHMpKSwKICAgICAgICAgICAgZHJvcHpvbmVBY3RpdmUgJiYKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRmlsZURyb3Bab25lLCB7IGNsYXNzTmFtZTogImNvbW1lbnQtZHJvcC16b25lIiwgb25Ecm9wOiB0aGlzLmhhbmRsZUF0dGFjaG1lbnRzLCBvbkxlYXZlOiB0aGlzLmhhbmRsZURyYWdMZWF2ZSwgY2VudGVyZWRDb3B5OiAnRHJvcCBoZXJlIHRvIGF0dGFjaCBmaWxlcycsIG9uRGlyZWN0b3J5RHJvcEVycm9yOiB0aGlzLmhhbmRsZURpcmVjdG9yeURyb3BFcnJvciwgaGlkZUljb246IHRydWUgfSksCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVGVhbU1lbWJlclBvcG92ZXIsIHsgaXRlbXM6IG1hdGNoZWRUZWFtTWVtYmVycywgcmVmOiB0aGlzLmhhbmRsZVJlZiwgb25TZWxlY3Q6IHRoaXMuaGFuZGxlU2VsZWN0LCBvblNob3c6IHRoaXMuaGFuZGxlUG9wb3ZlclNob3csIG9uSGlkZTogdGhpcy5oYW5kbGVQb3BvdmVySGlkZSwgaXNFbXB0eTogIShtYXRjaGVkVGVhbU1lbWJlcnMubGVuZ3RoICsgdGVhbU1lbWJlcnMubGVuZ3RoKSB9KSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJlZGl0b3IiIH0sCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEVkaXRvciwgeyBvbkJsdXI6IHRoaXMuaGFuZGxlQmx1ciwgb25Gb2N1czogdGhpcy5oYW5kbGVGb2N1cywgb25DaGFuZ2U6IHRoaXMuaGFuZGxlRWRpdG9yQ2hhbmdlLCBlZGl0b3JTdGF0ZTogZWRpdG9yU3RhdGUsIHBsYWNlaG9sZGVyOiBwbGFjZWhvbGRlck92ZXJyaWRlIHx8ICdXcml0ZSBhIGNvbW1lbnQgb3IgQG1lbnRpb24gYSB0ZWFtbWF0ZScsIHJlZjogdGhpcy5oYW5kbGVFZGl0b3JSZWYsIGtleUJpbmRpbmdGbjogdGhpcy5oYW5kbGVLZXlCaW5kaW5nLCBoYW5kbGVLZXlDb21tYW5kOiB0aGlzLmhhbmRsZUtleUNvbW1hbmQsIG9uVGFiOiB0aGlzLmhhbmRsZVRhYiB9KSwKICAgICAgICAgICAgICAgICEhYXR0YWNobWVudHNBcnJheSAmJiAhIWF0dGFjaG1lbnRzQXJyYXkubGVuZ3RoICYmCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJhdHRhY2htZW50LXNlY3Rpb24iIH0sIGF0dGFjaG1lbnRzQXJyYXkubWFwKGZ1bmN0aW9uIChhdHRhY2htZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KEF0dGFjaG1lbnRDZWxsLCB7IGlkOiBhdHRhY2htZW50LmlkLCBrZXk6IGF0dGFjaG1lbnQuaWQsIGZpbGVuYW1lOiBhdHRhY2htZW50LmZpbGVuYW1lLCBwcm9ncmVzczogYXR0YWNobWVudC5wcm9ncmVzcywgaWNvblVybDogZmlsZW5hbWVJY29uVXJsKGF0dGFjaG1lbnQuZmlsZW5hbWUpLCBsZW5ndGg6IGF0dGFjaG1lbnQubGVuZ3RoLCBvbkRlbGV0ZTogX3RoaXMuaGFuZGxlQXR0YWNobWVudFJlbW92ZSwgZmlsZVVybDogYXR0YWNobWVudC5jbG91ZFVybCB9KTsKICAgICAgICAgICAgICAgICAgICB9KSkpLAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFVwbG9hZEJ1dHRvbiwgeyBjbGFzc05hbWU6IGNsYXNzbmFtZXMoJ2F0dGFjaG1lbnQtaWNvbicsICdpY29uJywgeyBmb2N1c2VkOiBmb2N1c2VkIH0pLCB1cGxvYWQ6IHRoaXMuaGFuZGxlQXR0YWNobWVudHMsIHNob3dJY29uOiB0cnVlIH0pLAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogImljb24iLCBvbkNsaWNrOiB0aGlzLmF0TWVudGlvbiB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChNZW50aW9ucywgbnVsbCkpLAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENvbW1lbnRDb25maXJtYXRpb25Qb3BvdmVyLCB7IG9uQ29uZmlybTogdGhpcy5oYW5kbGVDb25maXJtLCBvbkNhbmNlbDogdGhpcy5oYW5kbGVDYW5jZWwsIG91dHNpZGVNZW50aW9uczogb3V0c2lkZU1lbnRpb25zIH0pKSk7CiAgICB9OwogICAgcmV0dXJuIENvbW1lbnRFZGl0b3I7Cn0oUmVhY3QuUHVyZUNvbXBvbmVudCkpOwpleHBvcnQgZGVmYXVsdCBDb21tZW50RWRpdG9yOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/components/Composer/components/CommentEditor/CommentEditor.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/components/Composer/components/CommentEditor/CommentEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport classnames from 'classnames';\nimport draftToHtml from 'draftjs-to-html';\nimport {\n  convertToRaw,\n  Editor,\n  EditorState,\n  Modifier,\n  ContentBlock,\n  ContentState,\n  CompositeDecorator,\n  SelectionState,\n  getDefaultKeyBinding,\n} from 'draft-js';\nimport './CommentEditor.scss';\nimport { TeamMember, KeyCode, Attachment, Contact } from '@src/types';\nimport TeamMemberPopover, {\n  TeamMemberPopoverItem, TeamMemberPopoverItemType,\n} from './TeamMemberPopover/TeamMemberPopover';\nimport MentionToken from './MentionToken';\nimport { debounce, isEqual, values, cloneDeep, throttle } from 'lodash';\nimport Mentions from '@src/components/Icons/Mentions.svg';\nimport { FakeDOM } from '@src/lib/html';\nimport UploadButton from '@src/components/Base/UploadButton';\nimport { mongoId } from '@src/lib/crypt';\nimport AttachmentCell from '@src/components/Compose/Attachments/AttachmentCell';\nimport { filenameIconUrl } from '@src/lib/attachment';\nimport FileDropZone from '@src/components/Compose/FileDropZone';\nimport { isEmail } from '@src/lib/search';\nimport CommentConfirmationPopover from './CommentConfirmationPopover';\nimport { SharedThreadActivityCreateMeta, PING_INTERVAL } from '@src/ducks/sharedThreads';\nimport { SharedThreadActivityType } from '@src/types/sharedThreads';\nimport { CloudFileClient } from '@src/api/cloudFile';\nimport Confirm, { Props as ConfirmProps } from '@src/components/Base/Confirm';\nimport { uploadErrorMessage, BlobDescriptor } from '@src/lib/files';\nimport { AmplitudeEvents, logAmplitudeEvent } from '@src/lib/amplitude-analytics';\n\ninterface State {\n  editorState: EditorState;\n  focused: boolean;\n  query?: string;\n  matchedTeamMembers: TeamMemberPopoverItem[];\n  popoverShown: boolean;\n  attachments: {\n    [id: string]: Attachment;\n  };\n  dropzoneActive: boolean;\n  body?: string;\n  outsideMentions: string[];\n  confirmProps?: ConfirmProps;\n}\n\nexport interface Props {\n  placeholderOverride?: string;\n  onFocus?: () => void;\n  comment: (body: string, attachments: Attachment[]) => void;\n}\n\nexport interface DispatchProps {\n  contactTypeahead: (domains: string[]) => void;\n  clearContactTypeahead: () => void;\n  createSharedThreadActivity: (meta: SharedThreadActivityCreateMeta) => void;\n}\n\nexport interface StateProps {\n  domains: string[];\n  contacts: Contact[];\n  teamMembers: TeamMember[];\n  sharedThread?: string;\n}\n\nclass CommentEditor extends React.PureComponent<Props & StateProps & DispatchProps, State> {\n  popover: TeamMemberPopover;\n  compositeDecorator: CompositeDecorator;\n  editor: Editor;\n  popoverShowDebounce: any;\n  timeout: NodeJS.Timer;\n  recordTyping: any;\n\n  constructor(props: Props & StateProps & DispatchProps) {\n    super(props);\n\n    this.compositeDecorator = new CompositeDecorator([\n      {\n        strategy: this.handleStrategy,\n        component: MentionToken,\n      },\n    ]);\n    this.popoverShowDebounce = debounce(\n      () => {\n        if (this.popover) {\n          this.popover.show();\n        }\n      },\n      100,\n    );\n    this.recordTyping = throttle(\n      () => {\n        const { sharedThread, createSharedThreadActivity } = this.props;\n\n        if (sharedThread) {\n          createSharedThreadActivity({\n            type: SharedThreadActivityType.Comment,\n            sharedThread,\n          });\n        }\n      },\n      PING_INTERVAL,\n    );\n\n    this.state = {\n      editorState: EditorState.createEmpty(),\n      focused: false,\n      matchedTeamMembers: [],\n      popoverShown: false,\n      attachments: {},\n      dropzoneActive: false,\n      outsideMentions: [],\n    };\n  }\n\n  componentDidMount() {\n    const { domains, contactTypeahead } = this.props;\n    if (this.state.focused) {\n      contactTypeahead(domains);\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(\n    nextProps: Props & DispatchProps & StateProps, nextState: State,\n  ) {\n    const { query } = this.state;\n    let refresh = false;\n\n    // Do nothing for updates if not focused\n    if (!this.state.focused) {\n      return;\n    }\n\n    if (!isEqual(this.props.teamMembers, nextProps.teamMembers)) {\n      refresh = true;\n    }\n\n    if (nextProps.contacts.length > this.props.contacts.length) {\n      refresh = true;\n    }\n\n    // Update typeahead contacts from change in query\n    if (this.state.query !== nextState.query) {\n      this.props.contactTypeahead(this.props.domains);\n    }\n\n    if (refresh) {\n      this.setState({\n        matchedTeamMembers: this.getMatchedTeamMemberPopoverItem(\n          nextProps.teamMembers, nextProps.contacts, query,\n        ),\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    this.popoverShowDebounce.cancel();\n    clearTimeout(this.timeout);\n  }\n\n  getMatchedTeamMemberPopoverItem = (\n    teamMembers: TeamMember[],\n    contacts: Contact[],\n    query: string = '',\n  ) => {\n    const lowercaseQuery = query.toLowerCase();\n    const matchedTeamMembers = teamMembers\n      .filter(tm =>\n        tm.firstName.toLowerCase().startsWith(lowercaseQuery) ||\n        tm.lastName.toLowerCase().startsWith(lowercaseQuery) ||\n        tm.email.toLowerCase().startsWith(lowercaseQuery),\n      )\n      .map(tm => ({\n        photoUrl: tm.photoUrl,\n        firstName: tm.firstName,\n        lastName: tm.lastName,\n        email: tm.email,\n        id: tm.id,\n        type: TeamMemberPopoverItemType.TeamMember,\n      }));\n    const teamMemberEmails = teamMembers.map(t => t.email.toLowerCase());\n\n    const matchedContacts = contacts\n      .filter(c =>\n        teamMemberEmails.indexOf(c.email.toLowerCase()) === -1 &&\n        (c.givenName.toLowerCase().startsWith(lowercaseQuery) ||\n        c.familyName.toLowerCase().startsWith(lowercaseQuery) ||\n        c.email.toLowerCase().startsWith(lowercaseQuery)),\n      )\n      .map(c => ({\n        photoUrl: c.photoUrl,\n        firstName: c.givenName,\n        lastName: c.familyName,\n        email: c.email,\n        id: c.id,\n        type: TeamMemberPopoverItemType.Contact,\n      }));\n\n    return matchedTeamMembers.concat(matchedContacts);\n  }\n\n  handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    const { editorState } = this.state;\n    e.stopPropagation();\n\n    if (!editorState.getCurrentContent().getPlainText()) {\n      this.editor.focus();\n    }\n  }\n\n  handleBlur = () => {\n    this.setState({ focused: false });\n  }\n\n  focus = () => {\n    if (this.editor) {\n      clearTimeout(this.timeout);\n      this.timeout = global.setTimeout(\n        () => {\n          let editorState = this.state.editorState;\n          editorState = EditorState.moveFocusToEnd(editorState);\n          this.setState(\n            {\n              editorState,\n            },\n            () => this.handleFocus(),\n          );\n        },\n        0,\n      );\n    }\n  }\n\n  handleFocus = () => {\n    const { matchedTeamMembers, query } = this.state;\n\n    this.setState({ focused: true }, () => {\n      if (query !== undefined && matchedTeamMembers.length) {\n        this.popoverShowDebounce();\n      }\n    });\n    if (this.props.onFocus) {\n      this.props.onFocus();\n    }\n  }\n\n  handleEditorChange = (editorState: EditorState) => {\n    const { teamMembers, contacts } = this.props;\n    const block = editorState.getCurrentContent().getLastBlock();\n    const text = block.getText();\n    const oldText = this.state.editorState.getCurrentContent().getLastBlock().getText();\n    const sameText = text === oldText;\n    let query;\n\n    const selectionState = editorState.getSelection();\n    let start = selectionState.getStartOffset() - 1;\n\n    while ((text.charAt(start) !== '@' && !text.charAt(start).match(/\\s/)) && start > 0) {\n      start -= 1;\n    }\n\n    if (text.charAt(start) === '@') {\n      let end = start;\n      query = '';\n      while (!text.charAt(end).match(/\\s/) && end < text.length) {\n        end += 1;\n        query += text.charAt(end);\n      }\n    }\n\n    if (query !== undefined) {\n      query = query.trim();\n    }\n\n    const matchedTeamMembers = this.getMatchedTeamMemberPopoverItem(\n      teamMembers, contacts, query,\n    );\n\n    if (matchedTeamMembers.length && !sameText && query !== undefined) {\n      this.popoverShowDebounce();\n    } else if (this.state.popoverShown) {\n      this.popoverShowDebounce.cancel();\n      this.popover.hide();\n    }\n\n    if (text) {\n      this.recordTyping();\n    }\n\n    this.setState(\n      {\n        editorState,\n        query,\n        matchedTeamMembers,\n      },\n      () => {\n        if (editorState.getSelection().getHasFocus()) {\n          this.editor.focus();\n        }\n      },\n    );\n  }\n\n  handleRef = (ref: TeamMemberPopover) => {\n    this.popover = ref;\n  }\n\n  getName = (item: TeamMemberPopoverItem) => {\n    if (item.firstName) {\n      return `${item.firstName} ${item.lastName}`.trim();\n    }\n\n    return item.email;\n  }\n\n  handleStrategy = (contentBlock: ContentBlock, callback: any, contentState: ContentState) => {\n    contentBlock.findEntityRanges(\n      (character) => {\n        const entityKey = character.getEntity();\n        if (entityKey === null) {\n          return false;\n        }\n        return contentState.getEntity(entityKey).getType() === 'MENTION';\n      },\n      callback,\n    );\n  }\n\n  insertSpace = () => {\n    const spaceCharacter = ' ';\n\n    const currentState = this.state.editorState;\n    const newContentState = Modifier.replaceText(\n      currentState.getCurrentContent(),\n      currentState.getSelection(),\n      spaceCharacter,\n    );\n\n    this.setState({\n      editorState: EditorState.push(currentState, newContentState, 'insert-characters'),\n    });\n  }\n\n  handleSelect = (item: TeamMemberPopoverItem) => {\n    let editorState = this.state.editorState;\n    const text = editorState.getCurrentContent().getLastBlock().getText();\n    let selectionState = editorState.getSelection();\n    let start = selectionState.getStartOffset();\n    const end = selectionState.getEndOffset();\n\n    while (text.charAt(start) !== '@' && start > 0) {\n      start -= 1;\n    }\n\n    selectionState = selectionState.merge({\n      anchorOffset: start,\n      focusOffset: end,\n    }) as SelectionState;\n    let contentState = editorState.getCurrentContent().createEntity('MENTION', 'IMMUTABLE', {\n      value: item.type === TeamMemberPopoverItemType.TeamMember ? item.id : item.email,\n      id: item.id,\n    });\n\n    contentState = Modifier.replaceText(\n      editorState.getCurrentContent(),\n      selectionState,\n      `@${this.getName(item)}`,\n      undefined,\n      contentState.getLastCreatedEntityKey(),\n    );\n\n    editorState = EditorState.push(\n      editorState,\n      contentState,\n      'apply-entity',\n    );\n    editorState = EditorState.set(editorState, { decorator: this.compositeDecorator });\n\n    this.popoverShowDebounce.cancel();\n    this.popover.hide();\n    this.setState(\n      {\n        editorState,\n      },\n      () => {\n        this.editor.focus();\n        this.insertSpace();\n      },\n    );\n  }\n\n  handleEditorRef = (ref: Editor) => {\n    this.editor = ref;\n  }\n\n  atMention = (e: React.MouseEvent<HTMLElement>) => {\n    if (this.state.query !== undefined) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const { editorState } = this.state;\n    const text = editorState.getCurrentContent().getPlainText();\n    let insert = '@';\n\n    if (text && !text.endsWith(' ')) {\n      insert = ' @';\n    }\n\n    const contentState = Modifier.insertText(\n      editorState.getCurrentContent(),\n      editorState.getSelection(),\n      insert,\n    );\n    let newEditorState = EditorState.push(editorState, contentState, 'insert-characters');\n    newEditorState = EditorState.set(newEditorState, { decorator: this.compositeDecorator });\n\n    this.editor.focus();\n    this.popoverShowDebounce();\n    this.setState({\n      editorState: newEditorState,\n      query: '',\n    });\n  }\n\n  handleKeyBinding = (e: React.KeyboardEvent<HTMLElement>) => {\n    switch (e.keyCode) {\n      case KeyCode.Enter:\n\n        if (this.state.popoverShown) {\n          return 'select-member';\n        }\n\n        if (this.state.outsideMentions.length) {\n          return 'comment-confirm';\n        }\n\n        if (!e.shiftKey) {\n          return 'comment';\n        }\n        break;\n      case KeyCode.Esc: {\n        const handled = this.handleEscape(e);\n        if (handled) {\n          return 'pm-escape';\n        }\n        break;\n      }\n      case KeyCode.Up: {\n        const handled = this.handleUpArrow(e);\n        if (handled) {\n          return 'pm-up-arrow';\n        }\n        break;\n      }\n      case KeyCode.Down: {\n        const handled = this.handleDownArrow(e);\n        if (handled) {\n          return 'pm-down-arrow';\n        }\n        break;\n      }\n      case KeyCode.Tab: {\n        const handled = this.handleTab(e);\n        if (handled) {\n          return 'pm-tab';\n        }\n        break;\n      }\n      default:\n        break;\n    }\n\n    return getDefaultKeyBinding(e);\n  }\n\n  // TODO(SHIN): Update when comment attachments are abstracted to redux state\n  handleKeyCommand = (command: string) => {\n    const { comment } = this.props;\n\n    if (command === 'comment') {\n      const content = this.state.editorState.getCurrentContent();\n\n      // render empty\n      if (!content.getPlainText()) {\n        return 'not-handled';\n      }\n\n      const html = draftToHtml(convertToRaw(content));\n      const container = FakeDOM().createElement('div');\n      container.innerHTML = html;\n      const mentions = container.getElementsByClassName('wysiwyg-mention');\n      let span;\n      let identifier;\n      const outsideMentions: string[] = [];\n\n      logAmplitudeEvent(AmplitudeEvents.CommentOnEmail);\n      if (mentions.length) {\n        logAmplitudeEvent(AmplitudeEvents.MentionTeamOnEmail);\n      }\n\n      Array.from(mentions).forEach((m) => {\n        span = FakeDOM().createElement('span');\n        identifier = m.getAttribute('data-value');\n        span.innerHTML = m.innerHTML;\n        if (identifier && isEmail(identifier)) {\n          span.setAttribute('data-pm-email', identifier);\n          outsideMentions.push(identifier);\n        } else if (identifier) {\n          span.setAttribute('data-pm-user', identifier);\n        }\n\n        if (m.parentNode) {\n          m.parentNode.replaceChild(span, m);\n        }\n      });\n\n      if (outsideMentions.length) {\n        this.setState(\n          {\n            outsideMentions,\n            body: container.innerHTML,\n          },\n        );\n        return 'handled';\n      }\n\n      // TODO(SHIN): Update when comment attachments are abstracted to redux state\n      const attachments = values(this.state.attachments);\n      comment(container.innerHTML, attachments);\n      if (attachments.filter(attachment => attachment.progress < 1).length > 0) {\n        return 'handled';\n      }\n      this.setState(\n        {\n          editorState: EditorState.createEmpty(),\n          focused: false,\n          attachments: {},\n        },\n        this.editor.blur,\n      );\n      return 'handled';\n    }\n\n    if (command === 'comment-confirm') {\n      this.handleConfirm();\n      return 'handled';\n    }\n\n    if (command === 'select-member') {\n      this.popover.select();\n      return 'handled';\n    }\n\n    // Handle custom key commands\n    switch (command) {\n      case 'pm-tab':\n      case 'pm-up-arrow':\n      case 'pm-down-arrow':\n      case 'pm-escape':\n        return 'handled';\n      default:\n        break;\n    }\n\n    return 'not-handled';\n  }\n\n  handleConfirm = () => {\n    const { comment } = this.props;\n    const { body } = this.state;\n    const attachments = values(this.state.attachments);\n\n    if (!body) {\n      return;\n    }\n\n    comment(body, attachments);\n    if (attachments.filter(attachment => attachment.progress < 1).length > 0) {\n      return;\n    }\n\n    this.setState(\n      {\n        editorState: EditorState.createEmpty(),\n        focused: false,\n        attachments: {},\n        outsideMentions: [],\n      },\n      this.editor.blur,\n    );\n  }\n\n  handleCancel = () => {\n    this.setState({\n      outsideMentions: [],\n    });\n  }\n\n  handleTab = (e: React.KeyboardEvent<HTMLElement>): boolean => {\n    if (this.state.popoverShown && this.popover) {\n      this.popover.select();\n      return true;\n    }\n\n    return false;\n  }\n\n  handleUpArrow = (e: React.KeyboardEvent<HTMLElement>): boolean => {\n    const { popoverShown } = this.state;\n\n    if (popoverShown) {\n      this.popover.upArrow();\n      return true;\n    }\n\n    return false;\n  }\n\n  handleDownArrow = (e: React.KeyboardEvent<HTMLElement>): boolean => {\n    const { popoverShown } = this.state;\n\n    if (popoverShown) {\n      this.popover.downArrow();\n      return true;\n    }\n\n    return false;\n  }\n\n  handleEscape = (e: React.KeyboardEvent<HTMLElement>): boolean => {\n    if (this.popover && this.state.popoverShown) {\n      this.popoverShowDebounce.cancel();\n      this.popover.hide();\n      return true;\n    }\n\n    if (this.state.outsideMentions.length) {\n      this.handleCancel();\n      return true;\n    }\n\n    // Handle refocusing to infinite thread list\n    // HACK(SHIN): Need to refocus manually using DOM since no props changes\n    const threadList = document.getElementsByClassName('infinite-thread-list');\n    this.editor.blur();\n    const element = threadList[0];\n    if (element && element instanceof HTMLElement) {\n      element.focus();\n    }\n\n    return true;\n  }\n\n  handlePopoverShow = () => {\n    this.setState({ popoverShown: true }, () => this.editor.focus());\n  }\n\n  handlePopoverHide = () => {\n    this.setState({ popoverShown: false }, () => {\n      this.props.clearContactTypeahead();\n    });\n  }\n\n  handleAttachmentRemove = (id: string) => {\n    const attachments = cloneDeep(this.state.attachments);\n    delete attachments[id];\n    this.setState({\n      attachments,\n    });\n  }\n\n  handleAttachments = (files: File[]) => {\n    files.forEach((file) => {\n      const id = mongoId();\n      const attachment: Attachment = {\n        id,\n        filename: file.name,\n        length: file.size,\n        created: new Date(),\n        updated: new Date(),\n        type: file.type,\n        cloudFile: '',\n        cloudUrl: '',\n        cloud: false,\n        inline: false,\n        progress: 0,\n      };\n\n      this.setState({\n        attachments: {\n          ...this.state.attachments,\n          [attachment.id]: attachment,\n        },\n        dropzoneActive: false,\n      });\n\n      new CloudFileClient()\n        .uploadWithProgress(file)\n        .subscribe({\n          next: (value) => {\n            if (typeof value === 'number') {\n              this.setState({\n                attachments: {\n                  ...this.state.attachments,\n                  [attachment.id]: {\n                    ...attachment,\n                    progress: value,\n                  },\n                },\n              });\n              return;\n            }\n\n            this.setState({\n              attachments: {\n                ...this.state.attachments,\n                [attachment.id]: {\n                  ...attachment,\n                  cloudFile: value.cloudFile,\n                  cloudUrl: value.cloudUrl,\n                  progress: 1,\n                },\n              },\n            });\n          },\n        });\n    });\n  }\n\n  // DropZone handlers\n  handleDragEnter = (event: React.DragEvent<HTMLDivElement>) => {\n    if (event.dataTransfer.types.indexOf('Files') !== -1) {\n      this.setState({ dropzoneActive: true });\n    }\n  }\n\n  handleDragLeave = () => {\n    this.setState({ dropzoneActive: false });\n  }\n\n  handleDirectoryDropError = (b: BlobDescriptor) => {\n    const confirmProps: ConfirmProps = {\n      title: 'Error attaching file',\n      message: uploadErrorMessage(b),\n      confirmCopy: 'Ok',\n      onConfirm: () => {\n        this.setState({ confirmProps: undefined });\n      },\n    };\n\n    this.setState({ confirmProps, dropzoneActive: false });\n  }\n\n  // TODO(SHIN): Performance Hotfix: Identify better conditional showing of team popover\n  render() {\n    const {\n      editorState,\n      matchedTeamMembers,\n      attachments,\n      focused,\n      dropzoneActive,\n      outsideMentions,\n      confirmProps,\n    } = this.state;\n    const { teamMembers, placeholderOverride } = this.props;\n    const isEmpty = !!editorState.getCurrentContent().getPlainText();\n    const attachmentsArray = !!attachments && values(attachments);\n\n    return (\n      <div\n        className={classnames('comment-editor', {\n          'hide-placeholder': isEmpty,\n        })}\n        onClick={this.handleClick}\n        onDragEnter={this.handleDragEnter}\n      >\n        {confirmProps && <Confirm {...confirmProps} />}\n        {dropzoneActive &&\n          <FileDropZone\n            className=\"comment-drop-zone\"\n            onDrop={this.handleAttachments}\n            onLeave={this.handleDragLeave}\n            centeredCopy={'Drop here to attach files'}\n            onDirectoryDropError={this.handleDirectoryDropError}\n            hideIcon\n          />\n        }\n        <TeamMemberPopover\n          items={matchedTeamMembers}\n          ref={this.handleRef}\n          onSelect={this.handleSelect}\n          onShow={this.handlePopoverShow}\n          onHide={this.handlePopoverHide}\n          isEmpty={!(matchedTeamMembers.length + teamMembers.length)}\n        />\n        <div className=\"editor\">\n          <Editor\n            onBlur={this.handleBlur}\n            onFocus={this.handleFocus}\n            onChange={this.handleEditorChange}\n            editorState={editorState}\n            placeholder={placeholderOverride || 'Write a comment or @mention a teammate'}\n            ref={this.handleEditorRef}\n            keyBindingFn={this.handleKeyBinding}\n            handleKeyCommand={this.handleKeyCommand}\n            onTab={this.handleTab}\n          />\n          {!!attachmentsArray && !!attachmentsArray.length &&\n            <div className=\"attachment-section\">\n              {attachmentsArray.map(attachment =>\n                <AttachmentCell\n                  id={attachment.id}\n                  key={attachment.id}\n                  filename={attachment.filename}\n                  progress={attachment.progress}\n                  iconUrl={filenameIconUrl(attachment.filename)}\n                  length={attachment.length}\n                  onDelete={this.handleAttachmentRemove}\n                  fileUrl={attachment.cloudUrl}\n                />,\n              )}\n            </div>\n          }\n        </div>\n        <UploadButton\n          className={classnames('attachment-icon', 'icon', { focused })}\n          upload={this.handleAttachments}\n          showIcon\n        />\n        <button className=\"icon\" onClick={this.atMention}>\n          <Mentions />\n        </button>\n        <CommentConfirmationPopover\n          onConfirm={this.handleConfirm}\n          onCancel={this.handleCancel}\n          outsideMentions={outsideMentions}\n        />\n      </div>\n    );\n  }\n}\n\nexport default CommentEditor;\n"]}]}