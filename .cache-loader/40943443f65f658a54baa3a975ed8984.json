{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/threads.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/threads.ts","mtime":1675280254053},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgewogICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHsKICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKQogICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfTsKICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9Owp2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfaiwgX2ssIF9sLCBfbSwgX28sIF9wLCBfcSwgX3IsIF9zOwppbXBvcnQgeyBjcmVhdGUsIGNyZWF0ZUFjdGlvbiwgY3JlYXRlU2luZ2xlIH0gZnJvbSAnQHNyYy9saWIvcmVkdXgnOwppbXBvcnQgdXBkYXRlIGZyb20gJ2ltbXV0YWJpbGl0eS1oZWxwZXInOwppbXBvcnQgeyBmbGF0TWFwLCBmbGF0dGVuLCBlbmRzV2l0aCwga2V5QnksIGZpbmRJbmRleCwgaXNFcXVhbCwgc2l6ZSwgdW5pcUJ5IH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IHsgUmVzb3VyY2VTdGF0dXMgfSBmcm9tICdAc3JjL3R5cGVzJzsKaW1wb3J0IHsgcmVzb3VyY2VMb2FkaW5nLCByZXNvdXJjZU9rLCByZXNvdXJjZUZhaWxlZCwgcmVzb3VyY2VSZWZyZXNoaW5nIH0gZnJvbSAnQHNyYy9saWIvcmVzb3VyY2UnOwppbXBvcnQgeyBjcmVhdGVTZWxlY3RvciB9IGZyb20gJ0BzcmMvbGliL3NlbGVjdG9yJzsKaW1wb3J0IHsgY29tcHV0ZVRocmVhZCwgbWF0Y2hlc1RocmVhZCB9IGZyb20gJ0BzcmMvbGliL3RocmVhZCc7CmltcG9ydCB7IGZudjFhMzIgfSBmcm9tICdAc3JjL2xpYi9jcnlwdCc7CmltcG9ydCB7IHBhcnNlUXVlcnlQYXJhbXMgfSBmcm9tICdAc3JjL2xpYi9zZWFyY2gnOwpleHBvcnQgdmFyIFRIUkVBRF9ESVNBQkxFX1RSQUNLID0gKF9hID0gY3JlYXRlKCdUSFJFQURfRElTQUJMRV9UUkFDSycsIHsKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2VsZWN0ZWRUaHJlYWQ6IHsgJHNldDogcGF5bG9hZCB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9hLnR5cGUpLCB0aHJlYWREaXNhYmxlVHJhY2sgPSBfYS5hY3Rpb24sIHRocmVhZERpc2FibGVUcmFja1JlZHVjZXIgPSBfYS5yZWR1Y2VyOwovLyBUaHJlYWQgU2VsZWN0Ci8vIE5PVEU6IFRoaXMgYWN0aW9uIHNob3VsZCBub3QgYmUgdXNlZCBkaXJlY3RseS4KLy8gSXQgaXMgdHJpZ2VycmVkIGJ5IGxvY2F0aW9uIGNoYW5nZXMgdG8gdXBkYXRlIHRoZSBzZWxlY3RlZFRocmVhZApleHBvcnQgdmFyIFRIUkVBRF9TRUxFQ1QgPSAoX2IgPSBjcmVhdGUoJ1RIUkVBRF9TRUxFQ1QnLCB7CiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIHNlbGVjdGVkVGhyZWFkOiB7ICRzZXQ6IHBheWxvYWQgPT09IG51bGwgPyB1bmRlZmluZWQgOiBwYXlsb2FkIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2IudHlwZSksIHRocmVhZFNlbGVjdCA9IF9iLmFjdGlvbiwgdGhyZWFkU2VsZWN0UmVkdWNlciA9IF9iLnJlZHVjZXI7CmV4cG9ydCB2YXIgQ09OVEFDVF9USFJFQURfU0VMRUNUID0gKF9jID0gY3JlYXRlKCdDT05UQUNUX1RIUkVBRF9TRUxFQ1QnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzZWxlY3RlZENvbnRhY3RUaHJlYWQ6IHsgJHNldDogbWV0YSB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9jLnR5cGUpLCBjb250YWN0VGhyZWFkU2VsZWN0ID0gX2MuYWN0aW9uLCBjb250YWN0VGhyZWFkU2VsZWN0UmVkdWNlciA9IF9jLnJlZHVjZXI7Ci8vIFVwZGF0ZSBtdWx0aXBsZSBzZWxlY3Rpb25zCmV4cG9ydCB2YXIgU0VMRUNURURfSURTX1VQREFURSA9IChfZCA9IGNyZWF0ZVNpbmdsZSgnU0VMRUNURURfSURTX1VQREFURScsIGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgIHNlbGVjdGVkSWRzOiB7ICRzZXQ6IG1ldGEgfSwKICAgIH0pOwp9KSwgX2QudHlwZSksIHNlbGVjdGVkSWRzVXBkYXRlID0gX2QuYWN0aW9uLCBzZWxlY3RlZElkc1VwZGF0ZVJlZHVjZXIgPSBfZC5yZWR1Y2VyOwovLyBIQUNLKFNISU4gJiBKRUZGKTogQ2xlYXJzIG1haWxib3ggdGhyZWFkcyB3aGVuIHNlYXJjaCBzdGFydHMuIFdoZW4gc3VjY2VzcyBjcmVhdGVTZWxlY3RvcgovLyBNYWlsYm94VGhyZWFkcyBpcyByZWZyZXNoZWQsIHNpbmNlIG1vZGUgaGFzIGNsZWFyZWQgVGhyZWFkc0RhdGFTb3VyY2UsIGl0IHdpbGwgYXBwZW5kU29ydGVkSXRlbXMKLy8gYW5kIFREUyB3aWxsIHVwZGF0ZSB3aXRoIHNlYXJjaCByZXN1bHRzCmV4cG9ydCB2YXIgVEhSRUFEU19TRUFSQ0ggPSAoX2UgPSBjcmVhdGUoJ1RIUkVBRFNfU0VBUkNIJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIHZhciBxdWVyeVBhcmFtcyA9IHBhcnNlUXVlcnlQYXJhbXMobWV0YS5xdWVyeSwgc3RhdGUubGlzdHMpOwogICAgICAgIHZhciBxdWVyeUNoYW5nZWQgPSAhaXNFcXVhbChxdWVyeVBhcmFtcywgc3RhdGUubWFpbGJveC5xdWVyeVBhcmFtcyk7CiAgICAgICAgdmFyIHByb3ZpZGVyU2VhcmNoQ2hhbmdlZCA9IG1ldGEucHJvdmlkZXIgIT09IHN0YXRlLm1haWxib3gucHJvdmlkZXJTZWFyY2g7CiAgICAgICAgaWYgKCFxdWVyeUNoYW5nZWQgJiYgIXByb3ZpZGVyU2VhcmNoQ2hhbmdlZCkgewogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgfQogICAgICAgIC8vIFNldCBxdWVyeS9xdWVyeVBhcmFtcyB0byB1bmRlZmluZWQgaWYgbm8gdmFsdWUsIGluIG9yZGVyIHRvIG1hdGNoIGNsZWFyZWQgbWFpbGJveCBiZWhhdmlvcgogICAgICAgIHZhciB1cGRhdGVkUXVlcnkgPSAhIW1ldGEucXVlcnkgJiYgbWV0YS5xdWVyeSB8fCB1bmRlZmluZWQ7CiAgICAgICAgdmFyIHVwZGF0ZWRRdWVyeVBhcmFtcyA9ICEhc2l6ZShPYmplY3Qua2V5cyhxdWVyeVBhcmFtcykpICYmIHF1ZXJ5UGFyYW1zIHx8IHVuZGVmaW5lZDsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIG1haWxib3g6IHsKICAgICAgICAgICAgICAgIHF1ZXJ5OiB7ICRzZXQ6IHVwZGF0ZWRRdWVyeSB9LAogICAgICAgICAgICAgICAgcXVlcnlQYXJhbXM6IHsgJHNldDogdXBkYXRlZFF1ZXJ5UGFyYW1zIH0sCiAgICAgICAgICAgICAgICBwcm92aWRlclNlYXJjaDogeyAkc2V0OiBtZXRhLnByb3ZpZGVyIH0sCiAgICAgICAgICAgICAgICBwcm92aWRlclNlYXJjaENvbXBsZXRlOiB7ICRzZXQ6IGZhbHNlIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNlbGVjdGVkSWRzOiB7ICRzZXQ6IG5ldyBNYXAoKSB9LAogICAgICAgICAgICAvLyBzZWxlY3RlZFRocmVhZDogeyAkc2V0OiB1bmRlZmluZWQgfSwKICAgICAgICAgICAgbWFpbGJveFRocmVhZHM6IHsgJHNldDogcXVlcnlDaGFuZ2VkID8gcmVzb3VyY2VMb2FkaW5nKCkgOiBzdGF0ZS5tYWlsYm94VGhyZWFkcyB9LAogICAgICAgIH0pOwogICAgfSwKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgewogICAgICAgIC8vIElmIGhhdmUgcmVzdWx0cyByZXBsYWNlIG1haWxib3hUaHJlYWRzIHdpdGggcmVzdWx0cwogICAgICAgIHZhciBvbGRNYWlsYm94VGhyZWFkcyA9IHN0YXRlLm1haWxib3hUaHJlYWRzLmRhdGEgfHwgW107CiAgICAgICAgdmFyIGNvbmNhdFJlc3VsdHMgPSBvbGRNYWlsYm94VGhyZWFkcy5jb25jYXQocGF5bG9hZC50aHJlYWRzKTsKICAgICAgICB2YXIgdW5pcVRocmVhZHMgPSB1bmlxQnkoY29uY2F0UmVzdWx0cywgJ2lkJyk7CiAgICAgICAgLy8gT3RoZXJ3aXNlIHJldHVybgogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgbWFpbGJveFRocmVhZHM6IHsKICAgICAgICAgICAgICAgIHN0YXR1czogeyAkc2V0OiBSZXNvdXJjZVN0YXR1cy5PayB9LAogICAgICAgICAgICAgICAgZGF0YTogeyAkc2V0OiB1bmlxVGhyZWFkcyB9LAogICAgICAgICAgICB9LAogICAgICAgICAgICBtYWlsYm94OiB7CiAgICAgICAgICAgICAgICBwcm92aWRlclNlYXJjaENvbXBsZXRlOiB7CiAgICAgICAgICAgICAgICAgICAgJHNldDogcGF5bG9hZC5wcm92aWRlciAmJiB0cnVlIHx8IHN0YXRlLm1haWxib3gucHJvdmlkZXJTZWFyY2hDb21wbGV0ZSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2UudHlwZSksIHRocmVhZHNTZWFyY2ggPSBfZS5hY3Rpb24sIHRocmVhZHNTZWFyY2hSZWR1Y2VyID0gX2UucmVkdWNlcjsKLy8gVGhyZWFkIExpc3QKLy8gTk9URTogVGhpcyBhY3Rpb24gc2hvdWxkIG5vdCBiZSB1c2VkIGRpcmVjdGx5LgovLyBJdCBpcyB0cmlnZXJyZWQgYnkgbG9jYXRpb24gY2hhbmdlcyB0byB1cGRhdGUgdGhlIHNlbGVjdGVkVGhyZWFkCi8vIEl0IGlzIGFsc28gdHJpZ2VycmVkIGJ5IEJyaWRnZSBUaHJlYWRVcGRhdGUgZXZlbnRzCi8vIE1ldGEgaWRlbnRpZmllcyB3aGV0aGVyIHRocmVhZCBsaXN0IHNob3VsZCBiZSByZWZyZXNoZWQgb3Igbm90CmV4cG9ydCB2YXIgVEhSRUFEX0xJU1QgPSAoX2YgPSBjcmVhdGUoJ1RIUkVBRF9MSVNUJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIC8vIERvbid0IHJlZnJlc2ggbWFpbGJveCB3aGlsZSBpbiBxdWVyeSBtb2RlCiAgICAgICAgaWYgKHN0YXRlLm1haWxib3gucXVlcnkgJiYgc3RhdGUubWFpbGJveC5xdWVyeSAhPT0gJycpIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIG1haWxib3hUaHJlYWRzOiB7ICRzZXQ6IG1ldGEKICAgICAgICAgICAgICAgICAgICA/IHJlc291cmNlUmVmcmVzaGluZyhzdGF0ZS5tYWlsYm94VGhyZWFkcy5kYXRhIHx8IFtdKQogICAgICAgICAgICAgICAgICAgIDogcmVzb3VyY2VMb2FkaW5nKCkgfSwKICAgICAgICB9KTsKICAgIH0sCiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsKICAgICAgICAvLyBEbyBub3QgaW5jcmVtZW50IHJlZnJlc2ggY291bnRlciB3aGVuIGluIHNhbWUgbWFpbGJveAogICAgICAgIHZhciB1cGRhdGVkSHlkcmF0ZUNvdW50ID0gIW1ldGEKICAgICAgICAgICAgPyBzdGF0ZS5tYWlsYm94Lmh5ZHJhdGVDb3VudCB8fCAwICsgMQogICAgICAgICAgICA6IHN0YXRlLm1haWxib3guaHlkcmF0ZUNvdW50OwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgbWFpbGJveFRocmVhZHM6IHsgJHNldDogcmVzb3VyY2VPayhwYXlsb2FkKSB9LAogICAgICAgICAgICBtYWlsYm94OiB7CiAgICAgICAgICAgICAgICBoeWRyYXRlQ291bnQ6IHsgJHNldDogdXBkYXRlZEh5ZHJhdGVDb3VudCB9LAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9mLnR5cGUpLCB0aHJlYWRMaXN0ID0gX2YuYWN0aW9uLCB0aHJlYWRMaXN0UmVkdWNlciA9IF9mLnJlZHVjZXI7CmV4cG9ydCB2YXIgVEhSRUFEU19TRUxFQ1RFRF9DT05UQUNUID0gKF9nID0gY3JlYXRlKCdUSFJFQURTX1NFTEVDVEVEX0NPTlRBQ1QnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgaWYgKG1ldGEgPT09ICcnKSB7CiAgICAgICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29udGFjdFRocmVhZHM6IHsgJHNldDogW10gfSwKICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29udGFjdEZpbGVzOiB7ICRzZXQ6IFtdIH0sCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RhdGU7CiAgICB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzZWxlY3RlZENvbnRhY3RUaHJlYWRzOiB7ICRzZXQ6IHBheWxvYWQgfSwKICAgICAgICAgICAgc2VsZWN0ZWRDb250YWN0RmlsZXM6IHsKICAgICAgICAgICAgICAgICRzZXQ6IGZsYXRNYXAocGF5bG9hZAogICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHRocmVhZCkgeyByZXR1cm4gdGhyZWFkLmhhc0F0dGFjaG1lbnRzICYmIHRocmVhZC5tZXNzYWdlcy5sZW5ndGg7IH0pLCBmdW5jdGlvbiAodGhyZWFkKSB7IHJldHVybiBmbGF0dGVuKHRocmVhZC5tZXNzYWdlcy5tYXAoZnVuY3Rpb24gKG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVzc2FnZS5hdHRhY2htZW50cwogICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhdHRhY2htZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAhYXR0YWNobWVudC5pbmxpbmUgJiYgIWVuZHNXaXRoKGF0dGFjaG1lbnQuZmlsZW5hbWUudG9Mb3dlckNhc2UoKSwgJy5pY3MnKTsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChhdHRhY2htZW50KSB7IHJldHVybiAoewogICAgICAgICAgICAgICAgICAgICAgICBhdHRhY2htZW50OiBhdHRhY2htZW50LAogICAgICAgICAgICAgICAgICAgICAgICBjb250YWN0OiBtZXNzYWdlLmZyb20sCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWQ6IG1lc3NhZ2UuaW50ZXJuYWwsCiAgICAgICAgICAgICAgICAgICAgfSk7IH0pOwogICAgICAgICAgICAgICAgfSkpOyB9KSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCn0pLCBfZy50eXBlKSwgdGhyZWFkc1NlbGVjdGVkQ29udGFjdCA9IF9nLmFjdGlvbiwgdGhyZWFkc1NlbGVjdGVkQ29udGFjdFJlZHVjZXIgPSBfZy5yZWR1Y2VyOwpleHBvcnQgdmFyIFRIUkVBRF9GRVRDSCA9IChfaCA9IGNyZWF0ZSgnVEhSRUFEX0ZFVENIJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIHZhciBfYTsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIHRocmVhZHM6IChfYSA9IHt9LAogICAgICAgICAgICAgICAgX2FbbWV0YV0gPSB7ICRzZXQ6IHJlc291cmNlTG9hZGluZygpIH0sCiAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgfSk7CiAgICB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgdGhyZWFkczogKF9hID0ge30sCiAgICAgICAgICAgICAgICBfYVttZXRhXSA9IHsgJHNldDogcmVzb3VyY2VPayhwYXlsb2FkKSB9LAogICAgICAgICAgICAgICAgX2EpLAogICAgICAgIH0pOwogICAgfSwKICAgIGZhaWx1cmU6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgZXJyb3IpIHsKICAgICAgICB2YXIgX2E7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICB0aHJlYWRzOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgIF9hW21ldGFdID0geyAkc2V0OiByZXNvdXJjZUZhaWxlZChlcnJvcikgfSwKICAgICAgICAgICAgICAgIF9hKSwKICAgICAgICB9KTsKICAgIH0sCn0pLCBfaC50eXBlKSwgdGhyZWFkRmV0Y2ggPSBfaC5hY3Rpb24sIHRocmVhZEZldGNoUmVkdWNlciA9IF9oLnJlZHVjZXI7CmV4cG9ydCB2YXIgVEhSRUFEX1VQREFURSA9IChfaiA9IGNyZWF0ZSgnVEhSRUFEX1VQREFURScsIHsKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgewogICAgICAgIGlmIChzdGF0ZS5zZWxlY3RlZFRocmVhZCAmJiBzdGF0ZS5zZWxlY3RlZFRocmVhZC5pZCA9PT0gcGF5bG9hZC5pZCkgewogICAgICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7IHNlbGVjdGVkVGhyZWFkOiB7ICRzZXQ6IHBheWxvYWQgfSB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgfSwKfSksIF9qLnR5cGUpLCB0aHJlYWRVcGRhdGUgPSBfai5hY3Rpb24sIHRocmVhZFVwZGF0ZVJlZHVjZXIgPSBfai5yZWR1Y2VyOwpleHBvcnQgdmFyIFRIUkVBRF9TV0lQRV9JRF9TRVQgPSAoX2sgPSBjcmVhdGUoJ1RIUkVBRF9TV0lQRV9JRF9TRVQnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICB0aHJlYWRTd2lwZUlkOiB7ICRzZXQ6IG1ldGEgJiYgbWV0YSB8fCB1bmRlZmluZWQgfSwKICAgICAgICB9KTsKICAgIH0sCn0pLCBfay50eXBlKSwgdGhyZWFkU3dpcGVJZFNldCA9IF9rLmFjdGlvbiwgdGhyZWFkU3dpcGVJZFNldFJlZHVjZXIgPSBfay5yZWR1Y2VyOwovLyBSZW1vdmVzIHNlbGVjdGVkIHRocmVhZCBvbiBzdWNjZXNzZnVsIGRlbGV0ZQpleHBvcnQgdmFyIFRIUkVBRF9ERUxFVEUgPSAoX2wgPSBjcmVhdGUoJ1RIUkVBRF9ERUxFVEUnLCB7CiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEpIHsKICAgICAgICAvLyBSZW1vdmUgZnJvbSBtYWlsYm94VGhyZWFkcwogICAgICAgIHZhciBzZWxlY3RlZE1hdGNoID0gc3RhdGUuc2VsZWN0ZWRUaHJlYWQgJiYgc3RhdGUuc2VsZWN0ZWRUaHJlYWQuaWQgPT09IG1ldGE7CiAgICAgICAgLy8gUmVtb3ZlIGZyb20gc2VsZWN0ZWRUaHJlYWQKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIHNlbGVjdGVkVGhyZWFkOiB7CiAgICAgICAgICAgICAgICAkc2V0OiBzZWxlY3RlZE1hdGNoID8gbnVsbCA6IHN0YXRlLnNlbGVjdGVkVGhyZWFkLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9sLnR5cGUpLCB0aHJlYWREZWxldGUgPSBfbC5hY3Rpb24sIHRocmVhZERlbGV0ZVJlZHVjZXIgPSBfbC5yZWR1Y2VyOwovLyBUaHJlYWQgTW92ZSBVbmRvIFJlZHVjZXIgdW5zZXRzIHNlbGVjdGVkSWRzCmV4cG9ydCB2YXIgVEhSRUFEX01PVkVfVU5ETyA9IChfbSA9IGNyZWF0ZSgnVEhSRUFEX01PVkVfVU5ETycsIHt9KSwgX20udHlwZSksIHRocmVhZE1vdmVVbmRvID0gX20uYWN0aW9uLCB0aHJlYWRNb3ZlVW5kb1JlZHVjZXIgPSBfbS5yZWR1Y2VyOwovLyBUaHJlYWRTaW5nbGUgdXBkYXRlcyBhbnkgY3VycmVudGx5IHNlbGVjdGVkIHRocmVhZHMgZnJvbSBhIGhpc3RvcnkgZXZlbnQKZXhwb3J0IHZhciBUSFJFQURfU0lOR0xFID0gKF9vID0gY3JlYXRlKCdUSFJFQURfU0lOR0xFJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIHZhciBfYSwgX2I7CiAgICAgICAgLy8gSWRlbnRpZmllcyBpZiB0aHJlYWQgc2hvdWxkIGJlIHVwZGF0ZWQKICAgICAgICB2YXIgZXhpc3RpbmdUaHJlYWQ7CiAgICAgICAgdmFyIGV4aXN0aW5nVGhyZWFkS2V5OwogICAgICAgIGlmIChzdGF0ZS5zZWxlY3RlZFRocmVhZCkgewogICAgICAgICAgICBleGlzdGluZ1RocmVhZCA9IHN0YXRlLnNlbGVjdGVkVGhyZWFkOwogICAgICAgICAgICBleGlzdGluZ1RocmVhZEtleSA9ICdzZWxlY3RlZFRocmVhZCc7CiAgICAgICAgfQogICAgICAgIC8vIFVwZGF0ZSBtYWlsYm94IHRocmVhZCBpbiBzdGF0ZSBpZiBhIG1hdGNoaW5nIHRocmVhZCBleGlzdHMKICAgICAgICB2YXIgbWFpbGJveFRocmVhZEluZGV4ID0gc3RhdGUubWFpbGJveFRocmVhZHMgJiYgc3RhdGUubWFpbGJveFRocmVhZHMuZGF0YSAmJgogICAgICAgICAgICBmaW5kSW5kZXgoc3RhdGUubWFpbGJveFRocmVhZHMuZGF0YSwgeyBpZDogbWV0YS5pZCB9KTsKICAgICAgICB2YXIgbWFpbGJveFRocmVhZFVwZGF0ZSA9IG1haWxib3hUaHJlYWRJbmRleCAhPT0gdW5kZWZpbmVkICYmIG1haWxib3hUaHJlYWRJbmRleCA+IC0xICYmIHsKICAgICAgICAgICAgbWFpbGJveFRocmVhZHM6IHsKICAgICAgICAgICAgICAgIGRhdGE6IChfYSA9IHt9LAogICAgICAgICAgICAgICAgICAgIF9hW21haWxib3hUaHJlYWRJbmRleF0gPSB7ICRzZXQ6IG1ldGEgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSB8fCB7fTsKICAgICAgICAvLyBVcGRhdGUgZm9yIGV4aXN0aW5nIHRocmVhZAogICAgICAgIHZhciBuZXdUaHJlYWQgPSBtZXRhLm1lc3NhZ2VzLmxlbmd0aCA+IDAgPyBtZXRhIDogdW5kZWZpbmVkOwogICAgICAgIHZhciBleGlzdGluZ1RocmVhZFVwZGF0ZSA9IGV4aXN0aW5nVGhyZWFkICYmIGV4aXN0aW5nVGhyZWFkS2V5ICYmCiAgICAgICAgICAgIG1hdGNoZXNUaHJlYWQoZXhpc3RpbmdUaHJlYWQsIG1ldGEpICYmIChfYiA9IHt9LAogICAgICAgICAgICBfYltleGlzdGluZ1RocmVhZEtleV0gPSB7CiAgICAgICAgICAgICAgICAkc2V0OiBuZXdUaHJlYWQsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIF9iKSB8fCB7fTsKICAgICAgICAvLyBVcGRhdGUgbWFpbGJveFRocmVhZHMgYW5kIGV4aXN0aW5nIHRocmVhZHMgaWYgYW55IGhhdmUgY2hhbmdlZAogICAgICAgIGlmIChtYWlsYm94VGhyZWFkVXBkYXRlIHx8IGV4aXN0aW5nVGhyZWFkVXBkYXRlKSB7CiAgICAgICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIF9fYXNzaWduKF9fYXNzaWduKHt9LCBleGlzdGluZ1RocmVhZFVwZGF0ZSksIG1haWxib3hUaHJlYWRVcGRhdGUpKTsKICAgICAgICB9CiAgICAgICAgLy8gT3RoZXJ3aXNlIHJldHVybiBzdGF0ZQogICAgICAgIHJldHVybiBzdGF0ZTsKICAgIH0sCn0pLCBfby50eXBlKSwgdGhyZWFkU2luZ2xlID0gX28uYWN0aW9uLCB0aHJlYWRTaW5nbGVSZWR1Y2VyID0gX28ucmVkdWNlcjsKLy8gVG9nZ2xlcyBJbmNyZW1lbnRhbCBTeW5jIGluZGljYXRvcgpleHBvcnQgdmFyIElOQ1JFTUVOVEFMX1NUQVRVU19UT0dHTEUgPSAoX3AgPSBjcmVhdGUoJ0lOQ1JFTUVOVEFMX1NUQVRVU19UT0dHTEUnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7IHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICBpbmNyZW1lbnRhbFN5bmNpbmc6IHsgJHNldDogbWV0YSB9LAogICAgfSk7IH0sCn0pLCBfcC50eXBlKSwgaW5jcmVtZW50YWxTdGF0dXNUb2dnbGUgPSBfcC5hY3Rpb24sIGluY3JlbWVudGFsU3RhdHVzVG9nZ2xlUmVkdWNlciA9IF9wLnJlZHVjZXI7CmV4cG9ydCB2YXIgVEhSRUFEX0FUVEFDSE1FTlRfRE9XTkxPQURfUFJPR1JFU1MgPSAoX3EgPSBjcmVhdGUoJ1RIUkVBRF9BVFRBQ0hNRU5UX0RPV05MT0FEX1BST0dSRVNTJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIHZhciBfYTsKICAgICAgICB2YXIgZXhpc3RpbmcgPSBzdGF0ZS5hdHRhY2htZW50c0Rvd25sb2FkaW5nW21ldGEuaWRdOwogICAgICAgIGlmIChleGlzdGluZyAmJiBleGlzdGluZy5wcm9ncmVzcyA9PT0gMSkgewogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgfQogICAgICAgIGlmIChtZXRhLnByb2dyZXNzID09PSAxICYmIHN0YXRlLmF0dGFjaG1lbnRzRG93bmxvYWRpbmdbbWV0YS5pZF0gIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICBzdGF0ZS5hdHRhY2htZW50c0Rvd25sb2FkaW5nW21ldGEuaWRdLnByZXZpZXcpIHsKICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICAgICAgYXR0YWNobWVudHNEb3dubG9hZGluZzogewogICAgICAgICAgICAgICAgICAgICR1bnNldDogW21ldGEuaWRdLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChtZXRhLnByb2dyZXNzID09PSAxICYmIG1ldGEucHJldmlldykgewogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgYXR0YWNobWVudHNEb3dubG9hZGluZzogKF9hID0ge30sCiAgICAgICAgICAgICAgICBfYVttZXRhLmlkXSA9IHsKICAgICAgICAgICAgICAgICAgICAkc2V0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyZXNzOiBtZXRhLnByb2dyZXNzLAogICAgICAgICAgICAgICAgICAgICAgICBwcmV2aWV3OiBtZXRhLnByZXZpZXcsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX3EudHlwZSksIHRocmVhZEF0dGFjaG1lbnREb3dubG9hZFByb2dyZXNzID0gX3EuYWN0aW9uLCB0aHJlYWRBdHRhY2htZW50RG93bmxvYWRQcm9ncmVzc1JlZHVjZXIgPSBfcS5yZWR1Y2VyOwpleHBvcnQgdmFyIEFUVEFDSE1FTlRfRE9XTkxPQURfUFJPR1JFU1NfQ0xFQVIgPSAoX3IgPSBjcmVhdGUoJ0FUVEFDSE1FTlRfRE9XTkxPQURfUFJPR1JFU1NfQ0xFQVInLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBhdHRhY2htZW50c0Rvd25sb2FkaW5nOiB7CiAgICAgICAgICAgICAgICAkc2V0OiB7fSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCn0pLCBfci50eXBlKSwgYXR0YWNobWVudERvd25sb2FkUHJvZ3Jlc3NDbGVhciA9IF9yLmFjdGlvbiwgYXR0YWNobWVudERvd25sb2FkUHJvZ3Jlc3NDbGVhclJlZHVjZXIgPSBfci5yZWR1Y2VyOwpleHBvcnQgdmFyIFRIUkVBRF9MSVNUX1dJRFRIX1NFVCA9IChfcyA9IGNyZWF0ZSgnVEhSRUFEX0xJU1RfV0lEVEhfU0VUJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0aHJlYWRMaXN0V2lkdGgnLCBtZXRhLnRvU3RyaW5nKCkpOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgdGhyZWFkTGlzdFdpZHRoOiB7ICRzZXQ6IG1ldGEgfSwKICAgICAgICB9KTsKICAgIH0sCn0pLCBfcy50eXBlKSwgdGhyZWFkTGlzdFdpZHRoU2V0ID0gX3MuYWN0aW9uLCB0aHJlYWRMaXN0V2lkdGhTZXRSZWR1Y2VyID0gX3MucmVkdWNlcjsKLy8gVGhyZWFkIENvbW1pdCBtZXRhCmV4cG9ydCB2YXIgVEhSRUFEX0NPTU1JVFNfU1VCTUlUID0gJ1RIUkVBRF9DT01NSVRTX1NVQk1JVCc7CmV4cG9ydCB2YXIgdGhyZWFkQ29tbWl0c1N1Ym1pdCA9IGNyZWF0ZUFjdGlvbihUSFJFQURfQ09NTUlUU19TVUJNSVQpOwovLyBSdW5zIHNlbGVjdG9yIHRvIHRyeSB0byByZXRyaWV2ZSB0aHJlYWQgZnJvbSBtYWlsYm94VGhyZWFkcyBpZiBleGlzdHMKZXhwb3J0IHZhciBzZWxlY3RUaHJlYWQgPSBjcmVhdGVTZWxlY3RvcihbCiAgICBmdW5jdGlvbiAoc3RhdGUsIHRocmVhZElkKSB7IHJldHVybiBzdGF0ZS5tYWlsYm94VGhyZWFkcy5kYXRhOyB9LAogICAgZnVuY3Rpb24gKHN0YXRlLCB0aHJlYWRJZCkgeyByZXR1cm4gdGhyZWFkSWQ7IH0sCl0sIGZ1bmN0aW9uICh0aHJlYWRzLCB0aHJlYWRJZCkgewogICAgaWYgKCF0aHJlYWRzIHx8ICF0aHJlYWRzLmxlbmd0aCkgewogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICB2YXIgdGhyZWFkc0RpY3QgPSB0aHJlYWRzICYmIGtleUJ5KHRocmVhZHMsICdpZCcpOwogICAgcmV0dXJuIHRocmVhZHNEaWN0ICYmIHRocmVhZHNEaWN0W3RocmVhZElkXTsKfSwgZnVuY3Rpb24gKHRocmVhZHMsIHRocmVhZElkKSB7IHJldHVybiBmbnYxYTMyKHRocmVhZElkKTsgfSwgWydtYWlsYm94VGhyZWFkcyddKTsKLy8gU2VsZWN0b3IKZXhwb3J0IHZhciBzZWxlY3RBY3Rpdml0eVRocmVhZCA9IGNyZWF0ZVNlbGVjdG9yKFsKICAgIGZ1bmN0aW9uIChzdGF0ZSwgdGhyZWFkSWQpIHsKICAgICAgICB2YXIgdGhyZWFkID0gc3RhdGUudGhyZWFkc1t0aHJlYWRJZF07CiAgICAgICAgaWYgKHRocmVhZCAmJiB0aHJlYWQuZGF0YSkgewogICAgICAgICAgICByZXR1cm4gdGhyZWFkLmRhdGE7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9LApdLCBmdW5jdGlvbiAodGhyZWFkLCB0aHJlYWRJZCkgewogICAgaWYgKHRocmVhZCkgewogICAgICAgIHJldHVybiB0aHJlYWQ7CiAgICB9CiAgICByZXR1cm4gY29tcHV0ZVRocmVhZCh7IGlkOiB0aHJlYWRJZCB9KTsKfSwgZnVuY3Rpb24gKHRocmVhZCwgdGhyZWFkSWQpIHsgcmV0dXJuIGZudjFhMzIodGhyZWFkSWQpOyB9KTsKLy8gRGVmYXVsdCBFeHBvcnQKZXhwb3J0IGRlZmF1bHQgWwogICAgaW5jcmVtZW50YWxTdGF0dXNUb2dnbGVSZWR1Y2VyLAogICAgY29udGFjdFRocmVhZFNlbGVjdFJlZHVjZXIsCiAgICB0aHJlYWRMaXN0UmVkdWNlciwKICAgIHRocmVhZFNlbGVjdFJlZHVjZXIsCiAgICB0aHJlYWRVcGRhdGVSZWR1Y2VyLAogICAgdGhyZWFkU2luZ2xlUmVkdWNlciwKICAgIHRocmVhZHNTZWxlY3RlZENvbnRhY3RSZWR1Y2VyLAogICAgdGhyZWFkc1NlYXJjaFJlZHVjZXIsCiAgICB0aHJlYWRGZXRjaFJlZHVjZXIsCiAgICBzZWxlY3RlZElkc1VwZGF0ZVJlZHVjZXIsCiAgICB0aHJlYWRTd2lwZUlkU2V0UmVkdWNlciwKICAgIHRocmVhZEF0dGFjaG1lbnREb3dubG9hZFByb2dyZXNzUmVkdWNlciwKICAgIGF0dGFjaG1lbnREb3dubG9hZFByb2dyZXNzQ2xlYXJSZWR1Y2VyLAogICAgdGhyZWFkTGlzdFdpZHRoU2V0UmVkdWNlciwKICAgIHRocmVhZERlbGV0ZVJlZHVjZXIsCiAgICB0aHJlYWREaXNhYmxlVHJhY2tSZWR1Y2VyLApdOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/threads.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/threads.ts"],"names":[],"mappings":"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","sourcesContent":["import { create, createAction, createSingle } from '@src/lib/redux';\nimport update from 'immutability-helper';\nimport { flatMap, flatten, endsWith, keyBy, findIndex, isEqual, size, uniqBy } from 'lodash';\n\nimport { Mailbox, Thread, Commit, ThreadCommitMeta, ResourceStatus } from '@src/types';\nimport { resourceLoading, resourceOk, resourceFailed, resourceRefreshing } from '@src/lib/resource';\nimport { createSelector } from '@src/lib/selector';\nimport { computeThread, matchesThread } from '@src/lib/thread';\nimport { fnv1a32 } from '@src/lib/crypt';\nimport { parseQueryParams } from '@src/lib/search';\n\nexport const {\n  type: THREAD_DISABLE_TRACK,\n  action: threadDisableTrack,\n  reducer: threadDisableTrackReducer,\n} = create<string|Error, Thread|null>('THREAD_DISABLE_TRACK', {\n  success: (state, meta, payload) =>\n    update(state, {\n      selectedThread: { $set: payload },\n    }),\n});\n\n// Thread Select\n// NOTE: This action should not be used directly.\n// It is trigerred by location changes to update the selectedThread\nexport const {\n  type: THREAD_SELECT,\n  action: threadSelect,\n  reducer: threadSelectReducer,\n} = create<string, Thread|null>('THREAD_SELECT', {\n  success: (state, meta, payload) =>\n    update(state, {\n      selectedThread: { $set: payload === null ? undefined : payload },\n    }),\n});\n\nexport const {\n  type: CONTACT_THREAD_SELECT,\n  action: contactThreadSelect,\n  reducer: contactThreadSelectReducer,\n} = create<Thread|undefined, Thread>('CONTACT_THREAD_SELECT', {\n  start: (state, meta) =>\n    update(state, {\n      selectedContactThread: { $set: meta },\n    }),\n});\n\n// Update multiple selections\nexport const {\n  type: SELECTED_IDS_UPDATE,\n  action: selectedIdsUpdate,\n  reducer: selectedIdsUpdateReducer,\n} = createSingle<Map<string, boolean>>('SELECTED_IDS_UPDATE', (state, meta) =>\n  update(state, {\n    selectedIds: { $set: meta },\n  }),\n);\n\nexport interface ThreadSearchMeta {\n  query: string;\n  provider?: boolean;\n}\n\nexport interface ThreadSearchPayload {\n  provider: boolean;\n  threads: Thread[];\n}\n\n// HACK(SHIN & JEFF): Clears mailbox threads when search starts. When success createSelector\n// MailboxThreads is refreshed, since mode has cleared ThreadsDataSource, it will appendSortedItems\n// and TDS will update with search results\nexport const {\n  type: THREADS_SEARCH,\n  action: threadsSearch,\n  reducer: threadsSearchReducer,\n} = create<ThreadSearchMeta, ThreadSearchPayload>('THREADS_SEARCH', {\n  start: (state, meta) => {\n    const queryParams = parseQueryParams(meta.query, state.lists);\n    const queryChanged = !isEqual(queryParams, state.mailbox.queryParams);\n    const providerSearchChanged = meta.provider !== state.mailbox.providerSearch;\n    if (!queryChanged && !providerSearchChanged) {\n      return state;\n    }\n\n    // Set query/queryParams to undefined if no value, in order to match cleared mailbox behavior\n    const updatedQuery = !!meta.query && meta.query || undefined;\n    const updatedQueryParams = !!size(Object.keys(queryParams)) && queryParams || undefined;\n    return update(state, {\n      mailbox: {\n        query: { $set: updatedQuery },\n        queryParams: { $set:  updatedQueryParams },\n        providerSearch: { $set: meta.provider },\n        providerSearchComplete: { $set: false },\n      },\n      selectedIds: { $set: new Map() },\n      // selectedThread: { $set: undefined },\n      mailboxThreads: { $set: queryChanged ? resourceLoading() : state.mailboxThreads },\n    });\n  },\n  success: (state, meta, payload) => {\n    // If have results replace mailboxThreads with results\n    const oldMailboxThreads = state.mailboxThreads.data || [];\n    const concatResults = oldMailboxThreads.concat(payload.threads);\n    const uniqThreads = uniqBy(concatResults, 'id');\n\n    // Otherwise return\n    return update(state, {\n      mailboxThreads: {\n        status: { $set: ResourceStatus.Ok },\n        data: { $set: uniqThreads },\n      },\n      mailbox: {\n        providerSearchComplete: {\n          $set: payload.provider && true || state.mailbox.providerSearchComplete,\n        },\n      },\n    });\n  },\n});\n\n// Thread List\n// NOTE: This action should not be used directly.\n// It is trigerred by location changes to update the selectedThread\n// It is also trigerred by Bridge ThreadUpdate events\n// Meta identifies whether thread list should be refreshed or not\nexport const {\n  type: THREAD_LIST,\n  action: threadList,\n  reducer: threadListReducer,\n} = create<boolean, Thread[]>('THREAD_LIST', {\n  start: (state, meta) => {\n    // Don't refresh mailbox while in query mode\n    if (state.mailbox.query && state.mailbox.query !== '') {\n      return state;\n    }\n    return update(state, {\n      mailboxThreads: { $set: meta\n        ? resourceRefreshing(state.mailboxThreads.data || [])\n        : resourceLoading() },\n    });\n  },\n  success: (state, meta, payload) => {\n    // Do not increment refresh counter when in same mailbox\n    const updatedHydrateCount = !meta\n      ? state.mailbox.hydrateCount || 0 + 1\n      : state.mailbox.hydrateCount;\n    return update(state, {\n      mailboxThreads: { $set: resourceOk(payload) },\n      mailbox: {\n        hydrateCount: { $set: updatedHydrateCount },\n      },\n    });\n  },\n});\n\nexport const {\n  type: THREADS_SELECTED_CONTACT,\n  action: threadsSelectedContact,\n  reducer: threadsSelectedContactReducer,\n} = create<string, Thread[]>('THREADS_SELECTED_CONTACT', {\n  start: (state, meta) => {\n    if (meta === '') {\n      return update(state, {\n        selectedContactThreads: { $set: [] },\n        selectedContactFiles: { $set: [] },\n      });\n    }\n\n    return state;\n  },\n  success: (state, meta, payload) =>\n    update(state, {\n      selectedContactThreads: { $set: payload },\n      selectedContactFiles: {\n        $set: flatMap(\n          payload\n            .filter(thread => thread.hasAttachments && thread.messages.length),\n          thread => flatten(thread.messages.map(message =>\n            message.attachments\n              .filter(attachment =>\n                !attachment.inline && !endsWith(attachment.filename.toLowerCase(), '.ics'),\n              )\n              .map(attachment => ({\n                attachment,\n                contact: message.from,\n                created: message.internal,\n              })),\n          ))),\n      },\n    }),\n});\n\nexport const {\n  type: THREAD_FETCH,\n  action: threadFetch,\n  reducer: threadFetchReducer,\n} = create<string, Thread>('THREAD_FETCH', {\n  start: (state, meta) =>\n    update(state, {\n      threads: {\n        [meta]: { $set: resourceLoading<Thread>() },\n      },\n    }),\n  success: (state, meta, payload) =>\n    update(state, {\n      threads: {\n        [meta]: { $set: resourceOk<Thread>(payload) },\n      },\n    }),\n  failure: (state, meta, error) =>\n    update(state, {\n      threads: {\n        [meta]: { $set: resourceFailed<Thread>(error) },\n      },\n    }),\n});\n\nexport const {\n  type: THREAD_UPDATE,\n  action: threadUpdate,\n  reducer: threadUpdateReducer,\n} = create<Commit, Thread>('THREAD_UPDATE', {\n  success: (state, meta, payload) => {\n    if (state.selectedThread && state.selectedThread.id === payload.id) {\n      return update(state, { selectedThread: { $set: payload } });\n    }\n    return state;\n  },\n});\n\nexport const {\n  type: THREAD_SWIPE_ID_SET,\n  action: threadSwipeIdSet,\n  reducer: threadSwipeIdSetReducer,\n} = create<string|null, null>('THREAD_SWIPE_ID_SET', {\n  start: (state, meta) => {\n    return update(state, {\n      threadSwipeId: { $set: meta && meta || undefined },\n    });\n  },\n});\n\n// Removes selected thread on successful delete\nexport const {\n  type: THREAD_DELETE,\n  action: threadDelete,\n  reducer: threadDeleteReducer,\n} = create<string, null>('THREAD_DELETE', {\n  success: (state, meta) => {\n    // Remove from mailboxThreads\n    const selectedMatch = state.selectedThread && state.selectedThread.id === meta;\n\n    // Remove from selectedThread\n    return update(state, {\n      selectedThread: {\n        $set: selectedMatch ? null : state.selectedThread,\n      },\n    });\n  },\n});\n\n// Thread Move Undo Reducer unsets selectedIds\nexport const {\n  type: THREAD_MOVE_UNDO,\n  action: threadMoveUndo,\n  reducer: threadMoveUndoReducer,\n} = create<Mailbox, Thread>('THREAD_MOVE_UNDO', {});\n\n// ThreadSingle updates any currently selected threads from a history event\nexport const {\n  type: THREAD_SINGLE,\n  action: threadSingle,\n  reducer: threadSingleReducer,\n} = create<Thread, undefined>('THREAD_SINGLE', {\n  start: (state, meta) => {\n    // Identifies if thread should be updated\n    let existingThread: Thread | undefined;\n    let existingThreadKey: string| undefined;\n    if (state.selectedThread) {\n      existingThread = state.selectedThread;\n      existingThreadKey = 'selectedThread';\n    }\n\n    // Update mailbox thread in state if a matching thread exists\n    const mailboxThreadIndex = state.mailboxThreads && state.mailboxThreads.data &&\n      findIndex(state.mailboxThreads.data, { id: meta.id });\n    const mailboxThreadUpdate = mailboxThreadIndex !== undefined && mailboxThreadIndex > -1 && {\n      mailboxThreads: {\n        data: {\n          [mailboxThreadIndex]: { $set: meta },\n        },\n      },\n    } || {};\n\n    // Update for existing thread\n    const newThread = meta.messages.length > 0 ? meta : undefined;\n    const existingThreadUpdate = existingThread && existingThreadKey &&\n      matchesThread(existingThread, meta) &&\n      {\n        [existingThreadKey]: {\n          $set: newThread,\n        },\n      } || {};\n\n    // Update mailboxThreads and existing threads if any have changed\n    if (mailboxThreadUpdate || existingThreadUpdate) {\n      return update(state, {\n        ...existingThreadUpdate,\n        ...mailboxThreadUpdate,\n      });\n    }\n\n    // Otherwise return state\n    return state;\n  },\n});\n\n// Toggles Incremental Sync indicator\nexport const {\n  type: INCREMENTAL_STATUS_TOGGLE,\n  action: incrementalStatusToggle,\n  reducer: incrementalStatusToggleReducer,\n} = create<boolean, undefined>('INCREMENTAL_STATUS_TOGGLE', {\n  start: (state, meta) => update(state, {\n    incrementalSyncing: { $set: meta },\n  }),\n});\n\nexport interface AttachmentDownloadProgressMeta {\n  id: string;\n  progress: number;\n  preview: boolean;\n}\n\nexport const {\n  type: THREAD_ATTACHMENT_DOWNLOAD_PROGRESS,\n  action: threadAttachmentDownloadProgress,\n  reducer: threadAttachmentDownloadProgressReducer,\n} = create<\n  AttachmentDownloadProgressMeta,\n  AttachmentDownloadProgressMeta\n>('THREAD_ATTACHMENT_DOWNLOAD_PROGRESS', {\n  start: (state, meta) => {\n    const existing = state.attachmentsDownloading[meta.id];\n    if (existing && existing.progress === 1) {\n      return state;\n    }\n\n    if (meta.progress === 1 && state.attachmentsDownloading[meta.id] !== undefined &&\n      state.attachmentsDownloading[meta.id].preview) {\n      return update(state, {\n        attachmentsDownloading: {\n          $unset: [meta.id],\n        },\n      });\n    }\n\n    if (meta.progress === 1 && meta.preview) {\n      return state;\n    }\n\n    return update(state, {\n      attachmentsDownloading: {\n        [meta.id]: {\n          $set: {\n            progress: meta.progress,\n            preview: meta.preview,\n          },\n        },\n      },\n    });\n  },\n});\n\nexport const {\n  type: ATTACHMENT_DOWNLOAD_PROGRESS_CLEAR,\n  action: attachmentDownloadProgressClear,\n  reducer: attachmentDownloadProgressClearReducer,\n} = create<null, undefined>('ATTACHMENT_DOWNLOAD_PROGRESS_CLEAR', {\n  start: (state, meta) =>\n    update(state, {\n      attachmentsDownloading: {\n        $set: {},\n      },\n    }),\n});\n\nexport const {\n  type: THREAD_LIST_WIDTH_SET,\n  action: threadListWidthSet,\n  reducer: threadListWidthSetReducer,\n} = create<number, undefined>('THREAD_LIST_WIDTH_SET', {\n  start: (state, meta) => {\n    localStorage.setItem('threadListWidth', meta.toString());\n\n    return update(state, {\n      threadListWidth: { $set: meta },\n    });\n  },\n});\n\n// Thread Commit meta\nexport const THREAD_COMMITS_SUBMIT = 'THREAD_COMMITS_SUBMIT';\nexport const threadCommitsSubmit =\n  createAction<ThreadCommitMeta, null>(THREAD_COMMITS_SUBMIT);\n\n// Runs selector to try to retrieve thread from mailboxThreads if exists\nexport const selectThread = createSelector<string, Thread[]|string|undefined, Thread|undefined>(\n  [\n    (state, threadId) => state.mailboxThreads.data,\n    (state, threadId) => threadId,\n  ],\n  (threads: Thread[], threadId: string) => {\n    if (!threads || !threads.length) {\n      return undefined;\n    }\n    const threadsDict = threads && keyBy(threads, 'id');\n    return threadsDict && threadsDict[threadId];\n  },\n  (threads: Thread[], threadId: string) => fnv1a32(threadId),\n  ['mailboxThreads'],\n);\n\n// Selector\nexport const selectActivityThread = createSelector<string, Thread|undefined, Thread>(\n  [\n    (state, threadId) => {\n      const thread = state.threads[threadId];\n\n      if (thread && thread.data) {\n        return thread.data;\n      }\n\n      return undefined;\n    },\n  ],\n  (thread: Thread, threadId: string) => {\n    if (thread) {\n      return thread;\n    }\n\n    return computeThread({ id: threadId } as any);\n  },\n  (thread: Thread, threadId: string) => fnv1a32(threadId),\n);\n\n// Default Export\nexport default [\n  incrementalStatusToggleReducer,\n  contactThreadSelectReducer,\n  threadListReducer,\n  threadSelectReducer,\n  threadUpdateReducer,\n  threadSingleReducer,\n  threadsSelectedContactReducer,\n  threadsSearchReducer,\n  threadFetchReducer,\n  selectedIdsUpdateReducer,\n  threadSwipeIdSetReducer,\n  threadAttachmentDownloadProgressReducer,\n  attachmentDownloadProgressClearReducer,\n  threadListWidthSetReducer,\n  threadDeleteReducer,\n  threadDisableTrackReducer,\n];\n"]}]}