{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/PublicSharedThreads/PublicSharedThreads.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/PublicSharedThreads/PublicSharedThreads.tsx","mtime":1675280254085},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHsKICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7CiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkKICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgIH07CiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfTsKaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JzsKaW1wb3J0IFNpZ25VcEhlYWRlciBmcm9tICcuL2NvbXBvbmVudHMvU2lnblVwSGVhZGVyL1NpZ25VcEhlYWRlcic7CmltcG9ydCAnLi9QdWJsaWNTaGFyZWRUaHJlYWRzLnNjc3MnOwppbXBvcnQgeyBDZWxsVHlwZSwgU2hhcmVkVGhyZWFkQWN0aXZpdHlUeXBlLCB9IGZyb20gJ0BzcmMvdHlwZXMvc2hhcmVkVGhyZWFkcyc7CmltcG9ydCB7IHBhcnRpY2lwYW50c1RvU3RyaW5nLCBwYXJzZUFkZHJlc3MgfSBmcm9tICdAc3JjL2xpYi9hZGRyZXNzJzsKaW1wb3J0IENvbGxhcHNlZENlbGwgZnJvbSAnQHNyYy9jb21wb25lbnRzL1RocmVhZERldGFpbC9jb21wb25lbnRzL0NlbGwvQ29sbGFwc2VkQ2VsbCc7CmltcG9ydCB7IGxhc3QsIGZvckVhY2gsIGZpcnN0IH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IEV4cGFuZGVkQ2VsbCBmcm9tICdAc3JjL2NvbXBvbmVudHMvVGhyZWFkRGV0YWlsL2NvbXBvbmVudHMvQ2VsbC9FeHBhbmRlZENlbGwnOwppbXBvcnQgU2lnblVwUG9wb3ZlciBmcm9tICcuL2NvbXBvbmVudHMvU2lnblVwUG9wb3Zlci9TaWduVXBQb3BvdmVyJzsKaW1wb3J0IENvbW1lbnRQb3BvdmVyIGZyb20gJy4vY29tcG9uZW50cy9Db21tZW50UG9wb3Zlci9Db21tZW50UG9wb3Zlcic7CmltcG9ydCBDb21tZW50Q2VsbCBmcm9tICdAc3JjL2NvbXBvbmVudHMvQ2VsbHMvQ29tbWVudENlbGwnOwovLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoCmltcG9ydCBDb21tZW50RWRpdG9yIGZyb20gJ0BzcmMvY29tcG9uZW50cy9UaHJlYWREZXRhaWwvY29tcG9uZW50cy9Db21wb3Nlci9jb21wb25lbnRzL0NvbW1lbnRFZGl0b3InOwovLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoCmltcG9ydCBTaGFyZWRUaHJlYWRFcnJvclBhZ2UgZnJvbSAnQHNyYy9yb3V0ZXMvUHVibGljU2hhcmVkVGhyZWFkcy9jb21wb25lbnRzL1NoYXJlZFRocmVhZEVycm9yUGFnZSc7CmltcG9ydCBicm93c2VySGlzdG9yeSBmcm9tICdAc3JjL2xpYi9icm93c2VySGlzdG9yeSc7CmltcG9ydCBDZW50ZXJlZExvYWRlciBmcm9tICdAc3JjL2NvbXBvbmVudHMvTG9hZGVyL0NlbnRlcmVkTG9hZGVyJzsKaW1wb3J0IHsgUElOR19JTlRFUlZBTCB9IGZyb20gJ0BzcmMvZHVja3Mvc2hhcmVkVGhyZWFkcyc7CmltcG9ydCBUeXBpbmdDZWxsLCB7IFR5cGluZ1R5cGUgfSBmcm9tICdAc3JjL2NvbXBvbmVudHMvQ2VsbHMvVHlwaW5nQ2VsbC9UeXBpbmdDZWxsJzsKaW1wb3J0IFBvbHltYWlsTG9nbyBmcm9tICdAc3JjL3JvdXRlcy9Mb2dpbi9JY29ucy9Qb2x5bWFpbExvZ29AM3gucG5nJzsKaW1wb3J0IHsgSVNfSU9TIH0gZnJvbSAnQHNyYy9saWIvZGV2aWNlJzsKaW1wb3J0IFNoYXJlZERyYWZ0Q2VsbCBmcm9tICdAc3JjL2NvbXBvbmVudHMvVGhyZWFkRGV0YWlsL2NvbXBvbmVudHMvQ2VsbC9TaGFyZWREcmFmdENlbGwnOwppbXBvcnQgeyBBbXBsaXR1ZGVFdmVudHMsIGxvZ0FtcGxpdHVkZUV2ZW50IH0gZnJvbSAnQHNyYy9saWIvYW1wbGl0dWRlLWFuYWx5dGljcyc7CnZhciBQdWJsaWNTaGFyZWRUaHJlYWRzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgX19leHRlbmRzKFB1YmxpY1NoYXJlZFRocmVhZHMsIF9zdXBlcik7CiAgICBmdW5jdGlvbiBQdWJsaWNTaGFyZWRUaHJlYWRzKHByb3BzKSB7CiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7CiAgICAgICAgX3RoaXMucmVjb3JkVmlldyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIHNoYXJlZFRocmVhZCA9IF9hLnNoYXJlZFRocmVhZCwgY3JlYXRlU2hhcmVkVGhyZWFkQWN0aXZpdHkgPSBfYS5jcmVhdGVTaGFyZWRUaHJlYWRBY3Rpdml0eTsKICAgICAgICAgICAgaWYgKHNoYXJlZFRocmVhZCAmJiBzaGFyZWRUaHJlYWQuZGF0YSAmJiBzaGFyZWRUaHJlYWQuZGF0YS5pZCkgewogICAgICAgICAgICAgICAgY3JlYXRlU2hhcmVkVGhyZWFkQWN0aXZpdHkoewogICAgICAgICAgICAgICAgICAgIHR5cGU6IFNoYXJlZFRocmVhZEFjdGl2aXR5VHlwZS5WaWV3LAogICAgICAgICAgICAgICAgICAgIHNoYXJlZFRocmVhZDogc2hhcmVkVGhyZWFkLmRhdGEuaWQsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMucHJvY2Vzc0NlbGxDb2xsYXBzZVN0YXRlcyA9IGZ1bmN0aW9uICh0aHJlYWQsIGZvcmNlRXhwYW5kKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZE1lc3NhZ2VJZCA9IF90aGlzLnByb3BzLnNlbGVjdGVkTWVzc2FnZUlkOwogICAgICAgICAgICB2YXIgZXhwYW5kZWRLZXlzID0ge307CiAgICAgICAgICAgIHRocmVhZC5tZXNzYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBleHBhbmRlZEtleXNbbWVzc2FnZS5pZF0gPSBmb3JjZUV4cGFuZCAmJiBmb3JjZUV4cGFuZC5pbmRleE9mKG1lc3NhZ2UuaWQpID4gLTEgPyB0cnVlIDogZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBBbHdheXMgc2hvdyBsYXN0IGlkIGZvciBub3cKICAgICAgICAgICAgdmFyIGxhc3RNZXNzYWdlID0gbGFzdCh0aHJlYWQubWVzc2FnZXMpOwogICAgICAgICAgICB2YXIgbGFzdElkID0gbGFzdE1lc3NhZ2UgJiYgbGFzdE1lc3NhZ2UuaWQgfHwgJyc7CiAgICAgICAgICAgIGlmIChsYXN0SWQgJiYgIXNlbGVjdGVkTWVzc2FnZUlkKSB7CiAgICAgICAgICAgICAgICBleHBhbmRlZEtleXNbbGFzdElkXSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gT3ZlcmlkZSBleHBhbmRlZCBzZWxlY3Rpb24gaWYgd2UgaGF2ZSBhIHNwZWNpZmljIG1lc3NhZ2Ugc2VsZWN0ZWQKICAgICAgICAgICAgaWYgKHNlbGVjdGVkTWVzc2FnZUlkKSB7CiAgICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBmaXJzdCh0aHJlYWQubWVzc2FnZXMuZmlsdGVyKGZ1bmN0aW9uIChtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2UuaWQgPT09IHNlbGVjdGVkTWVzc2FnZUlkIHx8IG1lc3NhZ2UucmZjSWQgPT09IHNlbGVjdGVkTWVzc2FnZUlkOwogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwYW5kZWRLZXlzW21hdGNoLmlkXSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBleHBhbmRlZEtleXM6IGV4cGFuZGVkS2V5cyB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmdldExhc3RDb21tZW50U2Nyb2xsUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjb21tZW50cyA9IF90aGlzLnByb3BzLmNvbW1lbnRzOwogICAgICAgICAgICBpZiAoY29tbWVudHMgJiYgY29tbWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB2YXIgbGFzdENvbW1lbnRfMSA9IGxhc3QoY29tbWVudHMpOwogICAgICAgICAgICAgICAgaWYgKGxhc3RDb21tZW50XzEgJiYgX3RoaXMucmVmKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGxzID0gX3RoaXMucmVmLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NvbW1lbnQtY2VsbCcpOwogICAgICAgICAgICAgICAgICAgIHZhciBjZWxsID0gQXJyYXkuZnJvbShjZWxscykKICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLmRhdGFzZXQuY29tbWVudCA9PT0gbGFzdENvbW1lbnRfMS5pZDsgfSlbMF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IGNlbGwub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9OwogICAgICAgIF90aGlzLmdldExhc3RNZXNzYWdlU2Nyb2xsUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0aHJlYWQgPSBfdGhpcy5wcm9wcy50aHJlYWQ7CiAgICAgICAgICAgIGlmICghdGhyZWFkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBBbHdheXMgc2hvdyBsYXN0IGlkIGZvciBub3cKICAgICAgICAgICAgdmFyIGxhc3RNZXNzYWdlID0gbGFzdCh0aHJlYWQubWVzc2FnZXMpOwogICAgICAgICAgICB2YXIgbGFzdElkID0gbGFzdE1lc3NhZ2UgJiYgbGFzdE1lc3NhZ2UuaWQgfHwgJyc7CiAgICAgICAgICAgIHZhciBjZWxscyA9IF90aGlzLnJlZi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdleHBhbmRlZC1jZWxsJyk7CiAgICAgICAgICAgIHZhciBjZWxsID0gQXJyYXkuZnJvbShjZWxscykKICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5kYXRhc2V0Lm1lc3NhZ2UgPT09IGxhc3RJZDsgfSlbMF07CiAgICAgICAgICAgIGlmIChjZWxsKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsID0gY2VsbC5vZmZzZXRUb3A7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuZ2V0Q2VsbHMgPSBmdW5jdGlvbiAocHJvcHMpIHsKICAgICAgICAgICAgaWYgKHByb3BzLnRocmVhZCAmJiBwcm9wcy50aHJlYWQpIHsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IHByb3BzLnRocmVhZC5tZXNzYWdlcy5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuICh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogQ2VsbFR5cGUuTWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICBkYXRlOiBtLmludGVybmFsLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IG0sCiAgICAgICAgICAgICAgICB9KTsgfSk7CiAgICAgICAgICAgICAgICB2YXIgY29tbWVudHMgPSAocHJvcHMuY29tbWVudHMgfHwgW10pLm1hcChmdW5jdGlvbiAoYykgeyByZXR1cm4gKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiBDZWxsVHlwZS5Db21tZW50LAogICAgICAgICAgICAgICAgICAgIGRhdGU6IGMuY3JlYXRlZCwKICAgICAgICAgICAgICAgICAgICBkYXRhOiBjLAogICAgICAgICAgICAgICAgfSk7IH0pOwogICAgICAgICAgICAgICAgdmFyIHJlcGx5aW5nID0gKHByb3BzLnJlcGx5aW5nIHx8IFtdKS5tYXAoZnVuY3Rpb24gKHIpIHsgcmV0dXJuICh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogQ2VsbFR5cGUuVHlwaW5nLAogICAgICAgICAgICAgICAgICAgIGRhdGU6IHIudGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IHIsCiAgICAgICAgICAgICAgICB9KTsgfSk7CiAgICAgICAgICAgICAgICB2YXIgY29tbWVudGluZyA9IChwcm9wcy5jb21tZW50aW5nIHx8IFtdKS5tYXAoZnVuY3Rpb24gKGMpIHsgcmV0dXJuICh7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogQ2VsbFR5cGUuVHlwaW5nLAogICAgICAgICAgICAgICAgICAgIGRhdGU6IGMudGltZXN0YW1wLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGMsCiAgICAgICAgICAgICAgICB9KTsgfSk7CiAgICAgICAgICAgICAgICB2YXIgZHJhZnRzID0gKHByb3BzLnNoYXJlZFRocmVhZERyYWZ0ICYmIFtwcm9wcy5zaGFyZWRUaHJlYWREcmFmdF0gfHwgW10pCiAgICAgICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoYykgeyByZXR1cm4gKHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiBDZWxsVHlwZS5EcmFmdCwKICAgICAgICAgICAgICAgICAgICBkYXRlOiBjLnVwZGF0ZWQsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogYywKICAgICAgICAgICAgICAgIH0pOyB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBtZXNzYWdlcy5jb25jYXQoY29tbWVudHMpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYS5kYXRlIDwgYi5kYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGEuZGF0ZSA+IGIuZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9KS5jb25jYXQocmVwbHlpbmcpLmNvbmNhdChjb21tZW50aW5nKS5jb25jYXQoZHJhZnRzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJDZWxsID0gZnVuY3Rpb24gKGNlbGwpIHsKICAgICAgICAgICAgaWYgKGNlbGwudHlwZSA9PT0gQ2VsbFR5cGUuTWVzc2FnZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlbmRlck1lc3NhZ2UoY2VsbC5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2VsbC50eXBlID09PSBDZWxsVHlwZS5UeXBpbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5yZW5kZXJUeXBpbmcoY2VsbC5kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2VsbC50eXBlID09PSBDZWxsVHlwZS5EcmFmdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnJlbmRlclNoYXJlZERyYWZ0Q2VsbCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5yZW5kZXJDb21tZW50KGNlbGwuZGF0YSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJDb21tZW50ID0gZnVuY3Rpb24gKGNvbW1lbnQpIHsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29tbWVudENlbGwsIHsgY29tbWVudDogY29tbWVudCwga2V5OiBjb21tZW50LmlkIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMucmVuZGVyVHlwaW5nID0gZnVuY3Rpb24gKGFjdGl2aXR5KSB7CiAgICAgICAgICAgIGlmICghYWN0aXZpdHkudXNlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHR5cGU7CiAgICAgICAgICAgIHN3aXRjaCAoYWN0aXZpdHkudHlwZSkgewogICAgICAgICAgICAgICAgY2FzZSBTaGFyZWRUaHJlYWRBY3Rpdml0eVR5cGUuQ29tbWVudDoKICAgICAgICAgICAgICAgICAgICB0eXBlID0gVHlwaW5nVHlwZS5Db21tZW50OwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBTaGFyZWRUaHJlYWRBY3Rpdml0eVR5cGUuUmVwbHk6CiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IFR5cGluZ1R5cGUuUmVwbHk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChUeXBpbmdDZWxsLCB7IGtleTogdHlwZSArICItIiArIGFjdGl2aXR5LnVzZXJJZCwgdHlwZTogdHlwZSwgdXNlcjogewogICAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogYWN0aXZpdHkudXNlci5maXJzdE5hbWUsIHBob3RvVXJsOiBhY3Rpdml0eS51c2VyLnBob3RvVXJsLAogICAgICAgICAgICAgICAgfSB9KSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJNZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIHRocmVhZCA9IF9hLnRocmVhZCwgYm9kaWVzID0gX2EuYm9kaWVzLCBzaGFyZWRUaHJlYWQgPSBfYS5zaGFyZWRUaHJlYWQsIG1lID0gX2EubWUsIHNlbGVjdGVkTWVzc2FnZUlkID0gX2Euc2VsZWN0ZWRNZXNzYWdlSWQ7CiAgICAgICAgICAgIHZhciBjb2xsYXBzZWQgPSAhX3RoaXMuc3RhdGUuZXhwYW5kZWRLZXlzW21lc3NhZ2UuaWRdOwogICAgICAgICAgICB2YXIgRXhwYW5kZWRDZWxsQ29ubmVjdCA9IEV4cGFuZGVkQ2VsbDsKICAgICAgICAgICAgdmFyIENvbGxhcHNlZENlbGxDb25uZWN0ID0gQ29sbGFwc2VkQ2VsbDsKICAgICAgICAgICAgdmFyIGlzT3duZXIgPSBzaGFyZWRUaHJlYWQgJiYgc2hhcmVkVGhyZWFkLmRhdGEgJiYgbWUgJiYgc2hhcmVkVGhyZWFkLmRhdGEudXNlciA9PT0gbWUuaWQ7CiAgICAgICAgICAgIGlmICghdGhyZWFkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29sbGFwc2VkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29sbGFwc2VkQ2VsbENvbm5lY3QsIHsgaWQ6IG1lc3NhZ2UuaWQsIG9uVG9nZ2xlRXhwYW5kOiBfdGhpcy5oYW5kbGVDZWxsRXhwYW5kLCBrZXk6IG1lc3NhZ2UuaWQsIG1lc3NhZ2U6IG1lc3NhZ2UsIGhpZGVUcmFja3M6ICFpc093bmVyLCBwdWJsaWNGb2N1czogc2VsZWN0ZWRNZXNzYWdlSWQgJiYgc2VsZWN0ZWRNZXNzYWdlSWQgPT09IG1lc3NhZ2UuaWQgfSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghYm9kaWVzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYm9keSA9IGJvZGllcy5maWx0ZXIoZnVuY3Rpb24gKGIpIHsgcmV0dXJuIGIuaWQgPT09IG1lc3NhZ2UuaWQ7IH0pWzBdOwogICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoRXhwYW5kZWRDZWxsQ29ubmVjdCwgeyBvblRvZ2dsZUV4cGFuZDogX3RoaXMuaGFuZGxlQ2VsbEV4cGFuZCwga2V5OiBtZXNzYWdlLmlkLCBtZXNzYWdlOiBtZXNzYWdlLCBtZXNzYWdlQm9keTogYm9keSwgdGhyZWFkSWQ6IHRocmVhZC5pZCwgaGlkZUFjdGlvbnM6IHRydWUsIGhpZGVUcmFja3M6ICFpc093bmVyLCBwdWJsaWNGb2N1czogc2VsZWN0ZWRNZXNzYWdlSWQgJiYgc2VsZWN0ZWRNZXNzYWdlSWQgPT09IG1lc3NhZ2UuaWQgfSkpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMucmVuZGVyU2hhcmVkRHJhZnRDZWxsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoU2hhcmVkRHJhZnRDZWxsLCBudWxsKSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVDZWxsRXhwYW5kID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICB2YXIgX2E7CiAgICAgICAgICAgIHZhciBvbGRWYWx1ZSA9IF90aGlzLnN0YXRlLmV4cGFuZGVkS2V5c1trZXldIHx8IGZhbHNlOwogICAgICAgICAgICB2YXIgZXhwYW5kZWRLZXlzID0gX19hc3NpZ24oX19hc3NpZ24oe30sIF90aGlzLnN0YXRlLmV4cGFuZGVkS2V5cyksIChfYSA9IHt9LCBfYVtrZXldID0gIW9sZFZhbHVlLCBfYSkpOwogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGV4cGFuZGVkS2V5czogZXhwYW5kZWRLZXlzIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlUmVmID0gZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICBfdGhpcy5yZWYgPSByZWY7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVTaWduVXBQb3BvdmVySGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBzaWduVXBQb3BvdmVyU2hvd246IGZhbHNlLCBjb21tZW50UG9wb3ZlclNob3duOiBmYWxzZSB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVNpZ25VcFBvcG92ZXJTaG93ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNpZ25VcFBvcG92ZXJTaG93bjogdHJ1ZSB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVNpZ25JbkNsaWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBicm93c2VySGlzdG9yeS5wdXNoKCcvbG9naW4nKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUNvbW1lbnRQb3BvdmVySGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBzaWduVXBQb3BvdmVyU2hvd246IGZhbHNlLCBjb21tZW50UG9wb3ZlclNob3duOiBmYWxzZSB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUNvbW1lbnRQb3BvdmVyU2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIG1lID0gX2EubWUsIHNoYXJlZFRocmVhZCA9IF9hLnNoYXJlZFRocmVhZDsKICAgICAgICAgICAgaWYgKG1lICYmIHNoYXJlZFRocmVhZCAmJiBzaGFyZWRUaHJlYWQuZGF0YSAmJiBzaGFyZWRUaHJlYWQuZGF0YS50ZWFtICE9PSBtZS50ZWFtKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbW1lbnRQb3BvdmVyU2hvd246IHRydWUgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBzaWduVXBQb3BvdmVyU2hvd246IHRydWUgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVDb21tZW50ID0gZnVuY3Rpb24gKGNvbW1lbnQpIHsKICAgICAgICAgICAgbG9nQW1wbGl0dWRlRXZlbnQoQW1wbGl0dWRlRXZlbnRzLkNvbW1lbnRPbkVtYWlsKTsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIHRocmVhZCA9IF9hLnRocmVhZCwgc2hhcmVkVGhyZWFkID0gX2Euc2hhcmVkVGhyZWFkLCBzaGFyZWRUaHJlYWREcmFmdCA9IF9hLnNoYXJlZFRocmVhZERyYWZ0OwogICAgICAgICAgICB2YXIgbGFzdE1lc3NhZ2UgPSB0aHJlYWQgJiYgbGFzdCh0aHJlYWQubWVzc2FnZXMpOwogICAgICAgICAgICB2YXIgc2hhcmVkVGhyZWFkSWQgPSBzaGFyZWRUaHJlYWQgJiYgc2hhcmVkVGhyZWFkLmRhdGEgJiYgc2hhcmVkVGhyZWFkLmRhdGEuaWQ7CiAgICAgICAgICAgIGlmIChzaGFyZWRUaHJlYWRJZCAmJiB0aHJlYWQgJiYgbGFzdE1lc3NhZ2UgJiYgbGFzdE1lc3NhZ2UucmZjSWQpIHsKICAgICAgICAgICAgICAgIHZhciBjb21wdXRlZFJmY0lkID0gKHNoYXJlZFRocmVhZERyYWZ0ID09PSBudWxsIHx8IHNoYXJlZFRocmVhZERyYWZ0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaGFyZWRUaHJlYWREcmFmdC5pZCkgJiYgIjwiICsgc2hhcmVkVGhyZWFkRHJhZnQuaWQgKyAiQHBvbHltYWlsLmlvPiIgfHwKICAgICAgICAgICAgICAgICAgICBsYXN0TWVzc2FnZS5yZmNJZDsKICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLmNyZWF0ZUNvbW1lbnQoewogICAgICAgICAgICAgICAgICAgIHJmY0lkOiBjb21wdXRlZFJmY0lkLAogICAgICAgICAgICAgICAgICAgIGJvZHk6IGNvbW1lbnQsCiAgICAgICAgICAgICAgICAgICAgdGhyZWFkOiBzaGFyZWRUaHJlYWRJZCwKICAgICAgICAgICAgICAgICAgICBkcmFmdDogc2hhcmVkVGhyZWFkRHJhZnQgPT09IG51bGwgfHwgc2hhcmVkVGhyZWFkRHJhZnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNoYXJlZFRocmVhZERyYWZ0LmlkLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLnJlbmRlckNvbW1lbnRQYW5lID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgbWUgPSBfYS5tZSwgc2hhcmVkVGhyZWFkID0gX2Euc2hhcmVkVGhyZWFkOwogICAgICAgICAgICAvLyBTaG93IENvbW1lbnQgRWRpdG9yIGlzIHVzZXIgaXMgb24gdGVhbQogICAgICAgICAgICB2YXIgcGxhY2Vob2xkZXJPdmVycmlkZSA9IElTX0lPUyAmJiAnV3JpdGUgYSBjb21tZW50JyB8fCAnV3JpdGUgYSBjb21tZW50IG9yIEBtZW50aW9uIGEgdGVhbW1hdGUnOwogICAgICAgICAgICBpZiAobWUgJiYgc2hhcmVkVGhyZWFkICYmIHNoYXJlZFRocmVhZC5kYXRhICYmIHNoYXJlZFRocmVhZC5kYXRhLnRlYW0gPT09IG1lLnRlYW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJjb21tZW50LWlucHV0IiB9LAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29tbWVudEVkaXRvciwgeyBjb21tZW50OiBfdGhpcy5oYW5kbGVDb21tZW50LCBwbGFjZWhvbGRlck92ZXJyaWRlOiBwbGFjZWhvbGRlck92ZXJyaWRlIH0pKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gRG8gbm90IHNob3cgY29tbWVudCBwYW5lIGlmIHVzZXIgaXMgbm90IG9uIHRoZSBzYW1lIHRlYW0KICAgICAgICAgICAgaWYgKG1lICYmIHNoYXJlZFRocmVhZCAmJiBzaGFyZWRUaHJlYWQuZGF0YSAmJiBzaGFyZWRUaHJlYWQuZGF0YS50ZWFtICE9PSBtZS50ZWFtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2hvdyBidXR0b24gaW5wdXQKICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImNvbW1lbnQtaW5wdXQiIH0sCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogImNvbW1lbnQtYnV0dG9uIiwgb25DbGljazogX3RoaXMuaGFuZGxlQ29tbWVudFBvcG92ZXJTaG93IH0sIHBsYWNlaG9sZGVyT3ZlcnJpZGUpKSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVNb2JpbGVCcm93c2VyQ29udGludWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgc2hvd0Jyb3dzZXI6IHRydWUgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVpT1NPcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICdwb2x5bWFpbDovLycgKyB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJPd25lckxhYmVsID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2hhcmVkT3duZXIgPSBfdGhpcy5wcm9wcy5zaGFyZWRPd25lcjsKICAgICAgICAgICAgaWYgKHNoYXJlZE93bmVyKSB7CiAgICAgICAgICAgICAgICBpZiAoISFzaGFyZWRPd25lci5maXJzdE5hbWUgJiYgISFzaGFyZWRPd25lci5sYXN0TmFtZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaGFyZWRPd25lci5maXJzdE5hbWUgKyAiICIgKyBzaGFyZWRPd25lci5sYXN0TmFtZSArICIgIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghIXNoYXJlZE93bmVyLmVtYWlsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNoYXJlZE93bmVyLmVtYWlsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9OwogICAgICAgIF90aGlzLnJlbmRlck1vYmlsZUNhcHR1cmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCBzaGFyZWRUaHJlYWQgPSBfYS5zaGFyZWRUaHJlYWQsIHNoYXJlZE93bmVyID0gX2Euc2hhcmVkT3duZXIsIHNoYXJlZE93bmVyUGhvdG9VcmwgPSBfYS5zaGFyZWRPd25lclBob3RvVXJsOwogICAgICAgICAgICAvLyBEZXN0cnVjdHVyZWQgc2hhcmVkIHRocmVhZAogICAgICAgICAgICB2YXIgc3QgPSBzaGFyZWRUaHJlYWQgPT09IG51bGwgfHwgc2hhcmVkVGhyZWFkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzaGFyZWRUaHJlYWQuZGF0YTsKICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInB1YmxpYy1zaGFyZWQtdGhyZWFkcy1tb2JpbGUtY2FwdHVyZSIgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaGVhZGVyLXNlY3Rpb24iIH0sCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiaW1nIiwgeyBzcmM6IFBvbHltYWlsTG9nbywgYWx0OiAiIiwgY2xhc3NOYW1lOiAibG9nbyIgfSkpLAogICAgICAgICAgICAgICAgc3QgJiYgKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAic2hhcmVkLXRocmVhZC1wcmV2aWV3IiB9LAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaGVhZGVyIiB9LAogICAgICAgICAgICAgICAgICAgICAgICBzaGFyZWRPd25lciAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJzaGFyZWQtbGFiZWwiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiaW1nIiwgeyBjbGFzc05hbWU6ICJtZW1iZXItYXZhdGFyIiwgc3JjOiBzaGFyZWRPd25lclBob3RvVXJsIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogIm5hbWUtbGFiZWwiIH0sIF90aGlzLnJlbmRlck93bmVyTGFiZWwoKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBzaGFyZWQgd2l0aCB5b3U6IiksCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImgzIiwgeyBjbGFzc05hbWU6ICJzdWJqZWN0IiB9LCBzdC5zdWJqZWN0KSwKICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJwYXJ0aWNpcGFudHMiIH0sIHBhcnRpY2lwYW50c1RvU3RyaW5nKHN0LnBhcnRpY2lwYW50cy5tYXAocGFyc2VBZGRyZXNzKSkpKSkpLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJhY3Rpb24tc2VjdGlvbiIgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogIm9wZW4taW9zIiwgb25DbGljazogX3RoaXMuaGFuZGxlaU9TT3BlbiB9LCAiT3BlbiBQb2x5bWFpbCBpT1MiKSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogIm9wZW4tYnJvd3NlciIsIG9uQ2xpY2s6IF90aGlzLmhhbmRsZU1vYmlsZUJyb3dzZXJDb250aW51ZSB9LCAiT3BlbiBpbiBicm93c2VyIikpKSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgICAgICAgZXhwYW5kZWRLZXlzOiB7fSwKICAgICAgICAgICAgY2VsbHM6IF90aGlzLmdldENlbGxzKHByb3BzKSwKICAgICAgICAgICAgc2lnblVwUG9wb3ZlclNob3duOiBmYWxzZSwKICAgICAgICAgICAgY29tbWVudFBvcG92ZXJTaG93bjogZmFsc2UsCiAgICAgICAgICAgIHNob3dCcm93c2VyOiAhSVNfSU9TLAogICAgICAgIH07CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgfQogICAgUHVibGljU2hhcmVkVGhyZWFkcy5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy52aWV3SW50ZXJ2YWwgPSBnbG9iYWwuc2V0SW50ZXJ2YWwodGhpcy5yZWNvcmRWaWV3LCBQSU5HX0lOVEVSVkFMKTsKICAgIH07CiAgICBQdWJsaWNTaGFyZWRUaHJlYWRzLnByb3RvdHlwZS5jb21wb25lbnRXaWxsVW5tb3VudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBjbGVhckludGVydmFsKHRoaXMudmlld0ludGVydmFsKTsKICAgIH07CiAgICBQdWJsaWNTaGFyZWRUaHJlYWRzLnByb3RvdHlwZS5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIChuZXh0UHJvcHMpIHsKICAgICAgICBpZiAoIW5leHRQcm9wcy50aHJlYWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgZXhwYW5kZWRNZXNzYWdlcyA9IG5leHRQcm9wcy50aHJlYWQubWVzc2FnZXMuZmlsdGVyKGZ1bmN0aW9uIChtKSB7IHJldHVybiAhbS5yZWFkOyB9KS5tYXAoZnVuY3Rpb24gKG0pIHsgcmV0dXJuIG0uaWQ7IH0pOwogICAgICAgIC8vIEhhbmRsZSBjaGFuZ2VzIHRvIHRocmVhZAogICAgICAgIGlmICghdGhpcy5wcm9wcy50aHJlYWQgfHwgdGhpcy5wcm9wcy50aHJlYWQuaWQgIT09IG5leHRQcm9wcy50aHJlYWQuaWQpIHsKICAgICAgICAgICAgdGhpcy5zY3JvbGxlZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBIYW5kbGUgbmV3IG1lc3NhZ2VzIC0+IGV4cGFuZCB0aGVtIGF1dG9tYXRpY2FsbHkKICAgICAgICBpZiAodGhpcy5wcm9wcy50aHJlYWQgJiYgbmV4dFByb3BzLnRocmVhZCAmJiBuZXh0UHJvcHMudGhyZWFkLmlkID09PSB0aGlzLnByb3BzLnRocmVhZC5pZCkgewogICAgICAgICAgICB2YXIgb2xkTWVzc2FnZXNfMSA9IHt9OwogICAgICAgICAgICB0aGlzLnByb3BzLnRocmVhZC5tZXNzYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICBvbGRNZXNzYWdlc18xW21lc3NhZ2UuaWRdID0gdHJ1ZSAmJiBtZXNzYWdlLnJlYWQ7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBleHBhbmRlZE1lc3NhZ2VzID0gbmV4dFByb3BzLnRocmVhZC5tZXNzYWdlcwogICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAobWVzc2FnZSkgeyByZXR1cm4gIW9sZE1lc3NhZ2VzXzFbbWVzc2FnZS5pZF07IH0pCiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChtZXNzYWdlKSB7IHJldHVybiBtZXNzYWdlLmlkOyB9KTsKICAgICAgICB9CiAgICAgICAgLy8gcHJlc2VydmUgZXhwYW5kZWQgY2VsbHMKICAgICAgICBpZiAodGhpcy5zdGF0ZS5leHBhbmRlZEtleXMpIHsKICAgICAgICAgICAgZm9yRWFjaCh0aGlzLnN0YXRlLmV4cGFuZGVkS2V5cywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAmJiBleHBhbmRlZE1lc3NhZ2VzLmluZGV4T2Yoa2V5KSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBleHBhbmRlZE1lc3NhZ2VzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIC8vIEhhbmRsZSB0aHJlYWQgbWVzc2FnZXMgY29sbGFwc2VkL3VuY29sbGFwc2VkIHN0YXRlCiAgICAgICAgaWYgKG5leHRQcm9wcy50aHJlYWQpIHsKICAgICAgICAgICAgdGhpcy5wcm9jZXNzQ2VsbENvbGxhcHNlU3RhdGVzKG5leHRQcm9wcy50aHJlYWQsIGV4cGFuZGVkTWVzc2FnZXMpOwogICAgICAgIH0KICAgICAgICBpZiAobmV4dFByb3BzLnRocmVhZCAhPT0gdGhpcy5wcm9wcy50aHJlYWQgfHwKICAgICAgICAgICAgbmV4dFByb3BzLnRocmVhZC5tZXNzYWdlcyAhPT0gdGhpcy5wcm9wcy50aHJlYWQubWVzc2FnZXMgfHwKICAgICAgICAgICAgbmV4dFByb3BzLmNvbW1lbnRzICE9PSB0aGlzLnByb3BzLmNvbW1lbnRzIHx8CiAgICAgICAgICAgIG5leHRQcm9wcy5yZXBseWluZyAhPT0gdGhpcy5wcm9wcy5yZXBseWluZyB8fAogICAgICAgICAgICBuZXh0UHJvcHMuY29tbWVudGluZyAhPT0gdGhpcy5wcm9wcy5jb21tZW50aW5nKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBjZWxsczogdGhpcy5nZXRDZWxscyhuZXh0UHJvcHMpIH0pOwogICAgICAgIH0KICAgIH07CiAgICBQdWJsaWNTaGFyZWRUaHJlYWRzLnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiAob2xkUHJvcHMpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBfYSA9IHRoaXMucHJvcHMsIHNoYXJlZFRocmVhZCA9IF9hLnNoYXJlZFRocmVhZCwgbWUgPSBfYS5tZSwgc2VsZWN0ZWRNZXNzYWdlSWQgPSBfYS5zZWxlY3RlZE1lc3NhZ2VJZDsKICAgICAgICAvLyBSZWRpcmVjdCBpZiBlcnJvciBhbmQgdXNlciBpcyBub3QgbG9nZ2VkIGluCiAgICAgICAgaWYgKHNoYXJlZFRocmVhZCAmJiBzaGFyZWRUaHJlYWQuZXJyb3IgJiYgIW1lKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gSGFuZGxlcyBtb3Zpbmcgc2Nyb2xsIHBvc2l0aW9uIHdoZW5ldmVyIG5ldyBjb21tZW50cyBhcmUgbG9hZGVkCiAgICAgICAgdmFyIG5ld0NvbW1lbnRzID0gdGhpcy5wcm9wcy5jb21tZW50cyB8fCBbXTsKICAgICAgICB2YXIgb2xkQ29tbWVudHMgPSBvbGRQcm9wcy5jb21tZW50cyB8fCBbXTsKICAgICAgICBpZiAobmV3Q29tbWVudHMubGVuZ3RoID4gb2xkQ29tbWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IGdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBsYXN0Q29tbWVudCA9IGxhc3QobmV3Q29tbWVudHMpOwogICAgICAgICAgICAgICAgaWYgKGxhc3RDb21tZW50ICYmIF90aGlzLnJlZikgewogICAgICAgICAgICAgICAgICAgIHZhciBjZWxscyA9IF90aGlzLnJlZi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdleHBhbmRlZC1jZWxsJyk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGwgPSBBcnJheS5mcm9tKGNlbGxzKQogICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gc2VsZWN0ZWRNZXNzYWdlSWQgPwogICAgICAgICAgICAgICAgICAgICAgICBlbC5kYXRhc2V0Lm1lc3NhZ2UgPT09IHNlbGVjdGVkTWVzc2FnZUlkIDogdHJ1ZTsgfSlbMF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2Nyb2xsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSBfdGhpcy5yZWYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnY2VsbHMnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhYmxlWzBdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29tbWVudFNjcm9sbFBvc2l0aW9uID0gX3RoaXMuZ2V0TGFzdENvbW1lbnRTY3JvbGxQb3NpdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VTY3JvbGxQb3NpdGlvbiA9IGNlbGwub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJlaGF2aW9yID0gJ3Ntb290aCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsID0gTWF0aC5tYXgoY29tbWVudFNjcm9sbFBvc2l0aW9uLCBtZXNzYWdlU2Nyb2xsUG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVbMF0uc2Nyb2xsVG8oeyB0b3A6IHZhbCwgYmVoYXZpb3I6IGJlaGF2aW9yIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgICB2YXIgbmV3VHlwaW5nQ2VsbHMgPSB0aGlzLnByb3BzLnJlcGx5aW5nLm1hcChmdW5jdGlvbiAocikgeyByZXR1cm4gInItIiArIHIudXNlcklkOyB9KQogICAgICAgICAgICAuY29uY2F0KHRoaXMucHJvcHMuY29tbWVudGluZy5tYXAoZnVuY3Rpb24gKGMpIHsgcmV0dXJuICJjLSIgKyBjLnVzZXJJZDsgfSkpOwogICAgICAgIHZhciBvbGRUeXBpbmdDZWxscyA9IG9sZFByb3BzLnJlcGx5aW5nLm1hcChmdW5jdGlvbiAocikgeyByZXR1cm4gInItIiArIHIudXNlcklkOyB9KQogICAgICAgICAgICAuY29uY2F0KG9sZFByb3BzLmNvbW1lbnRpbmcubWFwKGZ1bmN0aW9uIChjKSB7IHJldHVybiAiYy0iICsgYy51c2VySWQ7IH0pKTsKICAgICAgICBpZiAobmV3VHlwaW5nQ2VsbHMuam9pbignJykgIT09IG9sZFR5cGluZ0NlbGxzLmpvaW4oJycpKSB7CiAgICAgICAgICAgIHRoaXMudGltZW91dCA9IGdsb2JhbC5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciB0eXBpbmdDZWxscyA9IF90aGlzLnJlZiAmJiBfdGhpcy5yZWYuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgndHlwaW5nLWNlbGwnKTsKICAgICAgICAgICAgICAgIGlmICh0eXBpbmdDZWxscyAmJiB0eXBpbmdDZWxscy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IHR5cGluZ0NlbGxzW3R5cGluZ0NlbGxzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICAgICAgICAgIGlmIChjZWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNjcm9sbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlID0gX3RoaXMucmVmLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2NlbGxzJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWJsZVswXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbCA9IGNlbGwub2Zmc2V0VG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVbMF0uc2Nyb2xsVG8oeyB0b3A6IHZhbCwgYmVoYXZpb3I6ICdzbW9vdGgnIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgIH07CiAgICBQdWJsaWNTaGFyZWRUaHJlYWRzLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF9hID0gdGhpcy5wcm9wcywgc2hhcmVkVGhyZWFkID0gX2Euc2hhcmVkVGhyZWFkLCB0aHJlYWQgPSBfYS50aHJlYWQsIHNoYXJlZE93bmVyID0gX2Euc2hhcmVkT3duZXIsIHNoYXJlZE93bmVyUGhvdG9VcmwgPSBfYS5zaGFyZWRPd25lclBob3RvVXJsLCBtZSA9IF9hLm1lLCBvcmlnaW5hbFRocmVhZEVycm9yID0gX2Eub3JpZ2luYWxUaHJlYWRFcnJvcjsKICAgICAgICB2YXIgX2IgPSB0aGlzLnN0YXRlLCBzaWduVXBQb3BvdmVyU2hvd24gPSBfYi5zaWduVXBQb3BvdmVyU2hvd24sIGNvbW1lbnRQb3BvdmVyU2hvd24gPSBfYi5jb21tZW50UG9wb3ZlclNob3duLCBjZWxscyA9IF9iLmNlbGxzLCBzaG93QnJvd3NlciA9IF9iLnNob3dCcm93c2VyOwogICAgICAgIHZhciBvcmlnaW5hbEVycm9yID0gISFvcmlnaW5hbFRocmVhZEVycm9yICYmICF0aHJlYWQ7CiAgICAgICAgdmFyIHNoYXJlZFRocmVhZEVycm9yID0gc2hhcmVkVGhyZWFkICYmIHNoYXJlZFRocmVhZC5lcnJvcjsKICAgICAgICAvLyBTaG93IG1vYmlsZSBjYXB0dXJlIHBhZ2UgaWYgc2hhcmVkIHRocmVhZCBmZXRjaGVkIHByb3Blcmx5IGFuZCBicm93c2VyIGlzIG5vdCBtb2JpbGUKICAgICAgICBpZiAoIXNob3dCcm93c2VyICYmICEoc2hhcmVkVGhyZWFkRXJyb3IgfHwgb3JpZ2luYWxUaHJlYWRFcnJvcikpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTW9iaWxlQ2FwdHVyZSgpOwogICAgICAgIH0KICAgICAgICAvLyBIYW5kbGUgY2FzZSBmb3Igd2hlbiB1c2VyIGlzIG5vdCBsb2dnZWQgaW4KICAgICAgICBpZiAoIW1lICYmIHNoYXJlZFRocmVhZEVycm9yKSB7CiAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJwdWJsaWMtc2hhcmVkLXRocmVhZHMiLCByZWY6IHRoaXMuaGFuZGxlUmVmIH0sCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFNpZ25VcEhlYWRlciwgeyBtZTogbWUsIG9uQnV0dG9uUHJlc3M6IHRoaXMuaGFuZGxlU2lnbkluQ2xpY2sgfSksCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogIm1haW4iIH0sCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChTaGFyZWRUaHJlYWRFcnJvclBhZ2UsIG51bGwpKSwKICAgICAgICAgICAgICAgIHNpZ25VcFBvcG92ZXJTaG93biAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFNpZ25VcFBvcG92ZXIsIHsgb25IaWRlOiB0aGlzLmhhbmRsZVNpZ25VcFBvcG92ZXJIaWRlIH0pLAogICAgICAgICAgICAgICAgY29tbWVudFBvcG92ZXJTaG93biAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KENvbW1lbnRQb3BvdmVyLCB7IG9uSGlkZTogdGhpcy5oYW5kbGVDb21tZW50UG9wb3ZlckhpZGUgfSkpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1lICYmIChzaGFyZWRUaHJlYWRFcnJvciB8fCBvcmlnaW5hbEVycm9yKSkgewogICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAicHVibGljLXNoYXJlZC10aHJlYWRzIiwgcmVmOiB0aGlzLmhhbmRsZVJlZiB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChTaWduVXBIZWFkZXIsIHsgbWU6IG1lLCBvbkJ1dHRvblByZXNzOiB0aGlzLmhhbmRsZVNpZ25JbkNsaWNrIH0pLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJtYWluIiB9LAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoU2hhcmVkVGhyZWFkRXJyb3JQYWdlLCB7IGVtYWlsOiBtZS5lbWFpbCB9KSksCiAgICAgICAgICAgICAgICBzaWduVXBQb3BvdmVyU2hvd24gJiYgUmVhY3QuY3JlYXRlRWxlbWVudChTaWduVXBQb3BvdmVyLCB7IG9uSGlkZTogdGhpcy5oYW5kbGVTaWduVXBQb3BvdmVySGlkZSB9KSwKICAgICAgICAgICAgICAgIGNvbW1lbnRQb3BvdmVyU2hvd24gJiYgUmVhY3QuY3JlYXRlRWxlbWVudChDb21tZW50UG9wb3ZlciwgeyBvbkhpZGU6IHRoaXMuaGFuZGxlQ29tbWVudFBvcG92ZXJIaWRlIH0pKSk7CiAgICAgICAgfQogICAgICAgIC8vIFNob3cgTG9hZGVyCiAgICAgICAgaWYgKCFzaGFyZWRUaHJlYWQgfHwgIXRocmVhZCB8fCAhc2hhcmVkVGhyZWFkLmRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInB1YmxpYy1zaGFyZWQtdGhyZWFkcyIsIHJlZjogdGhpcy5oYW5kbGVSZWYgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoU2lnblVwSGVhZGVyLCB7IG1lOiBtZSwgb25CdXR0b25QcmVzczogdGhpcy5oYW5kbGVTaWduSW5DbGljayB9KSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAibWFpbiIgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENlbnRlcmVkTG9hZGVyLCBudWxsKSksCiAgICAgICAgICAgICAgICBzaWduVXBQb3BvdmVyU2hvd24gJiYgUmVhY3QuY3JlYXRlRWxlbWVudChTaWduVXBQb3BvdmVyLCB7IG9uSGlkZTogdGhpcy5oYW5kbGVTaWduVXBQb3BvdmVySGlkZSB9KSwKICAgICAgICAgICAgICAgIGNvbW1lbnRQb3BvdmVyU2hvd24gJiYgUmVhY3QuY3JlYXRlRWxlbWVudChDb21tZW50UG9wb3ZlciwgeyBvbkhpZGU6IHRoaXMuaGFuZGxlQ29tbWVudFBvcG92ZXJIaWRlIH0pKSk7CiAgICAgICAgfQogICAgICAgIHZhciBzdCA9IHNoYXJlZFRocmVhZC5kYXRhOwogICAgICAgIC8vIHNvbWUgdGhyZWFkcyBkb24ndCBoYXZlIGFuIG93bmVyIGxhYmVsCiAgICAgICAgdmFyIHNoYXJlZFN0cmluZyA9IHRoaXMucmVuZGVyT3duZXJMYWJlbCgpID8gJyBzaGFyZWQnIDogJ1NoYXJlZCc7CiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInB1YmxpYy1zaGFyZWQtdGhyZWFkcyIsIHJlZjogdGhpcy5oYW5kbGVSZWYgfSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChTaWduVXBIZWFkZXIsIHsgbWU6IG1lLCBvbkJ1dHRvblByZXNzOiB0aGlzLmhhbmRsZVNpZ25JbkNsaWNrIH0pLAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogIm1haW4iIH0sCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImhlYWRlciIgfSwKICAgICAgICAgICAgICAgICAgICBzaGFyZWRPd25lciAmJgogICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInNoYXJlZC1sYWJlbCIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImltZyIsIHsgY2xhc3NOYW1lOiAibWVtYmVyLWF2YXRhciIsIHNyYzogc2hhcmVkT3duZXJQaG90b1VybCB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogIm5hbWUtbGFiZWwiIH0sIHRoaXMucmVuZGVyT3duZXJMYWJlbCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlZFN0cmluZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgd2l0aCB5b3U6ICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdC5zdWJqZWN0KSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJoMyIsIHsgY2xhc3NOYW1lOiAic3ViamVjdCIgfSwgc3Quc3ViamVjdCksCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJwYXJ0aWNpcGFudHMiIH0sIHBhcnRpY2lwYW50c1RvU3RyaW5nKHN0LnBhcnRpY2lwYW50cy5tYXAocGFyc2VBZGRyZXNzKSkpKSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiY2VsbHMiIH0sIGNlbGxzLm1hcCh0aGlzLnJlbmRlckNlbGwpKSksCiAgICAgICAgICAgIHRoaXMucmVuZGVyQ29tbWVudFBhbmUoKSwKICAgICAgICAgICAgc2lnblVwUG9wb3ZlclNob3duICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoU2lnblVwUG9wb3ZlciwgeyBvbkhpZGU6IHRoaXMuaGFuZGxlU2lnblVwUG9wb3ZlckhpZGUgfSksCiAgICAgICAgICAgIGNvbW1lbnRQb3BvdmVyU2hvd24gJiYgUmVhY3QuY3JlYXRlRWxlbWVudChDb21tZW50UG9wb3ZlciwgeyBvbkhpZGU6IHRoaXMuaGFuZGxlQ29tbWVudFBvcG92ZXJIaWRlIH0pKSk7CiAgICB9OwogICAgcmV0dXJuIFB1YmxpY1NoYXJlZFRocmVhZHM7Cn0oUmVhY3QuUHVyZUNvbXBvbmVudCkpOwpleHBvcnQgZGVmYXVsdCBQdWJsaWNTaGFyZWRUaHJlYWRzOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/PublicSharedThreads/PublicSharedThreads.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/PublicSharedThreads/PublicSharedThreads.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport SignUpHeader from './components/SignUpHeader/SignUpHeader';\n\nimport './PublicSharedThreads.scss';\nimport {\n  SharedThread, Cell, CellType, Comment, SharedThreadActivityType, SharedThreadActivity,\n} from '@src/types/sharedThreads';\nimport { Resource, Thread, Message, MessageBody, TeamMember, Me, Draft } from '@src/types';\nimport { participantsToString, parseAddress } from '@src/lib/address';\nimport CollapsedCell from '@src/components/ThreadDetail/components/Cell/CollapsedCell';\nimport { last, forEach, first } from 'lodash';\nimport ExpandedCell from '@src/components/ThreadDetail/components/Cell/ExpandedCell';\nimport SignUpPopover from './components/SignUpPopover/SignUpPopover';\nimport CommentPopover from './components/CommentPopover/CommentPopover';\nimport CommentCell from '@src/components/Cells/CommentCell';\n\n// tslint:disable-next-line:max-line-length\nimport CommentEditor from '@src/components/ThreadDetail/components/Composer/components/CommentEditor';\nimport { CommentCreateMeta } from '@src/ducks/comments';\n// tslint:disable-next-line:max-line-length\nimport SharedThreadErrorPage from '@src/routes/PublicSharedThreads/components/SharedThreadErrorPage';\nimport browserHistory from '@src/lib/browserHistory';\nimport CenteredLoader from '@src/components/Loader/CenteredLoader';\nimport { SharedThreadActivityCreateMeta, PING_INTERVAL } from '@src/ducks/sharedThreads';\nimport TypingCell, { TypingType } from '@src/components/Cells/TypingCell/TypingCell';\nimport PolymailLogo from '@src/routes/Login/Icons/PolymailLogo@3x.png';\nimport { IS_IOS } from '@src/lib/device';\nimport SharedDraftCell from '@src/components/ThreadDetail/components/Cell/SharedDraftCell';\nimport { AmplitudeEvents, logAmplitudeEvent } from '@src/lib/amplitude-analytics';\n\nexport interface StateProps {\n  sharedThread?: Resource<SharedThread>;\n  thread?: Thread;\n  comments?: Comment[];\n  bodies?: MessageBody[];\n  me?: Me;\n  originalThreadError?: Error;\n  sharedOwner?: TeamMember;\n  sharedOwnerPhotoUrl?: string;\n  selectedMessageId?: string;\n  replying: SharedThreadActivity[];\n  commenting: SharedThreadActivity[];\n  sharedThreadDraft?: Draft;\n}\n\nexport interface DispatchProps {\n  createComment: (meta: CommentCreateMeta) => void;\n  createSharedThreadActivity: (meta: SharedThreadActivityCreateMeta) => void;\n}\n\ninterface State {\n  expandedKeys: { [id: string]: boolean; };\n  cells: Cell[];\n  signUpPopoverShown: boolean;\n  commentPopoverShown: boolean;\n  showBrowser: boolean;\n}\n\nclass PublicSharedThreads extends React.PureComponent<StateProps & DispatchProps, State> {\n  scrolled: boolean;\n  timeout: NodeJS.Timer;\n  ref: HTMLDivElement;\n  viewInterval: NodeJS.Timer;\n\n  constructor(props: StateProps & DispatchProps) {\n    super(props);\n\n    this.state = {\n      expandedKeys: {},\n      cells: this.getCells(props),\n      signUpPopoverShown: false,\n      commentPopoverShown: false,\n      showBrowser: !IS_IOS,\n    };\n  }\n\n  recordView = () => {\n    const { sharedThread, createSharedThreadActivity } = this.props;\n\n    if (sharedThread && sharedThread.data && sharedThread.data.id) {\n      createSharedThreadActivity({\n        type: SharedThreadActivityType.View,\n        sharedThread: sharedThread.data.id,\n      });\n    }\n  }\n\n  componentDidMount() {\n    this.viewInterval = global.setInterval(\n      this.recordView, PING_INTERVAL,\n    );\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.viewInterval);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: StateProps) {\n    if (!nextProps.thread) {\n      return;\n    }\n\n    let expandedMessages: string[] = nextProps.thread.messages.filter(m => !m.read).map(m => m.id);\n\n    // Handle changes to thread\n    if (!this.props.thread || this.props.thread.id !== nextProps.thread.id) {\n      this.scrolled = false;\n    }\n\n    // Handle new messages -> expand them automatically\n    if (this.props.thread && nextProps.thread && nextProps.thread.id === this.props.thread.id) {\n      const oldMessages: { [id: string]: boolean } = {};\n\n      this.props.thread.messages.forEach((message) => {\n        oldMessages[message.id] = true && message.read;\n      });\n\n      expandedMessages = nextProps.thread.messages\n        .filter(message => !oldMessages[message.id])\n        .map(message => message.id);\n    }\n\n    // preserve expanded cells\n    if (this.state.expandedKeys) {\n      forEach(this.state.expandedKeys, (value, key) => {\n        if (value && expandedMessages.indexOf(key) === -1) {\n          expandedMessages.push(key);\n        }\n      });\n    }\n\n    // Handle thread messages collapsed/uncollapsed state\n    if (nextProps.thread) {\n      this.processCellCollapseStates(nextProps.thread, expandedMessages);\n    }\n\n    if (nextProps.thread !== this.props.thread ||\n      nextProps.thread.messages !== this.props.thread.messages ||\n      nextProps.comments !== this.props.comments ||\n      nextProps.replying !== this.props.replying ||\n      nextProps.commenting !== this.props.commenting\n    ) {\n      this.setState({ cells: this.getCells(nextProps) });\n    }\n  }\n\n  componentDidUpdate(oldProps: StateProps) {\n    const { sharedThread, me, selectedMessageId } = this.props;\n\n    // Redirect if error and user is not logged in\n    if (sharedThread && sharedThread.error && !me) {\n      return;\n    }\n\n    // Handles moving scroll position whenever new comments are loaded\n    const newComments = this.props.comments || [];\n    const oldComments = oldProps.comments || [];\n    if (newComments.length > oldComments.length) {\n      this.timeout = global.setTimeout(\n        () => {\n          const lastComment = last(newComments);\n          if (lastComment && this.ref) {\n            const cells = this.ref.getElementsByClassName('expanded-cell');\n            const cell = Array.from(cells)\n              .filter((el: HTMLElement) => selectedMessageId ?\n                el.dataset.message === selectedMessageId : true)[0];\n            if (cell) {\n              this.scrolled = true;\n              const table = this.ref.getElementsByClassName('cells');\n              if (table[0]) {\n                const commentScrollPosition = this.getLastCommentScrollPosition();\n                const messageScrollPosition = (cell as any).offsetTop;\n                const behavior = 'smooth';\n                const val = Math.max(commentScrollPosition, messageScrollPosition);\n                table[0].scrollTo({ top: val, behavior });\n              }\n            }\n          }\n        },\n        500,\n      );\n    }\n\n    const newTypingCells = this.props.replying.map(r => `r-${r.userId}`)\n      .concat(this.props.commenting.map(c => `c-${c.userId}`));\n    const oldTypingCells = oldProps.replying.map(r => `r-${r.userId}`)\n      .concat(oldProps.commenting.map(c => `c-${c.userId}`));\n    if (newTypingCells.join('') !== oldTypingCells.join('')) {\n      this.timeout = global.setTimeout(\n        () => {\n          const typingCells = this.ref && this.ref.getElementsByClassName('typing-cell');\n          if (typingCells && typingCells.length) {\n            const cell = typingCells[typingCells.length - 1];\n            if (cell) {\n              this.scrolled = true;\n              const table = this.ref.getElementsByClassName('cells');\n              if (table[0]) {\n                const val = (cell as any).offsetTop;\n                table[0].scrollTo({ top: val, behavior: 'smooth' });\n              }\n            }\n          }\n        },\n        500,\n      );\n    }\n  }\n\n  processCellCollapseStates = (thread: Thread, forceExpand?: string[]) => {\n    const { selectedMessageId } = this.props;\n    const expandedKeys = {};\n\n    thread.messages.forEach((message) => {\n      expandedKeys[message.id] = forceExpand && forceExpand.indexOf(message.id) > -1 ? true : false;\n    });\n\n    // Always show last id for now\n    const lastMessage = last(thread.messages);\n    const lastId = lastMessage && lastMessage.id || '';\n    if (lastId && !selectedMessageId) {\n      expandedKeys[lastId] = true;\n    }\n\n    // Overide expanded selection if we have a specific message selected\n    if (selectedMessageId) {\n      const match = first(\n        thread.messages.filter(message =>\n          message.id === selectedMessageId || message.rfcId === selectedMessageId,\n        ),\n      );\n      if (match) {\n        expandedKeys[match.id] = true;\n      }\n    }\n    this.setState({ expandedKeys });\n  }\n\n  getLastCommentScrollPosition = (): number => {\n    const { comments } = this.props;\n    if (comments && comments.length) {\n      const lastComment = last(comments);\n      if (lastComment && this.ref) {\n        const cells = this.ref.getElementsByClassName('comment-cell');\n        const cell = Array.from(cells)\n          .filter((el: HTMLElement) => el.dataset.comment === lastComment.id)[0];\n        if (cell) {\n          const val = (cell as any).offsetTop;\n          return val;\n        }\n      }\n    }\n    return 0;\n  }\n\n  getLastMessageScrollPosition = (): number => {\n    const { thread } = this.props;\n\n    if (!thread) {\n      return 0;\n    }\n\n    // Always show last id for now\n    const lastMessage = last(thread.messages);\n    const lastId = lastMessage && lastMessage.id || '';\n\n    const cells = this.ref.getElementsByClassName('expanded-cell');\n    const cell = Array.from(cells)\n      .filter((el: HTMLElement) => el.dataset.message === lastId)[0];\n    if (cell) {\n      const val = (cell as any).offsetTop;\n      return val;\n    }\n\n    return 0;\n  }\n\n  getCells = (props: StateProps) => {\n    if (props.thread && props.thread) {\n      const messages: Cell[] = props.thread.messages.map(m => ({\n        type: CellType.Message,\n        date: m.internal,\n        data: m,\n      }));\n      const comments: Cell[] = (props.comments || []).map(c => ({\n        type: CellType.Comment,\n        date: c.created,\n        data: c,\n      }));\n      const replying: Cell[] = (props.replying || []).map(r => ({\n        type: CellType.Typing,\n        date: r.timestamp,\n        data: r,\n      }));\n      const commenting: Cell[] = (props.commenting || []).map(c => ({\n        type: CellType.Typing,\n        date: c.timestamp,\n        data: c,\n      }));\n\n      const drafts: Cell[] = (props.sharedThreadDraft && [props.sharedThreadDraft] || [])\n        .map(c => ({\n          type: CellType.Draft,\n          date: c.updated,\n          data: c,\n        }));\n\n      return messages.concat(comments).sort((a, b) => {\n        if (a.date < b.date) {\n          return  -1;\n        }\n\n        if (a.date > b.date) {\n          return 1;\n        }\n\n        return 0;\n      }).concat(replying).concat(commenting).concat(drafts);\n    }\n\n    return [];\n  }\n\n  renderCell = (cell: Cell) => {\n    if (cell.type === CellType.Message) {\n      return this.renderMessage(cell.data as Message);\n    }\n\n    if (cell.type === CellType.Typing) {\n      return this.renderTyping(cell.data as SharedThreadActivity);\n    }\n\n    if (cell.type === CellType.Draft) {\n      return this.renderSharedDraftCell();\n    }\n\n    return this.renderComment(cell.data as Comment);\n  }\n\n  renderComment = (comment: Comment) => {\n    return <CommentCell comment={comment} key={comment.id} />;\n  }\n\n  renderTyping = (activity: SharedThreadActivity) => {\n    if (!activity.user) {\n      return null;\n    }\n\n    let type;\n    switch (activity.type) {\n      case SharedThreadActivityType.Comment:\n        type = TypingType.Comment;\n        break;\n      case SharedThreadActivityType.Reply:\n        type = TypingType.Reply;\n        break;\n      default:\n        return null;\n    }\n\n    return (\n      <TypingCell\n        key={`${type}-${activity.userId}`}\n        type={type}\n        user={{\n          firstName: activity.user.firstName, photoUrl: activity.user.photoUrl,\n        }}\n      />\n    );\n  }\n\n  renderMessage = (message: Message) => {\n    const { thread, bodies, sharedThread, me, selectedMessageId } = this.props;\n    const collapsed = !this.state.expandedKeys[message.id];\n    const ExpandedCellConnect = ExpandedCell as any;\n    const CollapsedCellConnect = CollapsedCell as any;\n    const isOwner = sharedThread && sharedThread.data && me && sharedThread.data.user === me.id;\n\n    if (!thread) {\n      return null;\n    }\n\n    if (collapsed) {\n      return (\n        <CollapsedCellConnect\n          id={message.id}\n          onToggleExpand={this.handleCellExpand}\n          key={message.id}\n          message={message}\n          hideTracks={!isOwner}\n          publicFocus={selectedMessageId && selectedMessageId === message.id}\n        />\n      );\n    }\n\n    if (!bodies) {\n      return null;\n    }\n\n    const body = bodies.filter(b => b.id === message.id)[0];\n    return (\n      <ExpandedCellConnect\n        onToggleExpand={this.handleCellExpand}\n        key={message.id}\n        message={message}\n        messageBody={body}\n        threadId={thread.id}\n        hideActions\n        hideTracks={!isOwner}\n        publicFocus={selectedMessageId && selectedMessageId === message.id}\n      />\n    );\n  }\n\n  renderSharedDraftCell = () => {\n    return (\n      <SharedDraftCell />\n    );\n  }\n\n  handleCellExpand = (key: string) => {\n    const oldValue  = this.state.expandedKeys[key] || false;\n    const expandedKeys = { ...this.state.expandedKeys, [key]: !oldValue };\n    this.setState({ expandedKeys });\n  }\n\n  handleRef = (ref: HTMLDivElement) => {\n    this.ref = ref;\n  }\n\n  handleSignUpPopoverHide = () => {\n    this.setState({ signUpPopoverShown: false, commentPopoverShown: false });\n  }\n\n  handleSignUpPopoverShow = () => {\n    this.setState({ signUpPopoverShown: true });\n  }\n\n  handleSignInClick = () => {\n    browserHistory.push('/login');\n  }\n\n  handleCommentPopoverHide = () => {\n    this.setState({ signUpPopoverShown: false, commentPopoverShown: false });\n  }\n\n  handleCommentPopoverShow = () => {\n    const { me, sharedThread } = this.props;\n    if (me && sharedThread && sharedThread.data && sharedThread.data.team !== me.team) {\n      this.setState({ commentPopoverShown: true });\n      return;\n    }\n\n    this.setState({ signUpPopoverShown: true });\n  }\n\n  handleComment = (comment: string) => {\n    logAmplitudeEvent(AmplitudeEvents.CommentOnEmail);\n    const { thread, sharedThread, sharedThreadDraft } = this.props;\n    const lastMessage = thread && last(thread.messages);\n    const sharedThreadId = sharedThread && sharedThread.data && sharedThread.data.id;\n    if (sharedThreadId && thread && lastMessage && lastMessage.rfcId) {\n      const computedRfcId = sharedThreadDraft?.id && `<${sharedThreadDraft.id}@polymail.io>` ||\n        lastMessage.rfcId;\n      this.props.createComment({\n        rfcId: computedRfcId,\n        body: comment,\n        thread: sharedThreadId,\n        draft: sharedThreadDraft?.id,\n      });\n    }\n  }\n\n  renderCommentPane = () => {\n    const {\n      me,\n      sharedThread,\n    } = this.props;\n\n    // Show Comment Editor is user is on team\n    const placeholderOverride = IS_IOS && 'Write a comment' || 'Write a comment or @mention a teammate';\n    if (me && sharedThread && sharedThread.data && sharedThread.data.team === me.team) {\n      return (\n        <div className=\"comment-input\">\n          <CommentEditor\n            comment={this.handleComment}\n            placeholderOverride={placeholderOverride}\n          />\n        </div>\n      );\n    }\n\n    // Do not show comment pane if user is not on the same team\n    if (me && sharedThread && sharedThread.data && sharedThread.data.team !== me.team) {\n      return null;\n    }\n\n    // Otherwise show button input\n    return (\n      <div className=\"comment-input\">\n        <button className=\"comment-button\" onClick={this.handleCommentPopoverShow}>\n          {placeholderOverride}\n          </button>\n      </div>\n    );\n  }\n\n  handleMobileBrowserContinue = () => {\n    this.setState({ showBrowser: true });\n  }\n\n  handleiOSOpen = () => {\n    window.location.href = 'polymail://' + window.location.pathname;\n  }\n\n  renderOwnerLabel = () => {\n    const { sharedOwner } = this.props;\n    if (sharedOwner) {\n      if (!!sharedOwner.firstName && !!sharedOwner.lastName) {\n        return `${sharedOwner.firstName} ${sharedOwner.lastName} `;\n      }\n      if (!!sharedOwner.email) {\n        return sharedOwner.email;\n      }\n    }\n    return '';\n  }\n\n  renderMobileCapture = () => {\n    const {\n      sharedThread,\n      sharedOwner,\n      sharedOwnerPhotoUrl,\n    } = this.props;\n\n    // Destructured shared thread\n    const st = sharedThread?.data;\n\n    return (\n      <div className=\"public-shared-threads-mobile-capture\">\n        <div className=\"header-section\">\n          <img src={PolymailLogo} alt=\"\" className=\"logo\"/>\n        </div>\n        {st && (\n          <div className=\"shared-thread-preview\">\n            <div className=\"header\">\n              {sharedOwner &&\n                <div className=\"shared-label\">\n                  <img className=\"member-avatar\" src={sharedOwnerPhotoUrl} />\n                  <span className=\"name-label\">\n                    {this.renderOwnerLabel()}\n                  </span> shared with you:\n              </div>\n              }\n              <h3 className=\"subject\">{st.subject}</h3>\n              <div className=\"participants\">\n                {participantsToString(st.participants.map(parseAddress))}\n              </div>\n            </div>\n          </div>\n        )}\n        <div className=\"action-section\">\n          <button className=\"open-ios\" onClick={this.handleiOSOpen}>\n            Open Polymail iOS\n          </button>\n          <button\n            className=\"open-browser\"\n            onClick={this.handleMobileBrowserContinue}\n          >\n            Open in browser\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const {\n      sharedThread,\n      thread,\n      sharedOwner,\n      sharedOwnerPhotoUrl,\n      me,\n      originalThreadError,\n    } = this.props;\n    const { signUpPopoverShown, commentPopoverShown, cells, showBrowser } = this.state;\n    const originalError = !!originalThreadError && !thread;\n    const sharedThreadError = sharedThread && sharedThread.error;\n\n    // Show mobile capture page if shared thread fetched properly and browser is not mobile\n    if (!showBrowser && !(sharedThreadError || originalThreadError)) {\n      return this.renderMobileCapture();\n    }\n\n    // Handle case for when user is not logged in\n    if (!me && sharedThreadError) {\n      return (\n        <div className=\"public-shared-threads\" ref={this.handleRef}>\n          <SignUpHeader me={me} onButtonPress={this.handleSignInClick} />\n          <div className=\"main\">\n            <SharedThreadErrorPage\n            />\n          </div>\n          {signUpPopoverShown && <SignUpPopover onHide={this.handleSignUpPopoverHide} />}\n          {commentPopoverShown && <CommentPopover onHide={this.handleCommentPopoverHide} />}\n        </div>\n      );\n    }\n\n    if (me && (sharedThreadError || originalError)) {\n      return (\n        <div className=\"public-shared-threads\" ref={this.handleRef}>\n          <SignUpHeader me={me} onButtonPress={this.handleSignInClick} />\n          <div className=\"main\">\n            <SharedThreadErrorPage\n              email={me.email}\n            />\n          </div>\n          {signUpPopoverShown && <SignUpPopover onHide={this.handleSignUpPopoverHide} />}\n          {commentPopoverShown && <CommentPopover onHide={this.handleCommentPopoverHide} />}\n        </div>\n      );\n    }\n\n    // Show Loader\n    if (!sharedThread || !thread || !sharedThread.data) {\n      return (\n        <div className=\"public-shared-threads\" ref={this.handleRef}>\n          <SignUpHeader me={me} onButtonPress={this.handleSignInClick} />\n          <div className=\"main\">\n            <CenteredLoader />\n          </div>\n          {signUpPopoverShown && <SignUpPopover onHide={this.handleSignUpPopoverHide} />}\n          {commentPopoverShown && <CommentPopover onHide={this.handleCommentPopoverHide} />}\n        </div>\n      );\n    }\n\n    const st = sharedThread.data;\n    // some threads don't have an owner label\n    const sharedString = this.renderOwnerLabel() ? ' shared' : 'Shared';\n    return (\n      <div className=\"public-shared-threads\" ref={this.handleRef}>\n        <SignUpHeader me={me} onButtonPress={this.handleSignInClick} />\n        <div className=\"main\">\n          <div className=\"header\">\n            {sharedOwner &&\n              <div className=\"shared-label\">\n                <img className=\"member-avatar\" src={sharedOwnerPhotoUrl} />\n                <span className=\"name-label\">\n                  {this.renderOwnerLabel()}\n                </span>{sharedString} with you: {st.subject}\n            </div>\n            }\n            <h3 className=\"subject\">{st.subject}</h3>\n            <div className=\"participants\">\n              {participantsToString(st.participants.map(parseAddress))}\n            </div>\n          </div>\n          <div className=\"cells\">\n            {cells.map(this.renderCell)}\n          </div>\n        </div>\n        {this.renderCommentPane()}\n        {signUpPopoverShown && <SignUpPopover onHide={this.handleSignUpPopoverHide} />}\n        {commentPopoverShown && <CommentPopover onHide={this.handleCommentPopoverHide} />}\n      </div>\n    );\n  }\n}\n\nexport default PublicSharedThreads;\n"]}]}