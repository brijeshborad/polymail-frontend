{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/MessageTemplates/routes/MessageTemplateDetail/MessageTemplateDetail.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/MessageTemplates/routes/MessageTemplateDetail/MessageTemplateDetail.tsx","mtime":1675280254084},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHsKICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7CiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkKICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgIH07CiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfTsKaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgZmlyc3QgfSBmcm9tICdsb2Rhc2gnOwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7CmltcG9ydCB7IEZpbGVUeXBlLCBUZW1wbGF0ZVR5cGUsIEtleUNvZGUsIH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCBOYXZpZ2F0aW9uSGVhZGVyIGZyb20gJ0BzcmMvcm91dGVzL1NldHRpbmdzL2NvbXBvbmVudHMvTmF2aWdhdGlvbkhlYWRlcic7CmltcG9ydCBUZXh0SW5wdXQgZnJvbSAnQHNyYy9jb21wb25lbnRzL0Zvcm0vVGV4dElucHV0JzsKLy8gaW1wb3J0IFRvZ2dsZUNlbGwgZnJvbSAnQHNyYy9yb3V0ZXMvU2V0dGluZ3MvY29tcG9uZW50cy9Ub2dnbGVDZWxsJzsKaW1wb3J0IENvbXBvc2VQYW5lIGZyb20gJ0BzcmMvY29tcG9uZW50cy9Db21wb3NlL0NvbXBvc2VQYW5lJzsKaW1wb3J0IHsgcmVwbGFjZVdpdGhQbGFjZWhvbGRlcnMsIHN0cmlwU2lnbmF0dXJlSWRzIH0gZnJvbSAnQHNyYy9saWIvdGVtcGxhdGUnOwppbXBvcnQgeyBtb25nb0lkIH0gZnJvbSAnQHNyYy9saWIvY3J5cHQnOwppbXBvcnQgeyBmaWxlRm9ybWF0IH0gZnJvbSAnQHNyYy9saWIvYXR0YWNobWVudCc7CmltcG9ydCB7IHNlbGVjdFBob3RvVXJsIH0gZnJvbSAnQHNyYy9kdWNrcy90ZWFtTWVtYmVycyc7CmltcG9ydCAnLi9NZXNzYWdlVGVtcGxhdGVEZXRhaWwuc2Nzcyc7CmltcG9ydCBVcGdyYWRlUHJvbXB0IGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL1VwZ3JhZGVQcm9tcHQvVXBncmFkZVByb21wdCc7CmltcG9ydCBicm93c2VySGlzdG9yeSBmcm9tICdAc3JjL2xpYi9icm93c2VySGlzdG9yeSc7CmltcG9ydCB7IEhvdGtleUFjdGlvbiB9IGZyb20gJ0BzcmMvbGliL2hvdGtleXMnOwppbXBvcnQgQ29uZmlybSBmcm9tICdAc3JjL2NvbXBvbmVudHMvQmFzZS9Db25maXJtJzsKaW1wb3J0IFJlY2lwaWVudHNFZGl0b3IgZnJvbSAnQHNyYy9jb21wb25lbnRzL0Zvcm0vUmVjaXBpZW50c0VkaXRvcic7CmltcG9ydCB7IEVkaXRvclR5cGUgfSBmcm9tICdAc3JjL2NvbXBvbmVudHMvRm9ybS9SZWNpcGllbnRzRWRpdG9yL1JlY2lwaWVudHNFZGl0b3InOwppbXBvcnQgeyBBbXBsaXR1ZGVFdmVudHMsIGxvZ0FtcGxpdHVkZUV2ZW50IH0gZnJvbSAnQHNyYy9saWIvYW1wbGl0dWRlLWFuYWx5dGljcyc7Ci8vIFRPRE8oU0hJTik6IEZpeCB0YWJiaW5nIGlzc3VlCnZhciBNZXNzYWdlVGVtcGxhdGVEZXRhaWwgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoTWVzc2FnZVRlbXBsYXRlRGV0YWlsLCBfc3VwZXIpOwogICAgZnVuY3Rpb24gTWVzc2FnZVRlbXBsYXRlRGV0YWlsKCkgewogICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7CiAgICAgICAgX3RoaXMuZWRpdG9yUmVmcyA9IHt9OwogICAgICAgIF90aGlzLmhhbmRsZUNvbXBvc2VQYW5lUmVmID0gZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICBfdGhpcy5jb21wb3NlUGFuZSA9IHJlZjsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUlucHV0Q2hhbmdlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gX3RoaXMucHJvcHMudGVtcGxhdGU7CiAgICAgICAgICAgIHZhciBwcm9wZXJ0eSA9IGUuY3VycmVudFRhcmdldC5pZDsKICAgICAgICAgICAgdmFyIHZhbHVlID0gZS5jdXJyZW50VGFyZ2V0LnZhbHVlOwogICAgICAgICAgICB2YXIgbmV3U3RhdGUgPSB7IHNob3dTYXZlOiB0cnVlIH07CiAgICAgICAgICAgIG5ld1N0YXRlW3Byb3BlcnR5XSA9IHRlbXBsYXRlICYmIHRlbXBsYXRlW3Byb3BlcnR5XSA9PT0gdmFsdWUgPyB1bmRlZmluZWQgOiB2YWx1ZTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUobmV3U3RhdGUpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQ29tcG9zZXJDaGFuZ2UgPSBmdW5jdGlvbiAoYm9keSkgewogICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBfdGhpcy5wcm9wcy50ZW1wbGF0ZTsKICAgICAgICAgICAgLy8gSGFuZGxlIE5ldyBTdGF0ZQogICAgICAgICAgICB2YXIgbmV3U3RhdGUgPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgX3RoaXMuc3RhdGUpLCB7IGJvZHk6IHRlbXBsYXRlICYmIHRlbXBsYXRlLmJvZHkgPT09IGJvZHkgPyB1bmRlZmluZWQgOiBib2R5IH0pOwogICAgICAgICAgICAvLyBVcGRhdGUgc2hvd1NhdmUgaWYgYm9keSBjaGFuZ2VkCiAgICAgICAgICAgIG5ld1N0YXRlLnNob3dTYXZlID0gdHJ1ZTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUobmV3U3RhdGUpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVG9nZ2xlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdGVhbSA9IF90aGlzLnByb3BzLnRlYW07CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHRlYW06ICFfdGhpcy5zdGF0ZS50ZWFtICYmIHRlYW0gPyB0ZWFtLmlkIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgc2hvd1NhdmU6IHRydWUsCiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlU2F2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbG9nQW1wbGl0dWRlRXZlbnQoQW1wbGl0dWRlRXZlbnRzLlNhdmVNZXNzYWdlVGVtcGxhdGUpOwogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgdGVtcGxhdGUgPSBfYS50ZW1wbGF0ZSwgdXBkYXRlVGVtcGxhdGUgPSBfYS51cGRhdGVUZW1wbGF0ZSwgY3JlYXRlVGVtcGxhdGUgPSBfYS5jcmVhdGVUZW1wbGF0ZTsKICAgICAgICAgICAgLy8gVXBkYXRlIGlmIGV4aXN0aW5nCiAgICAgICAgICAgIGlmICh0ZW1wbGF0ZSkgewogICAgICAgICAgICAgICAgLy8gSGFuZGxlIHVwZGF0aW5nIHdpdGggYW55IHVwZGF0ZWQgdmFsdWVzIGluIHRoZSBzdGF0ZQogICAgICAgICAgICAgICAgdmFyIHVwZGF0ZWRfMSA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCB0ZW1wbGF0ZSksIHsgc2hvd1NhdmU6IHVuZGVmaW5lZCB9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKF90aGlzLnN0YXRlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBfdGhpcy5zdGF0ZVtrZXldOwogICAgICAgICAgICAgICAgICAgIGlmIChbJ3Nob3dDYycsICdzaG93QmNjJywgJ3BvcG92ZXJTaG93biddLmluZGV4T2Yoa2V5KSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZF8xW2tleV0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlclVwZGF0ZWRUZW1wbGF0ZSA9IHJlcGxhY2VXaXRoUGxhY2Vob2xkZXJzKHVwZGF0ZWRfMSk7CiAgICAgICAgICAgICAgICB2YXIgZmluYWxUZW1wbGF0ZSA9IHN0cmlwU2lnbmF0dXJlSWRzKHBsYWNlaG9sZGVyVXBkYXRlZFRlbXBsYXRlKTsKICAgICAgICAgICAgICAgIHVwZGF0ZVRlbXBsYXRlKGZpbmFsVGVtcGxhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgeyAvLyBDcmVhdGUgaWYgbmV3CiAgICAgICAgICAgICAgICB2YXIgbmV3VGVtcGxhdGUgPSB7CiAgICAgICAgICAgICAgICAgICAgaWQ6ICcnLAogICAgICAgICAgICAgICAgICAgIG5hbWU6IF90aGlzLnN0YXRlLm5hbWUgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogX3RoaXMuc3RhdGUuc3ViamVjdCB8fCAnJywKICAgICAgICAgICAgICAgICAgICBib2R5OiBfdGhpcy5zdGF0ZS5ib2R5IHx8ICcnLAogICAgICAgICAgICAgICAgICAgIHVzZXI6ICcnLAogICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRzOiBbXSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLAogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWQ6IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgICAgICAgdHlwZTogVGVtcGxhdGVUeXBlLk1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgdG86IF90aGlzLnN0YXRlLnRvLAogICAgICAgICAgICAgICAgICAgIGNjOiBfdGhpcy5zdGF0ZS5jYywKICAgICAgICAgICAgICAgICAgICBiY2M6IF90aGlzLnN0YXRlLmJjYywKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB2YXIgcGxhY2Vob2xkZXJVcGRhdGVkVGVtcGxhdGUgPSByZXBsYWNlV2l0aFBsYWNlaG9sZGVycyhuZXdUZW1wbGF0ZSk7CiAgICAgICAgICAgICAgICB2YXIgZmluYWxUZW1wbGF0ZSA9IHN0cmlwU2lnbmF0dXJlSWRzKHBsYWNlaG9sZGVyVXBkYXRlZFRlbXBsYXRlKTsKICAgICAgICAgICAgICAgIGNyZWF0ZVRlbXBsYXRlKGZpbmFsVGVtcGxhdGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFJlc2V0IHN0YXRlCiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHNob3dTYXZlOiB1bmRlZmluZWQsCiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlU2hhcmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCBmZWF0dXJlcyA9IF9hLmZlYXR1cmVzLCB0ZWFtID0gX2EudGVhbSwgdGVtcGxhdGUgPSBfYS50ZW1wbGF0ZSwgc2hhcmVUZW1wbGF0ZSA9IF9hLnNoYXJlVGVtcGxhdGU7CiAgICAgICAgICAgIGlmIChmZWF0dXJlcy5zaGFyZWRUZW1wbGF0ZXMgJiYgdGVhbSAmJiB0ZW1wbGF0ZSkgewogICAgICAgICAgICAgICAgc2hhcmVUZW1wbGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVJZDogdGVtcGxhdGUuaWQsCiAgICAgICAgICAgICAgICAgICAgdGVhbUlkOiB0ZWFtLmlkLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsb2dBbXBsaXR1ZGVFdmVudChBbXBsaXR1ZGVFdmVudHMuU2hhcmVUZW1wbGF0ZVdpdGhUZWFtKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVXBsb2FkID0gZnVuY3Rpb24gKGZpbGVzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCB0ZW1wbGF0ZSA9IF9hLnRlbXBsYXRlLCBhZGRBdHRhY2htZW50ID0gX2EuYWRkQXR0YWNobWVudCwgc2V0VG9hc3QgPSBfYS5zZXRUb2FzdCwgY2xvdWRBdHRhY2htZW50cyA9IF9hLmNsb3VkQXR0YWNobWVudHM7CiAgICAgICAgICAgIGlmICghdGVtcGxhdGUpIHsKICAgICAgICAgICAgICAgIHNldFRvYXN0KG5ldyBFcnJvcignUGxlYXNlIHNhdmUgdGhpcyB0ZW1wbGF0ZSBiZWZvcmUgYWRkaW5nIGFueSBmaWxlcyEnKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQmxvY2sgYWJpbGl0eSB0byBhdHRhY2ggZmlsZXMgbGFyZ2VyIHRoYW4gMjUgTUIuCiAgICAgICAgICAgIGlmIChmaWxlcy5maWx0ZXIoZnVuY3Rpb24gKGZpbGUpIHsgcmV0dXJuIGZpbGUuc2l6ZSA+IDI1MDAwMDAwOyB9KS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHZhciBjb25maXJtUHJvcHMgPSB7CiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdFcnJvciBVcGxvYWRpbmcgQXR0YWNobWVudCcsCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1lvdSBjYW5ub3QgdXBsb2FkIGFuIGF0dGFjaG1lbnQgZ3JlYXRlciB0aGFuIDI1IE1CLicsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUNvcHk6ICdPaycsCiAgICAgICAgICAgICAgICAgICAgb25Db25maXJtOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgY29uZmlybVByb3BzOiB1bmRlZmluZWQgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbmZpcm1Qcm9wczogY29uZmlybVByb3BzIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpbGVzLmZvckVhY2goZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBtZXRhCiAgICAgICAgICAgICAgICB2YXIgaW5saW5lID0gZmlsZUZvcm1hdChmaWxlLnR5cGUpID09PSBGaWxlVHlwZS5JbWFnZTsKICAgICAgICAgICAgICAgIHZhciBhdHRhY2htZW50ID0gewogICAgICAgICAgICAgICAgICAgIGZpbGU6IGZpbGUsCiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VJZDogdGVtcGxhdGUuaWQsCiAgICAgICAgICAgICAgICAgICAgYXR0YWNobWVudDogbW9uZ29JZCgpLAogICAgICAgICAgICAgICAgICAgIGlubGluZTogaW5saW5lICYmICFvcHRpb25zLnNoaWZ0S2V5ICYmICFvcHRpb25zLmlnbm9yZUlubGluZSwKICAgICAgICAgICAgICAgICAgICBjbG91ZDogY2xvdWRBdHRhY2htZW50cyAmJiAhaW5saW5lICYmICFvcHRpb25zLnNoaWZ0S2V5LAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGFkZEF0dGFjaG1lbnQoYXR0YWNobWVudCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNob3dTYXZlOiB0cnVlIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQXR0YWNobWVudFJlbW92ZSA9IGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgdGVtcGxhdGUgPSBfYS50ZW1wbGF0ZSwgYXR0YWNobWVudE1ldGFzID0gX2EuYXR0YWNobWVudE1ldGFzOwogICAgICAgICAgICBpZiAodGVtcGxhdGUpIHsKICAgICAgICAgICAgICAgIHZhciBhdHRhY2htZW50VG9SZW1vdmUgPSBmaXJzdCh0ZW1wbGF0ZS5hdHRhY2htZW50cwogICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGVhY2gpIHsgcmV0dXJuIGVhY2guaWQgPT09IGlkOyB9KSk7CiAgICAgICAgICAgICAgICB2YXIgbWV0YVRvUmVtb3ZlID0gYXR0YWNobWVudE1ldGFzICYmCiAgICAgICAgICAgICAgICAgICAgZmlyc3QoYXR0YWNobWVudE1ldGFzLmZpbHRlcihmdW5jdGlvbiAobWV0YSkgeyByZXR1cm4gbWV0YS5kYXRhICYmIG1ldGEuZGF0YS5hdHRhY2htZW50ID09PSBpZDsgfSkpOwogICAgICAgICAgICAgICAgLy8gSGFuZGxlIGRlbGV0aW9uIG9mIG1ldGEgaWYgZXhpc3RzCiAgICAgICAgICAgICAgICBpZiAobWV0YVRvUmVtb3ZlICYmIG1ldGFUb1JlbW92ZS5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcHMucmVtb3ZlQXR0YWNobWVudChtZXRhVG9SZW1vdmUuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBzaG93U2F2ZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBIYW5kbGUgZGVsZXRpb24gb2YgYXR0YWNobWVudCBpZiBleGlzdHMKICAgICAgICAgICAgICAgIGlmIChhdHRhY2htZW50VG9SZW1vdmUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgYXR0YWNobWVudCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VJZDogdGVtcGxhdGUuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnQ6IGF0dGFjaG1lbnRUb1JlbW92ZS5pZCwKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcHMucmVtb3ZlQXR0YWNobWVudChhdHRhY2htZW50KTsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNob3dTYXZlOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlRGVsZXRlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgdGVtcGxhdGUgPSBfYS50ZW1wbGF0ZSwgZGVsZXRlVGVtcGxhdGUgPSBfYS5kZWxldGVUZW1wbGF0ZSwgaGlzdG9yeSA9IF9hLmhpc3Rvcnk7CiAgICAgICAgICAgIGlmICh0ZW1wbGF0ZSkgewogICAgICAgICAgICAgICAgdmFyIGNvbmZpcm1Qcm9wcyA9IHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1JlbW92aW5nIFRlbXBsYXRlJywKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIHJlbW92ZSB0aGlzIHRlbXBsYXRlPycsCiAgICAgICAgICAgICAgICAgICAgY29uZmlybUNvcHk6ICdSZW1vdmUnLAogICAgICAgICAgICAgICAgICAgIG9uQ29uZmlybTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbmZpcm1Qcm9wczogdW5kZWZpbmVkLCBzaG93U2F2ZTogZmFsc2UgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZVRlbXBsYXRlKHRlbXBsYXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeS5yZXBsYWNlKCcvdGVtcGxhdGVzJyk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvbkNhbmNlbDogZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IHVuZGVmaW5lZCB9KTsgfSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbmZpcm1Qcm9wczogY29uZmlybVByb3BzIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVUb3BUZW1wbGF0ZVNoYXJlVG9vbHRpcFJlZiA9IGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgX3RoaXMudG9wVGVtcGxhdGVTaGFyZVRvb2x0aXAgPSByZWY7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVUb3BUZW1wbGF0ZVNoYXJlTW91c2VFbnRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGZlYXR1cmVzID0gX3RoaXMucHJvcHMuZmVhdHVyZXM7CiAgICAgICAgICAgIGlmIChfdGhpcy50b3BUZW1wbGF0ZVNoYXJlVG9vbHRpcCAmJiAhZmVhdHVyZXMuc2hhcmVkVGVtcGxhdGVzKSB7CiAgICAgICAgICAgICAgICBfdGhpcy50b3BUZW1wbGF0ZVNoYXJlVG9vbHRpcC5zaG93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVRvcFRlbXBsYXRlU2hhcmVNb3VzZUxlYXZlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoX3RoaXMudG9wVGVtcGxhdGVTaGFyZVRvb2x0aXApIHsKICAgICAgICAgICAgICAgIF90aGlzLnRvcFRlbXBsYXRlU2hhcmVUb29sdGlwLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQm90dG9tVGVtcGxhdGVTaGFyZVRvb2x0aXBSZWYgPSBmdW5jdGlvbiAocmVmKSB7CiAgICAgICAgICAgIF90aGlzLmJvdHRvbVRlbXBsYXRlU2hhcmVUb29sdGlwID0gcmVmOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQm90dG9tVGVtcGxhdGVTaGFyZU1vdXNlRW50ZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBmZWF0dXJlcyA9IF90aGlzLnByb3BzLmZlYXR1cmVzOwogICAgICAgICAgICBpZiAoX3RoaXMuYm90dG9tVGVtcGxhdGVTaGFyZVRvb2x0aXAgJiYgIWZlYXR1cmVzLnNoYXJlZFRlbXBsYXRlcykgewogICAgICAgICAgICAgICAgX3RoaXMuYm90dG9tVGVtcGxhdGVTaGFyZVRvb2x0aXAuc2hvdygpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVCb3R0b21UZW1wbGF0ZVNoYXJlTW91c2VMZWF2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKF90aGlzLmJvdHRvbVRlbXBsYXRlU2hhcmVUb29sdGlwKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5ib3R0b21UZW1wbGF0ZVNoYXJlVG9vbHRpcC5oaWRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVNjaGVkdWxpbmdVcmxTZWxlY3QgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCBzY2hlZHVsaW5nVXJsID0gX2Euc2NoZWR1bGluZ1VybCwgaG90a2V5VXBkYXRlID0gX2EuaG90a2V5VXBkYXRlOwogICAgICAgICAgICBpZiAoc2NoZWR1bGluZ1VybCkgewogICAgICAgICAgICAgICAgaG90a2V5VXBkYXRlKEhvdGtleUFjdGlvbi5Db3B5U2NoZWR1bGluZ1VybCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBicm93c2VySGlzdG9yeS5wdXNoKCcvY2FsZW5kYXInKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVGFiUHJlc3MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgdmFyIGhhbmRsZWQgPSBfdGhpcy5oYW5kbGVUYWJEaXJlY3Rpb24odHJ1ZSk7CiAgICAgICAgICAgIGlmICghaGFuZGxlZCkgewogICAgICAgICAgICAgICAgKF9hID0gX3RoaXMuY29tcG9zZVBhbmUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5mb2N1c0NvbnRlbnRFZGl0YWJsZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVTaGlmdFRhYlByZXNzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5oYW5kbGVUYWJEaXJlY3Rpb24oZmFsc2UpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlUmVmcyA9IGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgaWYgKHJlZikgewogICAgICAgICAgICAgICAgX3RoaXMuZWRpdG9yUmVmc1tyZWYucHJvcHMuaWRdID0gcmVmLmdldFdyYXBwZWRJbnN0YW5jZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvLyBIYW5kbGVzIGZvY3VzIGRpcmVjdGlvbiB3aGVuIHRhYmJpbmcuIFJldHVybnMgdHJ1ZSBpZiBoYW5kbGVkLCBmYWxzZSBpZiBub3QKICAgICAgICBfdGhpcy5oYW5kbGVUYWJEaXJlY3Rpb24gPSBmdW5jdGlvbiAoZm9yd2FyZCkgewogICAgICAgICAgICBpZiAoZm9yd2FyZCA9PT0gdm9pZCAwKSB7IGZvcndhcmQgPSB0cnVlOyB9CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnN0YXRlLCBzaG93QmNjID0gX2Euc2hvd0JjYywgc2hvd0NjID0gX2Euc2hvd0NjLCBwb3BvdmVyU2hvd24gPSBfYS5wb3BvdmVyU2hvd247CiAgICAgICAgICAgIHN3aXRjaCAocG9wb3ZlclNob3duKSB7CiAgICAgICAgICAgICAgICBjYXNlIEVkaXRvclR5cGUuVG86CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3J3YXJkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc2hvd0NjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVkaXRvclJlZnMuY2MuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChzaG93QmNjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVkaXRvclJlZnMuYmNjLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGNhc2UgRWRpdG9yVHlwZS5DYzoKICAgICAgICAgICAgICAgICAgICBpZiAoIWZvcndhcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZWRpdG9yUmVmcy50by5mb2N1cygpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dCY2MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZWRpdG9yUmVmcy5iY2MuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIGNhc2UgRWRpdG9yVHlwZS5CY2M6CiAgICAgICAgICAgICAgICAgICAgaWYgKGZvcndhcmQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoc2hvd0NjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmVkaXRvclJlZnMuY2MuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF90aGlzLmVkaXRvclJlZnMudG8uZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVFbXB0eSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuc2hvd1JlY2lwaWVudFBhbmVzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBzaG93VG86IHRydWUsCiAgICAgICAgICAgICAgICBzaG93Q2M6IHRydWUsCiAgICAgICAgICAgICAgICBzaG93QmNjOiB0cnVlLAogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLnNob3dUbyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc2hvd1RvOiB0cnVlLAogICAgICAgICAgICAgICAgcG9wb3ZlclNob3duOiBFZGl0b3JUeXBlLlRvLAogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgX2E7CiAgICAgICAgICAgICAgICAoX2EgPSBfdGhpcy5lZGl0b3JSZWZzLnRvKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9jdXMoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5zaG93Q2MgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHNob3dDYzogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvcG92ZXJTaG93bjogRWRpdG9yVHlwZS5DYywKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIF9hOwogICAgICAgICAgICAgICAgKF9hID0gX3RoaXMuZWRpdG9yUmVmcy5jYykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvY3VzKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuc2hvd0JjYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc2hvd0JjYzogdHJ1ZSwKICAgICAgICAgICAgICAgIHBvcG92ZXJTaG93bjogRWRpdG9yVHlwZS5CY2MsCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgICAgIChfYSA9IF90aGlzLmVkaXRvclJlZnMuYmNjKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9jdXMoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVSZWNpcGllbnRDaGFuZ2UgPSBmdW5jdGlvbiAobGlzdCwgcmVjaXBpZW50cykgewogICAgICAgICAgICB2YXIgX2E7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKChfYSA9IHt9LAogICAgICAgICAgICAgICAgX2FbbGlzdF0gPSByZWNpcGllbnRzLAogICAgICAgICAgICAgICAgX2Euc2hvd1NhdmUgPSB0cnVlLAogICAgICAgICAgICAgICAgX2EpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgX2E7CiAgICAgICAgICAgICAgICAoX2EgPSBfdGhpcy5lZGl0b3JSZWZzW2xpc3RdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZm9jdXMoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVTZWFyY2ggPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBwb3BvdmVyU2hvd246IGlkIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlRWRpdG9yQmx1ciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBwb3BvdmVyU2hvd246IHVuZGVmaW5lZCB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUtleURvd24gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2RlLkcpIHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLnN0YXRlID0ge307CiAgICAgICAgcmV0dXJuIF90aGlzOwogICAgfQogICAgTWVzc2FnZVRlbXBsYXRlRGV0YWlsLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mOwogICAgICAgIHZhciBfZyA9IHRoaXMucHJvcHMsIG1hdGNoID0gX2cubWF0Y2gsIGdldFRlbXBsYXRlID0gX2cuZ2V0VGVtcGxhdGUsIGdldFRlYW0gPSBfZy5nZXRUZWFtLCB0ZW1wbGF0ZSA9IF9nLnRlbXBsYXRlOwogICAgICAgIGlmICghdGVtcGxhdGUgJiYgbWF0Y2gucGFyYW1zLnRlbXBsYXRlSWQgJiYgbWF0Y2gucGFyYW1zLnRlbXBsYXRlSWQgIT09ICduZXcnKSB7CiAgICAgICAgICAgIGdldFRlbXBsYXRlKG1hdGNoLnBhcmFtcy50ZW1wbGF0ZUlkKTsKICAgICAgICB9CiAgICAgICAgZ2V0VGVhbSgpOwogICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGgKICAgICAgICB0aGlzLnVuYmxvY2sgPSB0aGlzLnByb3BzLmhpc3RvcnkuYmxvY2soZnVuY3Rpb24gKG5leHRMb2NhdGlvbiwgYWN0aW9uKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5zaG93U2F2ZSkgewogICAgICAgICAgICAgICAgdmFyIGNvbmZpcm1Qcm9wcyA9IHsKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1lvdSBoYXZlIHVuc2F2ZWQgY2hhbmdlcy4nLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdXb3VsZCB5b3UgbGlrZSB0byBkaXNjYXJkIHRoZXNlIGNoYW5nZXM/JywKICAgICAgICAgICAgICAgICAgICBjb25maXJtQ29weTogJ0Rpc2NhcmQnLAogICAgICAgICAgICAgICAgICAgIG9uQ29uZmlybTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGNvbmZpcm1Qcm9wczogdW5kZWZpbmVkLCBzaG93U2F2ZTogZmFsc2UgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucHJvcHMuaGlzdG9yeS5wdXNoKG5leHRMb2NhdGlvbi5wYXRobmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25DYW5jZWw6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNldFN0YXRlKHsgY29uZmlybVByb3BzOiB1bmRlZmluZWQgfSk7IH0sCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgIG5leHRMb2NhdGlvbjogbmV4dExvY2F0aW9uLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1Qcm9wczogY29uZmlybVByb3BzLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0pOwogICAgICAgIC8vIEhhbmRsZSBTdGF0ZSBTZXQKICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgc2hvd1RvOiAhISgoX2IgPSAoX2EgPSB0aGlzLnByb3BzLnRlbXBsYXRlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudG8pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5sZW5ndGgpLAogICAgICAgICAgICBzaG93Q2M6ICEhKChfZCA9IChfYyA9IHRoaXMucHJvcHMudGVtcGxhdGUpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5jYykgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLmxlbmd0aCksCiAgICAgICAgICAgIHNob3dCY2M6ICEhKChfZiA9IChfZSA9IHRoaXMucHJvcHMudGVtcGxhdGUpID09PSBudWxsIHx8IF9lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZS5iY2MpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5sZW5ndGgpLAogICAgICAgIH0pOwogICAgfTsKICAgIE1lc3NhZ2VUZW1wbGF0ZURldGFpbC5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy51bmJsb2NrKCk7CiAgICB9OwogICAgTWVzc2FnZVRlbXBsYXRlRGV0YWlsLnByb3RvdHlwZS5jb21wb25lbnREaWRVcGRhdGUgPSBmdW5jdGlvbiAob2xkUHJvcHMpIHsKICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfajsKICAgICAgICB2YXIgb2xkVGVtcGxhdGVJZCA9IG9sZFByb3BzLnRlbXBsYXRlICYmIG9sZFByb3BzLnRlbXBsYXRlLmlkOwogICAgICAgIHZhciBuZXdUZW1wbGF0ZUlkID0gdGhpcy5wcm9wcy50ZW1wbGF0ZSAmJiB0aGlzLnByb3BzLnRlbXBsYXRlLmlkOwogICAgICAgIGlmICh0aGlzLmNvbXBvc2VQYW5lICYmIG9sZFRlbXBsYXRlSWQgIT09IG5ld1RlbXBsYXRlSWQpIHsKICAgICAgICAgICAgLy8gUmVzZXQgYm9keSBvbiB0ZW1wbGF0ZSBpZCBjaGFuZ2UKICAgICAgICAgICAgdGhpcy5jb21wb3NlUGFuZS5jb250ZW50RWRpdGFibGUucmVzZXRPbkNoYW5nZURlYm91bmNlKCk7CiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgYm9keTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgbmFtZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgc3ViamVjdDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdGVhbTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdG86IChfYSA9IHRoaXMucHJvcHMudGVtcGxhdGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50bywKICAgICAgICAgICAgICAgIGNjOiAoX2IgPSB0aGlzLnByb3BzLnRlbXBsYXRlKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuY2MsCiAgICAgICAgICAgICAgICBiY2M6IChfYyA9IHRoaXMucHJvcHMudGVtcGxhdGUpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5iY2MsCiAgICAgICAgICAgICAgICBzaG93VG86ICEhKChfZSA9IChfZCA9IHRoaXMucHJvcHMudGVtcGxhdGUpID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZC50bykgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLmxlbmd0aCksCiAgICAgICAgICAgICAgICBzaG93Q2M6ICEhKChfZyA9IChfZiA9IHRoaXMucHJvcHMudGVtcGxhdGUpID09PSBudWxsIHx8IF9mID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZi5jYykgPT09IG51bGwgfHwgX2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9nLmxlbmd0aCksCiAgICAgICAgICAgICAgICBzaG93QmNjOiAhISgoX2ogPSAoX2ggPSB0aGlzLnByb3BzLnRlbXBsYXRlKSA9PT0gbnVsbCB8fCBfaCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2guYmNjKSA9PT0gbnVsbCB8fCBfaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2oubGVuZ3RoKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKICAgIE1lc3NhZ2VUZW1wbGF0ZURldGFpbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfYSA9IHRoaXMucHJvcHMsIHRlbXBsYXRlID0gX2EudGVtcGxhdGUsIAogICAgICAgIC8vIHRlYW0sCiAgICAgICAgZGlzcGF0Y2hBY3Rpb24gPSBfYS5kaXNwYXRjaEFjdGlvbiwgYXR0YWNobWVudE1ldGFzID0gX2EuYXR0YWNobWVudE1ldGFzLCB0ZWFtTWVtYmVycyA9IF9hLnRlYW1NZW1iZXJzLCBtZSA9IF9hLm1lLCBmZWF0dXJlcyA9IF9hLmZlYXR1cmVzLCBub0JyYW5kaW5nID0gX2Eubm9CcmFuZGluZywgdXNlTGlua1ByZXZpZXcgPSBfYS51c2VMaW5rUHJldmlldzsKICAgICAgICB2YXIgX2IgPSB0aGlzLnN0YXRlLCBjb25maXJtUHJvcHMgPSBfYi5jb25maXJtUHJvcHMsIHNob3dDYyA9IF9iLnNob3dDYywgc2hvd0JjYyA9IF9iLnNob3dCY2MsIHBvcG92ZXJTaG93biA9IF9iLnBvcG92ZXJTaG93biwgc2hvd1RvID0gX2Iuc2hvd1RvOwogICAgICAgIHZhciBuYW1lID0gdGhpcy5zdGF0ZS5uYW1lICE9PSB1bmRlZmluZWQKICAgICAgICAgICAgPyB0aGlzLnN0YXRlLm5hbWUKICAgICAgICAgICAgOiB0ZW1wbGF0ZSAmJiB0ZW1wbGF0ZS5uYW1lIHx8ICcnOwogICAgICAgIHZhciBzdWJqZWN0ID0gdGhpcy5zdGF0ZS5zdWJqZWN0ICE9PSB1bmRlZmluZWQKICAgICAgICAgICAgPyB0aGlzLnN0YXRlLnN1YmplY3QKICAgICAgICAgICAgOiB0ZW1wbGF0ZSAmJiB0ZW1wbGF0ZS5zdWJqZWN0IHx8ICcnOwogICAgICAgIHZhciBib2R5ID0gdGVtcGxhdGUgJiYgdGVtcGxhdGUuYm9keSB8fCAnJzsKICAgICAgICB2YXIgc2hvd1NhdmUgPSB0aGlzLnN0YXRlLnNob3dTYXZlOwogICAgICAgIHZhciB0ZW1wbGF0ZVRlYW0gPSB0aGlzLnN0YXRlLnRlYW0gIT09IHVuZGVmaW5lZAogICAgICAgICAgICA/IHRoaXMuc3RhdGUudGVhbQogICAgICAgICAgICA6IHRlbXBsYXRlICYmIHRlbXBsYXRlLnRlYW0gfHwgJyc7CiAgICAgICAgdmFyIGhlYWRlck5hbWUgPSB0aGlzLnN0YXRlLm5hbWUgfHwgKHRlbXBsYXRlICYmIHRlbXBsYXRlLm5hbWUpIHx8ICdOZXcgVGVtcGxhdGUnOwogICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJtZXNzYWdlLXRlbXBsYXRlLWRldGFpbCIsIG9uS2V5RG93bjogdGhpcy5oYW5kbGVLZXlEb3duIH0sCiAgICAgICAgICAgIGNvbmZpcm1Qcm9wcyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KENvbmZpcm0sIF9fYXNzaWduKHt9LCBjb25maXJtUHJvcHMpKSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChOYXZpZ2F0aW9uSGVhZGVyLCB7IHRpdGxlOiBoZWFkZXJOYW1lLCBvblNhdmU6IHNob3dTYXZlID8gdGhpcy5oYW5kbGVTYXZlIDogdW5kZWZpbmVkIH0pLAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogIm1haW4iIH0sCiAgICAgICAgICAgICAgICB0ZW1wbGF0ZSAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRvcC1yb3ciIH0sCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVUZWFtICYmIG1lICYmIHRlYW1NZW1iZXJzICYmCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImltZyIsIHsgY2xhc3NOYW1lOiAicHJvZmlsZS1waWMiLCBzcmM6IHNlbGVjdFBob3RvVXJsKHRlYW1NZW1iZXJzLCBtZSwgdGVtcGxhdGUudXNlcikgfSksCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJjcmVhdGVkIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAiQ3JlYXRlZCBvbiAiLAogICAgICAgICAgICAgICAgICAgICAgICBtb21lbnQodGVtcGxhdGUuY3JlYXRlZCkuZm9ybWF0KCdNTU0gRCwgWVlZWScpKSwKICAgICAgICAgICAgICAgICAgICAhdGVtcGxhdGVUZWFtICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAicHJpdmF0ZSIsIG9uTW91c2VFbnRlcjogdGhpcy5oYW5kbGVUb3BUZW1wbGF0ZVNoYXJlTW91c2VFbnRlciwgb25Nb3VzZUxlYXZlOiB0aGlzLmhhbmRsZVRvcFRlbXBsYXRlU2hhcmVNb3VzZUxlYXZlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICJUaGlzIHRlbXBsYXRlIGlzIHByaXZhdGUuIiwKICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgeyBjbGFzc05hbWU6ICJsaW5rIiwgb25DbGljazogdGhpcy5oYW5kbGVTaGFyZSB9LCAiU2hhcmUgd2l0aCB5b3VyIHRlYW0iKSwKICAgICAgICAgICAgICAgICAgICAgICAgIWZlYXR1cmVzLnNoYXJlZFRlbXBsYXRlcyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFVwZ3JhZGVQcm9tcHQsIHsgdGl0bGU6ICJTaGFyZWQgTWVzc2FnZSBUZW1wbGF0ZXMiLCBkZXNjcmlwdGlvbjogJ1RvIHNoYXJlIHRlbXBsYXRlcyB3aXRoIHlvdXIgdGVhbSwgJyArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VwZ3JhZGUgdG8gUG9seW1haWwgUHJlbWl1bSBvciBFbnRlcnByaXNlLicsIHJlZjogdGhpcy5oYW5kbGVUb3BUZW1wbGF0ZVNoYXJlVG9vbHRpcFJlZiB9KSkpLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZW1wbGF0ZSIgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRleHRJbnB1dCwgeyBkZXNjcmlwdGlvbjogIlRlbXBsYXRlIG5hbWUiLCBwbGFjZWhvbGRlcjogImVudGVyIG5hbWUuLi4iLCB2YWx1ZTogbmFtZSwgb25DaGFuZ2U6IHRoaXMuaGFuZGxlSW5wdXRDaGFuZ2UsIHR5cGU6ICJ0ZXh0IiwgaWQ6ICJuYW1lIiB9KSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRleHRJbnB1dCwgeyBkZXNjcmlwdGlvbjogIlN1YmplY3QiLCBwbGFjZWhvbGRlcjogImVudGVyIHN1YmplY3QuLi4iLCB2YWx1ZTogc3ViamVjdCwgb25DaGFuZ2U6IHRoaXMuaGFuZGxlSW5wdXRDaGFuZ2UsIHR5cGU6ICJ0ZXh0IiwgaWQ6ICJzdWJqZWN0IiB9KSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInJlY2lwaWVudHMtc2VjdGlvbiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgIXNob3dDYyAmJiAhc2hvd0JjYyAmJiAhc2hvd1RvICYmIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRpdGxlIiB9LCAiUmVjaXBpZW50cyIpKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1RvICYmIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInJlY2lwaWVudC1jb250YWluZXIiIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRpdGxlIiB9LCAiVG8iKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZWRpdG9yLWNvbnRhaW5lciIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFJlY2lwaWVudHNFZGl0b3IsIHsgaWQ6IEVkaXRvclR5cGUuVG8sIGtleTogdGVtcGxhdGUgPT09IG51bGwgfHwgdGVtcGxhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbXBsYXRlLmlkLCByZWY6IHRoaXMuaGFuZGxlUmVmcywgcmVjaXBpZW50czogdGhpcy5zdGF0ZS50byB8fCAodGVtcGxhdGUgPT09IG51bGwgfHwgdGVtcGxhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHRlbXBsYXRlLnRvKSB8fCBbXSwgb25SZWNpcGllbnRzQ2hhbmdlOiB0aGlzLmhhbmRsZVJlY2lwaWVudENoYW5nZSwgZm9jdXNlZDogcG9wb3ZlclNob3duID09PSBFZGl0b3JUeXBlLlRvLCBvbkNvbnRhY3RHcm91cEFkZDogdGhpcy5oYW5kbGVFbXB0eSwgb25UYWJQcmVzczogdGhpcy5oYW5kbGVUYWJQcmVzcywgb25TaGlmdFRhYlByZXNzOiB0aGlzLmhhbmRsZVNoaWZ0VGFiUHJlc3MsIG9uU2VhcmNoOiB0aGlzLmhhbmRsZVNlYXJjaCwgb25Gb2N1czogdGhpcy5oYW5kbGVTZWFyY2gsIG9uQmx1cjogdGhpcy5oYW5kbGVFZGl0b3JCbHVyIH0pKSkpLAogICAgICAgICAgICAgICAgICAgICAgICBzaG93Q2MgJiYgKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAicmVjaXBpZW50LWNvbnRhaW5lciIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGl0bGUiIH0sICJDYyIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJlZGl0b3ItY29udGFpbmVyIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoUmVjaXBpZW50c0VkaXRvciwgeyBpZDogRWRpdG9yVHlwZS5DYywga2V5OiB0ZW1wbGF0ZSA9PT0gbnVsbCB8fCB0ZW1wbGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVtcGxhdGUuaWQsIHJlZjogdGhpcy5oYW5kbGVSZWZzLCByZWNpcGllbnRzOiB0aGlzLnN0YXRlLmNjIHx8ICh0ZW1wbGF0ZSA9PT0gbnVsbCB8fCB0ZW1wbGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVtcGxhdGUuY2MpIHx8IFtdLCBvblJlY2lwaWVudHNDaGFuZ2U6IHRoaXMuaGFuZGxlUmVjaXBpZW50Q2hhbmdlLCBmb2N1c2VkOiBwb3BvdmVyU2hvd24gPT09IEVkaXRvclR5cGUuQ2MsIG9uQ29udGFjdEdyb3VwQWRkOiB0aGlzLmhhbmRsZUVtcHR5LCBvblRhYlByZXNzOiB0aGlzLmhhbmRsZVRhYlByZXNzLCBvblNoaWZ0VGFiUHJlc3M6IHRoaXMuaGFuZGxlU2hpZnRUYWJQcmVzcywgb25TZWFyY2g6IHRoaXMuaGFuZGxlU2VhcmNoLCBvbkZvY3VzOiB0aGlzLmhhbmRsZVNlYXJjaCwgb25CbHVyOiB0aGlzLmhhbmRsZUVkaXRvckJsdXIgfSkpKSksCiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dCY2MgJiYgKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAicmVjaXBpZW50LWNvbnRhaW5lciIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidGl0bGUiIH0sICJCY2MiKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZWRpdG9yLWNvbnRhaW5lciIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFJlY2lwaWVudHNFZGl0b3IsIHsgaWQ6IEVkaXRvclR5cGUuQmNjLCBrZXk6IHRlbXBsYXRlID09PSBudWxsIHx8IHRlbXBsYXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZW1wbGF0ZS5pZCwgcmVmOiB0aGlzLmhhbmRsZVJlZnMsIHJlY2lwaWVudHM6IHRoaXMuc3RhdGUuYmNjIHx8ICh0ZW1wbGF0ZSA9PT0gbnVsbCB8fCB0ZW1wbGF0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogdGVtcGxhdGUuYmNjKSB8fCBbXSwgb25SZWNpcGllbnRzQ2hhbmdlOiB0aGlzLmhhbmRsZVJlY2lwaWVudENoYW5nZSwgZm9jdXNlZDogcG9wb3ZlclNob3duID09PSBFZGl0b3JUeXBlLkJjYywgb25Db250YWN0R3JvdXBBZGQ6IHRoaXMuaGFuZGxlRW1wdHksIG9uVGFiUHJlc3M6IHRoaXMuaGFuZGxlVGFiUHJlc3MsIG9uU2hpZnRUYWJQcmVzczogdGhpcy5oYW5kbGVTaGlmdFRhYlByZXNzLCBvbkZvY3VzOiB0aGlzLmhhbmRsZVNlYXJjaCwgb25TZWFyY2g6IHRoaXMuaGFuZGxlU2VhcmNoLCBvbkJsdXI6IHRoaXMuaGFuZGxlRWRpdG9yQmx1ciB9KSkpKSwKICAgICAgICAgICAgICAgICAgICAgICAgIXNob3dUbyAmJiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgeyB0YWJJbmRleDogLTEsIGNsYXNzTmFtZTogImluY2x1ZGUtcmVjaXBpZW50LWJ1dHRvbiIsIG9uQ2xpY2s6IHRoaXMuc2hvd1RvIH0sICJJbmNsdWRlIFRPIikpLAogICAgICAgICAgICAgICAgICAgICAgICAhc2hvd0NjICYmIChSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IHRhYkluZGV4OiAtMSwgY2xhc3NOYW1lOiAiaW5jbHVkZS1yZWNpcGllbnQtYnV0dG9uIiwgb25DbGljazogdGhpcy5zaG93Q2MgfSwgIkluY2x1ZGUgQ0MiKSksCiAgICAgICAgICAgICAgICAgICAgICAgICFzaG93QmNjICYmIChSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IHRhYkluZGV4OiAtMSwgY2xhc3NOYW1lOiAiaW5jbHVkZS1yZWNpcGllbnQtYnV0dG9uIiwgb25DbGljazogdGhpcy5zaG93QmNjIH0sICJJbmNsdWRlIEJDQyIpKSksCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJjb21wb3NlIiB9LAogICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImRlc2NyaXB0aW9uIiB9LCAiTWVzc2FnZSIpLAogICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENvbXBvc2VQYW5lLCB7IHJlZjogdGhpcy5oYW5kbGVDb21wb3NlUGFuZVJlZiwgaHRtbDogYm9keSwgYWN0aW9uczogWydhdHRhY2htZW50JywgJ2Vtb2ppJywgJ2dpZicsICdjYWxlbmRhciddLCBhdHRhY2htZW50czogdGVtcGxhdGUgJiYgdGVtcGxhdGUuYXR0YWNobWVudHMgfHwgW10sIGF0dGFjaG1lbnRNZXRhczogYXR0YWNobWVudE1ldGFzIHx8IFtdLCBvbkNoYW5nZTogdGhpcy5oYW5kbGVDb21wb3NlckNoYW5nZSwgZGlzcGF0Y2hBY3Rpb246IGRpc3BhdGNoQWN0aW9uLCBvblVwbG9hZDogdGhpcy5oYW5kbGVVcGxvYWQsIG9uUmVtb3ZlQXR0YWNobWVudDogdGhpcy5oYW5kbGVBdHRhY2htZW50UmVtb3ZlLCB0ZW1wbGF0ZTogdGVtcGxhdGUgJiYgdGVtcGxhdGUuaWQsIGlzVGVtcGxhdGVFZGl0b3I6IHRydWUsIGZlYXR1cmVzOiBmZWF0dXJlcywgb25TY2hlZHVsaW5nVXJsU2VsZWN0OiB0aGlzLmhhbmRsZVNjaGVkdWxpbmdVcmxTZWxlY3QsIG5vQnJhbmRpbmc6IG5vQnJhbmRpbmcsIHVzZUxpbmtQcmV2aWV3OiB1c2VMaW5rUHJldmlldywgYXV0b2ZvY3VzOiBmYWxzZSB9KSksCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJpbnN0cnVjdGlvbnMiIH0sICdDcmVhdGUgYSBwbGFjZWhvbGRlciBieSB3cmFwcGluZyBhIHdvcmQgaW4gZG91YmxlIGN1cmx5IGJyYWNlcyBsaWtlIHRoaXM6ICcgKwogICAgICAgICAgICAgICAgICAgICAgICAne3tleGFtcGxlfX0uIFVzZSBUQUIgYWZ0ZXIgaW5zZXJ0aW5nIGEgdGVtcGxhdGUgdG8gcXVpY2tseSBqdW1wIHRvIGFuZCAnICsKICAgICAgICAgICAgICAgICAgICAgICAgJ3JlcGxhY2UgcGxhY2Vob2xkZXJzLicpLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlICYmCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsgb25DbGljazogdGhpcy5oYW5kbGVEZWxldGUsIGNsYXNzTmFtZTogImRlbGV0ZSIgfSwgIkRlbGV0ZSBUZW1wbGF0ZSIpKSkpKTsKICAgIH07CiAgICByZXR1cm4gTWVzc2FnZVRlbXBsYXRlRGV0YWlsOwp9KFJlYWN0LlB1cmVDb21wb25lbnQpKTsKZXhwb3J0IGRlZmF1bHQgTWVzc2FnZVRlbXBsYXRlRGV0YWlsOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/MessageTemplates/routes/MessageTemplateDetail/MessageTemplateDetail.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/MessageTemplates/routes/MessageTemplateDetail/MessageTemplateDetail.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport { first } from 'lodash';\nimport { RouteComponentProps } from 'react-router-dom';\nimport moment from 'moment';\n\nimport {\n  Template,\n  Team,\n  Action,\n  AttachmentMeta,\n  FileType,\n  TemplateType,\n  Me,\n  Features,\n  TeamMembers,\n  Resource,\n  KeyCode,\n } from '@src/types';\n\nimport NavigationHeader from '@src/routes/Settings/components/NavigationHeader';\nimport TextInput from '@src/components/Form/TextInput';\n// import ToggleCell from '@src/routes/Settings/components/ToggleCell';\nimport ComposePane from '@src/components/Compose/ComposePane';\nimport { replaceWithPlaceholders, stripSignatureIds } from '@src/lib/template';\n\nimport { mongoId } from '@src/lib/crypt';\nimport { fileFormat, AttachmentUploadOptions } from '@src/lib/attachment';\nimport { selectPhotoUrl } from '@src/ducks/teamMembers';\nimport './MessageTemplateDetail.scss';\nimport UpgradePrompt from '@src/components/Base/UpgradePrompt/UpgradePrompt';\nimport { TemplateShareMeta } from '@src/ducks/templates';\nimport browserHistory from '@src/lib/browserHistory';\nimport { HotkeyAction } from '@src/lib/hotkeys';\nimport Confirm, { Props as ConfirmProps } from '@src/components/Base/Confirm';\nimport { Location } from 'history';\nimport RecipientsEditor from '@src/components/Form/RecipientsEditor';\nimport { EditorType } from '@src/components/Form/RecipientsEditor/RecipientsEditor';\nimport { AmplitudeEvents, logAmplitudeEvent } from '@src/lib/amplitude-analytics';\n\nexport interface Props {\n  me?: Me;\n  template?: Template;\n  team?: Team;\n  attachmentMetas?: Array<Resource<AttachmentMeta>>;\n  teamMembers: TeamMembers;\n  features: Features;\n  schedulingUrl?: string;\n  cloudAttachments: boolean;\n  noBranding?: boolean;\n  useLinkPreview?: boolean;\n}\n\nexport interface DispatchProps {\n  getTemplate: (id: string) => void;\n  getTeam: () => void;\n  dispatchAction: (action: Action<any, any>) => void;\n  createTemplate: (template: Template) => void;\n  updateTemplate: (template: Template) => void;\n  deleteTemplate: (template: Template) => void;\n  addAttachment: (meta: AttachmentMeta) => void;\n  removeAttachment: (meta: AttachmentMeta) => void;\n  shareTemplate: (meta: TemplateShareMeta) => void;\n  hotkeyUpdate: (meta: HotkeyAction) => void;\n  setToast: (error: Error) => void;\n}\n\ninterface State {\n  name?: string;\n  subject?: string;\n  body?: string;\n  team?: string;\n  showSave?: boolean;\n  confirmProps?: ConfirmProps;\n  nextLocation?: string;\n\n  to?: string[];\n  cc?: string[];\n  bcc?: string[];\n\n  showTo?: boolean;\n  showCc?: boolean;\n  showBcc?: boolean;\n  popoverShown?: EditorType;\n}\n\n// TODO(SHIN): Fix tabbing issue\nclass MessageTemplateDetail extends\n  React.PureComponent<Props & RouteComponentProps<any> & DispatchProps, State> {\n  private topTemplateShareTooltip: UpgradePrompt;\n  private bottomTemplateShareTooltip: UpgradePrompt;\n  private composePane: ComposePane;\n\n  private editorRefs: {[id: string]: any} = {};\n\n  private unblock: () => void;\n\n  constructor() {\n    super();\n    this.state = {};\n  }\n\n  componentDidMount() {\n    const { match, getTemplate, getTeam, template } = this.props;\n\n    if (!template && match.params.templateId && match.params.templateId !== 'new') {\n      getTemplate(match.params.templateId);\n    }\n\n    getTeam();\n\n    // tslint:disable-next-line:max-line-length\n    this.unblock = this.props.history.block((nextLocation: Location<any>, action: any): string|false|void => {\n      if (this.state.showSave) {\n        const confirmProps: ConfirmProps = {\n          title: 'You have unsaved changes.',\n          message: 'Would you like to discard these changes?',\n          confirmCopy: 'Discard',\n          onConfirm: () => {\n            this.setState({ confirmProps: undefined, showSave: false }, () => {\n              this.props.history.push(nextLocation.pathname);\n            });\n          },\n          onCancel: () => this.setState({ confirmProps: undefined }),\n        };\n\n        this.setState({\n          nextLocation: nextLocation.pathname,\n          confirmProps,\n        });\n\n        return false;\n      }\n\n      return;\n    });\n\n    // Handle State Set\n    this.setState({\n      showTo: !!this.props.template?.to?.length,\n      showCc: !!this.props.template?.cc?.length,\n      showBcc: !!this.props.template?.bcc?.length,\n    });\n  }\n\n  componentWillUnmount() {\n    this.unblock();\n  }\n\n  componentDidUpdate(oldProps: Props) {\n    const oldTemplateId = oldProps.template && oldProps.template.id;\n    const newTemplateId = this.props.template && this.props.template.id;\n    if (this.composePane && oldTemplateId !== newTemplateId) {\n      // Reset body on template id change\n      this.composePane.contentEditable.resetOnChangeDebounce();\n      this.setState({\n        body: undefined,\n        name: undefined,\n        subject: undefined,\n        team: undefined,\n        to: this.props.template?.to,\n        cc: this.props.template?.cc,\n        bcc: this.props.template?.bcc,\n        showTo: !!this.props.template?.to?.length,\n        showCc: !!this.props.template?.cc?.length,\n        showBcc: !!this.props.template?.bcc?.length,\n      });\n    }\n  }\n\n  handleComposePaneRef = (ref: ComposePane) => {\n    this.composePane = ref;\n  }\n\n  handleInputChange = (e: React.SyntheticEvent<HTMLInputElement>) => {\n    const { template } = this.props;\n    const property = e.currentTarget.id;\n    const value = e.currentTarget.value;\n    const newState = { showSave: true };\n\n    newState[property] = template && template[property] === value ? undefined : value;\n    this.setState(newState);\n  }\n\n  handleComposerChange = (body: string) => {\n    const { template } = this.props;\n    // Handle New State\n    const newState: State = {\n      ...this.state,\n      body: template && template.body === body ? undefined : body,\n    };\n\n    // Update showSave if body changed\n    newState.showSave = true;\n\n    this.setState(newState);\n  }\n\n  handleToggle = () => {\n    const { team } = this.props;\n\n    this.setState({\n      team: !this.state.team && team ? team.id : undefined,\n      showSave: true,\n    });\n  }\n\n  handleSave = () => {\n    logAmplitudeEvent(AmplitudeEvents.SaveMessageTemplate);\n    const { template, updateTemplate, createTemplate } = this.props;\n    // Update if existing\n    if (template) {\n      // Handle updating with any updated values in the state\n      const updated = { ...template, showSave: undefined };\n      Object.keys(this.state).forEach((key) => {\n        const value = this.state[key];\n        if (['showCc', 'showBcc', 'popoverShown'].indexOf(key) > -1) {\n          return;\n        }\n        if (value !== undefined) {\n          updated[key] = value;\n        }\n      });\n\n      const placeholderUpdatedTemplate = replaceWithPlaceholders(updated);\n      const finalTemplate = stripSignatureIds(placeholderUpdatedTemplate);\n      updateTemplate(finalTemplate);\n    } else { // Create if new\n      const newTemplate: Template = {\n        id: '',\n        name: this.state.name || '',\n        subject: this.state.subject || '',\n        body: this.state.body || '',\n        user: '',\n        attachments: [],\n        created: new Date(),\n        updated: new Date(),\n        type: TemplateType.Message,\n        to: this.state.to,\n        cc: this.state.cc,\n        bcc: this.state.bcc,\n      };\n      const placeholderUpdatedTemplate = replaceWithPlaceholders(newTemplate);\n      const finalTemplate = stripSignatureIds(placeholderUpdatedTemplate);\n      createTemplate(finalTemplate);\n    }\n\n    // Reset state\n    this.setState({\n      showSave: undefined,\n    });\n  }\n\n  handleShare = () => {\n    const { features, team, template, shareTemplate } = this.props;\n\n    if (features.sharedTemplates && team && template) {\n      shareTemplate({\n        templateId: template.id,\n        teamId: team.id,\n      });\n      logAmplitudeEvent(AmplitudeEvents.ShareTemplateWithTeam);\n    }\n  }\n\n  handleUpload = (files: File[], options: AttachmentUploadOptions) => {\n    const { template, addAttachment, setToast, cloudAttachments } = this.props;\n    if (!template) {\n      setToast(new Error('Please save this template before adding any files!'));\n      return;\n    }\n\n    // Block ability to attach files larger than 25 MB.\n    if (files.filter(file => file.size > 25000000).length) {\n      const confirmProps: ConfirmProps = {\n        title: 'Error Uploading Attachment',\n        message: 'You cannot upload an attachment greater than 25 MB.',\n        confirmCopy: 'Ok',\n        onConfirm: () => {\n          this.setState({ confirmProps: undefined });\n        },\n      };\n\n      this.setState({ confirmProps });\n      return;\n    }\n\n    files.forEach((file) => {\n      // Create meta\n      const inline = fileFormat(file.type) === FileType.Image;\n      const attachment = {\n        file,\n        resourceId: template.id,\n        attachment: mongoId(),\n        inline: inline && !options.shiftKey && !options.ignoreInline,\n        cloud: cloudAttachments && !inline && !options.shiftKey,\n      };\n\n      addAttachment(attachment);\n    });\n\n    this.setState({ showSave: true });\n  }\n\n  handleAttachmentRemove = (id: string) => {\n    const { template, attachmentMetas } = this.props;\n    if (template) {\n      const attachmentToRemove = first(template.attachments\n        .filter(each => each.id === id));\n      const metaToRemove = attachmentMetas &&\n        first(attachmentMetas.filter(meta => meta.data && meta.data.attachment === id));\n\n      // Handle deletion of meta if exists\n      if (metaToRemove && metaToRemove.data) {\n        this.props.removeAttachment(metaToRemove.data);\n        this.setState({ showSave: true });\n        return;\n      }\n\n      // Handle deletion of attachment if exists\n      if (attachmentToRemove) {\n        const attachment = {\n          resourceId: template.id,\n          attachment: attachmentToRemove.id,\n          file: undefined,\n        };\n\n        this.props.removeAttachment(attachment);\n        this.setState({ showSave: true });\n        return;\n      }\n    }\n  }\n\n  handleDelete = () => {\n    const { template, deleteTemplate, history } = this.props;\n    if (template) {\n      const confirmProps: ConfirmProps = {\n        title: 'Removing Template',\n        message: 'Are you sure you want to remove this template?',\n        confirmCopy: 'Remove',\n        onConfirm: () => {\n          this.setState({ confirmProps: undefined, showSave: false });\n          deleteTemplate(template);\n          history.replace('/templates');\n        },\n        onCancel: () => this.setState({ confirmProps: undefined }),\n      };\n\n      this.setState({ confirmProps });\n    }\n  }\n\n  handleTopTemplateShareTooltipRef = (ref: UpgradePrompt) => {\n    this.topTemplateShareTooltip = ref;\n  }\n\n  handleTopTemplateShareMouseEnter = () => {\n    const { features } = this.props;\n\n    if (this.topTemplateShareTooltip && !features.sharedTemplates) {\n      this.topTemplateShareTooltip.show();\n    }\n  }\n\n  handleTopTemplateShareMouseLeave = () => {\n    if (this.topTemplateShareTooltip) {\n      this.topTemplateShareTooltip.hide();\n    }\n  }\n\n  handleBottomTemplateShareTooltipRef = (ref: UpgradePrompt) => {\n    this.bottomTemplateShareTooltip = ref;\n  }\n\n  handleBottomTemplateShareMouseEnter = () => {\n    const { features } = this.props;\n\n    if (this.bottomTemplateShareTooltip && !features.sharedTemplates) {\n      this.bottomTemplateShareTooltip.show();\n    }\n  }\n\n  handleBottomTemplateShareMouseLeave = () => {\n    if (this.bottomTemplateShareTooltip) {\n      this.bottomTemplateShareTooltip.hide();\n    }\n  }\n\n  handleSchedulingUrlSelect = () => {\n    const { schedulingUrl, hotkeyUpdate } = this.props;\n    if (schedulingUrl) {\n      hotkeyUpdate(HotkeyAction.CopySchedulingUrl);\n    } else {\n      browserHistory.push('/calendar');\n    }\n  }\n\n  handleTabPress = () => {\n    const handled = this.handleTabDirection(true);\n    if (!handled) {\n      this.composePane?.focusContentEditable();\n    }\n  }\n\n  handleShiftTabPress = () => {\n    this.handleTabDirection(false);\n  }\n\n  handleRefs = (ref: any) => {\n    if (ref) {\n      this.editorRefs[ref.props.id] = ref.getWrappedInstance();\n    }\n  }\n\n  // Handles focus direction when tabbing. Returns true if handled, false if not\n  handleTabDirection = (forward: boolean = true): boolean => {\n    const { showBcc, showCc, popoverShown } = this.state;\n\n    switch (popoverShown) {\n      case EditorType.To:\n        if (!forward) {\n          return true;\n        }\n        if (showCc) {\n          this.editorRefs.cc.focus();\n          return true;\n        }\n\n        if (showBcc) {\n          this.editorRefs.bcc.focus();\n        }\n\n        return false;\n      case EditorType.Cc:\n        if (!forward) {\n          this.editorRefs.to.focus();\n          return true;\n        }\n\n        if (showBcc) {\n          this.editorRefs.bcc.focus();\n          return true;\n        }\n\n        return false;\n\n      case EditorType.Bcc:\n        if (forward) {\n          return false;\n        }\n\n        if (showCc) {\n          this.editorRefs.cc.focus();\n          return true;\n        }\n\n        this.editorRefs.to.focus();\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  handleEmpty = () => {\n    return;\n  }\n\n  showRecipientPanes = () => {\n    this.setState({\n      showTo: true,\n      showCc: true,\n      showBcc: true,\n    });\n  }\n\n  showTo = () => {\n    this.setState(\n      {\n        showTo: true,\n        popoverShown: EditorType.To,\n      },\n      () => {\n        this.editorRefs.to?.focus();\n      },\n    );\n  }\n\n  showCc = () => {\n    this.setState(\n      {\n        showCc: true,\n        popoverShown: EditorType.Cc,\n      },\n      () => {\n        this.editorRefs.cc?.focus();\n      },\n    );\n  }\n\n  showBcc = () => {\n    this.setState(\n      {\n        showBcc: true,\n        popoverShown: EditorType.Bcc,\n      },\n      () => {\n        this.editorRefs.bcc?.focus();\n      },\n    );\n  }\n\n  handleRecipientChange = (list: string, recipients: string[]) => {\n    this.setState(\n      {\n        [list]: recipients,\n        showSave: true,\n      },\n      () => {\n        this.editorRefs[list]?.focus();\n      },\n    );\n  }\n\n  handleSearch = (id: EditorType) => {\n    this.setState({ popoverShown: id });\n  }\n\n  handleEditorBlur = () => {\n    this.setState({ popoverShown: undefined });\n  }\n\n  handleKeyDown = (e: React.KeyboardEvent<any>) => {\n    if (e.keyCode === KeyCode.G) {\n      e.stopPropagation();\n    }\n  }\n\n  render() {\n    const {\n      template,\n      // team,\n      dispatchAction,\n      attachmentMetas,\n      teamMembers,\n      me,\n      features,\n      noBranding,\n      useLinkPreview,\n    } = this.props;\n    const { confirmProps, showCc, showBcc, popoverShown, showTo } = this.state;\n\n    const name = this.state.name !== undefined\n      ? this.state.name\n      : template && template.name || '';\n    const subject = this.state.subject !== undefined\n      ? this.state.subject\n      : template && template.subject || '';\n    const body = template && template.body || '';\n    const showSave = this.state.showSave;\n    const templateTeam = this.state.team !== undefined\n      ? this.state.team\n      : template && template.team || '';\n\n    const headerName = this.state.name || (template && template.name) || 'New Template';\n\n    return (\n      <div\n        className=\"message-template-detail\"\n        onKeyDown={this.handleKeyDown}\n      >\n        {confirmProps && <Confirm {...confirmProps} />}\n        <NavigationHeader\n          title={headerName}\n          onSave={showSave ? this.handleSave : undefined}\n        />\n        <div className=\"main\">\n          {template && <div className=\"top-row\">\n            {templateTeam && me && teamMembers &&\n              <img className=\"profile-pic\" src={selectPhotoUrl(teamMembers, me, template.user)} />\n            }\n            <div className=\"created\">\n              Created on {moment(template.created).format('MMM D, YYYY')}\n            </div>\n            {!templateTeam && <div\n              className=\"private\"\n              onMouseEnter={this.handleTopTemplateShareMouseEnter}\n              onMouseLeave={this.handleTopTemplateShareMouseLeave}\n            >\n              This template is private.\n            <button className=\"link\" onClick={this.handleShare}>Share with your team</button>\n              {!features.sharedTemplates && <UpgradePrompt\n                title=\"Shared Message Templates\"\n                description={'To share templates with your team, ' +\n                  'upgrade to Polymail Premium or Enterprise.'}\n                ref={this.handleTopTemplateShareTooltipRef}\n              />}\n            </div>}\n          </div>}\n          <div className=\"template\">\n            <TextInput\n              description=\"Template name\"\n              placeholder=\"enter name...\"\n              value={name}\n              onChange={this.handleInputChange}\n              type=\"text\"\n              id=\"name\"\n            />\n            <TextInput\n              description=\"Subject\"\n              placeholder=\"enter subject...\"\n              value={subject}\n              onChange={this.handleInputChange}\n              type=\"text\"\n              id=\"subject\"\n            />\n            <div className=\"recipients-section\">\n              {!showCc && !showBcc && !showTo && (\n                <div className=\"title\">\n                  Recipients\n                </div>\n              )}\n              {showTo && (\n                <div className=\"recipient-container\">\n                <div className=\"title\">\n                  To\n                </div>\n                <div className=\"editor-container\">\n                  <RecipientsEditor\n                      id={EditorType.To}\n                      key={template?.id}\n                      ref={this.handleRefs}\n                      recipients={this.state.to || template?.to || []}\n                      onRecipientsChange={this.handleRecipientChange}\n                      focused={popoverShown === EditorType.To}\n                      onContactGroupAdd={this.handleEmpty}\n                      onTabPress={this.handleTabPress}\n                      onShiftTabPress={this.handleShiftTabPress}\n                      onSearch={this.handleSearch}\n                      onFocus={this.handleSearch}\n                      onBlur={this.handleEditorBlur}\n                    />\n                </div>\n              </div>\n              )}\n              {showCc && (\n                <div className=\"recipient-container\">\n                <div className=\"title\">\n                  Cc\n                </div>\n                <div className=\"editor-container\">\n                  <RecipientsEditor\n                      id={EditorType.Cc}\n                      key={template?.id}\n                      ref={this.handleRefs}\n                      recipients={this.state.cc || template?.cc || []}\n                      onRecipientsChange={this.handleRecipientChange}\n                      focused={popoverShown === EditorType.Cc}\n                      onContactGroupAdd={this.handleEmpty}\n                      onTabPress={this.handleTabPress}\n                      onShiftTabPress={this.handleShiftTabPress}\n                      onSearch={this.handleSearch}\n                      onFocus={this.handleSearch}\n                      onBlur={this.handleEditorBlur}\n                    />\n                </div>\n              </div>\n              )}\n              {showBcc && (\n                <div className=\"recipient-container\">\n                <div className=\"title\">\n                  Bcc\n                </div>\n                <div className=\"editor-container\">\n                  <RecipientsEditor\n                      id={EditorType.Bcc}\n                      key={template?.id}\n                      ref={this.handleRefs}\n                      recipients={this.state.bcc || template?.bcc || []}\n                      onRecipientsChange={this.handleRecipientChange}\n                      focused={popoverShown === EditorType.Bcc}\n                      onContactGroupAdd={this.handleEmpty}\n                      onTabPress={this.handleTabPress}\n                      onShiftTabPress={this.handleShiftTabPress}\n                      onFocus={this.handleSearch}\n                      onSearch={this.handleSearch}\n                      onBlur={this.handleEditorBlur}\n                    />\n                </div>\n              </div>\n              )}\n              {!showTo && (\n                <button\n                  tabIndex={-1}\n                  className=\"include-recipient-button\"\n                  onClick={this.showTo}\n                >\n                  Include TO\n                </button>\n              )}\n              {!showCc && (\n                <button\n                  tabIndex={-1}\n                  className=\"include-recipient-button\"\n                  onClick={this.showCc}\n                >\n                  Include CC\n                </button>\n              )}\n              {!showBcc && (\n                <button\n                  tabIndex={-1}\n                  className=\"include-recipient-button\"\n                  onClick={this.showBcc}\n                >\n                  Include BCC\n                </button>\n              )}\n            </div>\n            <div className=\"compose\">\n              <div className=\"description\">Message</div>\n              <ComposePane\n                ref={this.handleComposePaneRef}\n                html={body}\n                actions={['attachment', 'emoji', 'gif', 'calendar']}\n                attachments={template && template.attachments || []}\n                attachmentMetas={attachmentMetas || []}\n                onChange={this.handleComposerChange}\n                dispatchAction={dispatchAction}\n                onUpload={this.handleUpload}\n                onRemoveAttachment={this.handleAttachmentRemove}\n                template={template && template.id}\n                isTemplateEditor={true}\n                features={features}\n                onSchedulingUrlSelect={this.handleSchedulingUrlSelect}\n                noBranding={noBranding}\n                useLinkPreview={useLinkPreview}\n                autofocus={false}\n              />\n            </div>\n            <div className=\"instructions\">\n              {'Create a placeholder by wrapping a word in double curly braces like this: ' +\n                '{{example}}. Use TAB after inserting a template to quickly jump to and ' +\n                'replace placeholders.'}\n            </div>\n            {template &&\n              <button\n                onClick={this.handleDelete}\n                className=\"delete\"\n              >\n                Delete Template\n              </button>\n            }\n            {/* {!template && <ToggleCell\n            title={`Share this template with ${team ? team.name : 'your team'}`}\n            subtitle={`Allow other members of ${team ? team.name : 'your team'} ` +\n              `to use and edit this template.`}\n            on={!!templateTeam}\n            onToggle={this.handleToggle}\n            tooltip={<UpgradePrompt\n              className=\"tooltip\"\n              ref={this.handleBottomTemplateShareTooltipRef}\n              title=\"Shared Message Templates\"\n              description={'To share templates with your team, ' +\n                'upgrade to Polymail Premium or Enterprise.'}\n            />}\n            onTooltipShow={this.handleBottomTemplateShareMouseEnter}\n            onTooltipHide={this.handleBottomTemplateShareMouseLeave}\n          />} */}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default MessageTemplateDetail;\n"]}]}