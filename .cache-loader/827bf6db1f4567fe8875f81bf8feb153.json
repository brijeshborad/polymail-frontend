{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/billing.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/billing.ts","mtime":1675280254047},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaCwgX2o7CmltcG9ydCB1cGRhdGUgZnJvbSAnaW1tdXRhYmlsaXR5LWhlbHBlcic7CmltcG9ydCB7IGNyZWF0ZSB9IGZyb20gJ0BzcmMvbGliL3JlZHV4JzsKaW1wb3J0IHsgUmVzb3VyY2VTdGF0dXMsIE1lU3RhdHVzTmV3IH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCB7IHJlc291cmNlT2ssIHNlbGVjdFJlc291cmNlTG9hZGluZywgc2VsZWN0UmVzb3VyY2VFcnJvciwgcmVzb3VyY2VMb2FkaW5nLCByZXNvdXJjZUZhaWxlZCwgfSBmcm9tICdAc3JjL2xpYi9yZXNvdXJjZSc7CmltcG9ydCB7IEJpbGxpbmdTdWJzY3JpcHRpb25TdGF0dXMsIENvdXBvblR5cGUsIH0gZnJvbSAnQHNyYy90eXBlcy9iaWxsaW5nJzsKaW1wb3J0IHsgY3JlYXRlU2VsZWN0b3IgfSBmcm9tICdAc3JjL2xpYi9zZWxlY3Rvcic7Ci8vIHJlZHVjZXIgaGVscGVyIHRvIHVwZGF0ZSB0aGUgYmlsbGluZyBzdGF0ZSBvbiBzdWNjZXNzIGNhc2VzCmZ1bmN0aW9uIHVwZGF0ZUJpbGxpbmdTdGF0ZShzdGF0ZSwgYmlsbGluZywgc2V0VXBkYXRpbmcsIHNldEVycm9yLCB1bnNldENvdXBvbikgewogICAgaWYgKHNldFVwZGF0aW5nID09PSB2b2lkIDApIHsgc2V0VXBkYXRpbmcgPSBmYWxzZTsgfQogICAgaWYgKHNldEVycm9yID09PSB2b2lkIDApIHsgc2V0RXJyb3IgPSBmYWxzZTsgfQogICAgaWYgKHVuc2V0Q291cG9uID09PSB2b2lkIDApIHsgdW5zZXRDb3Vwb24gPSBmYWxzZTsgfQogICAgdmFyIHNwZWMgPSB7CiAgICAgICAgYmlsbGluZzogewogICAgICAgICAgICByZXNvdXJjZTogewogICAgICAgICAgICAgICAgJHNldDogcmVzb3VyY2VPayhiaWxsaW5nKSwKICAgICAgICAgICAgfSwKICAgICAgICB9LAogICAgfTsKICAgIGlmIChzZXRVcGRhdGluZykgewogICAgICAgIHNwZWMuYmlsbGluZy51cGRhdGluZyA9IHsgJHNldDogZmFsc2UgfTsKICAgIH0KICAgIGlmIChzZXRFcnJvcikgewogICAgICAgIHNwZWMuYmlsbGluZy51cGdyYWRpbmdFcnJvciA9IHsgJHNldDogdW5kZWZpbmVkIH07CiAgICB9CiAgICBpZiAodW5zZXRDb3Vwb24pIHsKICAgICAgICBzcGVjLmJpbGxpbmcuJHVuc2V0ID0gWyd1cGdyYWRlQ291cG9uJ107CiAgICB9CiAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCBzcGVjKTsKfQovLyByZWR1Y2VyIGhlbHBlciB0byBzZXQgdGhlIHVwZGF0aW5nIGFuZCBlcnJvciB2YWx1ZXMgb24gdGhlIGJpbGxpbmcgc3RhdGUKZnVuY3Rpb24gYmlsbGluZ0FjdGlvblVwZGF0aW5nKHN0YXRlLCB1cGRhdGluZywgZXJyb3IpIHsKICAgIHZhciBzcGVjID0gewogICAgICAgIGJpbGxpbmc6IHsKICAgICAgICAgICAgdXBkYXRpbmc6IHsKICAgICAgICAgICAgICAgICRzZXQ6IHVwZGF0aW5nLAogICAgICAgICAgICB9LAogICAgICAgIH0sCiAgICB9OwogICAgaWYgKGVycm9yKSB7CiAgICAgICAgc3BlYy5iaWxsaW5nLnVwZ3JhZGluZ0Vycm9yID0geyAkc2V0OiBlcnJvciB9OwogICAgfQogICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgc3BlYyk7Cn0KZXhwb3J0IHZhciBCSUxMSU5HX0ZFVENIID0gKF9hID0gY3JlYXRlKCdCSUxMSU5HX0ZFVENIJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgYmlsbGluZzogewogICAgICAgICAgICAgICAgcmVzb3VyY2U6IHsKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHsgJHNldDogUmVzb3VyY2VTdGF0dXMuTG9hZGluZyB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsgcmV0dXJuIHVwZGF0ZUJpbGxpbmdTdGF0ZShzdGF0ZSwgcGF5bG9hZCk7IH0sCiAgICBmYWlsdXJlOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIGVycm9yKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBiaWxsaW5nOiB7CiAgICAgICAgICAgICAgICByZXNvdXJjZTogewogICAgICAgICAgICAgICAgICAgIHN0YXR1czogeyAkc2V0OiBSZXNvdXJjZVN0YXR1cy5GYWlsdXJlIH0sCiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHsgJHNldDogZXJyb3IgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2EudHlwZSksIGJpbGxpbmdGZXRjaCA9IF9hLmFjdGlvbiwgYmlsbGluZ0ZldGNoUmVkdWNlciA9IF9hLnJlZHVjZXI7CmV4cG9ydCB2YXIgQklMTElOR19DUkVBVEUgPSAoX2IgPSBjcmVhdGUoJ0JJTExJTkdfQ1JFQVRFJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgeyByZXR1cm4gYmlsbGluZ0FjdGlvblVwZGF0aW5nKHN0YXRlLCB0cnVlKTsgfSwKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgeyByZXR1cm4gdXBkYXRlQmlsbGluZ1N0YXRlKHN0YXRlLCBwYXlsb2FkLCB0cnVlLCB0cnVlLCB0cnVlKTsgfSwKICAgIGZhaWx1cmU6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgZXJyb3IpIHsgcmV0dXJuIGJpbGxpbmdBY3Rpb25VcGRhdGluZyhzdGF0ZSwgZmFsc2UsIGVycm9yKTsgfSwKfSksIF9iLnR5cGUpLCBiaWxsaW5nQ3JlYXRlID0gX2IuYWN0aW9uLCBiaWxsaW5nQ3JlYXRlUmVkdWNlciA9IF9iLnJlZHVjZXI7CmV4cG9ydCB2YXIgQklMTElOR19VUERBVEUgPSAoX2MgPSBjcmVhdGUoJ0JJTExJTkdfVVBEQVRFJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgeyByZXR1cm4gYmlsbGluZ0FjdGlvblVwZGF0aW5nKHN0YXRlLCB0cnVlKTsgfSwKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgeyByZXR1cm4gdXBkYXRlQmlsbGluZ1N0YXRlKHN0YXRlLCBwYXlsb2FkLCB0cnVlLCB0cnVlKTsgfSwKICAgIGZhaWx1cmU6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgZXJyb3IpIHsgcmV0dXJuIGJpbGxpbmdBY3Rpb25VcGRhdGluZyhzdGF0ZSwgZmFsc2UsIGVycm9yKTsgfSwKfSksIF9jLnR5cGUpLCBiaWxsaW5nVXBkYXRlID0gX2MuYWN0aW9uLCBiaWxsaW5nVXBkYXRlUmVkdWNlciA9IF9jLnJlZHVjZXI7CmV4cG9ydCB2YXIgQklMTElOR19VUERBVEVfQ0FSRCA9IChfZCA9IGNyZWF0ZSgnQklMTElOR19VUERBVEVfQ0FSRCcsIHsKICAgIHN0YXJ0OiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEpIHsgcmV0dXJuIGJpbGxpbmdBY3Rpb25VcGRhdGluZyhzdGF0ZSwgdHJ1ZSk7IH0sCiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsgcmV0dXJuIHVwZGF0ZUJpbGxpbmdTdGF0ZShzdGF0ZSwgcGF5bG9hZCwgdHJ1ZSk7IH0sCiAgICBmYWlsdXJlOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIGVycm9yKSB7IHJldHVybiBiaWxsaW5nQWN0aW9uVXBkYXRpbmcoc3RhdGUsIGZhbHNlKTsgfSwKfSksIF9kLnR5cGUpLCBiaWxsaW5nVXBkYXRlQ2FyZCA9IF9kLmFjdGlvbiwgYmlsbGluZ1VwZGF0ZUNhcmRSZWR1Y2VyID0gX2QucmVkdWNlcjsKZXhwb3J0IHZhciBCSUxMSU5HX0NBTkNFTCA9IChfZSA9IGNyZWF0ZSgnQklMTElOR19DQU5DRUwnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7IHJldHVybiBiaWxsaW5nQWN0aW9uVXBkYXRpbmcoc3RhdGUsIHRydWUpOyB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7IHJldHVybiB1cGRhdGVCaWxsaW5nU3RhdGUoc3RhdGUsIHBheWxvYWQsIHRydWUpOyB9LAogICAgZmFpbHVyZTogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBlcnJvcikgeyByZXR1cm4gYmlsbGluZ0FjdGlvblVwZGF0aW5nKHN0YXRlLCBmYWxzZSk7IH0sCn0pLCBfZS50eXBlKSwgYmlsbGluZ0NhbmNlbCA9IF9lLmFjdGlvbiwgYmlsbGluZ0NhbmNlbFJlZHVjZXIgPSBfZS5yZWR1Y2VyOwpleHBvcnQgdmFyIEJJTExJTkdfQ0FOQ0VMTEFUSU9OX0ZFRURCQUNLID0gKF9mID0gY3JlYXRlKCdCSUxMSU5HX0NBTkNFTExBVElPTl9GRUVEQkFDSycsIHsKICAgIHN0YXJ0OiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEpIHsgcmV0dXJuIGJpbGxpbmdBY3Rpb25VcGRhdGluZyhzdGF0ZSwgdHJ1ZSk7IH0sCiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsgcmV0dXJuIGJpbGxpbmdBY3Rpb25VcGRhdGluZyhzdGF0ZSwgZmFsc2UpOyB9LAogICAgZmFpbHVyZTogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBlcnJvcikgeyByZXR1cm4gYmlsbGluZ0FjdGlvblVwZGF0aW5nKHN0YXRlLCBmYWxzZSk7IH0sCn0pLCBfZi50eXBlKSwgYmlsbGluZ0NhbmNlbGxhdGlvbkZlZWRiYWNrID0gX2YuYWN0aW9uLCBiaWxsaW5nQ2FuY2VsbGF0aW9uRmVlZGJhY2tSZWR1Y2VyID0gX2YucmVkdWNlcjsKZXhwb3J0IHZhciBCSUxMSU5HX1VQR1JBREVfQ09VUE9OX1NFVCA9IChfZyA9IGNyZWF0ZSgnQklMTElOR19VUEdSQURFX0NPVVBPTl9TRVQnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7IHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICBiaWxsaW5nOiB7CiAgICAgICAgICAgIHVwZ3JhZGVDb3Vwb246IHsKICAgICAgICAgICAgICAgICRzZXQ6IG1ldGEsCiAgICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgIH0pOyB9LAp9KSwgX2cudHlwZSksIGJpbGxpbmdVcGdyYWRlQ291cG9uU2V0ID0gX2cuYWN0aW9uLCBiaWxsaW5nVXBncmFkZUNvdXBvblNldFJlZHVjZXIgPSBfZy5yZWR1Y2VyOwpleHBvcnQgdmFyIEJJTExJTkdfVVBHUkFERV9DT1VQT05fVU5TRVQgPSAoX2ggPSBjcmVhdGUoJ0JJTExJTkdfVVBHUkFERV9DT1VQT05fVU5TRVQnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oQ291cG9uVHlwZS5Db3Vwb24pOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgYmlsbGluZzogewogICAgICAgICAgICAgICAgdXBncmFkZUNvdXBvbjogewogICAgICAgICAgICAgICAgICAgICRzZXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG1lOiB7CiAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgY291cG9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzZXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCn0pLCBfaC50eXBlKSwgYmlsbGluZ1VwZ3JhZGVDb3Vwb25VbnNldCA9IF9oLmFjdGlvbiwgYmlsbGluZ1VwZ3JhZGVDb3Vwb25VbnNldFJlZHVjZXIgPSBfaC5yZWR1Y2VyOwpleHBvcnQgZnVuY3Rpb24gYmlsbGluZ0NvdXBvbktleShtZXRhKSB7CiAgICByZXR1cm4gbWV0YS50aWVyICsgbWV0YS5iaWxsaW5nQ3ljbGUgKyBtZXRhLmNvdXBvbjsKfQpleHBvcnQgdmFyIEJJTExJTkdfQ09VUE9OX1ZBTElEQVRFID0gKF9qID0gY3JlYXRlKCdCSUxMSU5HX0NPVVBPTl9WQUxJREFURScsIHsKICAgIHN0YXJ0OiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEpIHsKICAgICAgICB2YXIgX2E7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBiaWxsaW5nOiB7CiAgICAgICAgICAgICAgICBjb3Vwb25zOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgICAgICBfYVtiaWxsaW5nQ291cG9uS2V5KG1ldGEpXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcmVzb3VyY2VMb2FkaW5nKCksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgYmlsbGluZzogewogICAgICAgICAgICAgICAgY291cG9uczogKF9hID0ge30sCiAgICAgICAgICAgICAgICAgICAgX2FbYmlsbGluZ0NvdXBvbktleShtZXRhKV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzZXQ6IHJlc291cmNlT2socGF5bG9hZCksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgZmFpbHVyZTogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBlcnJvcikgewogICAgICAgIHZhciBfYTsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIGJpbGxpbmc6IHsKICAgICAgICAgICAgICAgIGNvdXBvbnM6IChfYSA9IHt9LAogICAgICAgICAgICAgICAgICAgIF9hW2JpbGxpbmdDb3Vwb25LZXkobWV0YSldID0gewogICAgICAgICAgICAgICAgICAgICAgICAkc2V0OiByZXNvdXJjZUZhaWxlZChlcnJvciksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2oudHlwZSksIGJpbGxpbmdDb3Vwb25WYWxpZGF0ZSA9IF9qLmFjdGlvbiwgYmlsbGluZ0NvdXBvblZhbGlkYXRlUmVkdWNlciA9IF9qLnJlZHVjZXI7CmV4cG9ydCBkZWZhdWx0IFsKICAgIGJpbGxpbmdGZXRjaFJlZHVjZXIsCiAgICBiaWxsaW5nQ3JlYXRlUmVkdWNlciwKICAgIGJpbGxpbmdVcGRhdGVSZWR1Y2VyLAogICAgYmlsbGluZ0NhbmNlbFJlZHVjZXIsCiAgICBiaWxsaW5nQ2FuY2VsbGF0aW9uRmVlZGJhY2tSZWR1Y2VyLAogICAgYmlsbGluZ1VwZGF0ZUNhcmRSZWR1Y2VyLAogICAgYmlsbGluZ1VwZ3JhZGVDb3Vwb25TZXRSZWR1Y2VyLAogICAgYmlsbGluZ1VwZ3JhZGVDb3Vwb25VbnNldFJlZHVjZXIsCiAgICBiaWxsaW5nQ291cG9uVmFsaWRhdGVSZWR1Y2VyLApdOwpleHBvcnQgdmFyIHNlbGVjdEJpbGxpbmdMb2FkaW5nRXJyb3IgPSBjcmVhdGVTZWxlY3RvcihbCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLmJpbGxpbmc7IH0sCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLnRlYW07IH0sCl0sIGZ1bmN0aW9uIChiaWxsaW5nLCB0ZWFtKSB7CiAgICB2YXIgYmlsbGluZ0Vycm9yID0gc2VsZWN0UmVzb3VyY2VFcnJvcihiaWxsaW5nLnJlc291cmNlKTsKICAgIHZhciBoYXZlQmlsbGluZ0Vycm9yID0gYmlsbGluZ0Vycm9yICE9PSB1bmRlZmluZWQgJiYgYmlsbGluZ0Vycm9yLmNvZGUgIT09IDQwNDsKICAgIHJldHVybiBzZWxlY3RSZXNvdXJjZUVycm9yKHRlYW0pICE9PSB1bmRlZmluZWQgfHwgaGF2ZUJpbGxpbmdFcnJvcjsKfSwgdW5kZWZpbmVkLCBbJ2JpbGxpbmcnLCAndGVhbSddKTsKZXhwb3J0IHZhciBzZWxlY3RCaWxsaW5nTG9hZGluZyA9IGNyZWF0ZVNlbGVjdG9yKFsKICAgIGZ1bmN0aW9uIChzdGF0ZSkgeyByZXR1cm4gc3RhdGUuYmlsbGluZzsgfSwKICAgIGZ1bmN0aW9uIChzdGF0ZSkgeyByZXR1cm4gc3RhdGUudGVhbTsgfSwKXSwgZnVuY3Rpb24gKGJpbGxpbmcsIHRlYW0pIHsKICAgIHJldHVybiBzZWxlY3RSZXNvdXJjZUxvYWRpbmcoYmlsbGluZy5yZXNvdXJjZSkgfHwKICAgICAgICAoc2VsZWN0UmVzb3VyY2VMb2FkaW5nKHRlYW0pICYmICF0ZWFtLmRhdGEpOwp9LCB1bmRlZmluZWQsIFsnYmlsbGluZycsICd0ZWFtJ10pOwpleHBvcnQgdmFyIHNlbGVjdEJpbGxpbmdIYXZlQWN0aXZlU3Vic2NyaXB0aW9uID0gY3JlYXRlU2VsZWN0b3IoW2Z1bmN0aW9uIChzdGF0ZSkgeyByZXR1cm4gc3RhdGUuYmlsbGluZzsgfV0sIGZ1bmN0aW9uIChiaWxsaW5nKSB7CiAgICB2YXIgc3Vic2NyaXB0aW9uID0gYmlsbGluZy5yZXNvdXJjZS5kYXRhICYmIGJpbGxpbmcucmVzb3VyY2UuZGF0YS5zdWJzY3JpcHRpb247CiAgICBpZiAoIXN1YnNjcmlwdGlvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiBzdWJzY3JpcHRpb24uc3RhdHVzICE9PSBCaWxsaW5nU3Vic2NyaXB0aW9uU3RhdHVzLkNhbmNlbGVkICYmICFzdWJzY3JpcHRpb24ucGxhbkV4cGlyZXM7Cn0sIHVuZGVmaW5lZCwgWydiaWxsaW5nJ10pOwpleHBvcnQgdmFyIHNlbGVjdEJpbGxpbmdUcmlhbEV4cGlyZXMgPSBjcmVhdGVTZWxlY3RvcihbCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLmJpbGxpbmc7IH0sCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLnRlYW07IH0sCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLm1lOyB9LApdLCBmdW5jdGlvbiAoYmlsbGluZywgdGVhbSwgbWUpIHsKICAgIHZhciB0ZWFtRGF0YSA9IHRlYW0uZGF0YTsKICAgIHZhciBzdWJzY3JpcHRpb24gPSBiaWxsaW5nLnJlc291cmNlLmRhdGEgJiYgYmlsbGluZy5yZXNvdXJjZS5kYXRhLnN1YnNjcmlwdGlvbjsKICAgIHZhciBtZVN0YXR1c05ldyA9IG1lLmRhdGEgJiYgbWUuZGF0YS5zdGF0dXNOZXc7CiAgICBpZiAobWVTdGF0dXNOZXcgPT09IE1lU3RhdHVzTmV3LlRyaWFsKSB7CiAgICAgICAgcmV0dXJuIG1lLmRhdGEgJiYgbWUuZGF0YS50cmlhbEV4cGlyZXM7CiAgICB9CiAgICByZXR1cm4gKHRlYW1EYXRhICYmIHRlYW1EYXRhLnRyaWFsRXhwaXJlcykgfHwgKHN1YnNjcmlwdGlvbiAmJiBzdWJzY3JpcHRpb24udHJpYWxFeHBpcmVzKTsKfSwgdW5kZWZpbmVkLCBbJ2JpbGxpbmcnLCAndGVhbSddKTsKZXhwb3J0IHZhciBzZWxlY3RCaWxsaW5nUGxhbkV4cGlyZXMgPSBjcmVhdGVTZWxlY3RvcihbCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLmJpbGxpbmc7IH0sCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLnRlYW07IH0sCiAgICBmdW5jdGlvbiAoc3RhdGUpIHsgcmV0dXJuIHN0YXRlLm1lOyB9LApdLCBmdW5jdGlvbiAoYmlsbGluZywgdGVhbSwgbWUpIHsKICAgIHZhciB0ZWFtRGF0YSA9IHRlYW0uZGF0YTsKICAgIHZhciBzdWJzY3JpcHRpb24gPSBiaWxsaW5nLnJlc291cmNlLmRhdGEgJiYgYmlsbGluZy5yZXNvdXJjZS5kYXRhLnN1YnNjcmlwdGlvbjsKICAgIHJldHVybiAodGVhbURhdGEgJiYgdGVhbURhdGEucGxhbkV4cGlyZXMpIHx8IChzdWJzY3JpcHRpb24gJiYgc3Vic2NyaXB0aW9uLnBsYW5FeHBpcmVzKTsKfSwgdW5kZWZpbmVkLCBbJ2JpbGxpbmcnLCAndGVhbSddKTsKZXhwb3J0IHZhciBzZWxlY3RUcmFpbGluZyA9IGNyZWF0ZVNlbGVjdG9yKFsKICAgIGZ1bmN0aW9uIChzdGF0ZSkgeyByZXR1cm4gc3RhdGUuYmlsbGluZzsgfSwKXSwgZnVuY3Rpb24gKGJpbGxpbmcpIHsKICAgIGlmIChiaWxsaW5nLnJlc291cmNlLmRhdGEgJiYgYmlsbGluZy5yZXNvdXJjZS5kYXRhLnN1YnNjcmlwdGlvbgogICAgICAgICYmIGJpbGxpbmcucmVzb3VyY2UuZGF0YS5zdWJzY3JpcHRpb24uc3RhdHVzID09PSBCaWxsaW5nU3Vic2NyaXB0aW9uU3RhdHVzLlRyaWFsaW5nKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7Cn0sIHVuZGVmaW5lZCwgWydiaWxsaW5nJ10pOwpleHBvcnQgdmFyIHNlbGVjdEJpbGxpbmdDb3Vwb24gPSBmdW5jdGlvbiAoc3RhdGUsIGtleSkgewogICAgcmV0dXJuIHN0YXRlLmJpbGxpbmcuY291cG9uc1tiaWxsaW5nQ291cG9uS2V5KGtleSldOwp9OwpleHBvcnQgdmFyIHNlbGVjdEJpbGxpbmdDb3Vwb25TdGF0ZUxvYWRpbmcgPSBjcmVhdGVTZWxlY3RvcihbZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBzdGF0ZS5iaWxsaW5nOyB9XSwgZnVuY3Rpb24gKGJpbGxpbmcpIHsKICAgIGlmIChPYmplY3QudmFsdWVzKGJpbGxpbmcuY291cG9ucykubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoYmlsbGluZy5jb3Vwb25zKS5zb21lKGZ1bmN0aW9uIChjb3Vwb24pIHsgcmV0dXJuIGNvdXBvbi5zdGF0dXMgPT09IFJlc291cmNlU3RhdHVzLkxvYWRpbmc7IH0pOwp9LCB1bmRlZmluZWQsIFsnYmlsbGluZyddKTsK"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/billing.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/billing.ts"],"names":[],"mappings":"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","sourcesContent":["import update from 'immutability-helper';\n\nimport { create } from '@src/lib/redux';\nimport { Partial, ResourceStatus, StoreState, Team, Resource, Me, MeStatusNew } from '@src/types';\n\nimport {\n  resourceOk, selectResourceLoading, selectResourceError, resourceLoading, resourceFailed,\n} from '@src/lib/resource';\n\nimport {\n  Billing, BillingSubscription, BillingSubscriptionStatus,\n  BillingState, BillingCoupon, BillingCouponKey, CouponType,\n} from '@src/types/billing';\n\nimport {\n  BillingCreateBody, BillingCancellationFeedbackBody,\n} from '@src/api/billing';\n\nimport { ApiError } from '@src/api/base';\nimport { createSelector } from '@src/lib/selector';\n\n// reducer helper to update the billing state on success cases\nfunction updateBillingState(\n  state: StoreState, billing: Billing, setUpdating: boolean = false,\n  setError: boolean = false, unsetCoupon: boolean = false,\n): StoreState {\n  const spec: any = {\n    billing: {\n      resource: {\n        $set: resourceOk(billing),\n      },\n    },\n  };\n\n  if (setUpdating) {\n    spec.billing.updating = { $set: false };\n  }\n\n  if (setError) {\n    spec.billing.upgradingError = { $set: undefined };\n  }\n\n  if (unsetCoupon) {\n    spec.billing.$unset = ['upgradeCoupon'];\n  }\n\n  return update(state, spec);\n}\n\n// reducer helper to set the updating and error values on the billing state\nfunction billingActionUpdating(state: StoreState, updating: boolean, error?: Error): StoreState {\n  const spec: any = {\n    billing: {\n      updating: {\n        $set: updating,\n      },\n    },\n  };\n\n  if (error) {\n    spec.billing.upgradingError = { $set: error };\n  }\n\n  return update(state, spec);\n}\n\nexport const {\n  type: BILLING_FETCH,\n  action: billingFetch,\n  reducer: billingFetchReducer,\n} = create<null, Billing>('BILLING_FETCH', {\n  start: (state, meta) =>\n    update(state, {\n      billing: {\n        resource: {\n          status: { $set: ResourceStatus.Loading },\n        },\n      },\n    }),\n\n  success: (state, meta, payload) => updateBillingState(state, payload),\n\n  failure: (state, meta, error) =>\n    update(state, {\n      billing: {\n        resource: {\n          status: { $set: ResourceStatus.Failure },\n          error: { $set: error },\n        },\n      },\n    }),\n});\n\nexport const {\n  type: BILLING_CREATE,\n  action: billingCreate,\n  reducer: billingCreateReducer,\n} = create<BillingCreateBody, Billing>('BILLING_CREATE', {\n  start: (state, meta) => billingActionUpdating(state, true),\n  success: (state, meta, payload) => updateBillingState(state, payload, true, true, true),\n  failure: (state, meta, error) => billingActionUpdating(state, false, error),\n});\n\nexport const {\n  type: BILLING_UPDATE,\n  action: billingUpdate,\n  reducer: billingUpdateReducer,\n} = create<Partial<BillingSubscription>, Billing>('BILLING_UPDATE', {\n  start: (state, meta) => billingActionUpdating(state, true),\n  success: (state, meta, payload) => updateBillingState(state, payload, true, true),\n  failure: (state, meta, error) => billingActionUpdating(state, false, error),\n});\n\nexport const {\n  type: BILLING_UPDATE_CARD,\n  action: billingUpdateCard,\n  reducer: billingUpdateCardReducer,\n} = create<string, Billing>('BILLING_UPDATE_CARD', {\n  start: (state, meta) => billingActionUpdating(state, true),\n  success: (state, meta, payload) => updateBillingState(state, payload, true),\n  failure: (state, meta, error) => billingActionUpdating(state, false),\n});\n\nexport const {\n  type: BILLING_CANCEL,\n  action: billingCancel,\n  reducer: billingCancelReducer,\n} = create<null, Billing>('BILLING_CANCEL', {\n  start: (state, meta) => billingActionUpdating(state, true),\n  success: (state, meta, payload) => updateBillingState(state, payload, true),\n  failure: (state, meta, error) => billingActionUpdating(state, false),\n});\n\nexport const {\n  type: BILLING_CANCELLATION_FEEDBACK,\n  action: billingCancellationFeedback,\n  reducer: billingCancellationFeedbackReducer,\n} = create<BillingCancellationFeedbackBody, null>('BILLING_CANCELLATION_FEEDBACK', {\n  start: (state, meta) => billingActionUpdating(state, true),\n  success: (state, meta, payload) => billingActionUpdating(state, false),\n  failure: (state, meta, error) => billingActionUpdating(state, false),\n});\n\nexport const {\n  type: BILLING_UPGRADE_COUPON_SET,\n  action: billingUpgradeCouponSet,\n  reducer: billingUpgradeCouponSetReducer,\n} = create<BillingCouponKey, null>('BILLING_UPGRADE_COUPON_SET', {\n  start: (state, meta) => update(state, {\n    billing: {\n      upgradeCoupon: {\n        $set: meta,\n      },\n    },\n  }),\n});\n\nexport const {\n  type: BILLING_UPGRADE_COUPON_UNSET,\n  action: billingUpgradeCouponUnset,\n  reducer: billingUpgradeCouponUnsetReducer,\n} = create<null, null>('BILLING_UPGRADE_COUPON_UNSET', {\n  start: (state, meta) => {\n    localStorage.removeItem(CouponType.Coupon);\n\n    return update(state, {\n      billing: {\n        upgradeCoupon: {\n          $set: undefined,\n        },\n      },\n      me: {\n        data: {\n          coupon: {\n            $set: undefined,\n          },\n        },\n      },\n    });\n  },\n});\n\nexport function billingCouponKey(meta: BillingCouponKey): string {\n  return meta.tier + meta.billingCycle + meta.coupon;\n}\n\nexport const {\n  type: BILLING_COUPON_VALIDATE,\n  action: billingCouponValidate,\n  reducer: billingCouponValidateReducer,\n} = create<BillingCouponKey, BillingCoupon>('BILLING_COUPON_VALIDATE', {\n  start: (state, meta) => update(state, {\n    billing: {\n      coupons: {\n        [billingCouponKey(meta)]: {\n          $set: resourceLoading(),\n        },\n      },\n    },\n  }),\n\n  success: (state, meta, payload) => update(state, {\n    billing: {\n      coupons: {\n        [billingCouponKey(meta)]: {\n          $set: resourceOk(payload),\n        },\n      },\n    },\n  }),\n\n  failure: (state, meta, error) => update(state, {\n    billing: {\n      coupons: {\n        [billingCouponKey(meta)]: {\n          $set: resourceFailed(error),\n        },\n      },\n    },\n  }),\n});\n\nexport default [\n  billingFetchReducer,\n  billingCreateReducer,\n  billingUpdateReducer,\n  billingCancelReducer,\n  billingCancellationFeedbackReducer,\n  billingUpdateCardReducer,\n  billingUpgradeCouponSetReducer,\n  billingUpgradeCouponUnsetReducer,\n  billingCouponValidateReducer,\n];\n\nexport const selectBillingLoadingError = createSelector<\n  undefined,\n  BillingState | Resource<Team>,\n  boolean\n>(\n  [\n    state => state.billing,\n    state => state.team,\n  ],\n  (billing: BillingState, team: Resource<Team>) => {\n    const billingError = selectResourceError(billing.resource);\n    const haveBillingError = billingError !== undefined && (billingError as ApiError).code !== 404;\n    return selectResourceError(team) !== undefined || haveBillingError;\n  },\n  undefined,\n  ['billing', 'team'],\n);\n\nexport const selectBillingLoading = createSelector<\n  undefined,\n  BillingState | Resource<Team>,\n  boolean\n>(\n  [\n    state => state.billing,\n    state => state.team,\n  ],\n  (billing: BillingState, team: Resource<Team>) =>\n    selectResourceLoading(billing.resource) ||\n    (selectResourceLoading(team) && !team.data),\n  undefined,\n  ['billing', 'team'],\n);\n\nexport const selectBillingHaveActiveSubscription = createSelector<\n  undefined,\n  BillingState,\n  boolean\n>(\n  [state => state.billing],\n  (billing: BillingState) => {\n    const subscription = billing.resource.data && billing.resource.data.subscription;\n    if (!subscription) {\n      return false;\n    }\n    return subscription.status !== BillingSubscriptionStatus.Canceled && !subscription.planExpires;\n  },\n  undefined,\n  ['billing'],\n);\n\nexport const selectBillingTrialExpires = createSelector<\n  undefined,\n  BillingState | Resource<Team> | Resource<Me>,\n  Date | undefined\n>(\n  [\n    state => state.billing,\n    state => state.team,\n    state => state.me,\n  ],\n  (billing: BillingState, team: Resource<Team>, me: Resource<Me>) => {\n    const teamData = team.data;\n    const subscription = billing.resource.data && billing.resource.data.subscription;\n    const meStatusNew = me.data && me.data.statusNew;\n    if (meStatusNew === MeStatusNew.Trial) {\n      return me.data && me.data.trialExpires;\n    }\n\n    return (teamData && teamData.trialExpires) || (subscription && subscription.trialExpires);\n  },\n  undefined,\n  ['billing', 'team'],\n);\n\nexport const selectBillingPlanExpires = createSelector<\n  undefined,\n  BillingState | Resource<Team> | Resource<Me>,\n  Date | undefined\n>(\n  [\n    state => state.billing,\n    state => state.team,\n    state => state.me,\n  ],\n  (billing: BillingState, team: Resource<Team>, me: Resource<Me>) => {\n    const teamData = team.data;\n    const subscription = billing.resource.data && billing.resource.data.subscription;\n\n    return (teamData && teamData.planExpires) || (subscription && subscription.planExpires);\n  },\n  undefined,\n  ['billing', 'team'],\n);\n\nexport const selectTrailing = createSelector<\nundefined,\nBillingState,\nboolean\n>(\n  [\n    state => state.billing,\n  ],\n  (billing: BillingState) => {\n    if (billing.resource.data && billing.resource.data.subscription\n      && billing.resource.data.subscription.status === BillingSubscriptionStatus.Trialing) {\n      return true;\n    }\n\n    return false;\n  },\n  undefined,\n  ['billing'],\n);\n\nexport const selectBillingCoupon = (state: StoreState, key: BillingCouponKey) => {\n  return state.billing.coupons[billingCouponKey(key)];\n};\n\nexport const selectBillingCouponStateLoading = createSelector<\n  undefined,\n  BillingState,\n  boolean\n>(\n  [state => state.billing],\n  (billing: BillingState) => {\n    if (Object.values(billing.coupons).length === 0) {\n      return false;\n    }\n\n    return Object.values(billing.coupons).some(coupon => coupon.status === ResourceStatus.Loading);\n  },\n  undefined,\n  ['billing'],\n);\n"]}]}