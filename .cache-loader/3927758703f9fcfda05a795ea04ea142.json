{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/Compose/ComposePane.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/Compose/ComposePane.tsx","mtime":1675280254001},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHsKICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7CiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkKICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgIH07CiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfTsKaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JzsKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnOwppbXBvcnQgeyBmaWx0ZXIsIGZpbmRJbmRleCwgaXNFcXVhbCwgY29tcGFjdCwgdmFsdWVzLCBpbmRleE9mLCBrZXlCeSB9IGZyb20gJ2xvZGFzaCc7CmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnOwppbXBvcnQgeyBEcmFmdFN0YXR1cywgQWNjb3VudFR5cGUsIH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCB7IGFjY291bnRTaWduYXR1cmUgfSBmcm9tICdAc3JjL2xpYi9hY2NvdW50JzsKaW1wb3J0IEljb25CdXR0b24gZnJvbSAnQHNyYy9jb21wb25lbnRzL0Jhc2UvSWNvbkJ1dHRvbic7CmltcG9ydCBDb250ZW50RWRpdGFibGUgZnJvbSAnQHNyYy9jb21wb25lbnRzL0NvbnRlbnRFZGl0YWJsZS9Db250ZW50RWRpdGFibGUnOwppbXBvcnQgQXR0YWNobWVudENlbGwgZnJvbSAnLi9BdHRhY2htZW50cy9BdHRhY2htZW50Q2VsbCc7CmltcG9ydCB7IGZpbGVuYW1lSWNvblVybCB9IGZyb20gJ0BzcmMvbGliL2F0dGFjaG1lbnQnOwppbXBvcnQgQXR0YWNobWVudCBmcm9tICdAc3JjL2NvbXBvbmVudHMvSWNvbnMvQXR0YWNobWVudC5zdmcnOwppbXBvcnQgRm9sbG93VXAgZnJvbSAnQHNyYy9jb21wb25lbnRzL0ljb25zL0ZvbGxvd1VwLnN2Zyc7CmltcG9ydCBTZW5kTGF0ZXIgZnJvbSAnQHNyYy9jb21wb25lbnRzL0ljb25zL1NlbmRMYXRlci5zdmcnOwppbXBvcnQgVGhyZWVEb3RzIGZyb20gJ0BzcmMvY29tcG9uZW50cy9JY29ucy9UaHJlZURvdHMuc3ZnJzsKaW1wb3J0IFRyYXNoIGZyb20gJ0BzcmMvY29tcG9uZW50cy9JY29ucy9UcmFzaC5zdmcnOwppbXBvcnQgRmlsZURyb3Bab25lIGZyb20gJy4vRmlsZURyb3Bab25lJzsKLy8gVE9ETyhTSElOKTogQmV0YSAtIFJlLWVuYWJsZSB3aGVuIGJyaW5naW5nIGluIGNvbXBvc2Ugc3VwcHMKaW1wb3J0IFRlbXBsYXRlIGZyb20gJ0BzcmMvY29tcG9uZW50cy9JY29ucy9UZW1wbGF0ZS5zdmcnOwppbXBvcnQgQ2FsZW5kYXIgZnJvbSAnQHNyYy9jb21wb25lbnRzL0ljb25zL0NhbGVuZGFyLnN2Zyc7Ci8vIGltcG9ydCBFbW9qaSBmcm9tICcuL0ljb25zL0Vtb2ppLnN2Zyc7Ci8vIGltcG9ydCBHaWYgZnJvbSAnLi9JY29ucy9HaWYuc3ZnJzsKaW1wb3J0IFRyYWNrIGZyb20gJ0BzcmMvY29tcG9uZW50cy9JY29ucy9UcmFjay5zdmcnOwppbXBvcnQgVXBsb2FkQnV0dG9uIGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL1VwbG9hZEJ1dHRvbic7CmltcG9ydCAnLi9Db21wb3NlUGFuZS5zY3NzJzsKaW1wb3J0IHsgZ2V0SG90a2V5QnlOYW1lLCBIb3RrZXlBY3Rpb24gfSBmcm9tICdAc3JjL2xpYi9ob3RrZXlzJzsKaW1wb3J0IFVwZ3JhZGVQcm9tcHQgZnJvbSAnQHNyYy9jb21wb25lbnRzL0Jhc2UvVXBncmFkZVByb21wdC9VcGdyYWRlUHJvbXB0JzsKaW1wb3J0IENhbGVuZGFyTWVudSwgeyBDYWxlbmRhck9wdGlvbiB9IGZyb20gJ0BzcmMvY29tcG9uZW50cy9Db21wb3NlL2NvbXBvbmVudHMvQ2FsZW5kYXJNZW51JzsKaW1wb3J0IE9uYm9hcmRpbmdUaXAgZnJvbSAnQHNyYy9jb21wb25lbnRzL09uYm9hcmRpbmcvY29tcG9uZW50cy9PbmJvYXJkaW5nVGlwL09uYm9hcmRpbmdUaXAnOwppbXBvcnQgSG92ZXJUaXAgZnJvbSAnQHNyYy9jb21wb25lbnRzL0Jhc2UvSG92ZXJUaXAnOwppbXBvcnQgQ2xvc2UgZnJvbSAnQHNyYy9jb21wb25lbnRzL0ljb25zL0Nsb3NlLnN2Zyc7CmltcG9ydCB7IGlzRHJhZnRTZW5kaW5nLCBEcmFmdFNwZWNpYWxFcnJvciB9IGZyb20gJ0BzcmMvbGliL2RyYWZ0JzsKaW1wb3J0IENvbmZpcm0gZnJvbSAnQHNyYy9jb21wb25lbnRzL0Jhc2UvQ29uZmlybSc7CmltcG9ydCB7IHVwbG9hZEVycm9yTWVzc2FnZSB9IGZyb20gJ0BzcmMvbGliL2ZpbGVzJzsKaW1wb3J0IHsgaG90a2V5U3VnZ2VzdCB9IGZyb20gJ0BzcmMvZHVja3MvaG90a2V5cyc7CmltcG9ydCB7IEFtcGxpdHVkZUV2ZW50cywgbG9nQW1wbGl0dWRlRXZlbnQgfSBmcm9tICdAc3JjL2xpYi9hbXBsaXR1ZGUtYW5hbHl0aWNzJzsKLy8gVE9ETyhTSElOKTogQmV0YS0gUmUtZW5hYmxlIHdoZW4gYnJpbmdpbmcgaW4gY29tcG9zZSBzdXBwcwp2YXIgQUNUSU9OUyA9IFsKICAgIHsKICAgICAgICBzdHJpbmc6ICdhdHRhY2htZW50JywKICAgICAgICBpY29uOiBSZWFjdC5jcmVhdGVFbGVtZW50KEF0dGFjaG1lbnQsIHsgd2lkdGg6ICIxNnB4IiwgaGVpZ2h0OiAiMTZweCIgfSksCiAgICB9LAogICAgewogICAgICAgIHN0cmluZzogJ3RlbXBsYXRlJywKICAgICAgICBpY29uOiBSZWFjdC5jcmVhdGVFbGVtZW50KFRlbXBsYXRlLCB7IHdpZHRoOiAiMTZweCIsIGhlaWdodDogIjE2cHgiIH0pLAogICAgfSwKICAgIHsKICAgICAgICBzdHJpbmc6ICdjYWxlbmRhcicsCiAgICAgICAgaWNvbjogUmVhY3QuY3JlYXRlRWxlbWVudChDYWxlbmRhciwgeyB3aWR0aDogIjE2cHgiLCBoZWlnaHQ6ICIxNnB4IiB9KSwKICAgIH0sCl07Ci8vIFRPRE8oU0hJTik6IEhhbmRsZSBhY3Rpb25zIGZvciBjb21wb3NlIGFjY2Vzc29yaWVzCi8vIFRPRE8oU0hJTik6IEhhbmRsZSBhY3Rpb25zIGZvciBjb21wb3NlIHNlbmQKdmFyIENvbXBvc2VQYW5lID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgX19leHRlbmRzKENvbXBvc2VQYW5lLCBfc3VwZXIpOwogICAgZnVuY3Rpb24gQ29tcG9zZVBhbmUocHJvcHMpIHsKICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpczsKICAgICAgICBfdGhpcy5oYW5kbGVVcGxvYWRCdXR0b25SZWYgPSBmdW5jdGlvbiAocmVmKSB7CiAgICAgICAgICAgIF90aGlzLnVwbG9hZEJ1dHRvbiA9IHJlZjsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVJlZiA9IGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgX3RoaXMuY29udGVudEVkaXRhYmxlID0gcmVmOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuZm9jdXNDb250ZW50RWRpdGFibGUgPSBmdW5jdGlvbiAoc2VsZWN0Rmlyc3RQbGFjZWhvbGRlciwgc2VsZWN0TGFzdFBsYWNlaG9sZGVyKSB7CiAgICAgICAgICAgIF90aGlzLmNvbnRlbnRFZGl0YWJsZS5mb2N1cyhzZWxlY3RGaXJzdFBsYWNlaG9sZGVyLCBzZWxlY3RMYXN0UGxhY2Vob2xkZXIpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQ2xpY2sgPSBmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgICAgIHZhciBfYSA9IF90aGlzLnByb3BzLCBvblNob3dIaXN0b3J5ID0gX2Eub25TaG93SGlzdG9yeSwgZGlzcGF0Y2hBY3Rpb24gPSBfYS5kaXNwYXRjaEFjdGlvbjsKICAgICAgICAgICAgdmFyIGhvdGtleTsKICAgICAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3Nob3ctaGlzdG9yeSc6CiAgICAgICAgICAgICAgICAgICAgaWYgKG9uU2hvd0hpc3RvcnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb25TaG93SGlzdG9yeSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3RlbXBsYXRlJzoKICAgICAgICAgICAgICAgICAgICBob3RrZXkgPSBnZXRIb3RrZXlCeU5hbWUoSG90a2V5QWN0aW9uLk1lc3NhZ2VUZW1wbGF0ZXMpOwogICAgICAgICAgICAgICAgICAgIGlmIChob3RrZXkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hBY3Rpb24oaG90a2V5LmFjdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoQWN0aW9uKGhvdGtleVN1Z2dlc3QoSG90a2V5QWN0aW9uLk1lc3NhZ2VUZW1wbGF0ZXMpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdjYWxlbmRhcic6CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlQ2FsZW5kYXJNZW51VG9nZ2xlKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdhdHRhY2htZW50JzoKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8vIEhhbmRsZXMgZmlsZXMgdXBsb2FkCiAgICAgICAgX3RoaXMuaGFuZGxlRmlsZXMgPSBmdW5jdGlvbiAoZmlsZXMpIHsKICAgICAgICAgICAgdmFyIG9uVXBsb2FkID0gX3RoaXMucHJvcHMub25VcGxvYWQ7CiAgICAgICAgICAgIGlmIChvblVwbG9hZCkgewogICAgICAgICAgICAgICAgb25VcGxvYWQoZmlsZXMsIHsgaWdub3JlSW5saW5lOiB0cnVlIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5yZW5kZXJBdHRhY2htZW50Q2VsbHMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAoX3RoaXMucHJvcHMuYXR0YWNobWVudHMgJiYKICAgICAgICAgICAgX3RoaXMucHJvcHMuYXR0YWNobWVudHMKICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGF0dGFjaG1lbnQpIHsgcmV0dXJuICEoYXR0YWNobWVudC5jbG91ZCB8fCBhdHRhY2htZW50LmlubGluZSk7IH0pCiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChhdHRhY2htZW50KSB7IHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChBdHRhY2htZW50Q2VsbCwgeyBrZXk6IGF0dGFjaG1lbnQuaWQsIGlkOiBhdHRhY2htZW50LmlkLCBmaWxlbmFtZTogYXR0YWNobWVudC5maWxlbmFtZSwgaWNvblVybDogZmlsZW5hbWVJY29uVXJsKGF0dGFjaG1lbnQuZmlsZW5hbWUpLCBsZW5ndGg6IGF0dGFjaG1lbnQubGVuZ3RoLCBwcm9ncmVzczogMSwgb25EZWxldGU6IF90aGlzLnByb3BzLm9uUmVtb3ZlQXR0YWNobWVudCwgaW5kZXRlcm1pbmF0ZVVwbG9hZGluZzogYXR0YWNobWVudC51cGxvYWRpbmcsIGZpbGVVcmw6IGF0dGFjaG1lbnQuY2xvdWRVcmwgfSkpOyB9KSk7IH07CiAgICAgICAgX3RoaXMucmVuZGVyQXR0YWNobWVudE1ldGFDZWxscyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIChfdGhpcy5wcm9wcy5hdHRhY2htZW50TWV0YXMgJiYgX3RoaXMucHJvcHMuYXR0YWNobWVudE1ldGFzCiAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKG1ldGEpIHsKICAgICAgICAgICAgdmFyIGlubGluZSA9IG1ldGEuZGF0YSAmJiBtZXRhLmRhdGEuaW5saW5lIHx8IGZhbHNlOwogICAgICAgICAgICB2YXIgY2xvdWQgPSBtZXRhLmRhdGEgJiYgbWV0YS5kYXRhLmNsb3VkIHx8IGZhbHNlOwogICAgICAgICAgICB2YXIgYXR0YWNobWVudElkcyA9IChfdGhpcy5wcm9wcy5hdHRhY2htZW50cyB8fCBbXSkubWFwKGZ1bmN0aW9uIChhKSB7IHJldHVybiBhLmlkOyB9KTsKICAgICAgICAgICAgcmV0dXJuIG1ldGEuZGF0YSAmJiAhKGlubGluZSB8fCBjbG91ZCkgJiYKICAgICAgICAgICAgICAgIGF0dGFjaG1lbnRJZHMuaW5kZXhPZihtZXRhLmRhdGEuYXR0YWNobWVudCkgPT09IC0xOwogICAgICAgIH0pCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKG1ldGEpIHsKICAgICAgICAgICAgdmFyIGRhdGEgPSBtZXRhLmRhdGE7CiAgICAgICAgICAgIGlmICghZGF0YSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KEF0dGFjaG1lbnRDZWxsLCB7IGtleTogZGF0YS5hdHRhY2htZW50LCBpZDogZGF0YS5hdHRhY2htZW50LCBmaWxlbmFtZTogZGF0YS5maWxlbmFtZSB8fCBkYXRhLmZpbGUgJiYgZGF0YS5maWxlLm5hbWUgfHwgJ2F0dGFjaG1lbnQnLCBpY29uVXJsOiBmaWxlbmFtZUljb25VcmwoKGRhdGEuZmlsZW5hbWUgfHwgZGF0YS5maWxlICYmIGRhdGEuZmlsZS5uYW1lKSB8fCAnJyksIGxlbmd0aDogZGF0YS5sZW5ndGggfHwgZGF0YS5maWxlICYmIGRhdGEuZmlsZS5zaXplIHx8IDEwMDAsIG9uRGVsZXRlOiBfdGhpcy5wcm9wcy5vblJlbW92ZUF0dGFjaG1lbnQsIHByb2dyZXNzOiBkYXRhLnByb2dyZXNzIHx8IDAsIGVycm9yOiBtZXRhLmVycm9yLCBmaWxlVXJsOiBkYXRhLmNsb3VkVXJsLCBpc01ldGE6IHRydWUgfSkpOwogICAgICAgIH0pKTsgfTsKICAgICAgICAvLyBEcm9wWm9uZSBoYW5kbGVycwogICAgICAgIF90aGlzLmhhbmRsZURyYWdFbnRlciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyLnR5cGVzLmluZGV4T2YoJ0ZpbGVzJykgIT09IC0xKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGRyb3B6b25lQWN0aXZlOiB0cnVlIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVEcmFnTGVhdmUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZHJvcHpvbmVBY3RpdmU6IGZhbHNlIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVXBsb2FkID0gZnVuY3Rpb24gKGZpbGVzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBvblVwbG9hZCA9IF90aGlzLnByb3BzLm9uVXBsb2FkOwogICAgICAgICAgICBpZiAob25VcGxvYWQpIHsKICAgICAgICAgICAgICAgIG9uVXBsb2FkKGZpbGVzLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZHJvcHpvbmVBY3RpdmU6IGZhbHNlIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBIYW5kbGUgZHJvcHBpbmcgdG8gc3BlY2lmaWMgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbiAmJiBfdGhpcy5jb250ZW50RWRpdGFibGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGVudEVkaXRhYmxlLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVGb2xsb3dVcFJlZiA9IGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgX3RoaXMuZm9sbG93VXBUb29sdGlwID0gcmVmOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlU2VuZExhdGVyUmVmID0gZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICBfdGhpcy5zZW5kTGF0ZXJUb29sdGlwID0gcmVmOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVGVtcGxhdGVSZWYgPSBmdW5jdGlvbiAocmVmKSB7CiAgICAgICAgICAgIF90aGlzLnRlbXBsYXRlVG9vbHRpcCA9IHJlZjsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUZvbGxvd1VwVG9vbHRpcFNob3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBmZWF0dXJlcyA9IF90aGlzLnByb3BzLmZlYXR1cmVzOwogICAgICAgICAgICBpZiAoIWZlYXR1cmVzLmZvbGxvd1VwKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5mb2xsb3dVcFRvb2x0aXAuc2hvdygpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVGb2xsb3dVcFRvb2x0aXBIaWRlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoX3RoaXMuZm9sbG93VXBUb29sdGlwKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5mb2xsb3dVcFRvb2x0aXAuaGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVTZW5kTGF0ZXJUb29sdGlwU2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGZlYXR1cmVzID0gX3RoaXMucHJvcHMuZmVhdHVyZXM7CiAgICAgICAgICAgIGlmICghZmVhdHVyZXMuc2VuZExhdGVyKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZW5kTGF0ZXJUb29sdGlwLnNob3coKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlU2VuZExhdGVyVG9vbHRpcEhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5zZW5kTGF0ZXJUb29sdGlwKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5zZW5kTGF0ZXJUb29sdGlwLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVGVtcGxhdGVUb29sdGlwU2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGZlYXR1cmVzID0gX3RoaXMucHJvcHMuZmVhdHVyZXM7CiAgICAgICAgICAgIGlmICghZmVhdHVyZXMubWVzc2FnZVRlbXBsYXRlcykgewogICAgICAgICAgICAgICAgX3RoaXMudGVtcGxhdGVUb29sdGlwLnNob3coKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlVGVtcGxhdGVUb29sdGlwSGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKF90aGlzLnRlbXBsYXRlVG9vbHRpcCkgewogICAgICAgICAgICAgICAgX3RoaXMudGVtcGxhdGVUb29sdGlwLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQ2FsZW5kYXJNZW51VG9nZ2xlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNob3dDYWxlbmRhck1lbnU6IHRydWUgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVDYWxlbmRhck1lbnVIaWRlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNob3dDYWxlbmRhck1lbnU6IHVuZGVmaW5lZCB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUNhbGVuZGFyT3B0aW9uU2VsZWN0ID0gZnVuY3Rpb24gKG9wdGlvbikgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgZGlzcGF0Y2hBY3Rpb24gPSBfYS5kaXNwYXRjaEFjdGlvbiwgb25TY2hlZHVsaW5nVXJsU2VsZWN0ID0gX2Eub25TY2hlZHVsaW5nVXJsU2VsZWN0OwogICAgICAgICAgICBzd2l0Y2ggKG9wdGlvbikgewogICAgICAgICAgICAgICAgY2FzZSBDYWxlbmRhck9wdGlvbi5DYWxlbmRhckludml0ZToKICAgICAgICAgICAgICAgICAgICB2YXIgaG90a2V5ID0gZ2V0SG90a2V5QnlOYW1lKEhvdGtleUFjdGlvbi5DYWxlbmRhckludml0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhvdGtleSkgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaEFjdGlvbihob3RrZXkuYWN0aW9uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIENhbGVuZGFyT3B0aW9uLlNjaGVkdWxpbmdVcmw6CiAgICAgICAgICAgICAgICAgICAgaWYgKG9uU2NoZWR1bGluZ1VybFNlbGVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICBvblNjaGVkdWxpbmdVcmxTZWxlY3QoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbG9nQW1wbGl0dWRlRXZlbnQoQW1wbGl0dWRlRXZlbnRzLkNsaWNrU2hhcmVBdmFpbGFibGVNZWV0aW5nVGltZXMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlRGlzbWlzc0Vycm9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgb25FcnJvckRpc21pc3MgPSBfdGhpcy5wcm9wcy5vbkVycm9yRGlzbWlzczsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBzaG93RXJyb3I6IGZhbHNlIH0pOwogICAgICAgICAgICBpZiAob25FcnJvckRpc21pc3MpIHsKICAgICAgICAgICAgICAgIG9uRXJyb3JEaXNtaXNzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZURpcmVjdG9yeURyb3BFcnJvciA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgIHZhciBjb25maXJtUHJvcHMgPSB7CiAgICAgICAgICAgICAgICB0aXRsZTogJ0Vycm9yIGF0dGFjaGluZyBmaWxlJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHVwbG9hZEVycm9yTWVzc2FnZShiKSwKICAgICAgICAgICAgICAgIGNvbmZpcm1Db3B5OiAnT2snLAogICAgICAgICAgICAgICAgb25Db25maXJtOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IHVuZGVmaW5lZCB9KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgY29uZmlybVByb3BzOiBjb25maXJtUHJvcHMsIGRyb3B6b25lQWN0aXZlOiBmYWxzZSB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLnN0YXRlID0gewogICAgICAgICAgICBkcm9wem9uZUFjdGl2ZTogZmFsc2UsCiAgICAgICAgICAgIHNob3dFcnJvcjogZmFsc2UsCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICB9CiAgICBDb21wb3NlUGFuZS5wcm90b3R5cGUuY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMucHJvcHMuZHJhZnQgJiYgdGhpcy5wcm9wcy5kcmFmdC5lcnJvcikgewogICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHNob3dFcnJvcjogdHJ1ZSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKICAgIC8vIFVwZGF0ZSBzaWduYXR1cmUKICAgIC8vIFRPRE8oU0hJTiAmIFNIQUhBTik6IFBvc3NpYmxlIHJhY2UgY29uZGl0aW9uIG9yIGxvc3QgY2hhbmdlIGJldHdlZW4gYWNjb3VudCBkaWZmcy4KICAgIENvbXBvc2VQYW5lLnByb3RvdHlwZS5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIChuZXh0UHJvcHMpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIHZhciBpc1RlbXBsYXRlRWRpdG9yID0gbmV4dFByb3BzLmlzVGVtcGxhdGVFZGl0b3IsIHNob3dTZW50RnJvbVBvbHltYWlsID0gbmV4dFByb3BzLnNob3dTZW50RnJvbVBvbHltYWlsOwogICAgICAgIHZhciBuZXh0RHJhZnQgPSBuZXh0UHJvcHMuZHJhZnQ7CiAgICAgICAgdmFyIG9sZERyYWZ0ID0gdGhpcy5wcm9wcy5kcmFmdDsKICAgICAgICAvLyBJZGVudGlmaWVzIGlmIHNpZ25hdHVyZSBoYXMgYmVlbiBzd2l0Y2hlZAogICAgICAgIGlmIChuZXh0UHJvcHMuYWNjb3VudHMgJiYgbmV4dERyYWZ0ICYmIG9sZERyYWZ0ICYmCiAgICAgICAgICAgIG5leHREcmFmdC5pZCA9PT0gb2xkRHJhZnQuaWQpIHsKICAgICAgICAgICAgLy8gQWNjb3VudCBkaWZmZXJlbmNlcwogICAgICAgICAgICBpZiAobmV4dERyYWZ0LmFjY291bnQgIT09IG9sZERyYWZ0LmFjY291bnQpIHsKICAgICAgICAgICAgICAgIHZhciBuZXh0QWNjb3VudF8xID0gbmV4dERyYWZ0LmFjY291bnQ7CiAgICAgICAgICAgICAgICB2YXIgYWNjb3VudCA9IG5leHRQcm9wcy5hY2NvdW50cy5maWx0ZXIoZnVuY3Rpb24gKGFjYykgeyByZXR1cm4gYWNjLmlkID09PSBuZXh0QWNjb3VudF8xOyB9KVswXTsKICAgICAgICAgICAgICAgIGlmIChhY2NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb250ZW50RWRpdGFibGUudXBkYXRlU2lnbmF0dXJlKGFjY291bnRTaWduYXR1cmUoewogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50OiBhY2NvdW50LAogICAgICAgICAgICAgICAgICAgICAgICBkcmFmdElkOiBuZXh0RHJhZnQuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZlbnRFZGl0czogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2hvd1NlbnRGcm9tUG9seW1haWwpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnRFZGl0YWJsZS51cGRhdGVTZW50RnJvbVBvbHltYWlsKHNob3dTZW50RnJvbVBvbHltYWlsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBEbyBub3QgZG8gY29udGVudGVkaXRhYmxlIHVwZGF0ZXMgd2hlbiBkcmFmdCBpZCBpcyBub3QgdGhlIHNhbWUKICAgICAgICAvLyBIQUNLKFNISU4pOiBDaGVjayBmb3IgdGVtcGxhdGUgZWRpdG9yIHRvIGFsbG93IHRlbXBsYXRlIGF0dGFjaG1lbnRzIHRvIHByb2Nlc3MgdGhyb3VnaAogICAgICAgIHZhciBuZXh0RHJhZnRJZCA9IG5leHREcmFmdCAmJiBuZXh0RHJhZnQuaWQgfHwgJyc7CiAgICAgICAgdmFyIG9sZERyYWZ0SWQgPSBvbGREcmFmdCAmJiBvbGREcmFmdC5pZCB8fCAnJzsKICAgICAgICAvLyBEZXRlcm1pbmUgd2hldGhlciB0byBzaG93IGVycm9yCiAgICAgICAgdmFyIG5ld0RyYWZ0ID0gKG5leHREcmFmdCAmJiAhb2xkRHJhZnQpIHx8IChuZXh0RHJhZnQgJiYgbmV4dERyYWZ0ICE9PSBvbGREcmFmdCk7CiAgICAgICAgaWYgKG5ld0RyYWZ0KSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc2hvd0Vycm9yOiBuZXh0RHJhZnQgPyAhIW5leHREcmFmdC5lcnJvciA6IGZhbHNlLAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKG5leHREcmFmdElkICE9PSBvbGREcmFmdElkICYmICF0aGlzLnByb3BzLmlzVGVtcGxhdGVFZGl0b3IpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyBIYW5kbGUgdXBkYXRpbmcgYXR0YWNobWVudHMKICAgICAgICB2YXIgbmV4dEF0dGFjaG1lbnRzID0gbmV4dFByb3BzLmF0dGFjaG1lbnRzOwogICAgICAgIHZhciBvbGRBdHRhY2htZW50cyA9IHRoaXMucHJvcHMuYXR0YWNobWVudHM7CiAgICAgICAgaWYgKG5leHRBdHRhY2htZW50cyAmJiBvbGRBdHRhY2htZW50cykgewogICAgICAgICAgICBuZXh0QXR0YWNobWVudHMuCiAgICAgICAgICAgICAgICBmaWx0ZXIoZnVuY3Rpb24gKGF0dGFjaG1lbnQpIHsgcmV0dXJuIGZpbmRJbmRleChvbGRBdHRhY2htZW50cywgeyBpZDogYXR0YWNobWVudC5pZCB9KSA9PT0gLTE7IH0pCiAgICAgICAgICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAoYXR0YWNobWVudCkgewogICAgICAgICAgICAgICAgaWYgKGF0dGFjaG1lbnQuaW5saW5lKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29udGVudEVkaXRhYmxlLnJlcGxhY2VBdHRhY2htZW50KGF0dGFjaG1lbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGF0dGFjaG1lbnQuY2xvdWQpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZW50RWRpdGFibGUucmVwbGFjZUF0dGFjaG1lbnQoYXR0YWNobWVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAvLyBJbmplY3Rpb24gcG9pbnRzIGZvciBtZXRhcwogICAgICAgIC8vIFRPRE8oU0hJTik6IE1ha2Ugc3VyZSB0aGF0IGJvZHkgZG9lcyBub3QgaW5qZWN0IG9uIHJlc3RhcnQgb2YgYXBwIChCdWcpCiAgICAgICAgdmFyIG9sZE1ldGFzID0gdGhpcy5wcm9wcy5hdHRhY2htZW50TWV0YXM7CiAgICAgICAgdmFyIG5ld01ldGFzID0gbmV4dFByb3BzLmF0dGFjaG1lbnRNZXRhczsKICAgICAgICB2YXIgb2xkTWV0YUlkcyA9IGNvbXBhY3QodmFsdWVzKG9sZE1ldGFzLm1hcChmdW5jdGlvbiAobWV0YSkgeyByZXR1cm4gbWV0YS5kYXRhICYmIG1ldGEuZGF0YS5hdHRhY2htZW50OyB9KSkpOwogICAgICAgIGlmIChvbGRNZXRhcyAhPT0gbmV3TWV0YXMpIHsKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbWFwIG9mIGFscmVhZHkgY29tcGxldGVkIGF0dGFjaG1lbnRzCiAgICAgICAgICAgIHZhciBhdHRhY2htZW50SWRNYXBfMSA9IGtleUJ5KG5leHRBdHRhY2htZW50cywgJ2lkJyk7CiAgICAgICAgICAgIC8vIEluamVjdCBtZXRhcwogICAgICAgICAgICBuZXdNZXRhcwogICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAobWV0YSkgeyByZXR1cm4gbWV0YS5kYXRhICYmICFhdHRhY2htZW50SWRNYXBfMVttZXRhLmRhdGEuYXR0YWNobWVudF0gfHwgZmFsc2U7IH0pCiAgICAgICAgICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAobWV0YSkgewogICAgICAgICAgICAgICAgaWYgKCFtZXRhLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBSZXBsYWNlIGlmIGF2YWlsYWJsZQogICAgICAgICAgICAgICAgX3RoaXMuY29udGVudEVkaXRhYmxlLnJlcGxhY2VBdHRhY2htZW50TWV0YShtZXRhLmRhdGEsIG1ldGEuZXJyb3IpOwogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYXR0YWNobWVudCBtZXRhIGlzIG5ldwogICAgICAgICAgICAgICAgaWYgKGluZGV4T2Yob2xkTWV0YUlkcywgbWV0YS5kYXRhICYmIG1ldGEuZGF0YS5hdHRhY2htZW50KSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBEbyBub3QgaW5qZWN0IGlmIGFscmVhZHkgZXhpc3RzIGluIGJvZHkKICAgICAgICAgICAgICAgIGlmIChtZXRhLmRhdGEgJiYgX3RoaXMuY29udGVudEVkaXRhYmxlLmF0dGFjaG1lbnRFeGlzdHNJbkJvZHkobWV0YS5kYXRhLmF0dGFjaG1lbnQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gQ2hlY2tzIHRvIGVuc3VyZSB0aGF0IGF0dGFjaG1lbnQgaXMgbm90IGJlaW5nIGFkZGVkIGluamVjdGVkCiAgICAgICAgICAgICAgICAvLyBmb3IgYSB0ZW1wbGF0ZSBhdHRhY2htZW50IGJlaW5nIGFwcGxpZWQgdG8gYSBkcmFmdAogICAgICAgICAgICAgICAgdmFyIG5vdFRlbXBsYXRlSW5qZWN0aW9uID0gaXNUZW1wbGF0ZUVkaXRvciB8fCAhbWV0YS5kYXRhLnRlbXBsYXRlOwogICAgICAgICAgICAgICAgaWYgKG1ldGEuZGF0YS5pbmxpbmUgJiYgbm90VGVtcGxhdGVJbmplY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZW50RWRpdGFibGUuaW5qZWN0SW5saW5lQXR0YWNobWVudE1ldGEobWV0YS5kYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChtZXRhLmRhdGEuY2xvdWQgJiYgbm90VGVtcGxhdGVJbmplY3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb250ZW50RWRpdGFibGUuaW5qZWN0Q2xvdWRBdHRhY2htZW50TWV0YShtZXRhLmRhdGEsIG1ldGEuZXJyb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgLy8gYWRkIGNhbGVuZGFyIGludml0ZSBpZiBub3QgcHJldmlvdXNseSB0aGVyZQogICAgICAgIHZhciBvbGRDYWxlbmRhckludml0ZSA9IHRoaXMucHJvcHMuZHJhZnQgJiYgdGhpcy5wcm9wcy5kcmFmdC5jYWxlbmRhckludml0ZTsKICAgICAgICB2YXIgbmV3Q2FsZW5kYXJJbnZpdGUgPSBuZXh0UHJvcHMuZHJhZnQgJiYgbmV4dFByb3BzLmRyYWZ0LmNhbGVuZGFySW52aXRlOwogICAgICAgIGlmIChuZXdDYWxlbmRhckludml0ZSAmJiAhb2xkQ2FsZW5kYXJJbnZpdGUpIHsKICAgICAgICAgICAgdGhpcy5jb250ZW50RWRpdGFibGUuZm9jdXMoKTsKICAgICAgICAgICAgdGhpcy5jb250ZW50RWRpdGFibGUuYWRkQ2FsZW5kYXJJbnZpdGUobmV3Q2FsZW5kYXJJbnZpdGUpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChuZXdDYWxlbmRhckludml0ZSAmJiAhaXNFcXVhbChuZXdDYWxlbmRhckludml0ZSwgb2xkQ2FsZW5kYXJJbnZpdGUpKSB7CiAgICAgICAgICAgIHRoaXMuY29udGVudEVkaXRhYmxlLmZvY3VzKCk7CiAgICAgICAgICAgIHRoaXMuY29udGVudEVkaXRhYmxlLnJlcGxhY2VDYWxlbmRhckludml0ZShuZXdDYWxlbmRhckludml0ZSk7CiAgICAgICAgfQogICAgfTsKICAgIENvbXBvc2VQYW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgICB2YXIgX2EgPSB0aGlzLnByb3BzLCBvbkZvbGxvd1VwID0gX2Eub25Gb2xsb3dVcCwgb25TZW5kTGF0ZXIgPSBfYS5vblNlbmRMYXRlciwgb25TZW5kID0gX2Eub25TZW5kLCBhY3Rpb25zID0gX2EuYWN0aW9ucywgaHRtbCA9IF9hLmh0bWwsIG9uQ2hhbmdlID0gX2Eub25DaGFuZ2UsIGF1dG9mb2N1cyA9IF9hLmF1dG9mb2N1cywgZHJhZnQgPSBfYS5kcmFmdCwgb25TZWxlY3QgPSBfYS5vblNlbGVjdCwgb25UYWJQcmVzcyA9IF9hLm9uVGFiUHJlc3MsIG9uUmVtb3ZlQXR0YWNobWVudCA9IF9hLm9uUmVtb3ZlQXR0YWNobWVudCwgb25VcGxvYWQgPSBfYS5vblVwbG9hZCwgb25TaG93SGlzdG9yeSA9IF9hLm9uU2hvd0hpc3RvcnksIHRlbXBsYXRlID0gX2EudGVtcGxhdGUsIG5vQnJhbmRpbmcgPSBfYS5ub0JyYW5kaW5nLCBpc1RlbXBsYXRlRWRpdG9yID0gX2EuaXNUZW1wbGF0ZUVkaXRvciwgZ2V0Q29udGFjdCA9IF9hLmdldENvbnRhY3QsIGRyYWZ0QWNjb3VudCA9IF9hLmRyYWZ0QWNjb3VudCwgZmVhdHVyZXMgPSBfYS5mZWF0dXJlcywgdXNlTGlua1ByZXZpZXcgPSBfYS51c2VMaW5rUHJldmlldywgc2hvd1NlbmRPbmJvYXJkaW5nID0gX2Euc2hvd1NlbmRPbmJvYXJkaW5nLCBvbkRlbGV0ZSA9IF9hLm9uRGVsZXRlLCBvblRyYWNrID0gX2Eub25UcmFjaywgZHJhZnRQYXJlbnRBY2NvdW50ID0gX2EuZHJhZnRQYXJlbnRBY2NvdW50OwogICAgICAgIHZhciBfYiA9IHRoaXMuc3RhdGUsIGRyb3B6b25lQWN0aXZlID0gX2IuZHJvcHpvbmVBY3RpdmUsIHNob3dFcnJvciA9IF9iLnNob3dFcnJvciwgY29uZmlybVByb3BzID0gX2IuY29uZmlybVByb3BzOwogICAgICAgIC8vIFNldCBFcnJvcnMKICAgICAgICB2YXIgZXJyb3I7CiAgICAgICAgdmFyIHNjaGVkdWxlZENhbmNlbGVkID0gZmFsc2U7CiAgICAgICAgaWYgKGRyYWZ0KSB7CiAgICAgICAgICAgIGVycm9yID0gZHJhZnQuZXJyb3I7CiAgICAgICAgICAgIHNjaGVkdWxlZENhbmNlbGVkID0gZHJhZnQuZXJyb3IgPT09IERyYWZ0U3BlY2lhbEVycm9yLlNjaGVkdWxlZENhbmNlbDsKICAgICAgICB9CiAgICAgICAgLy8gSGFuZGxlcyBhY3Rpb24gY2xpY2tzCiAgICAgICAgdmFyIGFsbEFjdGlvbnMgPSBBQ1RJT05TOwogICAgICAgIGlmIChhY3Rpb25zKSB7CiAgICAgICAgICAgIGFsbEFjdGlvbnMgPSBmaWx0ZXIoYWxsQWN0aW9ucywgZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9ucy5pbmRleE9mKGFjdGlvbi5zdHJpbmcpICE9PSAtMTsgfSk7CiAgICAgICAgfQogICAgICAgIHZhciB0b3BBY2NvdW50ID0gZHJhZnRQYXJlbnRBY2NvdW50IHx8IGRyYWZ0QWNjb3VudDsKICAgICAgICBpZiAodG9wQWNjb3VudCAmJiB0b3BBY2NvdW50LnR5cGUgIT09IEFjY291bnRUeXBlLkdvb2dsZQogICAgICAgICAgICAmJiB0b3BBY2NvdW50LnR5cGUgIT09IEFjY291bnRUeXBlLk1pY3Jvc29mdCkgewogICAgICAgICAgICBhbGxBY3Rpb25zID0gZmlsdGVyKGFsbEFjdGlvbnMsIGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdHJpbmcgIT09ICdjYWxlbmRhcic7IH0pOwogICAgICAgIH0KICAgICAgICAvLyBTZXQgU2VuZCBCdXR0b24KICAgICAgICB2YXIgaXNTZW5kaW5nID0gZHJhZnQgJiYgaXNEcmFmdFNlbmRpbmcoZHJhZnQpOwogICAgICAgIHZhciBzZW5kTGFiZWwgPSAnU2VuZCc7CiAgICAgICAgaWYgKGRyYWZ0KSB7CiAgICAgICAgICAgIHN3aXRjaCAoZHJhZnQuc3RhdHVzKSB7CiAgICAgICAgICAgICAgICBjYXNlIERyYWZ0U3RhdHVzLlNlbmRpbmc6CiAgICAgICAgICAgICAgICBjYXNlIERyYWZ0U3RhdHVzLlN0YWdlZDoKICAgICAgICAgICAgICAgICAgICBzZW5kTGFiZWwgPSAnU2VuZGluZyc7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIERyYWZ0U3RhdHVzLlNjaGVkdWxlZDoKICAgICAgICAgICAgICAgICAgICBzZW5kTGFiZWwgPSAnU2VuZCBOb3cnOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBUT0RPKFNISU4pOiBEaXNjdXNzIGJldHRlciB3YXkgdG8gcmVzZXQgY29udGVudGVkaXRhYmxlIGlmIG5lY2Vzc2FyeQogICAgICAgIHZhciBjb250ZW50RWRpdGFibGVLZXkgPSBkcmFmdCAmJiBkcmFmdC5pZDsKICAgICAgICB2YXIgbmV3RHJhZnQgPSBkcmFmdCAmJiAhZHJhZnQudGhyZWFkVjI7CiAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogY2xhc3NuYW1lcygnY29tcG9zZS1wYW5lJywgeyAnbmV3LWRyYWZ0JzogISFuZXdEcmFmdCB9KSwgb25EcmFnRW50ZXI6IHRoaXMuaGFuZGxlRHJhZ0VudGVyLCBvbkRyYWdFeGl0OiB0aGlzLmhhbmRsZURyYWdMZWF2ZSB9LAogICAgICAgICAgICBjb25maXJtUHJvcHMgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChDb25maXJtLCBfX2Fzc2lnbih7fSwgY29uZmlybVByb3BzKSksCiAgICAgICAgICAgIGRyb3B6b25lQWN0aXZlICYmCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEZpbGVEcm9wWm9uZSwgeyBjbGFzc05hbWU6ICJjb21wb3NlLWRyb3Atem9uZSIsIG9uRHJvcDogdGhpcy5oYW5kbGVVcGxvYWQsIG9uTGVhdmU6IHRoaXMuaGFuZGxlRHJhZ0xlYXZlLCB0aXRsZTogJ0Ryb3AgaGVyZSB0byBhdHRhY2ggZmlsZXMnLCBkZXNjcmlwdGlvbjogJ1BvbHltYWlsIHdpbGwgYXV0b21hdGljYWxseSB0cmFjayB3aGVuIHlvdXIgYXR0YWNobWVudHMgYXJlIG9wZW5lZC4nLCBhbHRDb3B5OiAnSG9sZCBTSElGVCB3aGlsZSBkcm9wcGluZyB0byB1cGxvYWQgd2l0aG91dCB0cmFja2luZycsIG9uRGlyZWN0b3J5RHJvcEVycm9yOiB0aGlzLmhhbmRsZURpcmVjdG9yeURyb3BFcnJvciB9KSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJzY3JvbGwtYXJlYSIgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29udGVudEVkaXRhYmxlLCB7IGtleTogY29udGVudEVkaXRhYmxlS2V5LCByZWY6IHRoaXMuaGFuZGxlUmVmLCBodG1sOiBodG1sIHx8ICcnLCBhdXRvZm9jdXM6IGF1dG9mb2N1cywgb25DaGFuZ2U6IG9uQ2hhbmdlIHx8IHVuZGVmaW5lZCwgZGlzYWJsZWQ6IGlzU2VuZGluZywgb25TZWxlY3Q6IG9uU2VsZWN0LCB0ZW1wbGF0ZTogZHJhZnQgJiYgZHJhZnQudGVtcGxhdGUgfHwgdGVtcGxhdGUsIGRyYWZ0OiBkcmFmdCAmJiBkcmFmdC5pZCwgb25BdHRhY2htZW50VXBsb2FkOiB0aGlzLmhhbmRsZVVwbG9hZCwgb25BdHRhY2htZW50UmVtb3ZlOiBvblJlbW92ZUF0dGFjaG1lbnQsIG9uVGFiUHJlc3M6IG9uVGFiUHJlc3MsIG5vQnJhbmRpbmc6ICEhbm9CcmFuZGluZywgZ2V0Q29udGFjdDogZ2V0Q29udGFjdCwgdXNlTGlua1ByZXZpZXc6IHVzZUxpbmtQcmV2aWV3IH0pLAogICAgICAgICAgICAgICAgb25TaG93SGlzdG9yeSAmJgogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbkJ1dHRvbiwgeyBpZDogInNob3ctaGlzdG9yeSIsIGNsYXNzTmFtZTogInNob3ctaGlzdG9yeSIsIG9uQ2xpY2s6IHRoaXMuaGFuZGxlQ2xpY2ssIGljb246IFJlYWN0LmNyZWF0ZUVsZW1lbnQoVGhyZWVEb3RzLCBudWxsKSB9KSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiYXR0YWNobWVudHMtc2VjdGlvbiIgfSwKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckF0dGFjaG1lbnRDZWxscygpLAogICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyQXR0YWNobWVudE1ldGFDZWxscygpKSksCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiYm90dG9tLWJhciIgfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAibGVmdC1idXR0b25zIiB9LAogICAgICAgICAgICAgICAgICAgIG9uRGVsZXRlICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiY29udGFpbmVyIGRlbGV0ZSIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChIb3ZlclRpcCwgeyB0b3A6ICItMzVweCIsIGxlZnQ6ICItNXB4IiwgY29weTogIkRpc2NhcmQgRHJhZnQiLCBob3RrZXlBY3Rpb246IEhvdGtleUFjdGlvbi5EaXNjYXJkLCBhbmNob3JCb3R0b206IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsgY2xhc3NOYW1lOiAiYWN0aW9uLWJ1dHRvbiIsIG9uQ2xpY2s6IG9uRGVsZXRlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChUcmFzaCwgbnVsbCkpKSksCiAgICAgICAgICAgICAgICAgICAgYWxsQWN0aW9ucy5tYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChhY3Rpb24uc3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdhdHRhY2htZW50JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG9uVXBsb2FkICYmIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogY2xhc3NuYW1lcygnY29udGFpbmVyIGF0dGFjaG1lbnQnLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbm8tZGVsZXRlJzogIW9uRGVsZXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwga2V5OiBhY3Rpb24uc3RyaW5nICsgJ2NvbnRhaW5lcicgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChIb3ZlclRpcCwgeyB0b3A6ICItMzVweCIsIGxlZnQ6ICItNXB4IiwgY29weTogIkF0dGFjaCBhIEZpbGUiLCBhbmNob3JCb3R0b206IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVXBsb2FkQnV0dG9uLCB7IHJlZjogX3RoaXMuaGFuZGxlVXBsb2FkQnV0dG9uUmVmLCBjbGFzc05hbWU6ICJhY3Rpb24tYnV0dG9uIiwgdXBsb2FkOiBfdGhpcy5oYW5kbGVGaWxlcywga2V5OiBhY3Rpb24uc3RyaW5nLCBzaG93SWNvbjogdHJ1ZSB9KSkpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd0ZW1wbGF0ZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGtleTogYWN0aW9uLnN0cmluZyArICdjb250YWluZXInLCBjbGFzc05hbWU6ICJjb250YWluZXIgdGVtcGxhdGUiLCBvbk1vdXNlRW50ZXI6IF90aGlzLmhhbmRsZVRlbXBsYXRlVG9vbHRpcFNob3csIG9uTW91c2VMZWF2ZTogX3RoaXMuaGFuZGxlVGVtcGxhdGVUb29sdGlwSGlkZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEhvdmVyVGlwLCB7IHRvcDogIi0zNXB4IiwgbGVmdDogIi01cHgiLCBjb3B5OiAiTWVzc2FnZSBUZW1wbGF0ZSIsIGhvdGtleUFjdGlvbjogSG90a2V5QWN0aW9uLk1lc3NhZ2VUZW1wbGF0ZXMsIGFuY2hvckJvdHRvbTogdHJ1ZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChJY29uQnV0dG9uLCB7IGNsYXNzTmFtZTogY2xhc3NuYW1lcygnYWN0aW9uLWJ1dHRvbicsIHsgc2VsZWN0ZWQ6IHNlbGVjdGVkIH0pLCBpZDogYWN0aW9uLnN0cmluZywga2V5OiBhY3Rpb24uc3RyaW5nICsgc2VsZWN0ZWQudG9TdHJpbmcoKSwgaWNvbjogYWN0aW9uLmljb24sIG9uQ2xpY2s6IGZlYXR1cmVzLm1lc3NhZ2VUZW1wbGF0ZXMgPyBfdGhpcy5oYW5kbGVDbGljayA6IHVuZGVmaW5lZCB9KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICFmZWF0dXJlcy5tZXNzYWdlVGVtcGxhdGVzICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVXBncmFkZVByb21wdCwgeyB0aXRsZTogIk1lc3NhZ2UgVGVtcGxhdGVzIiwgZGVzY3JpcHRpb246ICdUbyBjcmVhdGUgYW5kIHVzZSBjdXN0b21pemFibGUgbWVzc2FnZSAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGVtcGxhdGVzLCB1cGdyYWRlIHRvIGEgcGFpZCBwbGFuLicsIHJlZjogX3RoaXMuaGFuZGxlVGVtcGxhdGVSZWYgfSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2NhbGVuZGFyJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9ICEhZHJhZnQgJiYgISFkcmFmdC5jYWxlbmRhckludml0ZSAmJiAhaXNUZW1wbGF0ZUVkaXRvcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsga2V5OiBhY3Rpb24uc3RyaW5nICsgJ2NvbnRhaW5lcicsIGNsYXNzTmFtZTogImNvbnRhaW5lciBjYWxlbmRhciIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc3RhdGUuc2hvd0NhbGVuZGFyTWVudSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChDYWxlbmRhck1lbnUsIHsgb3B0aW9uczogaXNUZW1wbGF0ZUVkaXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IFtDYWxlbmRhck9wdGlvbi5TY2hlZHVsaW5nVXJsXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IFtDYWxlbmRhck9wdGlvbi5DYWxlbmRhckludml0ZSwgQ2FsZW5kYXJPcHRpb24uU2NoZWR1bGluZ1VybF0sIG9uU2VsZWN0OiBfdGhpcy5oYW5kbGVDYWxlbmRhck9wdGlvblNlbGVjdCwgb25IaWRlOiBfdGhpcy5oYW5kbGVDYWxlbmRhck1lbnVIaWRlIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEhvdmVyVGlwLCB7IHRvcDogIi0zNXB4IiwgbGVmdDogIi01cHgiLCBjb3B5OiAiU2hhcmUgQ2FsZW5kYXIiLCBhbmNob3JCb3R0b206IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSWNvbkJ1dHRvbiwgeyBjbGFzc05hbWU6IGNsYXNzbmFtZXMoJ2FjdGlvbi1idXR0b24nLCB7IHNlbGVjdGVkOiBzZWxlY3RlZCB9KSwgaWQ6IGFjdGlvbi5zdHJpbmcsIGtleTogYWN0aW9uLnN0cmluZyArIHNlbGVjdGVkLnRvU3RyaW5nKCksIGljb246IGFjdGlvbi5pY29uLCBvbkNsaWNrOiBfdGhpcy5oYW5kbGVDbGljayB9KSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImNvbnRhaW5lciIsIGtleTogYWN0aW9uLnN0cmluZyArICdjb250YWluZXInIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEljb25CdXR0b24sIHsgY2xhc3NOYW1lOiBjbGFzc25hbWVzKCdhY3Rpb24tYnV0dG9uJywgeyBzZWxlY3RlZDogc2VsZWN0ZWQgfSksIGlkOiBhY3Rpb24uc3RyaW5nLCBrZXk6IGFjdGlvbi5zdHJpbmcgKyBzZWxlY3RlZC50b1N0cmluZygpLCBpY29uOiBhY3Rpb24uaWNvbiwgb25DbGljazogX3RoaXMuaGFuZGxlQ2xpY2sgfSkpKTsKICAgICAgICAgICAgICAgICAgICB9KSksCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInJpZ2h0LWJ1dHRvbnMiIH0sCiAgICAgICAgICAgICAgICAgICAgb25UcmFjayAmJgogICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRyYWNrLWNvbnRhaW5lciIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoSG92ZXJUaXAsIHsgdG9wOiAiLTM1cHgiLCBsZWZ0OiAiLTEwcHgiLCBjb3B5OiAiU2V0IE1lc3NhZ2UgVHJhY2tpbmciLCBhbmNob3JCb3R0b206IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogY2xhc3NuYW1lcygndHJhY2stYnV0dG9uJywgeyBhY3RpdmU6ICEhZHJhZnQgJiYgZHJhZnQudHJhY2sgfSksIG9uQ2xpY2s6IG9uVHJhY2sgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChUcmFjaywgeyBoZWlnaHQ6ICIxOHB4Iiwgd2lkdGg6ICIxMHB4IiB9KSkpKSwKICAgICAgICAgICAgICAgICAgICBvbkZvbGxvd1VwICYmCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZm9sbG93LXVwLWNvbnRhaW5lciIsIG9uTW91c2VFbnRlcjogdGhpcy5oYW5kbGVGb2xsb3dVcFRvb2x0aXBTaG93LCBvbk1vdXNlTGVhdmU6IHRoaXMuaGFuZGxlRm9sbG93VXBUb29sdGlwSGlkZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChIb3ZlclRpcCwgeyB0b3A6ICItMzVweCIsIGNvcHk6ICJGb2xsb3cgVXAgUmVtaW5kZXIiLCBob3RrZXlBY3Rpb246IEhvdGtleUFjdGlvbi5Gb2xsb3dVcFJlbWluZGVyLCBhbmNob3JCb3R0b206IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogY2xhc3NuYW1lcygnZm9sbG93LXVwLWJ1dHRvbicsIHsgc2VsZWN0ZWQ6IGRyYWZ0ICYmICEhZHJhZnQud2FpdGluZyB9KSwgb25DbGljazogZmVhdHVyZXMuZm9sbG93VXAgPyBvbkZvbGxvd1VwIDogdW5kZWZpbmVkIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRm9sbG93VXAsIG51bGwpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImNvbnRlbnQiIH0sIGRyYWZ0ICYmIGRyYWZ0LndhaXRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gbW9tZW50KGRyYWZ0LndhaXRpbmcud2hlbikuZnJvbU5vdygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICdGb2xsb3cgVXAnKSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIWZlYXR1cmVzLmZvbGxvd1VwICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVXBncmFkZVByb21wdCwgeyB0aXRsZTogIkZvbGxvdyBVcCBSZW1pbmRlcnMiLCBkZXNjcmlwdGlvbjogIlRvIHNldCBhdXRvbWF0aWMgZm9sbG93IHVwIHJlbWluZGVycywgdXBncmFkZSB0byBhIHBhaWQgcGxhbi4iLCByZWY6IHRoaXMuaGFuZGxlRm9sbG93VXBSZWYgfSkpLAogICAgICAgICAgICAgICAgICAgIG9uU2VuZExhdGVyICYmCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAic2VuZC1sYXRlci1jb250YWluZXIiLCBvbk1vdXNlRW50ZXI6IHRoaXMuaGFuZGxlU2VuZExhdGVyVG9vbHRpcFNob3csIG9uTW91c2VMZWF2ZTogdGhpcy5oYW5kbGVTZW5kTGF0ZXJUb29sdGlwSGlkZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChIb3ZlclRpcCwgeyB0b3A6ICItMzVweCIsIGNvcHk6ICJTZW5kIExhdGVyIiwgaG90a2V5QWN0aW9uOiBIb3RrZXlBY3Rpb24uU2VuZExhdGVyLCBhbmNob3JCb3R0b206IHRydWUgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogY2xhc3NuYW1lcygnc2VuZC1sYXRlci1idXR0b24nLCB7IHNlbGVjdGVkOiBkcmFmdCAmJiAhIWRyYWZ0LnNjaGVkdWxlZCB9KSwgb25DbGljazogZmVhdHVyZXMuc2VuZExhdGVyID8gb25TZW5kTGF0ZXIgOiB1bmRlZmluZWQgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChTZW5kTGF0ZXIsIG51bGwpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImNvbnRlbnQiIH0sIGRyYWZ0ICYmIGRyYWZ0LnNjaGVkdWxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBtb21lbnQoZHJhZnQuc2NoZWR1bGVkKS5mcm9tTm93KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJ1NlbmQgTGF0ZXInKSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIWZlYXR1cmVzLnNlbmRMYXRlciAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KFVwZ3JhZGVQcm9tcHQsIHsgdGl0bGU6ICJTZW5kIExhdGVyIiwgZGVzY3JpcHRpb246ICdUbyBzY2hlZHVsZSBlbWFpbHMgdG8gc2VuZCBhdXRvbWF0aWNhbGx5IGF0IGEgbGF0ZXIgdGltZSwnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyB1cGdyYWRlIHRvIGEgcGFpZCBwbGFuLicsIHJlZjogdGhpcy5oYW5kbGVTZW5kTGF0ZXJSZWYgfSkpLAogICAgICAgICAgICAgICAgICAgIG9uU2VuZCAmJiBkcmFmdCAmJgogICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEhvdmVyVGlwLCB7IHRvcDogIi0zNXB4IiwgY29weTogIlNlbmQgTWVzc2FnZSIsIGhvdGtleUFjdGlvbjogSG90a2V5QWN0aW9uLlNlbmQsIGFuY2hvckJvdHRvbTogdHJ1ZSB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgeyBvbkNsaWNrOiBvblNlbmQsIGNsYXNzTmFtZTogInNlbmQtYnV0dG9uIiwgZGlzYWJsZWQ6IGlzU2VuZGluZyB9LCBzZW5kTGFiZWwpKSwKICAgICAgICAgICAgICAgICAgICBzaG93U2VuZE9uYm9hcmRpbmcgJiYKICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChPbmJvYXJkaW5nVGlwLCB7IHRpdGxlOiAiUmVhZHkhIiwgbWVzc2FnZTogIkNsaWNrIHRvIHNlbmQgeW91ciBmaXJzdCBtZXNzYWdlIHdpdGggZW1haWwgdHJhY2tpbmcuIiwgdG9wOiAiNTBweCIsIHJpZ2h0OiAiMjBweCIgfSkpKSwKICAgICAgICAgICAgc2hvd0Vycm9yICYmIChSZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogY2xhc3NuYW1lcygnZXJyb3InLCB7IGNhbmNlbGVkOiBzY2hlZHVsZWRDYW5jZWxlZCB9KSB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIGVycm9yKSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsgY2xhc3NOYW1lOiAiY2xvc2UtYnV0dG9uIiwgb25DbGljazogdGhpcy5oYW5kbGVEaXNtaXNzRXJyb3IgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENsb3NlLCB7IGNsYXNzTmFtZTogImNsb3NlLWljb24iIH0pKSkpKSk7CiAgICB9OwogICAgcmV0dXJuIENvbXBvc2VQYW5lOwp9KFJlYWN0LlB1cmVDb21wb25lbnQpKTsKZXhwb3J0IGRlZmF1bHQgQ29tcG9zZVBhbmU7Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/Compose/ComposePane.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/Compose/ComposePane.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport moment from 'moment';\n\nimport { filter, findIndex, isEqual, compact, values, indexOf, keyBy } from 'lodash';\nimport classnames from 'classnames';\nimport {\n  Draft,\n  DraftStatus,\n  Account,\n  AttachmentMeta,\n  Action,\n  Attachment as AttachmentType,\n  Contact,\n  AccountType,\n  Features,\n  Resource,\n } from '@src/types';\nimport { accountSignature } from '@src/lib/account';\nimport IconButton from '@src/components/Base/IconButton';\nimport ContentEditable from '@src/components/ContentEditable/ContentEditable';\nimport AttachmentCell from './Attachments/AttachmentCell';\nimport { filenameIconUrl, AttachmentUploadOptions } from '@src/lib/attachment';\n\nimport Attachment from '@src/components/Icons/Attachment.svg';\nimport FollowUp from '@src/components/Icons/FollowUp.svg';\nimport SendLater from '@src/components/Icons/SendLater.svg';\nimport ThreeDots from '@src/components/Icons/ThreeDots.svg';\nimport Trash from '@src/components/Icons/Trash.svg';\n\nimport FileDropZone from './FileDropZone';\n\n// TODO(SHIN): Beta - Re-enable when bringing in compose supps\nimport Template from '@src/components/Icons/Template.svg';\nimport Calendar from '@src/components/Icons/Calendar.svg';\n// import Emoji from './Icons/Emoji.svg';\n// import Gif from './Icons/Gif.svg';\nimport Track from '@src/components/Icons/Track.svg';\n\nimport UploadButton from '@src/components/Base/UploadButton';\n\nimport './ComposePane.scss';\nimport { getHotkeyByName, HotkeyAction, Hotkey } from '@src/lib/hotkeys';\nimport UpgradePrompt from '@src/components/Base/UpgradePrompt/UpgradePrompt';\nimport CalendarMenu, { CalendarOption } from '@src/components/Compose/components/CalendarMenu';\nimport OnboardingTip from '@src/components/Onboarding/components/OnboardingTip/OnboardingTip';\nimport HoverTip from '@src/components/Base/HoverTip';\nimport Close from '@src/components/Icons/Close.svg';\nimport { isDraftSending, DraftSpecialError } from '@src/lib/draft';\nimport Confirm, { Props as ConfirmProps } from '@src/components/Base/Confirm';\nimport { BlobDescriptor, uploadErrorMessage } from '@src/lib/files';\nimport { hotkeySuggest } from '@src/ducks/hotkeys';\nimport { AmplitudeEvents, logAmplitudeEvent } from '@src/lib/amplitude-analytics';\n\nexport interface Props {\n  onSend?: () => void;\n  onSendLater?: () => void;\n  onFollowUp?: () => void;\n  onChange?: (value: string) => void;\n  onUpload?: (files: File[], options: AttachmentUploadOptions) => void;\n  onDelete?: () => void;\n  onRemoveAttachment?: (attachmentId: string) => void;\n  onSelect?: () => void;\n  onShowHistory?: () => void;\n  onTabPress?: (event: React.KeyboardEvent<HTMLDivElement>|KeyboardEvent) => boolean;\n  dispatchAction: (action: Action<any, any>) => void;\n  onSchedulingUrlSelect?: () => void;\n\n  draft?: Draft;\n  template?: string;\n  accounts?: Account[];\n  attachments?: AttachmentType[];\n  attachmentMetas: Array<Resource<AttachmentMeta>>;\n  actions?: string[];\n  html?: string;\n  showVariablePopover?: boolean;\n  noBranding?: boolean;\n  useLinkPreview?: boolean;\n  isTemplateEditor?: boolean;\n  getContact?: (email: string) => Contact;\n  draftAccount?: Account;\n  draftParentAccount?: Account;\n  features: Features;\n  showSendOnboarding?: boolean;\n  onTrack?: () => void;\n  autofocus?: boolean;\n  showSentFromPolymail?: boolean;\n  onErrorDismiss?: () => void;\n}\n\n// TODO(SHIN): Beta- Re-enable when bringing in compose supps\nconst ACTIONS = [\n  {\n    string: 'attachment',\n    icon: <Attachment width=\"16px\" height=\"16px\" />,\n  },\n  {\n    string: 'template',\n    icon: <Template width=\"16px\" height=\"16px\" />,\n  },\n  {\n    string: 'calendar',\n    icon: <Calendar width=\"16px\" height=\"16px\" />,\n  },\n  // {\n  //   string: 'emoji',\n  //   icon: <Emoji width=\"18px\" height=\"18px\" />,\n  // },\n  // {\n  //   string: 'gif',\n  //   icon: <Gif width=\"30px\" height=\"20px\" />,\n  // },\n];\n\ninterface State {\n  dropzoneActive: boolean;\n  showCalendarMenu?: boolean;\n  showError: boolean;\n  confirmProps?: ConfirmProps;\n}\n\n// TODO(SHIN): Handle actions for compose accessories\n// TODO(SHIN): Handle actions for compose send\nclass ComposePane extends React.PureComponent<Props, State> {\n  contentEditable: ContentEditable;\n  uploadButton: UploadButton;\n  private followUpTooltip: UpgradePrompt;\n  private sendLaterTooltip: UpgradePrompt;\n  private templateTooltip: UpgradePrompt;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      dropzoneActive: false,\n      showError: false,\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.draft && this.props.draft.error) {\n      this.setState({\n        showError: true,\n      });\n    }\n  }\n\n  // Update signature\n  // TODO(SHIN & SHAHAN): Possible race condition or lost change between account diffs.\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n    const { isTemplateEditor, showSentFromPolymail } = nextProps;\n    const nextDraft = nextProps.draft;\n    const oldDraft = this.props.draft;\n\n    // Identifies if signature has been switched\n    if (nextProps.accounts && nextDraft && oldDraft &&\n      nextDraft.id === oldDraft.id) {\n      // Account differences\n      if (nextDraft.account !== oldDraft.account) {\n        const nextAccount = nextDraft.account;\n        const account = nextProps.accounts.filter(acc => acc.id === nextAccount)[0];\n        if (account) {\n          this.contentEditable.updateSignature(accountSignature({\n            account,\n            draftId: nextDraft.id,\n            preventEdits: true,\n          }));\n        }\n\n        if (showSentFromPolymail) {\n          this.contentEditable.updateSentFromPolymail(showSentFromPolymail);\n        }\n      }\n    }\n\n    // Do not do contenteditable updates when draft id is not the same\n    // HACK(SHIN): Check for template editor to allow template attachments to process through\n    const nextDraftId = nextDraft && nextDraft.id || '';\n    const oldDraftId = oldDraft && oldDraft.id || '';\n\n    // Determine whether to show error\n    const newDraft = (nextDraft && !oldDraft) || (nextDraft && nextDraft !== oldDraft);\n    if (newDraft) {\n      this.setState({\n        showError: nextDraft ? !!nextDraft.error : false,\n      });\n    }\n\n    if (nextDraftId !== oldDraftId && !this.props.isTemplateEditor) {\n      return;\n    }\n\n    // Handle updating attachments\n    const nextAttachments = nextProps.attachments;\n    const oldAttachments = this.props.attachments;\n    if (nextAttachments && oldAttachments) {\n      nextAttachments.\n        filter(attachment => findIndex(oldAttachments, { id: attachment.id }) === -1)\n        .forEach((attachment) => {\n          if (attachment.inline) {\n            this.contentEditable.replaceAttachment(attachment);\n          }\n\n          if (attachment.cloud) {\n            this.contentEditable.replaceAttachment(attachment);\n          }\n        },\n      );\n    }\n\n    // Injection points for metas\n    // TODO(SHIN): Make sure that body does not inject on restart of app (Bug)\n    const oldMetas = this.props.attachmentMetas;\n    const newMetas = nextProps.attachmentMetas;\n    const oldMetaIds = compact(values(oldMetas.map(meta => meta.data && meta.data.attachment)));\n    if (oldMetas !== newMetas) {\n      // Create a map of already completed attachments\n      const attachmentIdMap = keyBy(nextAttachments, 'id');\n\n      // Inject metas\n      newMetas\n        .filter(meta => meta.data && !attachmentIdMap[meta.data.attachment] || false)\n        .forEach((meta) => {\n          if (!meta.data) {\n            return;\n          }\n\n          // Replace if available\n          this.contentEditable.replaceAttachmentMeta(meta.data, meta.error);\n\n          // Check if attachment meta is new\n          if (indexOf(oldMetaIds, meta.data && meta.data.attachment) !== -1) {\n            return;\n          }\n\n          // Do not inject if already exists in body\n          if (meta.data && this.contentEditable.attachmentExistsInBody(meta.data.attachment)) {\n            return;\n          }\n\n          // Checks to ensure that attachment is not being added injected\n          // for a template attachment being applied to a draft\n          const notTemplateInjection = isTemplateEditor || !meta.data.template;\n          if (meta.data.inline && notTemplateInjection) {\n            this.contentEditable.injectInlineAttachmentMeta(meta.data);\n          }\n\n          if (meta.data.cloud && notTemplateInjection) {\n            this.contentEditable.injectCloudAttachmentMeta(meta.data, meta.error);\n          }\n        });\n    }\n\n    // add calendar invite if not previously there\n    const oldCalendarInvite = this.props.draft && this.props.draft.calendarInvite;\n    const newCalendarInvite = nextProps.draft && nextProps.draft.calendarInvite;\n    if (newCalendarInvite && !oldCalendarInvite) {\n      this.contentEditable.focus();\n      this.contentEditable.addCalendarInvite(newCalendarInvite);\n    } else if (newCalendarInvite && !isEqual(newCalendarInvite, oldCalendarInvite)) {\n      this.contentEditable.focus();\n      this.contentEditable.replaceCalendarInvite(newCalendarInvite);\n    }\n  }\n\n  handleUploadButtonRef = (ref: UploadButton) => {\n    this.uploadButton = ref;\n  }\n\n  handleRef = (ref: ContentEditable) => {\n    this.contentEditable = ref;\n  }\n\n  focusContentEditable = (selectFirstPlaceholder?: boolean, selectLastPlaceholder?: boolean) => {\n    this.contentEditable.focus(selectFirstPlaceholder, selectLastPlaceholder);\n  }\n\n  handleClick = (action: string) => {\n    const { onShowHistory, dispatchAction } = this.props;\n\n    let hotkey: Hotkey|undefined;\n    switch (action) {\n      case 'show-history':\n        if (onShowHistory) {\n          onShowHistory();\n        }\n        break;\n      case 'template':\n        hotkey = getHotkeyByName(HotkeyAction.MessageTemplates);\n        if (hotkey) {\n          dispatchAction(hotkey.action);\n          dispatchAction(hotkeySuggest(HotkeyAction.MessageTemplates));\n        }\n        break;\n      case 'calendar':\n        this.handleCalendarMenuToggle();\n        break;\n      case 'attachment':\n        break;\n      default:\n        break;\n    }\n  }\n\n  // Handles files upload\n  handleFiles = (files: File[]) => {\n    const { onUpload } = this.props;\n    if (onUpload) {\n      onUpload(files, { ignoreInline: true });\n    }\n  }\n\n  renderAttachmentCells = () => (\n      this.props.attachments &&\n      this.props.attachments\n        .filter(attachment => !(attachment.cloud || attachment.inline))\n        .map(attachment => (\n          <AttachmentCell\n            key={attachment.id}\n            id={attachment.id}\n            filename={attachment.filename}\n            iconUrl={filenameIconUrl(attachment.filename)}\n            length={attachment.length}\n            progress={1}\n            onDelete={this.props.onRemoveAttachment}\n            indeterminateUploading={attachment.uploading}\n            fileUrl={attachment.cloudUrl}\n          />\n        ),\n    )\n  )\n\n  renderAttachmentMetaCells = () => (\n    this.props.attachmentMetas && this.props.attachmentMetas\n      .filter((meta) => {\n        const inline = meta.data && meta.data.inline || false;\n        const cloud = meta.data && meta.data.cloud || false;\n        const attachmentIds = (this.props.attachments || []).map(a => a.id);\n        return meta.data && !(inline || cloud) &&\n          attachmentIds.indexOf(meta.data.attachment) === -1;\n      })\n      .map((meta) => {\n        const { data } = meta;\n        if (!data) {\n          return null;\n        }\n        return (\n          <AttachmentCell\n            key={data.attachment}\n            id={data.attachment}\n            filename={data.filename || data.file && data.file.name || 'attachment'}\n            iconUrl={filenameIconUrl((data.filename || data.file && data.file.name) || '')}\n            length={data.length || data.file && data.file.size || 1000}\n            onDelete={this.props.onRemoveAttachment}\n            progress={data.progress || 0}\n            error={meta.error}\n            fileUrl={data.cloudUrl}\n            isMeta\n          />\n        );\n      })\n  )\n\n  // DropZone handlers\n  handleDragEnter = (event: React.DragEvent<HTMLDivElement>) => {\n    if (event.dataTransfer.types.indexOf('Files') !== -1) {\n      this.setState({ dropzoneActive: true });\n    }\n  }\n\n  handleDragLeave = () => {\n    this.setState({ dropzoneActive: false });\n  }\n\n  handleUpload = (files: File[], options: AttachmentUploadOptions) => {\n    const { onUpload } = this.props;\n    if (onUpload) {\n      onUpload(files, options);\n      this.setState({ dropzoneActive: false }, () => {\n        // Handle dropping to specific position\n        if (options.position && this.contentEditable) {\n          this.contentEditable.moveCursorToPosition(options.position);\n        }\n      });\n    }\n  }\n\n  handleFollowUpRef = (ref: UpgradePrompt) => {\n    this.followUpTooltip = ref;\n  }\n\n  handleSendLaterRef = (ref: UpgradePrompt) => {\n    this.sendLaterTooltip = ref;\n  }\n\n  handleTemplateRef = (ref: UpgradePrompt) => {\n    this.templateTooltip = ref;\n  }\n\n  handleFollowUpTooltipShow = () => {\n    const { features } = this.props;\n\n    if (!features.followUp) {\n      this.followUpTooltip.show();\n    }\n  }\n\n  handleFollowUpTooltipHide = () => {\n    if (this.followUpTooltip) {\n      this.followUpTooltip.hide();\n    }\n  }\n\n  handleSendLaterTooltipShow = () => {\n    const { features } = this.props;\n\n    if (!features.sendLater) {\n      this.sendLaterTooltip.show();\n    }\n  }\n\n  handleSendLaterTooltipHide = () => {\n    if (this.sendLaterTooltip) {\n      this.sendLaterTooltip.hide();\n    }\n  }\n\n  handleTemplateTooltipShow = () => {\n    const { features } = this.props;\n\n    if (!features.messageTemplates) {\n      this.templateTooltip.show();\n    }\n  }\n\n  handleTemplateTooltipHide = () => {\n    if (this.templateTooltip) {\n      this.templateTooltip.hide();\n    }\n  }\n\n  handleCalendarMenuToggle = () => {\n    this.setState({ showCalendarMenu: true });\n  }\n\n  handleCalendarMenuHide = () => {\n    this.setState({ showCalendarMenu: undefined });\n  }\n\n  handleCalendarOptionSelect = (option: CalendarOption) => {\n    const { dispatchAction, onSchedulingUrlSelect } = this.props;\n    switch (option) {\n      case CalendarOption.CalendarInvite:\n        const hotkey = getHotkeyByName(HotkeyAction.CalendarInvite);\n        if (hotkey) {\n          dispatchAction(hotkey.action);\n        }\n        break;\n      case CalendarOption.SchedulingUrl:\n        if (onSchedulingUrlSelect) {\n          onSchedulingUrlSelect();\n        }\n        logAmplitudeEvent(AmplitudeEvents.ClickShareAvailableMeetingTimes);\n        break;\n      default:\n        break;\n    }\n  }\n\n  handleDismissError = () => {\n    const { onErrorDismiss } = this.props;\n    this.setState({ showError: false });\n\n    if (onErrorDismiss) {\n      onErrorDismiss();\n    }\n  }\n\n  handleDirectoryDropError = (b: BlobDescriptor) => {\n    const confirmProps: ConfirmProps = {\n      title: 'Error attaching file',\n      message: uploadErrorMessage(b),\n      confirmCopy: 'Ok',\n      onConfirm: () => {\n        this.setState({ confirmProps: undefined });\n      },\n    };\n\n    this.setState({ confirmProps, dropzoneActive: false });\n  }\n\n  render() {\n    const {\n      onFollowUp,\n      onSendLater,\n      onSend,\n      actions,\n      html,\n      onChange,\n      autofocus,\n      draft,\n      onSelect,\n      onTabPress,\n      onRemoveAttachment,\n      onUpload,\n      onShowHistory,\n      template,\n      noBranding,\n      isTemplateEditor,\n      getContact,\n      draftAccount,\n      features,\n      useLinkPreview,\n      showSendOnboarding,\n      onDelete,\n      onTrack,\n      draftParentAccount,\n    } = this.props;\n\n    const { dropzoneActive, showError, confirmProps } = this.state;\n\n    // Set Errors\n    let error;\n    let scheduledCanceled = false;\n    if (draft) {\n      error = draft.error;\n      scheduledCanceled = draft.error === DraftSpecialError.ScheduledCancel;\n    }\n\n    // Handles action clicks\n    let allActions = ACTIONS;\n    if (actions) {\n      allActions = filter(allActions, action => actions.indexOf(action.string) !== -1);\n    }\n\n    const topAccount = draftParentAccount || draftAccount;\n\n    if (topAccount && topAccount.type !== AccountType.Google\n      && topAccount.type !== AccountType.Microsoft) {\n      allActions = filter(allActions, action => action.string !== 'calendar');\n    }\n\n    // Set Send Button\n    const isSending = draft && isDraftSending(draft);\n    let sendLabel = 'Send';\n    if (draft) {\n      switch (draft.status) {\n        case DraftStatus.Sending:\n        case DraftStatus.Staged:\n          sendLabel = 'Sending';\n          break;\n        case DraftStatus.Scheduled:\n          sendLabel = 'Send Now';\n          break;\n        default:\n          break;\n      }\n    }\n\n    // TODO(SHIN): Discuss better way to reset contenteditable if necessary\n    const contentEditableKey = draft && draft.id;\n    const newDraft = draft && !draft.threadV2;\n\n    return (\n      <div\n        className={classnames('compose-pane', { 'new-draft': !!newDraft })}\n        onDragEnter={this.handleDragEnter}\n        onDragExit={this.handleDragLeave}\n      >\n        {confirmProps && <Confirm {...confirmProps} />}\n        {dropzoneActive &&\n          <FileDropZone\n            className=\"compose-drop-zone\"\n            onDrop={this.handleUpload}\n            onLeave={this.handleDragLeave}\n            title={'Drop here to attach files'}\n            description={'Polymail will automatically track when your attachments are opened.'}\n            altCopy={'Hold SHIFT while dropping to upload without tracking'}\n            onDirectoryDropError={this.handleDirectoryDropError}\n          />\n        }\n        <div className=\"scroll-area\">\n          <ContentEditable\n            key={contentEditableKey}\n            ref={this.handleRef}\n            html={html || ''}\n            autofocus={autofocus}\n            onChange={onChange || undefined}\n            disabled={isSending}\n            onSelect={onSelect}\n            template={draft && draft.template || template}\n            draft={draft && draft.id}\n            onAttachmentUpload={this.handleUpload}\n            onAttachmentRemove={onRemoveAttachment}\n            onTabPress={onTabPress}\n            noBranding={!!noBranding}\n            getContact={getContact}\n            useLinkPreview={useLinkPreview}\n          />\n          {onShowHistory &&\n            <IconButton\n              id=\"show-history\"\n              className=\"show-history\"\n              onClick={this.handleClick}\n              icon={<ThreeDots />}\n            />\n          }\n          <div className=\"attachments-section\">\n            {this.renderAttachmentCells()}\n            {this.renderAttachmentMetaCells()}\n          </div>\n        </div>\n        <div className=\"bottom-bar\">\n          <div className=\"left-buttons\">\n            {onDelete && <div className=\"container delete\">\n              <HoverTip\n                top=\"-35px\"\n                left=\"-5px\"\n                copy=\"Discard Draft\"\n                hotkeyAction={HotkeyAction.Discard}\n                anchorBottom\n              >\n                <button className=\"action-button\" onClick={onDelete}>\n                  <Trash />\n                </button>\n              </HoverTip>\n            </div>}\n            {allActions.map((action) => {\n              let selected = false;\n              switch (action.string) {\n                case 'attachment':\n                  return (\n                    onUpload && (\n                      <div\n                        className={classnames('container attachment', {\n                          'no-delete': !onDelete,\n                        })}\n                        key={action.string + 'container'}\n                      >\n                        <HoverTip\n                          top=\"-35px\"\n                          left=\"-5px\"\n                          copy=\"Attach a File\"\n                          anchorBottom\n                        >\n                          <UploadButton\n                            ref={this.handleUploadButtonRef}\n                            className=\"action-button\"\n                            upload={this.handleFiles}\n                            key={action.string}\n                            showIcon\n                          />\n                        </HoverTip>\n                      </div>\n                    )\n                  );\n                case 'template':\n                  return (\n                    <div\n                      key={action.string + 'container'}\n                      className=\"container template\"\n                      onMouseEnter={this.handleTemplateTooltipShow}\n                      onMouseLeave={this.handleTemplateTooltipHide}\n                    >\n                      <HoverTip\n                        top=\"-35px\"\n                        left=\"-5px\"\n                        copy=\"Message Template\"\n                        hotkeyAction={HotkeyAction.MessageTemplates}\n                        anchorBottom\n                      >\n                        <IconButton\n                          className={classnames('action-button', { selected })}\n                          id={action.string}\n                          key={action.string + selected.toString()}\n                          icon={action.icon}\n                          onClick={features.messageTemplates ? this.handleClick : undefined}\n                        />\n                      </HoverTip>\n                      {!features.messageTemplates && <UpgradePrompt\n                        title=\"Message Templates\"\n                        description={'To create and use customizable message ' +\n                          'templates, upgrade to a paid plan.'}\n                        ref={this.handleTemplateRef}\n                      />}\n                    </div>\n                  );\n                case 'calendar':\n                  selected = !!draft && !!draft.calendarInvite && !isTemplateEditor;\n                  return (\n                    <div\n                      key={action.string + 'container'}\n                      className=\"container calendar\"\n                    >\n                      {this.state.showCalendarMenu &&\n                        <CalendarMenu\n                          options={isTemplateEditor\n                            ? [CalendarOption.SchedulingUrl]\n                            : [CalendarOption.CalendarInvite, CalendarOption.SchedulingUrl]\n                          }\n                          onSelect={this.handleCalendarOptionSelect}\n                          onHide={this.handleCalendarMenuHide}\n                        />\n                      }\n                      <HoverTip\n                        top=\"-35px\"\n                        left=\"-5px\"\n                        copy=\"Share Calendar\"\n                        anchorBottom\n                      >\n                        <IconButton\n                          className={classnames('action-button', { selected })}\n                          id={action.string}\n                          key={action.string + selected.toString()}\n                          icon={action.icon}\n                          onClick={this.handleClick}\n                        />\n                      </HoverTip>\n                    </div>\n                  );\n                default:\n                  break;\n              }\n\n              return (\n                <div\n                  className=\"container\"\n                  key={action.string + 'container'}\n                >\n                  <IconButton\n                    className={classnames('action-button', { selected })}\n                    id={action.string}\n                    key={action.string + selected.toString()}\n                    icon={action.icon}\n                    onClick={this.handleClick}\n                  />\n                </div>\n              );\n            },\n            )}\n          </div>\n          <div className=\"right-buttons\">\n          {onTrack &&\n            <div\n              className=\"track-container\"\n            >\n              <HoverTip\n                top=\"-35px\"\n                left=\"-10px\"\n                copy=\"Set Message Tracking\"\n                anchorBottom\n              >\n                <button\n                  className={classnames('track-button', { active: !!draft && draft.track })}\n                  onClick={onTrack}\n                >\n                  <Track height=\"18px\" width=\"10px\" />\n                </button>\n              </HoverTip>\n            </div>}\n          {onFollowUp &&\n            <div\n              className=\"follow-up-container\"\n              onMouseEnter={this.handleFollowUpTooltipShow}\n              onMouseLeave={this.handleFollowUpTooltipHide}\n            >\n              <HoverTip\n                top=\"-35px\"\n                copy=\"Follow Up Reminder\"\n                hotkeyAction={HotkeyAction.FollowUpReminder}\n                anchorBottom\n              >\n                <button\n                  className={\n                    classnames(\n                      'follow-up-button',\n                      { selected: draft && !!draft.waiting },\n                    )\n                  }\n                  onClick={features.followUp ? onFollowUp : undefined}\n                >\n                  <FollowUp />\n                  <div className=\"content\">\n                    {draft && draft.waiting\n                      ? moment(draft.waiting.when).fromNow()\n                      : 'Follow Up'\n                    }\n                  </div>\n                </button>\n              </HoverTip>\n              {!features.followUp && <UpgradePrompt\n                title=\"Follow Up Reminders\"\n                description=\"To set automatic follow up reminders, upgrade to a paid plan.\"\n                ref={this.handleFollowUpRef}\n              />}\n            </div>}\n          {onSendLater &&\n            <div\n              className=\"send-later-container\"\n              onMouseEnter={this.handleSendLaterTooltipShow}\n              onMouseLeave={this.handleSendLaterTooltipHide}\n            >\n              <HoverTip\n                top=\"-35px\"\n                copy=\"Send Later\"\n                hotkeyAction={HotkeyAction.SendLater}\n                anchorBottom\n              >\n                <button\n                  className={\n                    classnames(\n                      'send-later-button',\n                      { selected: draft && !!draft.scheduled },\n                    )\n                  }\n                  onClick={features.sendLater ? onSendLater : undefined}\n                >\n                  <SendLater />\n                  <div className=\"content\">\n                    {draft && draft.scheduled\n                      ? moment(draft.scheduled).fromNow()\n                      : 'Send Later'\n                    }\n                  </div>\n                </button>\n              </HoverTip>\n              {!features.sendLater && <UpgradePrompt\n                title=\"Send Later\"\n                description={'To schedule emails to send automatically at a later time,' +\n                  ' upgrade to a paid plan.'}\n                ref={this.handleSendLaterRef}\n              />}\n            </div>\n          }\n          {onSend && draft &&\n              <HoverTip\n                top=\"-35px\"\n                copy=\"Send Message\"\n                hotkeyAction={HotkeyAction.Send}\n                anchorBottom\n              >\n                <button onClick={onSend} className=\"send-button\" disabled={isSending}>\n                  {sendLabel}\n                </button>\n              </HoverTip>\n          }\n          {showSendOnboarding &&\n            <OnboardingTip\n              title=\"Ready!\"\n              message=\"Click to send your first message with email tracking.\"\n              top=\"50px\"\n              right=\"20px\"\n            />\n          }\n          </div>\n        </div>\n        {showError && (\n          <div\n            className={classnames('error', { canceled: scheduledCanceled })}\n          >\n            <span>{error}</span>\n            <button className=\"close-button\" onClick={this.handleDismissError}>\n              <Close className=\"close-icon\" />\n            </button>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default ComposePane;\n"]}]}