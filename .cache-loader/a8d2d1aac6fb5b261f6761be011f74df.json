{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/devices.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/devices.ts","mtime":1675280254055},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgewogICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHsKICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKQogICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfTsKICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9OwppbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7CmltcG9ydCBDb29raWVzIGZyb20gJ2pzLWNvb2tpZSc7CmltcG9ydCBwbGF0Zm9ybSBmcm9tICdwbGF0Zm9ybSc7CmltcG9ydCB7IHJhbmRvbUhleCB9IGZyb20gJ0BzcmMvbGliL2NyeXB0JzsKaW1wb3J0IHsgQWN0aW9uU3RhdHVzLCBEZXZpY2VQbGF0Zm9ybSwgRGV2aWNlVHlwZSB9IGZyb20gJ0BzcmMvdHlwZXMnOwppbXBvcnQgeyBERVZJQ0VfUkVHSVNURVIsIGRldmljZVJlZ2lzdGVyLCBkZXZpY2VVcGRhdGUsIERFVklDRV9VUERBVEUgfSBmcm9tICdAc3JjL2R1Y2tzL2RldmljZXMnOwppbXBvcnQgeyBTVEFSVCB9IGZyb20gJ0BzcmMvZHVja3MvYXV0aCc7CmltcG9ydCB7IFdJTkRPV19GT0NVUyB9IGZyb20gJ0BzcmMvZHVja3Mvd2luZG93JzsKaW1wb3J0IHsgcmVjb3JkRXZlbnQsIFVzZXJFdmVudHMgfSBmcm9tICdAc3JjL2xpYi9hbmFseXRpY3MnOwppbXBvcnQgeyBnZXRDb29raWVEb21haW4gfSBmcm9tICdAc3JjL2FwaS9iYXNlJzsKdmFyIHN0YXJ0VHJpZ2dlclJlZ2lzdGVyID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJAogICAgICAgIC5vZlR5cGUoU1RBUlQpCiAgICAgICAgLm1hcChmdW5jdGlvbiAoKSB7IHJldHVybiBkZXZpY2VSZWdpc3RlcihudWxsKTsgfSk7Cn07CnZhciB3aW5kb3dGb2N1c1RyaWdnZXJSZWdpc3RlciA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSwgZGVwcykgewogICAgcmV0dXJuIGFjdGlvbiQKICAgICAgICAub2ZUeXBlKFdJTkRPV19GT0NVUykKICAgICAgICAubWFwKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRldmljZVJlZ2lzdGVyKG51bGwpOyB9KTsKfTsKZXhwb3J0IHZhciB1cGRhdGVEZXZpY2VFcGljID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoREVWSUNFX1VQREFURSkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIHN0b3JlLmdldFN0YXRlKCkubG9nZ2VkSW47IH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBkZXBzLmRldmljZXMudXBkYXRlKGFjdGlvbi5tZXRhKQogICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChkZXZpY2UpIHsgcmV0dXJuIGRldmljZVVwZGF0ZShkZXZpY2UsIGRldmljZSk7IH0pCiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gT2JzZXJ2YWJsZS5vZihkZXZpY2VVcGRhdGUoYWN0aW9uLm1ldGEsIGUpKTsgfSk7CiAgICB9KTsKfTsKdmFyIHJlZ2lzdGVyRGV2aWNlID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlLCBkZXBzKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoREVWSUNFX1JFR0lTVEVSKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBzdG9yZS5nZXRTdGF0ZSgpLmxvZ2dlZEluICYmICFzdG9yZS5nZXRTdGF0ZSgpLnRmYU5lZWRlZCAmJiAhIXN0b3JlLmdldFN0YXRlKCkubWUuZGF0YTsKICAgIH0pCiAgICAgICAgLnRocm90dGxlVGltZSgzMDAwMDAgLyogNSBtaW51dGVzICovLCBkZXBzLnNjaGVkdWxlcikKICAgICAgICAuZG8oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVjb3JkRXZlbnQoVXNlckV2ZW50cy5PcGVuZWRBcHApOyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICAvLyBnZW5lcmF0ZSArIGNhY2hlIGRldmljZSBpZCBpbiBjb29raWUKICAgICAgICB2YXIgZGV2aWNlSWQgPSBDb29raWVzLmdldCgnZGV2aWNlSWQnKSB8fCAnJzsKICAgICAgICBpZiAoZGV2aWNlSWQubGVuZ3RoICE9PSAxNikgewogICAgICAgICAgICBkZXZpY2VJZCA9IHJhbmRvbUhleCgxNik7CiAgICAgICAgfQogICAgICAgIC8vIHNhdmUvcmVzZXQgY29va2llIGV4cGlyYXRpb24KICAgICAgICBDb29raWVzLnNldCgnZGV2aWNlSWQnLCBkZXZpY2VJZCwgeyBkb21haW46IGdldENvb2tpZURvbWFpbigpLCBleHBpcmVzOiAzNjUgfSk7CiAgICAgICAgLy8gZGV2aWNlIHVwYXRlcwogICAgICAgIHZhciBzb3VyY2VWZXJzaW9uID0gcHJvY2Vzcy5lbnYuU09VUkNFX1ZFUlNJT04uc3Vic3RyKDAsIDYpOwogICAgICAgIHZhciB1cGRhdGVkID0gewogICAgICAgICAgICBkZXZpY2VJZDogZGV2aWNlSWQsCiAgICAgICAgICAgIGxhc3RTZWVuOiBkZXBzLm5vdygpLAogICAgICAgICAgICBwbGF0Zm9ybTogRGV2aWNlUGxhdGZvcm0uV2ViLAogICAgICAgICAgICB0eXBlOiBEZXZpY2VUeXBlLkRlc2t0b3AsCiAgICAgICAgICAgIGJ1aWxkOiBzb3VyY2VWZXJzaW9uLAogICAgICAgICAgICBvczogcGxhdGZvcm0udWEgfHwgJ1Vua25vd24gVXNlciBBZ2VudCcsCiAgICAgICAgfTsKICAgICAgICAvLyBmaWd1cmUgb3V0IGRldmljZSB0eXBlIChvdGhlciB0aGFuIGRlc2t0b3ApCiAgICAgICAgaWYgKHBsYXRmb3JtLm9zICYmIHBsYXRmb3JtLm9zLmZhbWlseSkgewogICAgICAgICAgICBzd2l0Y2ggKHBsYXRmb3JtLm9zLmZhbWlseS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgICAgICAgICBjYXNlICdpcG9kJzoKICAgICAgICAgICAgICAgIGNhc2UgJ2lwaG9uZSc6CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlZC50eXBlID0gRGV2aWNlVHlwZS5Nb2JpbGU7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICdpcGFkJzoKICAgICAgICAgICAgICAgICAgICB1cGRhdGVkLnR5cGUgPSBEZXZpY2VUeXBlLlRhYmxldDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gSGFuZGxlIGVsZWN0cm9uCiAgICAgICAgaWYgKHdpbmRvdy5QTUVsZWN0cm9uQnJpZGdlICYmIHdpbmRvdy5QTUVsZWN0cm9uQnJpZGdlLm9zCiAgICAgICAgICAgICYmIHdpbmRvdy5QTUVsZWN0cm9uQnJpZGdlLnZlcnNpb24pIHsKICAgICAgICAgICAgaWYgKHdpbmRvdy5QTUVsZWN0cm9uQnJpZGdlLm9zID09PSAnbWFjb3MnKSB7CiAgICAgICAgICAgICAgICB1cGRhdGVkLnBsYXRmb3JtID0gRGV2aWNlUGxhdGZvcm0ubWFjT1M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAod2luZG93LlBNRWxlY3Ryb25CcmlkZ2Uub3MgPT09ICd3aW5kb3dzJykgewogICAgICAgICAgICAgICAgdXBkYXRlZC5wbGF0Zm9ybSA9IERldmljZVBsYXRmb3JtLldpbmRvd3M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlZC50eXBlID0gRGV2aWNlVHlwZS5EZXNrdG9wOwogICAgICAgICAgICB1cGRhdGVkLm9zID0gd2luZG93LlBNRWxlY3Ryb25CcmlkZ2Uub3M7CiAgICAgICAgICAgIGlmIChwbGF0Zm9ybS5vcykgewogICAgICAgICAgICAgICAgdXBkYXRlZC5vcyA9IHBsYXRmb3JtLm9zLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlZC5idWlsZCA9IHdpbmRvdy5QTUVsZWN0cm9uQnJpZGdlLnZlcnNpb24gKyAnLScgKyBzb3VyY2VWZXJzaW9uOwogICAgICAgIH0KICAgICAgICAvLyB1cGRhdGUgZXhpc3RpbmcgZGV2aWNlIG9yIGNyZWF0ZSBhIG5ldyBvbmUKICAgICAgICB2YXIgZmlsdGVyZWREZXZpY2VzID0gc3RvcmUuZ2V0U3RhdGUoKQogICAgICAgICAgICAuZGV2aWNlcy5maWx0ZXIoZnVuY3Rpb24gKGRldmljZSkgeyByZXR1cm4gZGV2aWNlLmRldmljZUlkID09PSBkZXZpY2VJZDsgfSk7CiAgICAgICAgdmFyIG5ld0RldmljZSA9IGZpbHRlcmVkRGV2aWNlcy5sZW5ndGggPT09IDAgPyBfX2Fzc2lnbih7fSwgdXBkYXRlZCkgOiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZmlsdGVyZWREZXZpY2VzWzBdKSwgdXBkYXRlZCk7CiAgICAgICAgLy8gcmVtb3ZlIG5vdGlmaWNhdGlvbnMgcHJvcGVydHkKICAgICAgICBkZWxldGUgbmV3RGV2aWNlLm5vdGlmaWNhdGlvbnM7CiAgICAgICAgdmFyIHJlcXVlc3QgPSBmaWx0ZXJlZERldmljZXMubGVuZ3RoID09PSAwID8KICAgICAgICAgICAgZGVwcy5kZXZpY2VzLmNyZWF0ZShuZXdEZXZpY2UpCiAgICAgICAgICAgIDogZGVwcy5kZXZpY2VzLnVwZGF0ZShuZXdEZXZpY2UpOwogICAgICAgIHJldHVybiByZXF1ZXN0CiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGRldmljZSkgeyByZXR1cm4gZGV2aWNlUmVnaXN0ZXIobnVsbCwgZGV2aWNlKTsgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKGRldmljZVJlZ2lzdGVyKG51bGwsIGUpKTsgfSk7CiAgICB9KTsKfTsKZXhwb3J0IGRlZmF1bHQgWwogICAgc3RhcnRUcmlnZ2VyUmVnaXN0ZXIsCiAgICB3aW5kb3dGb2N1c1RyaWdnZXJSZWdpc3RlciwKICAgIHJlZ2lzdGVyRGV2aWNlLAogICAgdXBkYXRlRGV2aWNlRXBpYywKXTsK"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/devices.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/devices.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable } from 'rxjs';\nimport { Epic } from 'redux-observable';\nimport Cookies from 'js-cookie';\nimport platform from 'platform';\n\nimport { Deps } from '@src/lib/epic';\nimport { randomHex } from '@src/lib/crypt';\n\nimport { Action, StoreState, ActionStatus, Device, DevicePlatform, DeviceType } from '@src/types';\nimport { DEVICE_REGISTER, deviceRegister, deviceUpdate, DEVICE_UPDATE } from '@src/ducks/devices';\nimport { START } from '@src/ducks/auth';\nimport { WINDOW_FOCUS } from '@src/ducks/window';\nimport { recordEvent, UserEvents } from '@src/lib/analytics';\nimport { getCookieDomain } from '@src/api/base';\n\nconst startTriggerRegister: Epic<Action<null, Device>, StoreState, Deps> =\n  (action$, store, deps) =>\n    action$\n      .ofType(START)\n      .map(() => deviceRegister(null));\n\nconst windowFocusTriggerRegister: Epic<Action<null, Device>, StoreState, Deps> =\n  (action$, store, deps) =>\n    action$\n      .ofType(WINDOW_FOCUS)\n      .map(() => deviceRegister(null));\n\nexport const updateDeviceEpic: Epic<Action<Device, Device>, StoreState, Deps> =\n(action$, store, deps) =>\n  action$.ofType(DEVICE_UPDATE)\n    .filter(action => action.status === ActionStatus.Start)\n    .filter(action => store.getState().loggedIn)\n    .flatMap(action =>\n      deps.devices.update(action.meta)\n        .map(device => deviceUpdate(device, device))\n        .catch((e: Error) => Observable.of(deviceUpdate(action.meta, e))),\n  );\n\nconst registerDevice: Epic<Action<null, Device>, StoreState, Deps> =\n  (action$, store, deps) =>\n    action$.ofType(DEVICE_REGISTER)\n      .filter(action => action.status === ActionStatus.Start)\n      .filter(action =>\n        store.getState().loggedIn && !store.getState().tfaNeeded && !!store.getState().me.data,\n      )\n      .throttleTime(300000 /* 5 minutes */, deps.scheduler)\n      .do(() => recordEvent(UserEvents.OpenedApp))\n      .flatMap((action) => {\n        // generate + cache device id in cookie\n        let deviceId = Cookies.get('deviceId') || '';\n        if (deviceId.length !== 16) {\n          deviceId = randomHex(16);\n        }\n\n        // save/reset cookie expiration\n        Cookies.set(\n          'deviceId',\n          deviceId,\n          { domain: getCookieDomain(), expires: 365 },\n        );\n\n        // device upates\n        const sourceVersion = process.env.SOURCE_VERSION!.substr(0, 6);\n        const updated: Partial<Device> = {\n          deviceId,\n          lastSeen: deps.now(),\n          platform: DevicePlatform.Web,\n          type: DeviceType.Desktop,\n          build: sourceVersion,\n          os: platform.ua || 'Unknown User Agent',\n        };\n\n        // figure out device type (other than desktop)\n        if (platform.os && platform.os.family) {\n          switch (platform.os.family.toLowerCase()) {\n            case 'ipod':\n            case 'iphone':\n              updated.type = DeviceType.Mobile;\n              break;\n            case 'ipad':\n              updated.type = DeviceType.Tablet;\n              break;\n            default:\n              break;\n          }\n        }\n\n        // Handle electron\n        if (window.PMElectronBridge && window.PMElectronBridge.os\n          && window.PMElectronBridge.version) {\n          if (window.PMElectronBridge.os === 'macos') {\n            updated.platform = DevicePlatform.macOS;\n          } else if (window.PMElectronBridge.os === 'windows') {\n            updated.platform = DevicePlatform.Windows;\n          }\n          updated.type = DeviceType.Desktop;\n          updated.os = window.PMElectronBridge.os;\n          if (platform.os) {\n            updated.os = platform.os.toString();\n          }\n          updated.build = window.PMElectronBridge.version + '-' + sourceVersion;\n        }\n\n        // update existing device or create a new one\n        const filteredDevices = store.getState()\n          .devices.filter(device => device.deviceId === deviceId);\n        const newDevice = filteredDevices.length === 0 ?\n          { ...updated } : { ...filteredDevices[0], ...updated };\n\n        // remove notifications property\n        delete (newDevice as any).notifications;\n\n        const request = filteredDevices.length === 0 ?\n          deps.devices.create(newDevice as any)\n            : deps.devices.update(newDevice as Device);\n\n        return request\n          .map(device => deviceRegister(null, device))\n          .catch(e => Observable.of(deviceRegister(null, e)));\n      });\n\nexport default [\n  startTriggerRegister,\n  windowFocusTriggerRegister,\n  registerDevice,\n  updateDeviceEpic,\n];\n"]}]}