{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/components/ShareThreadPopover/components/ShareToSlack/components/SlackMessageEditor/SlackMessageEditor.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/components/ShareThreadPopover/components/ShareToSlack/components/SlackMessageEditor/SlackMessageEditor.tsx","mtime":1675280254043},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCBjbGFzc25hbWVzIGZyb20gJ2NsYXNzbmFtZXMnOwppbXBvcnQgeyBLZXlDb2RlIH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCB7IEVkaXRvciwgRWRpdG9yU3RhdGUsIGdldERlZmF1bHRLZXlCaW5kaW5nLCBDb21wb3NpdGVEZWNvcmF0b3IsIE1vZGlmaWVyLCB9IGZyb20gJ2RyYWZ0LWpzJzsKaW1wb3J0ICcuL1NsYWNrTWVzc2FnZUVkaXRvci5zY3NzJzsKaW1wb3J0IFNsYWNrVHlwZWFoZWFkUG9wb3ZlciBmcm9tICcuL1NsYWNrVHlwZWFoZWFkUG9wb3Zlci9TbGFja1R5cGVhaGVhZFBvcG92ZXInOwppbXBvcnQgeyBkZWJvdW5jZSB9IGZyb20gJ2xvZGFzaCc7CmltcG9ydCBDaGFubmVsVG9rZW4gZnJvbSAnLi9DaGFubmVsVG9rZW4vQ2hhbm5lbFRva2VuJzsKaW1wb3J0IE1lbnRpb25Ub2tlbiBmcm9tICcuL01lbnRpb25Ub2tlbi9NZW50aW9uVG9rZW4nOwp2YXIgU2xhY2tNZXNzYWdlRWRpdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewogICAgX19leHRlbmRzKFNsYWNrTWVzc2FnZUVkaXRvciwgX3N1cGVyKTsKICAgIGZ1bmN0aW9uIFNsYWNrTWVzc2FnZUVkaXRvcihwcm9wcykgewogICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzOwogICAgICAgIF90aGlzLmhhbmRsZUNsaWNrT3V0c2lkZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBwb3BvdmVyU2hvd24gPSBfdGhpcy5zdGF0ZS5wb3BvdmVyU2hvd247CiAgICAgICAgICAgIGlmIChfdGhpcy5yZWYgJiYgX3RoaXMucG9wb3ZlciAmJiAhX3RoaXMucmVmLmNvbnRhaW5zKGUudGFyZ2V0KSAmJiBwb3BvdmVyU2hvd24pIHsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlRWRpdG9yUmVmID0gZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICBfdGhpcy5lZGl0b3IgPSByZWY7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVFZGl0b3JDaGFuZ2UgPSBmdW5jdGlvbiAoZWRpdG9yU3RhdGUpIHsKICAgICAgICAgICAgdmFyIF9hID0gX3RoaXMucHJvcHMsIG9uQ2hhbmdlID0gX2Eub25DaGFuZ2UsIG1lbWJlcnMgPSBfYS5tZW1iZXJzLCBjaGFubmVscyA9IF9hLmNoYW5uZWxzOwogICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkuZ2V0UGxhaW5UZXh0KCk7CiAgICAgICAgICAgIHZhciB3b3JkcyA9IG1lc3NhZ2Uuc3BsaXQoL1xzLyk7CiAgICAgICAgICAgIHZhciBxdWVyeSA9ICcnOwogICAgICAgICAgICB2YXIgbWF0Y2hlZE1lbWJlcnM7CiAgICAgICAgICAgIHZhciBtYXRjaGVkQ2hhbm5lbHM7CiAgICAgICAgICAgIHZhciBzaG93UG9wb3ZlciA9IGZhbHNlOwogICAgICAgICAgICBpZiAoIW1lc3NhZ2UubWF0Y2goL1xzJC8pICYmIHdvcmRzLmxlbmd0aCAmJiB3b3Jkc1t3b3Jkcy5sZW5ndGggLSAxXS5zdGFydHNXaXRoKCdAJykpIHsKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gd29yZHNbd29yZHMubGVuZ3RoIC0gMV0uc2xpY2UoMSk7CiAgICAgICAgICAgICAgICBpZiAobWVtYmVycy5kYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZE1lbWJlcnMgPSBtZW1iZXJzLmRhdGEuZmlsdGVyKGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsb3dlcmNhc2VRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmRpc3BsYXlOYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChsb3dlcmNhc2VRdWVyeSkgfHwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG0ucmVhbE5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKGxvd2VyY2FzZVF1ZXJ5KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlZE1lbWJlcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dQb3BvdmVyID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFtZXNzYWdlLm1hdGNoKC9ccyQvKSAmJiB3b3Jkcy5sZW5ndGggJiYgd29yZHNbd29yZHMubGVuZ3RoIC0gMV0uc3RhcnRzV2l0aCgnIycpKSB7CiAgICAgICAgICAgICAgICBxdWVyeSA9IHdvcmRzW3dvcmRzLmxlbmd0aCAtIDFdLnNsaWNlKDEpOwogICAgICAgICAgICAgICAgaWYgKGNoYW5uZWxzLmRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBtYXRjaGVkQ2hhbm5lbHMgPSBjaGFubmVscy5kYXRhLmZpbHRlcihmdW5jdGlvbiAoYykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG93ZXJjYXNlUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYy5uYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChsb3dlcmNhc2VRdWVyeSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZWRDaGFubmVscy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1BvcG92ZXIgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgbmV3U3RhdGUgPSB7IGVkaXRvclN0YXRlOiBlZGl0b3JTdGF0ZSB9OwogICAgICAgICAgICBpZiAobWVzc2FnZSAhPT0gX3RoaXMuc3RhdGUuZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKS5nZXRQbGFpblRleHQoKSkgewogICAgICAgICAgICAgICAgb25DaGFuZ2UoX3RoaXMuZ2V0U2xhY2tNZXNzYWdlKGVkaXRvclN0YXRlKSk7CiAgICAgICAgICAgICAgICBuZXdTdGF0ZS5jaGFubmVscyA9IG1hdGNoZWRDaGFubmVscyB8fCBbXTsKICAgICAgICAgICAgICAgIG5ld1N0YXRlLm1lbWJlcnMgPSBtYXRjaGVkTWVtYmVycyB8fCBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2hvd1BvcG92ZXIgJiYgIV90aGlzLnN0YXRlLnBvcG92ZXJTaG93bikgewogICAgICAgICAgICAgICAgX3RoaXMucG9wb3ZlclNob3dEZWJvdW5jZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghc2hvd1BvcG92ZXIgJiYgX3RoaXMuc3RhdGUucG9wb3ZlclNob3duKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyU2hvd0RlYm91bmNlLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgX3RoaXMucG9wb3Zlci5oaWRlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUobmV3U3RhdGUpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlS2V5QmluZGluZyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7CiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGUuRW50ZXI6CiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLnBvcG92ZXJTaG93bikgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3NlbGVjdCc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghZS5zaGlmdEtleSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ3Bvc3QtbWVzc2FnZSc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSBLZXlDb2RlLlVwOiB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZWQgPSBfdGhpcy5oYW5kbGVVcEFycm93KGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAncG0tdXAtYXJyb3cnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgS2V5Q29kZS5Eb3duOiB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZWQgPSBfdGhpcy5oYW5kbGVEb3duQXJyb3coZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdwbS1kb3duLWFycm93JzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGUuRXNjOiB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZWQgPSBfdGhpcy5oYW5kbGVFc2NhcGUoZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdwbS1lc2NhcGUnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGdldERlZmF1bHRLZXlCaW5kaW5nKGUpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuZ2V0U2xhY2tNZXNzYWdlID0gZnVuY3Rpb24gKGVkaXRvclN0YXRlKSB7CiAgICAgICAgICAgIHZhciBjb250ZW50U3RhdGUgPSBlZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpOwogICAgICAgICAgICB2YXIgc2VsZWN0aW9uU3RhdGUgPSBlZGl0b3JTdGF0ZS5nZXRTZWxlY3Rpb24oKTsKICAgICAgICAgICAgdmFyIGVudGl0eUtleTsKICAgICAgICAgICAgdmFyIGVudGl0eTsKICAgICAgICAgICAgdmFyIGxhc3RLZXk7CiAgICAgICAgICAgIHZhciBzdGFydDsKICAgICAgICAgICAgdmFyIGVuZDsKICAgICAgICAgICAgdmFyIGkgPSAwOwogICAgICAgICAgICB2YXIgdXBkYXRlZCA9IHt9OwogICAgICAgICAgICB3aGlsZSAoaSA8IGNvbnRlbnRTdGF0ZS5nZXRMYXN0QmxvY2soKS5nZXRUZXh0KCkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBlbnRpdHlLZXkgPSBjb250ZW50U3RhdGUuZ2V0TGFzdEJsb2NrKCkuZ2V0RW50aXR5QXQoaSk7CiAgICAgICAgICAgICAgICBpICs9IDE7CiAgICAgICAgICAgICAgICBpZiAobGFzdEtleSAmJiBzdGFydCAhPT0gdW5kZWZpbmVkICYmIGVuZCAhPT0gdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgJiYgbGFzdEtleSAhPT0gZW50aXR5S2V5ICYmICF1cGRhdGVkW2xhc3RLZXldKSB7CiAgICAgICAgICAgICAgICAgICAgc2VsZWN0aW9uU3RhdGUgPSBzZWxlY3Rpb25TdGF0ZS5tZXJnZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvck9mZnNldDogc3RhcnQgLSAxLAogICAgICAgICAgICAgICAgICAgICAgICBmb2N1c09mZnNldDogZW5kLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGVudGl0eSA9IGNvbnRlbnRTdGF0ZS5nZXRFbnRpdHkobGFzdEtleSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9hID0gZW50aXR5LmdldERhdGEoKSwgaWQgPSBfYS5pZCwgbmFtZSA9IF9hLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgY29udGVudFN0YXRlID0gTW9kaWZpZXIucmVwbGFjZVRleHQoY29udGVudFN0YXRlLCBzZWxlY3Rpb25TdGF0ZSwgZW50aXR5LmdldFR5cGUoKSA9PT0gJ0NIQU5ORUwnID8KICAgICAgICAgICAgICAgICAgICAgICAgIjwjIiArIGlkICsgInwiICsgbmFtZSArICI+IiA6ICI8QCIgKyBpZCArICI+IiwgdW5kZWZpbmVkLCBsYXN0S2V5KTsKICAgICAgICAgICAgICAgICAgICAvLyByZXNldAogICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRbbGFzdEtleV0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGxhc3RLZXkgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICAgICAgZW5kID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFlbnRpdHlLZXkpIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghbGFzdEtleSAmJiAhdXBkYXRlZFtlbnRpdHlLZXldKSB7CiAgICAgICAgICAgICAgICAgICAgbGFzdEtleSA9IGVudGl0eUtleTsKICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobGFzdEtleSAmJiBsYXN0S2V5ID09PSBlbnRpdHlLZXkpIHsKICAgICAgICAgICAgICAgICAgICBlbmQgPSBpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsYXN0S2V5ICYmIHN0YXJ0ICE9PSB1bmRlZmluZWQgJiYgZW5kICE9PSB1bmRlZmluZWQKICAgICAgICAgICAgICAgICYmICF1cGRhdGVkW2xhc3RLZXldKSB7CiAgICAgICAgICAgICAgICBzZWxlY3Rpb25TdGF0ZSA9IHNlbGVjdGlvblN0YXRlLm1lcmdlKHsKICAgICAgICAgICAgICAgICAgICBhbmNob3JPZmZzZXQ6IHN0YXJ0IC0gMSwKICAgICAgICAgICAgICAgICAgICBmb2N1c09mZnNldDogZW5kLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbnRpdHkgPSBjb250ZW50U3RhdGUuZ2V0RW50aXR5KGxhc3RLZXkpOwogICAgICAgICAgICAgICAgdmFyIF9iID0gZW50aXR5LmdldERhdGEoKSwgaWQgPSBfYi5pZCwgbmFtZSA9IF9iLm5hbWU7CiAgICAgICAgICAgICAgICBjb250ZW50U3RhdGUgPSBNb2RpZmllci5yZXBsYWNlVGV4dChjb250ZW50U3RhdGUsIHNlbGVjdGlvblN0YXRlLCBlbnRpdHkuZ2V0VHlwZSgpID09PSAnQ0hBTk5FTCcgPwogICAgICAgICAgICAgICAgICAgICI8IyIgKyBpZCArICJ8IiArIG5hbWUgKyAiPiIgOiAiPEAiICsgaWQgKyAiPiIsIHVuZGVmaW5lZCwgbGFzdEtleSk7CiAgICAgICAgICAgICAgICAvLyByZXNldAogICAgICAgICAgICAgICAgdXBkYXRlZFtsYXN0S2V5XSA9IHRydWU7CiAgICAgICAgICAgICAgICBsYXN0S2V5ID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgc3RhcnQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBlbmQgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnRTdGF0ZS5nZXRQbGFpblRleHQoKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUtleUNvbW1hbmQgPSBmdW5jdGlvbiAoY29tbWFuZCkgewogICAgICAgICAgICB2YXIgb25Qb3N0TWVzc2FnZSA9IF90aGlzLnByb3BzLm9uUG9zdE1lc3NhZ2U7CiAgICAgICAgICAgIGlmIChjb21tYW5kID09PSAncG9zdC1tZXNzYWdlJykgewogICAgICAgICAgICAgICAgb25Qb3N0TWVzc2FnZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuICdoYW5kbGVkJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29tbWFuZCA9PT0gJ3NlbGVjdCcpIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpcy5zdGF0ZS5tZW1iZXJzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXIuaGFuZGxlTWVtYmVyU2VsZWN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLm9uU2VsZWN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ2hhbmRsZWQnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEN1c3RvbSBoYW5kbGVycyBmb3Iga2V5IGNvbW1hbmRzCiAgICAgICAgICAgIHN3aXRjaCAoY29tbWFuZCkgewogICAgICAgICAgICAgICAgY2FzZSAncG0tdXAtYXJyb3cnOgogICAgICAgICAgICAgICAgY2FzZSAncG0tZG93bi1hcnJvdyc6CiAgICAgICAgICAgICAgICBjYXNlICdwbS1lc2NhcGUnOgogICAgICAgICAgICAgICAgICAgIHJldHVybiAnaGFuZGxlZCc7CiAgICAgICAgICAgICAgICBkZWZhdWx0OiBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJ25vdC1oYW5kbGVkJzsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUhvdEtleXMgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQ2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgZWRpdG9yU3RhdGUgPSBfdGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZTsKICAgICAgICAgICAgaWYgKCFlZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpLmdldFBsYWluVGV4dCgpKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5lZGl0b3IuZm9jdXMoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlU2hvdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgcG9wb3ZlclNob3duOiB0cnVlLAogICAgICAgICAgICAgICAgZWRpdG9yU3RhdGU6IEVkaXRvclN0YXRlLm1vdmVGb2N1c1RvRW5kKF90aGlzLnN0YXRlLmVkaXRvclN0YXRlKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVIaWRlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBwb3BvdmVyU2hvd246IGZhbHNlLAogICAgICAgICAgICAgICAgZWRpdG9yU3RhdGU6IEVkaXRvclN0YXRlLm1vdmVGb2N1c1RvRW5kKF90aGlzLnN0YXRlLmVkaXRvclN0YXRlKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVQb3BvdmVyUmVmID0gZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICBfdGhpcy5wb3BvdmVyID0gcmVmOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlUmVmID0gZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICBfdGhpcy5yZWYgPSByZWY7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVVcEFycm93ID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLnBvcG92ZXJTaG93bikgewogICAgICAgICAgICAgICAgX3RoaXMucG9wb3Zlci51cEFycm93KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVEb3duQXJyb3cgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUucG9wb3ZlclNob3duKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLmRvd25BcnJvdygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlRXNjYXBlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKF90aGlzLnN0YXRlLnBvcG92ZXJTaG93bikgewogICAgICAgICAgICAgICAgX3RoaXMucG9wb3ZlclNob3dEZWJvdW5jZS5jYW5jZWwoKTsKICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXIuaGlkZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlQ2hhbm5lbFNlbGVjdCA9IGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICAgIHZhciBlZGl0b3JTdGF0ZSA9IF90aGlzLnN0YXRlLmVkaXRvclN0YXRlOwogICAgICAgICAgICBlZGl0b3JTdGF0ZSA9IEVkaXRvclN0YXRlLm1vdmVTZWxlY3Rpb25Ub0VuZChlZGl0b3JTdGF0ZSk7CiAgICAgICAgICAgIHZhciB0ZXh0ID0gZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKS5nZXRMYXN0QmxvY2soKS5nZXRUZXh0KCk7CiAgICAgICAgICAgIHZhciBzZWxlY3Rpb25TdGF0ZSA9IGVkaXRvclN0YXRlLmdldFNlbGVjdGlvbigpOwogICAgICAgICAgICB2YXIgc3RhcnQgPSBzZWxlY3Rpb25TdGF0ZS5nZXRTdGFydE9mZnNldCgpOwogICAgICAgICAgICB2YXIgZW5kID0gc2VsZWN0aW9uU3RhdGUuZ2V0RW5kT2Zmc2V0KCk7CiAgICAgICAgICAgIHdoaWxlICh0ZXh0LmNoYXJBdChzdGFydCkgIT09ICcjJyAmJiBzdGFydCA+IDApIHsKICAgICAgICAgICAgICAgIHN0YXJ0IC09IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZWN0aW9uU3RhdGUgPSBzZWxlY3Rpb25TdGF0ZS5tZXJnZSh7CiAgICAgICAgICAgICAgICBhbmNob3JPZmZzZXQ6IHN0YXJ0LAogICAgICAgICAgICAgICAgZm9jdXNPZmZzZXQ6IGVuZCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBjb250ZW50U3RhdGUgPSBlZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpLmNyZWF0ZUVudGl0eSgnQ0hBTk5FTCcsICdJTU1VVEFCTEUnLCB7CiAgICAgICAgICAgICAgICBpZDogYy5pZCwKICAgICAgICAgICAgICAgIG5hbWU6IGMubmFtZSwKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnRlbnRTdGF0ZSA9IE1vZGlmaWVyLnJlcGxhY2VUZXh0KGVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCksIHNlbGVjdGlvblN0YXRlLCAiIyIgKyBjLm5hbWUsIHVuZGVmaW5lZCwgY29udGVudFN0YXRlLmdldExhc3RDcmVhdGVkRW50aXR5S2V5KCkpOwogICAgICAgICAgICBlZGl0b3JTdGF0ZSA9IEVkaXRvclN0YXRlLnB1c2goZWRpdG9yU3RhdGUsIGNvbnRlbnRTdGF0ZSwgJ2FwcGx5LWVudGl0eScpOwogICAgICAgICAgICBlZGl0b3JTdGF0ZSA9IEVkaXRvclN0YXRlLnNldChlZGl0b3JTdGF0ZSwgeyBkZWNvcmF0b3I6IF90aGlzLmNvbXBvc2l0ZURlY29yYXRvciB9KTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgZWRpdG9yU3RhdGU6IGVkaXRvclN0YXRlLAogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5lZGl0b3IuZm9jdXMoKTsKICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLm9uQ2hhbmdlKF90aGlzLmdldFNsYWNrTWVzc2FnZShlZGl0b3JTdGF0ZSkpOwogICAgICAgICAgICAgICAgX3RoaXMuaW5zZXJ0U3BhY2UoKTsKICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXJTaG93RGVib3VuY2UuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLmhpZGUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5pbnNlcnRTcGFjZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNwYWNlQ2hhcmFjdGVyID0gJyAnOwogICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gX3RoaXMuc3RhdGUuZWRpdG9yU3RhdGU7CiAgICAgICAgICAgIHZhciBuZXdDb250ZW50U3RhdGUgPSBNb2RpZmllci5yZXBsYWNlVGV4dChjdXJyZW50U3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKSwgY3VycmVudFN0YXRlLmdldFNlbGVjdGlvbigpLCBzcGFjZUNoYXJhY3Rlcik7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGVkaXRvclN0YXRlOiBFZGl0b3JTdGF0ZS5wdXNoKGN1cnJlbnRTdGF0ZSwgbmV3Q29udGVudFN0YXRlLCAnaW5zZXJ0LWNoYXJhY3RlcnMnKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVNZW1iZXJTZWxlY3QgPSBmdW5jdGlvbiAobSkgewogICAgICAgICAgICB2YXIgZWRpdG9yU3RhdGUgPSBfdGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZTsKICAgICAgICAgICAgZWRpdG9yU3RhdGUgPSBFZGl0b3JTdGF0ZS5tb3ZlU2VsZWN0aW9uVG9FbmQoZWRpdG9yU3RhdGUpOwogICAgICAgICAgICB2YXIgdGV4dCA9IGVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkuZ2V0TGFzdEJsb2NrKCkuZ2V0VGV4dCgpOwogICAgICAgICAgICB2YXIgc2VsZWN0aW9uU3RhdGUgPSBlZGl0b3JTdGF0ZS5nZXRTZWxlY3Rpb24oKTsKICAgICAgICAgICAgdmFyIHN0YXJ0ID0gc2VsZWN0aW9uU3RhdGUuZ2V0U3RhcnRPZmZzZXQoKTsKICAgICAgICAgICAgdmFyIGVuZCA9IHNlbGVjdGlvblN0YXRlLmdldEVuZE9mZnNldCgpOwogICAgICAgICAgICB3aGlsZSAodGV4dC5jaGFyQXQoc3RhcnQpICE9PSAnQCcgJiYgc3RhcnQgPiAwKSB7CiAgICAgICAgICAgICAgICBzdGFydCAtPSAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGVjdGlvblN0YXRlID0gc2VsZWN0aW9uU3RhdGUubWVyZ2UoewogICAgICAgICAgICAgICAgYW5jaG9yT2Zmc2V0OiBzdGFydCwKICAgICAgICAgICAgICAgIGZvY3VzT2Zmc2V0OiBlbmQsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgY29udGVudFN0YXRlID0gZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKS5jcmVhdGVFbnRpdHkoJ01FTlRJT04nLCAnSU1NVVRBQkxFJywgewogICAgICAgICAgICAgICAgaWQ6IG0uaWQsCiAgICAgICAgICAgICAgICBuYW1lOiBtLmRpc3BsYXlOYW1lLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29udGVudFN0YXRlID0gTW9kaWZpZXIucmVwbGFjZVRleHQoZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKSwgc2VsZWN0aW9uU3RhdGUsICJAIiArIG0uZGlzcGxheU5hbWUsIHVuZGVmaW5lZCwgY29udGVudFN0YXRlLmdldExhc3RDcmVhdGVkRW50aXR5S2V5KCkpOwogICAgICAgICAgICBlZGl0b3JTdGF0ZSA9IEVkaXRvclN0YXRlLnB1c2goZWRpdG9yU3RhdGUsIGNvbnRlbnRTdGF0ZSwgJ2FwcGx5LWVudGl0eScpOwogICAgICAgICAgICBlZGl0b3JTdGF0ZSA9IEVkaXRvclN0YXRlLnNldChlZGl0b3JTdGF0ZSwgeyBkZWNvcmF0b3I6IF90aGlzLmNvbXBvc2l0ZURlY29yYXRvciB9KTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgZWRpdG9yU3RhdGU6IGVkaXRvclN0YXRlLAogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5lZGl0b3IuZm9jdXMoKTsKICAgICAgICAgICAgICAgIF90aGlzLnByb3BzLm9uQ2hhbmdlKF90aGlzLmdldFNsYWNrTWVzc2FnZShlZGl0b3JTdGF0ZSkpOwogICAgICAgICAgICAgICAgX3RoaXMuaW5zZXJ0U3BhY2UoKTsKICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXJTaG93RGVib3VuY2UuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLmhpZGUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVTdHJhdGVneSA9IGZ1bmN0aW9uIChjb250ZW50QmxvY2ssIGNhbGxiYWNrLCBjb250ZW50U3RhdGUpIHsKICAgICAgICAgICAgY29udGVudEJsb2NrLmZpbmRFbnRpdHlSYW5nZXMoZnVuY3Rpb24gKGNoYXJhY3RlcikgewogICAgICAgICAgICAgICAgdmFyIGVudGl0eUtleSA9IGNoYXJhY3Rlci5nZXRFbnRpdHkoKTsKICAgICAgICAgICAgICAgIGlmIChlbnRpdHlLZXkgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY29udGVudFN0YXRlLmdldEVudGl0eShlbnRpdHlLZXkpLmdldFR5cGUoKSA9PT0gJ0NIQU5ORUwnIHx8CiAgICAgICAgICAgICAgICAgICAgY29udGVudFN0YXRlLmdldEVudGl0eShlbnRpdHlLZXkpLmdldFR5cGUoKSA9PT0gJ01FTlRJT04nOwogICAgICAgICAgICB9LCBjYWxsYmFjayk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5jb21wb3NpdGVEZWNvcmF0b3IgPSBuZXcgQ29tcG9zaXRlRGVjb3JhdG9yKFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3RyYXRlZ3k6IF90aGlzLmhhbmRsZVN0cmF0ZWd5LAogICAgICAgICAgICAgICAgY29tcG9uZW50OiBDaGFubmVsVG9rZW4sCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHN0cmF0ZWd5OiBfdGhpcy5oYW5kbGVTdHJhdGVneSwKICAgICAgICAgICAgICAgIGNvbXBvbmVudDogTWVudGlvblRva2VuLAogICAgICAgICAgICB9LAogICAgICAgIF0pOwogICAgICAgIF90aGlzLnBvcG92ZXJTaG93RGVib3VuY2UgPSBkZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5wb3BvdmVyICYmICFfdGhpcy5zdGF0ZS5wb3BvdmVyU2hvd24pIHsKICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXIuc2hvdygpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgMTAwKTsKICAgICAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgICAgICAgZWRpdG9yU3RhdGU6IEVkaXRvclN0YXRlLmNyZWF0ZUVtcHR5KCksCiAgICAgICAgICAgIGNoYW5uZWxzOiBwcm9wcy5jaGFubmVscy5kYXRhIHx8IFtdLAogICAgICAgICAgICBtZW1iZXJzOiBwcm9wcy5tZW1iZXJzLmRhdGEgfHwgW10sCiAgICAgICAgICAgIHBvcG92ZXJTaG93bjogZmFsc2UsCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICB9CiAgICBTbGFja01lc3NhZ2VFZGl0b3IucHJvdG90eXBlLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzID0gZnVuY3Rpb24gKG5leHRQcm9wcykgewogICAgICAgIGlmIChuZXh0UHJvcHMuY2hhbm5lbHMgIT09IHRoaXMucHJvcHMuY2hhbm5lbHMgfHwKICAgICAgICAgICAgbmV4dFByb3BzLm1lbWJlcnMgIT09IHRoaXMucHJvcHMubWVtYmVycykgewogICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGNoYW5uZWxzOiBuZXh0UHJvcHMuY2hhbm5lbHMuZGF0YSB8fCBbXSwKICAgICAgICAgICAgICAgIG1lbWJlcnM6IG5leHRQcm9wcy5tZW1iZXJzLmRhdGEgfHwgW10sCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH07CiAgICBTbGFja01lc3NhZ2VFZGl0b3IucHJvdG90eXBlLmNvbXBvbmVudERpZE1vdW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuaGFuZGxlQ2xpY2tPdXRzaWRlKTsKICAgIH07CiAgICBTbGFja01lc3NhZ2VFZGl0b3IucHJvdG90eXBlLmNvbXBvbmVudFdpbGxVbm1vdW50ID0gZnVuY3Rpb24gKCkgewogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuaGFuZGxlQ2xpY2tPdXRzaWRlKTsKICAgIH07CiAgICBTbGFja01lc3NhZ2VFZGl0b3IucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgX2EgPSB0aGlzLnN0YXRlLCBlZGl0b3JTdGF0ZSA9IF9hLmVkaXRvclN0YXRlLCBjaGFubmVscyA9IF9hLmNoYW5uZWxzLCBtZW1iZXJzID0gX2EubWVtYmVyczsKICAgICAgICB2YXIgaXNFbXB0eSA9ICEhZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKS5nZXRQbGFpblRleHQoKTsKICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiBjbGFzc25hbWVzKCdzbGFjay1tZXNzYWdlLWVkaXRvcicsIHsKICAgICAgICAgICAgICAgICdoaWRlLXBsYWNlaG9sZGVyJzogaXNFbXB0eSwKICAgICAgICAgICAgfSksIG9uS2V5RG93bjogdGhpcy5oYW5kbGVIb3RLZXlzLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUNsaWNrLCByZWY6IHRoaXMuaGFuZGxlUmVmIH0sCiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRWRpdG9yLCB7IG9uQ2hhbmdlOiB0aGlzLmhhbmRsZUVkaXRvckNoYW5nZSwgZWRpdG9yU3RhdGU6IGVkaXRvclN0YXRlLCBwbGFjZWhvbGRlcjogImFkZCBhIG1lc3NhZ2UuLiIsIHJlZjogdGhpcy5oYW5kbGVFZGl0b3JSZWYsIGtleUJpbmRpbmdGbjogdGhpcy5oYW5kbGVLZXlCaW5kaW5nLCBoYW5kbGVLZXlDb21tYW5kOiB0aGlzLmhhbmRsZUtleUNvbW1hbmQsIHRhYkluZGV4OiAwIH0pLAogICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFNsYWNrVHlwZWFoZWFkUG9wb3ZlciwgeyByZWY6IHRoaXMuaGFuZGxlUG9wb3ZlclJlZiwgY2hhbm5lbHM6IGNoYW5uZWxzLCBtZW1iZXJzOiBtZW1iZXJzLCBvbkhpZGU6IHRoaXMuaGFuZGxlSGlkZSwgb25TaG93OiB0aGlzLmhhbmRsZVNob3csIG9uTWVtYmVyU2VsZWN0OiB0aGlzLmhhbmRsZU1lbWJlclNlbGVjdCwgb25DaGFubmVsU2VsZWN0OiB0aGlzLmhhbmRsZUNoYW5uZWxTZWxlY3QgfSkpKTsKICAgIH07CiAgICByZXR1cm4gU2xhY2tNZXNzYWdlRWRpdG9yOwp9KFJlYWN0LlB1cmVDb21wb25lbnQpKTsKZXhwb3J0IGRlZmF1bHQgU2xhY2tNZXNzYWdlRWRpdG9yOwo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/components/ShareThreadPopover/components/ShareToSlack/components/SlackMessageEditor/SlackMessageEditor.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/components/ThreadDetail/components/ShareThreadPopover/components/ShareToSlack/components/SlackMessageEditor/SlackMessageEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport classnames from 'classnames';\nimport { KeyCode, Resource } from '@src/types';\nimport { SlackChannel, SlackMember } from '@src/types/slack';\nimport {\n  Editor,\n  EditorState,\n  getDefaultKeyBinding,\n  ContentBlock,\n  ContentState,\n  CompositeDecorator,\n  SelectionState,\n  Modifier,\n} from 'draft-js';\n\nimport './SlackMessageEditor.scss';\nimport SlackTypeaheadPopover from './SlackTypeaheadPopover/SlackTypeaheadPopover';\nimport { debounce } from 'lodash';\nimport ChannelToken from './ChannelToken/ChannelToken';\nimport MentionToken from './MentionToken/MentionToken';\n\nexport interface Props {\n  onPostMessage: () => void;\n  onChange: (msg: string) => void;\n  channels: Resource<SlackChannel[]>;\n  members: Resource<SlackMember[]>;\n}\n\ninterface State {\n  editorState: EditorState;\n  members: SlackMember[];\n  channels: SlackChannel[];\n  popoverShown: boolean;\n}\n\nclass SlackMessageEditor extends React.PureComponent<Props, State> {\n  editor: Editor;\n  popoverShowDebounce: any;\n  popover: SlackTypeaheadPopover;\n  ref: HTMLDivElement;\n  compositeDecorator: CompositeDecorator;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.compositeDecorator = new CompositeDecorator([\n      {\n        strategy: this.handleStrategy,\n        component: ChannelToken,\n      },\n      {\n        strategy: this.handleStrategy,\n        component: MentionToken,\n      },\n    ]);\n\n    this.popoverShowDebounce = debounce(\n      () => {\n        if (this.popover && !this.state.popoverShown) {\n          this.popover.show();\n        }\n      },\n      100,\n    );\n\n    this.state = {\n      editorState: EditorState.createEmpty(),\n      channels: props.channels.data || [],\n      members: props.members.data || [],\n      popoverShown: false,\n    };\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n    if (nextProps.channels !== this.props.channels ||\n      nextProps.members !== this.props.members) {\n      this.setState({\n        channels: nextProps.channels.data || [],\n        members: nextProps.members.data || [],\n      });\n    }\n  }\n\n  componentDidMount() {\n    document.addEventListener('mousedown', this.handleClickOutside);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousedown', this.handleClickOutside);\n  }\n\n  handleClickOutside = (e: KeyboardEvent) => {\n    const { popoverShown } = this.state;\n\n    if (this.ref && this.popover && !this.ref.contains(e.target as Node) && popoverShown) {\n      e.stopPropagation();\n      e.preventDefault();\n      this.popover.hide();\n    }\n  }\n\n  handleEditorRef = (ref: Editor) => {\n    this.editor = ref;\n  }\n\n  handleEditorChange = (editorState: EditorState) => {\n    const { onChange, members, channels } = this.props;\n    const message = editorState.getCurrentContent().getPlainText();\n    const words = message.split(/\\s/);\n    let query = '';\n    let matchedMembers;\n    let matchedChannels;\n    let showPopover = false;\n\n    if (!message.match(/\\s$/) && words.length && words[words.length - 1].startsWith('@')) {\n      query = words[words.length - 1].slice(1);\n\n      if (members.data) {\n        matchedMembers = members.data.filter((m) => {\n          const lowercaseQuery = query.toLowerCase();\n          return m.displayName.toLowerCase().startsWith(lowercaseQuery) ||\n            m.realName.toLowerCase().startsWith(lowercaseQuery);\n        });\n\n        if (matchedMembers.length) {\n          showPopover = true;\n        }\n      }\n    }\n\n    if (!message.match(/\\s$/) && words.length && words[words.length - 1].startsWith('#')) {\n      query = words[words.length - 1].slice(1);\n\n      if (channels.data) {\n        matchedChannels = channels.data.filter((c) => {\n          const lowercaseQuery = query.toLowerCase();\n          return c.name.toLowerCase().startsWith(lowercaseQuery);\n        });\n\n        if (matchedChannels.length) {\n          showPopover = true;\n        }\n      }\n    }\n\n    const newState: any = { editorState };\n    if (message !== this.state.editorState.getCurrentContent().getPlainText()) {\n      onChange(this.getSlackMessage(editorState));\n      newState.channels = matchedChannels || [];\n      newState.members = matchedMembers || [];\n    }\n\n    if (showPopover && !this.state.popoverShown) {\n      this.popoverShowDebounce();\n    }\n\n    if (!showPopover && this.state.popoverShown) {\n      this.popoverShowDebounce.cancel();\n      this.popover.hide();\n    }\n\n    this.setState(newState);\n  }\n\n  handleKeyBinding = (e: React.KeyboardEvent<HTMLElement>) => {\n    switch (e.keyCode) {\n      case KeyCode.Enter:\n        if (this.state.popoverShown) {\n          return 'select';\n        }\n\n        if (!e.shiftKey) {\n          return 'post-message';\n        }\n        break;\n      case KeyCode.Up: {\n        const handled = this.handleUpArrow(e);\n        if (handled) {\n          return 'pm-up-arrow';\n        }\n        break;\n      }\n      case KeyCode.Down: {\n        const handled = this.handleDownArrow(e);\n        if (handled) {\n          return 'pm-down-arrow';\n        }\n        break;\n      }\n      case KeyCode.Esc: {\n        const handled = this.handleEscape(e);\n        if (handled) {\n          return 'pm-escape';\n        }\n        break;\n      }\n      default:\n        break;\n    }\n\n    return getDefaultKeyBinding(e);\n  }\n\n  getSlackMessage = (editorState: EditorState) => {\n    let contentState = editorState.getCurrentContent();\n    let selectionState = editorState.getSelection();\n    let entityKey;\n    let entity;\n    let lastKey;\n    let start;\n    let end;\n    let i = 0;\n    const updated = {};\n\n    while (i < contentState.getLastBlock().getText().length) {\n      entityKey = contentState.getLastBlock().getEntityAt(i);\n      i += 1;\n      if (lastKey && start !== undefined && end !== undefined\n        && lastKey !== entityKey && !updated[lastKey]) {\n        selectionState = selectionState.merge({\n          anchorOffset: start - 1,\n          focusOffset: end,\n        }) as SelectionState;\n        entity = contentState.getEntity(lastKey);\n        const { id, name } = entity.getData();\n\n        contentState = Modifier.replaceText(\n          contentState,\n          selectionState,\n          entity.getType() === 'CHANNEL' ?\n            `<#${id}|${name}>` : `<@${id}>`,\n          undefined,\n          lastKey,\n        );\n\n        // reset\n        updated[lastKey] = true;\n        lastKey = undefined;\n        start = undefined;\n        end = undefined;\n      }\n\n      if (!entityKey) {\n        continue;\n      }\n\n      if (!lastKey && !updated[entityKey]) {\n        lastKey = entityKey;\n        start = i;\n      }\n\n      if (lastKey && lastKey === entityKey) {\n        end = i;\n      }\n    }\n\n    if (lastKey && start !== undefined && end !== undefined\n      && !updated[lastKey]) {\n      selectionState = selectionState.merge({\n        anchorOffset: start - 1,\n        focusOffset: end,\n      }) as SelectionState;\n      entity = contentState.getEntity(lastKey);\n      const { id, name } = entity.getData();\n\n      contentState = Modifier.replaceText(\n        contentState,\n        selectionState,\n        entity.getType() === 'CHANNEL' ?\n          `<#${id}|${name}>` : `<@${id}>`,\n        undefined,\n        lastKey,\n      );\n\n      // reset\n      updated[lastKey] = true;\n      lastKey = undefined;\n      start = undefined;\n      end = undefined;\n    }\n\n    return contentState.getPlainText();\n  }\n\n  handleKeyCommand = (command: string) => {\n    const { onPostMessage } = this.props;\n\n    if (command === 'post-message') {\n      onPostMessage();\n      return 'handled';\n    }\n\n    if (command === 'select') {\n      if (this.state.members.length) {\n        this.popover.handleMemberSelect();\n      } else {\n        this.popover.onSelect();\n      }\n      return 'handled';\n    }\n\n    // Custom handlers for key commands\n    switch (command) {\n      case 'pm-up-arrow':\n      case 'pm-down-arrow':\n      case 'pm-escape':\n        return 'handled';\n      default: break;\n    }\n\n    return 'not-handled';\n  }\n\n  handleHotKeys = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n  }\n\n  handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    const { editorState } = this.state;\n\n    if (!editorState.getCurrentContent().getPlainText()) {\n      this.editor.focus();\n    }\n  }\n\n  handleShow = () => {\n    this.setState({\n      popoverShown: true,\n      editorState: EditorState.moveFocusToEnd(this.state.editorState),\n    });\n  }\n\n  handleHide = () => {\n    this.setState({\n      popoverShown: false,\n      editorState: EditorState.moveFocusToEnd(this.state.editorState),\n    });\n  }\n\n  handlePopoverRef = (ref: SlackTypeaheadPopover) => {\n    this.popover = ref;\n  }\n\n  handleRef = (ref: HTMLDivElement) => {\n    this.ref = ref;\n  }\n\n  handleUpArrow = (e: React.KeyboardEvent<HTMLElement>): boolean => {\n    if (this.state.popoverShown) {\n      this.popover.upArrow();\n      return true;\n    }\n    return false;\n  }\n\n  handleDownArrow = (e: React.KeyboardEvent<HTMLElement>): boolean => {\n    if (this.state.popoverShown) {\n      this.popover.downArrow();\n      return true;\n    }\n    return false;\n  }\n\n  handleEscape = (e: React.KeyboardEvent<HTMLElement>): boolean => {\n    if (this.state.popoverShown) {\n      this.popoverShowDebounce.cancel();\n      this.popover.hide();\n      return true;\n    }\n    return false;\n  }\n\n  handleChannelSelect = (c: SlackChannel) => {\n    let editorState = this.state.editorState;\n    editorState = EditorState.moveSelectionToEnd(editorState);\n    const text = editorState.getCurrentContent().getLastBlock().getText();\n    let selectionState = editorState.getSelection();\n    let start = selectionState.getStartOffset();\n    const end = selectionState.getEndOffset();\n\n    while (text.charAt(start) !== '#' && start > 0) {\n      start -= 1;\n    }\n\n    selectionState = selectionState.merge({\n      anchorOffset: start,\n      focusOffset: end,\n    }) as SelectionState;\n    let contentState = editorState.getCurrentContent().createEntity('CHANNEL', 'IMMUTABLE', {\n      id: c.id,\n      name: c.name,\n    });\n\n    contentState = Modifier.replaceText(\n      editorState.getCurrentContent(),\n      selectionState,\n      `#${c.name}`,\n      undefined,\n      contentState.getLastCreatedEntityKey(),\n    );\n\n    editorState = EditorState.push(\n      editorState,\n      contentState,\n      'apply-entity',\n    );\n    editorState = EditorState.set(editorState, { decorator: this.compositeDecorator });\n\n    this.setState(\n      {\n        editorState,\n      },\n      () => {\n        this.editor.focus();\n        this.props.onChange(this.getSlackMessage(editorState));\n        this.insertSpace();\n        this.popoverShowDebounce.cancel();\n        this.popover.hide();\n      },\n    );\n  }\n\n  insertSpace = () => {\n    const spaceCharacter = ' ';\n\n    const currentState = this.state.editorState;\n    const newContentState = Modifier.replaceText(\n      currentState.getCurrentContent(),\n      currentState.getSelection(),\n      spaceCharacter,\n    );\n\n    this.setState({\n      editorState: EditorState.push(currentState, newContentState, 'insert-characters'),\n    });\n  }\n\n  handleMemberSelect = (m: SlackMember) => {\n    let editorState = this.state.editorState;\n    editorState = EditorState.moveSelectionToEnd(editorState);\n    const text = editorState.getCurrentContent().getLastBlock().getText();\n    let selectionState = editorState.getSelection();\n    let start = selectionState.getStartOffset();\n    const end = selectionState.getEndOffset();\n\n    while (text.charAt(start) !== '@' && start > 0) {\n      start -= 1;\n    }\n\n    selectionState = selectionState.merge({\n      anchorOffset: start,\n      focusOffset: end,\n    }) as SelectionState;\n    let contentState = editorState.getCurrentContent().createEntity('MENTION', 'IMMUTABLE', {\n      id: m.id,\n      name: m.displayName,\n    });\n\n    contentState = Modifier.replaceText(\n      editorState.getCurrentContent(),\n      selectionState,\n      `@${m.displayName}`,\n      undefined,\n      contentState.getLastCreatedEntityKey(),\n    );\n\n    editorState = EditorState.push(\n      editorState,\n      contentState,\n      'apply-entity',\n    );\n    editorState = EditorState.set(editorState, { decorator: this.compositeDecorator });\n\n    this.setState(\n      {\n        editorState,\n      },\n      () => {\n        this.editor.focus();\n        this.props.onChange(this.getSlackMessage(editorState));\n        this.insertSpace();\n        this.popoverShowDebounce.cancel();\n        this.popover.hide();\n      },\n    );\n  }\n\n  handleStrategy = (contentBlock: ContentBlock, callback: any, contentState: ContentState) => {\n    contentBlock.findEntityRanges(\n      (character) => {\n        const entityKey = character.getEntity();\n        if (entityKey === null) {\n          return false;\n        }\n        return contentState.getEntity(entityKey).getType() === 'CHANNEL' ||\n          contentState.getEntity(entityKey).getType() === 'MENTION';\n      },\n      callback,\n    );\n  }\n\n  render() {\n    const { editorState, channels, members } = this.state;\n    const isEmpty = !!editorState.getCurrentContent().getPlainText();\n\n    return (\n      <div\n        className={classnames('slack-message-editor', {\n          'hide-placeholder': isEmpty,\n        })}\n        onKeyDown={this.handleHotKeys}\n        onClick={this.handleClick}\n        ref={this.handleRef}\n      >\n        <Editor\n          onChange={this.handleEditorChange}\n          editorState={editorState}\n          placeholder=\"add a message..\"\n          ref={this.handleEditorRef}\n          keyBindingFn={this.handleKeyBinding}\n          handleKeyCommand={this.handleKeyCommand}\n          tabIndex={0}\n        />\n        <SlackTypeaheadPopover\n          ref={this.handlePopoverRef}\n          channels={channels}\n          members={members}\n          onHide={this.handleHide}\n          onShow={this.handleShow}\n          onMemberSelect={this.handleMemberSelect}\n          onChannelSelect={this.handleChannelSelect}\n        />\n      </div>\n    );\n  }\n}\n\nexport default SlackMessageEditor;\n"]}]}