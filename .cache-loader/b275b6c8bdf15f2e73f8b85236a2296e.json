{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/salesforce.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/salesforce.ts","mtime":1675280254051},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgewogICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHsKICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKQogICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfTsKICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9Owp2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oLCBfaiwgX2ssIF9sOwppbXBvcnQgdXBkYXRlIGZyb20gJ2ltbXV0YWJpbGl0eS1oZWxwZXInOwppbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7CmltcG9ydCB7IGNyZWF0ZSB9IGZyb20gJ0BzcmMvbGliL3JlZHV4JzsKaW1wb3J0IHsgY3JlYXRlU2VsZWN0b3IgfSBmcm9tICdAc3JjL2xpYi9zZWxlY3Rvcic7CmltcG9ydCB7IHJlc291cmNlT2ssIHJlc291cmNlTG9hZGluZywgcmVzb3VyY2VSZWZyZXNoaW5nLCByZXNvdXJjZUZhaWxlZCB9IGZyb20gJ0BzcmMvbGliL3Jlc291cmNlJzsKaW1wb3J0IHsgU09iamVjdEZpZWxkVHlwZSwgU2FsZXNmb3JjZVRhc2tTdGF0dXMsIH0gZnJvbSAnQHNyYy90eXBlcy9zYWxlc2ZvcmNlJzsKaW1wb3J0IHsgUmVzb3VyY2VTdGF0dXMgfSBmcm9tICdAc3JjL3R5cGVzJzsKaW1wb3J0IHsgY3JlYXRlRGVmYXVsdEhlYWRlcnMsIH0gZnJvbSAnQHNyYy9kdWNrcy9zZXF1ZW5jZVJlY2lwaWVudHMnOwpleHBvcnQgdmFyIFNBTEVTRk9SQ0VfTElTVFZJRVcgPSAoX2EgPSBjcmVhdGUoJ1NBTEVTRk9SQ0VfTElTVFZJRVcnLCB7CiAgICBzZXR1cDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIGlmIChzdGF0ZS5zYWxlc2ZvcmNlLmxpc3RWaWV3c1ttZXRhXSkgewogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgfQogICAgICAgIHZhciBkYXRhID0gc3RhdGUuc2FsZXNmb3JjZS5saXN0Vmlld3NbbWV0YV0gJiYgc3RhdGUuc2FsZXNmb3JjZS5saXN0Vmlld3NbbWV0YV0uZGF0YTsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIHNhbGVzZm9yY2U6IHsKICAgICAgICAgICAgICAgIGxpc3RWaWV3czogKF9hID0ge30sCiAgICAgICAgICAgICAgICAgICAgX2FbbWV0YV0gPSB7ICRzZXQ6IHJlc291cmNlUmVmcmVzaGluZyhkYXRhIHx8IFtdKSB9LAogICAgICAgICAgICAgICAgICAgIF9hKSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgbGlzdFZpZXdzOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgICAgICBfYVttZXRhXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7ICRzZXQ6IFJlc291cmNlU3RhdHVzLlJlZnJlc2hpbmcgfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIF9hKSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsKICAgICAgICB2YXIgX2E7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzYWxlc2ZvcmNlOiB7CiAgICAgICAgICAgICAgICBsaXN0Vmlld3M6IChfYSA9IHt9LAogICAgICAgICAgICAgICAgICAgIF9hW21ldGFdID0gewogICAgICAgICAgICAgICAgICAgICAgICAkc2V0OiByZXNvdXJjZU9rKHBheWxvYWQpLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgX2EpLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9hLnR5cGUpLCBzYWxlc2ZvcmNlTGlzdFZpZXcgPSBfYS5hY3Rpb24sIHNhbGVzZm9yY2VMaXN0Vmlld1JlZHVjZXIgPSBfYS5yZWR1Y2VyOwpleHBvcnQgdmFyIFNBTEVTRk9SQ0VfQ09OVEFDVF9MSVNUID0gKF9iID0gY3JlYXRlKCdTQUxFU0ZPUkNFX0NPTlRBQ1RfTElTVCcsIHsKICAgIHNldHVwOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEpIHsKICAgICAgICBpZiAoc3RhdGUuc2VxdWVuY2VSZWNpcGllbnRzQWRkU3RhdGUpIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIHNlcXVlbmNlUmVjaXBpZW50c0FkZFN0YXRlOiB7CiAgICAgICAgICAgICAgICAkc2V0OiB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogY3JlYXRlRGVmYXVsdEhlYWRlcnMoc3RhdGUpLAogICAgICAgICAgICAgICAgICAgIHJlY2lwaWVudHM6IFtdLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzZXF1ZW5jZVJlY2lwaWVudHNBZGRTdGF0ZTogewogICAgICAgICAgICAgICAgaGVhZGVyc1RvQWRkOiB7ICRzZXQ6IHJlc291cmNlTG9hZGluZygpIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgdmFyIHJlY2lwaWVudHMgPSBzdGF0ZS5zZXF1ZW5jZVJlY2lwaWVudHNBZGRTdGF0ZSAmJgogICAgICAgICAgICBzdGF0ZS5zZXF1ZW5jZVJlY2lwaWVudHNBZGRTdGF0ZS5yZWNpcGllbnRzIHx8IFtdOwogICAgICAgIHZhciBzZXF1ZW5jZSA9IHN0YXRlLnNlbGVjdGVkU2VxdWVuY2U7CiAgICAgICAgdmFyIG5ld1JlY2lwaWVudHMgPSBbXTsKICAgICAgICB2YXIgbmV3SGVhZGVycyA9IFtdOwogICAgICAgIHZhciBlbWFpbEZpZWxkOwogICAgICAgIHZhciBnaXZlbk5hbWVGaWVsZDsKICAgICAgICB2YXIgZmFtaWx5TmFtZUZpZWxkOwogICAgICAgIGlmIChzZXF1ZW5jZSkgewogICAgICAgICAgICB2YXIgdmFyaWFibGVzXzE7CiAgICAgICAgICAgIG5ld1JlY2lwaWVudHMgPSBwYXlsb2FkCiAgICAgICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLmZpZWxkcy5maW5kKGZ1bmN0aW9uIChmKSB7IHJldHVybiBmLnR5cGUgPT09IFNPYmplY3RGaWVsZFR5cGUuRW1haWw7IH0pOyB9KQogICAgICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAocykgewogICAgICAgICAgICAgICAgdmFyaWFibGVzXzEgPSB7fTsKICAgICAgICAgICAgICAgIHMuZmllbGRzLmZvckVhY2goZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZi5kaXNwbGF5TmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZmlyc3QgbmFtZScgfHwKICAgICAgICAgICAgICAgICAgICAgICAgZi5kaXNwbGF5TmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZmlyc3RuYW1lJykgewogICAgICAgICAgICAgICAgICAgICAgICBnaXZlbk5hbWVGaWVsZCA9IGY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGYuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2xhc3QgbmFtZScgfHwKICAgICAgICAgICAgICAgICAgICAgICAgZi5kaXNwbGF5TmFtZS50b0xvd2VyQ2FzZSgpID09PSAnbGFzdG5hbWUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbWlseU5hbWVGaWVsZCA9IGY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlc18xW2YuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKV0gPSBmLmRpc3BsYXlWYWx1ZSB8fCBmLnZhbHVlIHx8ICcnOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBlbWFpbEZpZWxkID0gcy5maWVsZHMuZmluZChmdW5jdGlvbiAoZikgeyByZXR1cm4gZi50eXBlID09PSBTT2JqZWN0RmllbGRUeXBlLkVtYWlsOyB9KTsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgc2VxdWVuY2U6IHNlcXVlbmNlLAogICAgICAgICAgICAgICAgICAgIGVtYWlsOiBlbWFpbEZpZWxkLnZhbHVlLAogICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogdmFyaWFibGVzXzEsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKG5ld1JlY2lwaWVudHMubGVuZ3RoKSB7CiAgICAgICAgICAgIG5ld0hlYWRlcnMgPSBPYmplY3Qua2V5cyhuZXdSZWNpcGllbnRzWzBdLnZhcmlhYmxlcykubWFwKGZ1bmN0aW9uIChoKSB7IHJldHVybiBoLnRvTG93ZXJDYXNlKCk7IH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIHNlcXVlbmNlUmVjaXBpZW50c0FkZFN0YXRlOiB7CiAgICAgICAgICAgICAgICAkc2V0OiB7CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogc3RhdGUuc2VxdWVuY2VSZWNpcGllbnRzQWRkU3RhdGUuaGVhZGVycywKICAgICAgICAgICAgICAgICAgICByZWNpcGllbnRzOiBuZXdSZWNpcGllbnRzLm1hcChmdW5jdGlvbiAocikgeyByZXR1cm4gcmVzb3VyY2VPayhyKTsgfSkuY29uY2F0KHJlY2lwaWVudHMpLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnNUb0FkZDogcmVzb3VyY2VPayhuZXdIZWFkZXJzKSwKICAgICAgICAgICAgICAgICAgICBlbWFpbEhlYWRlcjogZW1haWxGaWVsZCA/IGVtYWlsRmllbGQuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBnaXZlbk5hbWVIZWFkZXI6IGdpdmVuTmFtZUZpZWxkID8gZ2l2ZW5OYW1lRmllbGQuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBmYW1pbHlOYW1lSGVhZGVyOiBmYW1pbHlOYW1lRmllbGQgPyBmYW1pbHlOYW1lRmllbGQuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgZmFpbHVyZTogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBlcnJvcikgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2VxdWVuY2VSZWNpcGllbnRzQWRkU3RhdGU6IHsKICAgICAgICAgICAgICAgICRzZXQ6IF9fYXNzaWduKF9fYXNzaWduKHt9LCBzdGF0ZS5zZXF1ZW5jZVJlY2lwaWVudHNBZGRTdGF0ZSksIHsgaGVhZGVyc1RvQWRkOiB1bmRlZmluZWQgfSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2IudHlwZSksIHNhbGVzZm9yY2VDb250YWN0TGlzdCA9IF9iLmFjdGlvbiwgc2FsZXNmb3JjZUNvbnRhY3RMaXN0UmVkdWNlciA9IF9iLnJlZHVjZXI7CmV4cG9ydCB2YXIgU0FMRVNGT1JDRV9MRUFEU19MSVNUID0gKF9jID0gY3JlYXRlKCdTQUxFU0ZPUkNFX0xFQURTX0xJU1QnLCB7CiAgICBzZXR1cDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgaWYgKHN0YXRlLnNlcXVlbmNlUmVjaXBpZW50c0FkZFN0YXRlKSB7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzZXF1ZW5jZVJlY2lwaWVudHNBZGRTdGF0ZTogewogICAgICAgICAgICAgICAgJHNldDogewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IGNyZWF0ZURlZmF1bHRIZWFkZXJzKHN0YXRlKSwKICAgICAgICAgICAgICAgICAgICByZWNpcGllbnRzOiBbXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2VxdWVuY2VSZWNpcGllbnRzQWRkU3RhdGU6IHsKICAgICAgICAgICAgICAgIGhlYWRlcnNUb0FkZDogeyAkc2V0OiByZXNvdXJjZUxvYWRpbmcoKSB9LAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgcGF5bG9hZCkgewogICAgICAgIHZhciByZWNpcGllbnRzID0gc3RhdGUuc2VxdWVuY2VSZWNpcGllbnRzQWRkU3RhdGUgJiYKICAgICAgICAgICAgc3RhdGUuc2VxdWVuY2VSZWNpcGllbnRzQWRkU3RhdGUucmVjaXBpZW50cyB8fCBbXTsKICAgICAgICB2YXIgc2VxdWVuY2UgPSBzdGF0ZS5zZWxlY3RlZFNlcXVlbmNlOwogICAgICAgIHZhciBuZXdSZWNpcGllbnRzID0gW107CiAgICAgICAgdmFyIG5ld0hlYWRlcnMgPSBbXTsKICAgICAgICB2YXIgZW1haWxGaWVsZDsKICAgICAgICB2YXIgZ2l2ZW5OYW1lRmllbGQ7CiAgICAgICAgdmFyIGZhbWlseU5hbWVGaWVsZDsKICAgICAgICBpZiAoc2VxdWVuY2UpIHsKICAgICAgICAgICAgdmFyIHZhcmlhYmxlc18yOwogICAgICAgICAgICBuZXdSZWNpcGllbnRzID0gcGF5bG9hZAogICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAocykgeyByZXR1cm4gcy5maWVsZHMuZmluZChmdW5jdGlvbiAoZikgeyByZXR1cm4gZi50eXBlID09PSBTT2JqZWN0RmllbGRUeXBlLkVtYWlsOyB9KTsgfSkKICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHMpIHsKICAgICAgICAgICAgICAgIHZhcmlhYmxlc18yID0ge307CiAgICAgICAgICAgICAgICBlbWFpbEZpZWxkID0gcy5maWVsZHMuZmluZChmdW5jdGlvbiAoZikgeyByZXR1cm4gZi50eXBlID09PSBTT2JqZWN0RmllbGRUeXBlLkVtYWlsOyB9KTsKICAgICAgICAgICAgICAgIHMuZmllbGRzLmZvckVhY2goZnVuY3Rpb24gKGYpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZi5kaXNwbGF5TmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZmlyc3QgbmFtZScgfHwKICAgICAgICAgICAgICAgICAgICAgICAgZi5kaXNwbGF5TmFtZS50b0xvd2VyQ2FzZSgpID09PSAnZmlyc3RuYW1lJykgewogICAgICAgICAgICAgICAgICAgICAgICBnaXZlbk5hbWVGaWVsZCA9IGY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGYuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2xhc3QgbmFtZScgfHwKICAgICAgICAgICAgICAgICAgICAgICAgZi5kaXNwbGF5TmFtZS50b0xvd2VyQ2FzZSgpID09PSAnbGFzdG5hbWUnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbWlseU5hbWVGaWVsZCA9IGY7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlc18yW2YuZGlzcGxheU5hbWUudG9Mb3dlckNhc2UoKV0gPSBmLmRpc3BsYXlWYWx1ZSB8fCBmLnZhbHVlIHx8ICcnOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlOiBzZXF1ZW5jZSwKICAgICAgICAgICAgICAgICAgICBlbWFpbDogZW1haWxGaWVsZC52YWx1ZSwKICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHZhcmlhYmxlc18yLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChuZXdSZWNpcGllbnRzLmxlbmd0aCkgewogICAgICAgICAgICBuZXdIZWFkZXJzID0gT2JqZWN0LmtleXMobmV3UmVjaXBpZW50c1swXS52YXJpYWJsZXMpLm1hcChmdW5jdGlvbiAoaCkgeyByZXR1cm4gaC50b0xvd2VyQ2FzZSgpOyB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzZXF1ZW5jZVJlY2lwaWVudHNBZGRTdGF0ZTogewogICAgICAgICAgICAgICAgJHNldDogewogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHN0YXRlLnNlcXVlbmNlUmVjaXBpZW50c0FkZFN0YXRlLmhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgcmVjaXBpZW50czogbmV3UmVjaXBpZW50cy5tYXAoZnVuY3Rpb24gKHIpIHsgcmV0dXJuIHJlc291cmNlT2socik7IH0pLmNvbmNhdChyZWNpcGllbnRzKSwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzVG9BZGQ6IHJlc291cmNlT2sobmV3SGVhZGVycyksCiAgICAgICAgICAgICAgICAgICAgZW1haWxIZWFkZXI6IGVtYWlsRmllbGQgPyBlbWFpbEZpZWxkLmRpc3BsYXlOYW1lLnRvTG93ZXJDYXNlKCkgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZ2l2ZW5OYW1lSGVhZGVyOiBnaXZlbk5hbWVGaWVsZCA/IGdpdmVuTmFtZUZpZWxkLmRpc3BsYXlOYW1lLnRvTG93ZXJDYXNlKCkgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZmFtaWx5TmFtZUhlYWRlcjogZmFtaWx5TmFtZUZpZWxkID8gZmFtaWx5TmFtZUZpZWxkLmRpc3BsYXlOYW1lLnRvTG93ZXJDYXNlKCkgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKICAgIGZhaWx1cmU6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSwgZXJyb3IpIHsKICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIHNlcXVlbmNlUmVjaXBpZW50c0FkZFN0YXRlOiB7CiAgICAgICAgICAgICAgICAkc2V0OiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgc3RhdGUuc2VxdWVuY2VSZWNpcGllbnRzQWRkU3RhdGUpLCB7IGhlYWRlcnNUb0FkZDogdW5kZWZpbmVkIH0pLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9jLnR5cGUpLCBzYWxlc2ZvcmNlTGVhZHNMaXN0ID0gX2MuYWN0aW9uLCBzYWxlc2ZvcmNlTGVhZHNMaXN0UmVkdWNlciA9IF9jLnJlZHVjZXI7CmV4cG9ydCB2YXIgU0FMRVNGT1JDRV9TVU1NQVJZX0ZFVENIID0gKF9kID0gY3JlYXRlKCdTQUxFU0ZPUkNFX1NVTU1BUllfRkVUQ0gnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgc3VtbWFyaWVzOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgICAgICBfYVttZXRhXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcmVzb3VyY2VMb2FkaW5nKCksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgc3VtbWFyaWVzOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgICAgICBfYVttZXRhXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcmVzb3VyY2VPayhwYXlsb2FkKSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIF9hKSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCiAgICBmYWlsdXJlOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIGVycm9yKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgc3VtbWFyaWVzOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgICAgICBfYVttZXRhXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcmVzb3VyY2VGYWlsZWQoZXJyb3IpLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgX2EpLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9kLnR5cGUpLCBzYWxlc2ZvcmNlU3VtbWFyeUZldGNoID0gX2QuYWN0aW9uLCBzYWxlc2ZvcmNlU3VtbWFyeUZldGNoUmVkdWNlciA9IF9kLnJlZHVjZXI7CmV4cG9ydCB2YXIgU2FsZXNmb3JjZVN1bW1hcnlNZXRhVHlwZTsKKGZ1bmN0aW9uIChTYWxlc2ZvcmNlU3VtbWFyeU1ldGFUeXBlKSB7CiAgICBTYWxlc2ZvcmNlU3VtbWFyeU1ldGFUeXBlWyJMZWFkIl0gPSAibGVhZCI7CiAgICBTYWxlc2ZvcmNlU3VtbWFyeU1ldGFUeXBlWyJDb250YWN0Il0gPSAiY29udGFjdCI7CiAgICBTYWxlc2ZvcmNlU3VtbWFyeU1ldGFUeXBlWyJBY2NvdW50Il0gPSAiYWNjb3VudCI7CiAgICBTYWxlc2ZvcmNlU3VtbWFyeU1ldGFUeXBlWyJDcmVhdGUiXSA9ICJjcmVhdGUiOwp9KShTYWxlc2ZvcmNlU3VtbWFyeU1ldGFUeXBlIHx8IChTYWxlc2ZvcmNlU3VtbWFyeU1ldGFUeXBlID0ge30pKTsKLy8gQ2xlYXJzIHBlbmRpbmcgc3VtbWFyeQpleHBvcnQgdmFyIFNBTEVTRk9SQ0VfUEVORElOR19DTEVBUiA9IChfZSA9IGNyZWF0ZSgnU0FMRVNGT1JDRV9QRU5ESU5HX0NMRUFSJywgewogICAgc3RhcnQ6IGZ1bmN0aW9uIChzdGF0ZSwgbWV0YSkgewogICAgICAgIC8vIENsZWFyIHBlbmRpbmcgc3VtbWFyaWVzIGFuZCBzdW1tYXJpZXMgaWYgZXJyb3IgcmVjb3JkZWQKICAgICAgICBpZiAoc3RhdGUuc2FsZXNmb3JjZS5zdW1tYXJpZXNbbWV0YS5lbWFpbF0gJiYgc3RhdGUuc2FsZXNmb3JjZS5zdW1tYXJpZXNbbWV0YS5lbWFpbF0uZXJyb3IpIHsKICAgICAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgICAgIHBlbmRpbmdTdW1tYXJpZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHVuc2V0OiBbbWV0YS5lbWFpbF0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzdW1tYXJpZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHVuc2V0OiBbbWV0YS5lbWFpbF0sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAvLyBPdGhlcndpc2UganVzdCBjbGVhciBwZW5kaW5nCiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzYWxlc2ZvcmNlOiB7CiAgICAgICAgICAgICAgICBwZW5kaW5nU3VtbWFyaWVzOiB7CiAgICAgICAgICAgICAgICAgICAgJHVuc2V0OiBbbWV0YS5lbWFpbF0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9lLnR5cGUpLCBzYWxlc2ZvcmNlUGVuZGluZ0NsZWFyID0gX2UuYWN0aW9uLCBzYWxlc2ZvcmNlUGVuZGluZ0NsZWFyUmVkdWNlciA9IF9lLnJlZHVjZXI7Ci8vIENsZWFycyBwZW5kaW5nIHVwZGF0ZQpleHBvcnQgdmFyIFNBTEVTRk9SQ0VfUEVORElOR19VUERBVEUgPSAoX2YgPSBjcmVhdGUoJ1NBTEVTRk9SQ0VfUEVORElOR19VUERBVEUnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgcGVuZGluZ1N1bW1hcmllczogKF9hID0ge30sCiAgICAgICAgICAgICAgICAgICAgX2FbbWV0YS5lbWFpbF0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzZXQ6IG1ldGEsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2YudHlwZSksIHNhbGVzZm9yY2VQZW5kaW5nVXBkYXRlID0gX2YuYWN0aW9uLCBzYWxlc2ZvcmNlUGVuZGluZ1VwZGF0ZVJlZHVjZXIgPSBfZi5yZWR1Y2VyOwpleHBvcnQgdmFyIFNBTEVTRk9SQ0VfU1VNTUFSWV9DUkVBVEUgPSAoX2cgPSBjcmVhdGUoJ1NBTEVTRk9SQ0VfU1VNTUFSWV9DUkVBVEUnLCB7CiAgICBzdGFydDogZnVuY3Rpb24gKHN0YXRlLCBtZXRhKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgc3VtbWFyaWVzOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgICAgICBfYVttZXRhLmVtYWlsXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcmVzb3VyY2VMb2FkaW5nKCksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgc3VtbWFyaWVzOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgICAgICBfYVttZXRhLmVtYWlsXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcmVzb3VyY2VPayhwYXlsb2FkKSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIF9hKSwKICAgICAgICAgICAgfSwKICAgICAgICB9KTsKICAgIH0sCiAgICBmYWlsdXJlOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIGVycm9yKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgc3VtbWFyaWVzOiAoX2EgPSB7fSwKICAgICAgICAgICAgICAgICAgICBfYVttZXRhLmVtYWlsXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcmVzb3VyY2VGYWlsZWQoZXJyb3IpLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgX2EpLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9nLnR5cGUpLCBzYWxlc2ZvcmNlU3VtbWFyeUNyZWF0ZSA9IF9nLmFjdGlvbiwgc2FsZXNmb3JjZVN1bW1hcnlDcmVhdGVSZWR1Y2VyID0gX2cucmVkdWNlcjsKZXhwb3J0IHZhciBTQUxFU0ZPUkNFX1NVTU1BUllfVVBEQVRFID0gKF9oID0gY3JlYXRlKCdTQUxFU0ZPUkNFX1NVTU1BUllfVVBEQVRFJywgewogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgdmFyIF9hLCBfYjsKICAgICAgICAvLyBkb24ndCB1cGRhdGUgc3RhdGUgaWYgaGF2ZSBubyBTRkRDIGRhdGEgZm9yIGVtYWlsCiAgICAgICAgdmFyIGVtYWlsID0gbWV0YS5lbWFpbDsKICAgICAgICBpZiAoIXN0YXRlLnNhbGVzZm9yY2Uuc3VtbWFyaWVzW2VtYWlsXSB8fCAhc3RhdGUuc2FsZXNmb3JjZS5zdW1tYXJpZXNbZW1haWxdLmRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdXBkYXRlKHN0YXRlLCB7CiAgICAgICAgICAgIHNhbGVzZm9yY2U6IHsKICAgICAgICAgICAgICAgIHN1bW1hcmllczogKF9hID0ge30sCiAgICAgICAgICAgICAgICAgICAgX2FbZW1haWxdID0gewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiAoX2IgPSB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9iW21ldGEudHlwZV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNldDogcGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYiksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2gudHlwZSksIHNhbGVzZm9yY2VTdW1tYXJ5VXBkYXRlID0gX2guYWN0aW9uLCBzYWxlc2ZvcmNlU3VtbWFyeVVwZGF0ZVJlZHVjZXIgPSBfaC5yZWR1Y2VyOwpleHBvcnQgdmFyIFNBTEVTRk9SQ0VfU0NIRU1BX0dFVCA9IChfaiA9IGNyZWF0ZSgnU0FMRVNGT1JDRV9TQ0hFTUFfR0VUJywgewogICAgc3VjY2VzczogZnVuY3Rpb24gKHN0YXRlLCBtZXRhLCBwYXlsb2FkKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiB1cGRhdGUoc3RhdGUsIHsKICAgICAgICAgICAgc2FsZXNmb3JjZTogewogICAgICAgICAgICAgICAgc2NoZW1hczogKF9hID0ge30sCiAgICAgICAgICAgICAgICAgICAgX2FbbWV0YV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRzZXQ6IHBheWxvYWQsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2oudHlwZSksIHNhbGVzZm9yY2VTY2hlbWFHZXQgPSBfai5hY3Rpb24sIHNhbGVzZm9yY2VTY2hlbWFHZXRSZWR1Y2VyID0gX2oucmVkdWNlcjsKZXhwb3J0IHZhciBTQUxFU0ZPUkNFX0xFQURfQ09OVkVSVCA9IChfayA9IGNyZWF0ZSgnU0FMRVNGT1JDRV9MRUFEX0NPTlZFUlQnLCB7CiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsKICAgICAgICB2YXIgX2E7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzYWxlc2ZvcmNlOiB7CiAgICAgICAgICAgICAgICBzdW1tYXJpZXM6IChfYSA9IHt9LAogICAgICAgICAgICAgICAgICAgIF9hW21ldGFdID0gewogICAgICAgICAgICAgICAgICAgICAgICAkc2V0OiByZXNvdXJjZU9rKHBheWxvYWQpLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgX2EpLAogICAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgfSwKfSksIF9rLnR5cGUpLCBzYWxlc2ZvcmNlTGVhZENvbnZlcnQgPSBfay5hY3Rpb24sIHNhbGVzZm9yY2VMZWFkQ29udmVydFJlZHVjZXIgPSBfay5yZWR1Y2VyOwpleHBvcnQgdmFyIFNBTEVTRk9SQ0VfVEFTS19DUkVBVEUgPSAoX2wgPSBjcmVhdGUoJ1NBTEVTRk9SQ0VfVEFTS19DUkVBVEUnLCB7CiAgICBzdWNjZXNzOiBmdW5jdGlvbiAoc3RhdGUsIG1ldGEsIHBheWxvYWQpIHsKICAgICAgICB2YXIgX2EsIF9iOwogICAgICAgIC8vIGRvbid0IHVwZGF0ZSBzdGF0ZSBpZiBkYXRhIGZvciBlbWFpbCBpcyBub3Qgb24gU0Ygc3RhdGUKICAgICAgICB2YXIgZW1haWwgPSBtZXRhLkVtYWlsOwogICAgICAgIGlmICghc3RhdGUuc2FsZXNmb3JjZS5zdW1tYXJpZXNbZW1haWxdIHx8ICFzdGF0ZS5zYWxlc2ZvcmNlLnN1bW1hcmllc1tlbWFpbF0uZGF0YSkgewogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgfQogICAgICAgIC8vIHVwZGF0ZSBzdGF0ZQogICAgICAgIHZhciB0YXNrVHlwZSA9IG1ldGEuU3RhdHVzID09PSBTYWxlc2ZvcmNlVGFza1N0YXR1cy5Db21wbGV0ZWQgPyAnYWN0aXZpdHlIaXN0b3J5JyA6ICd0YXNrcyc7CiAgICAgICAgcmV0dXJuIHVwZGF0ZShzdGF0ZSwgewogICAgICAgICAgICBzYWxlc2ZvcmNlOiB7CiAgICAgICAgICAgICAgICBzdW1tYXJpZXM6IChfYSA9IHt9LAogICAgICAgICAgICAgICAgICAgIF9hW2VtYWlsXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogKF9iID0ge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYlt0YXNrVHlwZV0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVuc2hpZnQ6IFtwYXlsb2FkXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYiksCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBfYSksCiAgICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICB9LAp9KSwgX2wudHlwZSksIHNhbGVzZm9yY2VUYXNrQ3JlYXRlID0gX2wuYWN0aW9uLCBzYWxlc2ZvcmNlVGFza0NyZWF0ZVJlZHVjZXIgPSBfbC5yZWR1Y2VyOwpleHBvcnQgdmFyIHNlbGVjdFNhbGVzZm9yY2VUYXNrcyA9IGNyZWF0ZVNlbGVjdG9yKFsKICAgIGZ1bmN0aW9uIChzdGF0ZSwgZW1haWwpIHsKICAgICAgICB2YXIgc3VtbWFyeSA9IHN0YXRlLnNhbGVzZm9yY2Uuc3VtbWFyaWVzW2VtYWlsXTsKICAgICAgICBpZiAoc3VtbWFyeSAmJiBzdW1tYXJ5LmRhdGEpIHsKICAgICAgICAgICAgcmV0dXJuIHN1bW1hcnkuZGF0YS50YXNrczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFtdOwogICAgfSwKXSwgZnVuY3Rpb24gKHRhc2tzKSB7IHJldHVybiB0YXNrcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICB2YXIgZHVlRGF0ZUEgPSBhLmZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGYpIHsgcmV0dXJuIGYubmFtZSA9PT0gJ0FjdGl2aXR5RGF0ZSc7IH0pLm1hcChmdW5jdGlvbiAoZikgeyByZXR1cm4gZi52YWx1ZTsgfSlbMF07CiAgICB2YXIgZHVlRGF0ZUIgPSBiLmZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGYpIHsgcmV0dXJuIGYubmFtZSA9PT0gJ0FjdGl2aXR5RGF0ZSc7IH0pLm1hcChmdW5jdGlvbiAoZikgeyByZXR1cm4gZi52YWx1ZTsgfSlbMF07CiAgICB2YXIgY3JlYXRlZEEgPSBhLmZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGYpIHsgcmV0dXJuIGYubmFtZSA9PT0gJ0NyZWF0ZWREYXRlJzsgfSkubWFwKGZ1bmN0aW9uIChmKSB7IHJldHVybiBmLnZhbHVlOyB9KVswXTsKICAgIHZhciBjcmVhdGVkQiA9IGIuZmllbGRzLmZpbHRlcihmdW5jdGlvbiAoZikgeyByZXR1cm4gZi5uYW1lID09PSAnQ3JlYXRlZERhdGUnOyB9KS5tYXAoZnVuY3Rpb24gKGYpIHsgcmV0dXJuIGYudmFsdWU7IH0pWzBdOwogICAgaWYgKGR1ZURhdGVBID09PSAnJykgewogICAgICAgIGR1ZURhdGVBID0gdW5kZWZpbmVkOwogICAgfQogICAgaWYgKGR1ZURhdGVCID09PSAnJykgewogICAgICAgIGR1ZURhdGVCID0gdW5kZWZpbmVkOwogICAgfQogICAgaWYgKGNyZWF0ZWRBID09PSAnJykgewogICAgICAgIGNyZWF0ZWRBID0gdW5kZWZpbmVkOwogICAgfQogICAgaWYgKGNyZWF0ZWRCID09PSAnJykgewogICAgICAgIGNyZWF0ZWRCID0gdW5kZWZpbmVkOwogICAgfQogICAgaWYgKCFkdWVEYXRlQSAmJiAhZHVlRGF0ZUIpIHsKICAgICAgICByZXR1cm4gbW9tZW50KGNyZWF0ZWRBKS5pc0FmdGVyKGNyZWF0ZWRCKSA/IC0xIDogMTsKICAgIH0KICAgIGlmICghZHVlRGF0ZUIgJiYgZHVlRGF0ZUEpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBpZiAoZHVlRGF0ZUIgJiYgIWR1ZURhdGVBKSB7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CiAgICBpZiAobW9tZW50KGR1ZURhdGVBKS5pc1NhbWUoZHVlRGF0ZUIsICdkYXknKSkgewogICAgICAgIHJldHVybiBtb21lbnQoY3JlYXRlZEEpLmlzQWZ0ZXIoY3JlYXRlZEIpID8gMSA6IC0xOwogICAgfQogICAgcmV0dXJuIG1vbWVudChkdWVEYXRlQSkuaXNBZnRlcihkdWVEYXRlQikgPyAxIDogLTE7Cn0pOyB9LCB1bmRlZmluZWQsIFsnc2FsZXNmb3JjZSddKTsKZXhwb3J0IGRlZmF1bHQgWwogICAgc2FsZXNmb3JjZUxpc3RWaWV3UmVkdWNlciwKICAgIHNhbGVzZm9yY2VDb250YWN0TGlzdFJlZHVjZXIsCiAgICBzYWxlc2ZvcmNlTGVhZHNMaXN0UmVkdWNlciwKICAgIHNhbGVzZm9yY2VTdW1tYXJ5RmV0Y2hSZWR1Y2VyLAogICAgc2FsZXNmb3JjZVN1bW1hcnlDcmVhdGVSZWR1Y2VyLAogICAgc2FsZXNmb3JjZVN1bW1hcnlVcGRhdGVSZWR1Y2VyLAogICAgc2FsZXNmb3JjZUxlYWRDb252ZXJ0UmVkdWNlciwKICAgIHNhbGVzZm9yY2VUYXNrQ3JlYXRlUmVkdWNlciwKICAgIHNhbGVzZm9yY2VTY2hlbWFHZXRSZWR1Y2VyLAogICAgc2FsZXNmb3JjZVBlbmRpbmdVcGRhdGVSZWR1Y2VyLAogICAgc2FsZXNmb3JjZVBlbmRpbmdDbGVhclJlZHVjZXIsCl07Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/salesforce.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/ducks/salesforce.ts"],"names":[],"mappings":"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","sourcesContent":["import update from 'immutability-helper';\nimport moment from 'moment';\n\nimport { create } from '@src/lib/redux';\nimport { createSelector } from '@src/lib/selector';\nimport { resourceOk, resourceLoading, resourceRefreshing, resourceFailed } from '@src/lib/resource';\n\nimport {\n  SObjectType,\n  SFDCListView,\n  SObject,\n  SObjectFieldType,\n  SObjectField,\n  SalesforceSummary,\n  SalesforceTaskStatus,\n  SObjectSchema,\n} from '@src/types/salesforce';\n\nimport { ResourceStatus } from '@src/types';\nimport {\n  SequenceRecipientCreateRecipient, createDefaultHeaders,\n} from '@src/ducks/sequenceRecipients';\n\nexport const {\n  type: SALESFORCE_LISTVIEW,\n  action: salesforceListView,\n  reducer: salesforceListViewReducer,\n} = create<SObjectType, SFDCListView[]>('SALESFORCE_LISTVIEW', {\n  setup: (state, meta) => {\n    if (state.salesforce.listViews[meta]) {\n      return state;\n    }\n\n    const data = state.salesforce.listViews[meta] && state.salesforce.listViews[meta].data;\n    return update(state, {\n      salesforce: {\n        listViews: {\n          [meta]: { $set: resourceRefreshing(data || []) },\n        },\n      },\n    });\n  },\n\n  start: (state, meta) =>\n    update(state, {\n      salesforce: {\n        listViews: {\n          [meta]: {\n            status: { $set: ResourceStatus.Refreshing },\n          },\n        },\n      },\n    }),\n\n  success: (state, meta, payload) =>\n    update(state, {\n      salesforce: {\n        listViews: {\n          [meta]: {\n            $set: resourceOk(payload),\n          },\n        },\n      },\n    }),\n});\n\nexport const {\n  type: SALESFORCE_CONTACT_LIST,\n  action: salesforceContactList,\n  reducer: salesforceContactListReducer,\n} = create<string, SObject[]>('SALESFORCE_CONTACT_LIST', {\n  setup: (state, meta) => {\n    if (state.sequenceRecipientsAddState) {\n      return state;\n    }\n\n    return update(state, {\n      sequenceRecipientsAddState: {\n        $set: {\n          headers: createDefaultHeaders(state),\n          recipients: [],\n        },\n      },\n    });\n  },\n  start: (state, meta) =>\n    update(state, {\n      sequenceRecipientsAddState: {\n        headersToAdd: { $set: resourceLoading() },\n      },\n    }),\n  success: (state, meta, payload) => {\n    const recipients = state.sequenceRecipientsAddState &&\n      state.sequenceRecipientsAddState.recipients || [];\n    const sequence = state.selectedSequence;\n    let newRecipients: SequenceRecipientCreateRecipient[] = [];\n    let newHeaders: string[] = [];\n    let emailField: SObjectField | undefined;\n    let givenNameField: SObjectField | undefined;\n    let familyNameField: SObjectField | undefined;\n\n    if (sequence) {\n      let variables: any;\n      newRecipients = payload\n        .filter(s => s.fields.find(f => f.type === SObjectFieldType.Email))\n        .map((s) => {\n          variables = {};\n          s.fields.forEach((f) => {\n            if (f.displayName.toLowerCase() === 'first name' ||\n              f.displayName.toLowerCase() === 'firstname') {\n              givenNameField = f;\n            } else if (f.displayName.toLowerCase() === 'last name' ||\n              f.displayName.toLowerCase() === 'lastname') {\n              familyNameField = f;\n            }\n            variables[f.displayName.toLowerCase()] = f.displayValue || f.value || '';\n          });\n          emailField = s.fields.find(f => f.type === SObjectFieldType.Email);\n\n          return {\n            sequence,\n            email: emailField!.value,\n            variables,\n          };\n        });\n    }\n\n    if (newRecipients.length) {\n      newHeaders = Object.keys(newRecipients[0].variables!).map(h => h.toLowerCase());\n    }\n\n    return update(state, {\n      sequenceRecipientsAddState: {\n        $set: {\n          headers: state.sequenceRecipientsAddState!.headers,\n          recipients: newRecipients.map(r => resourceOk(r)).concat(recipients),\n          headersToAdd: resourceOk(newHeaders),\n          emailHeader: emailField ? emailField.displayName.toLowerCase() : undefined,\n          givenNameHeader: givenNameField ? givenNameField.displayName.toLowerCase() : undefined,\n          familyNameHeader: familyNameField ? familyNameField.displayName.toLowerCase() : undefined,\n        },\n      },\n    });\n  },\n\n  failure: (state, meta, error) =>\n    update(state, {\n      sequenceRecipientsAddState: {\n        $set: {\n          ...state.sequenceRecipientsAddState,\n          headersToAdd: undefined,\n        },\n      },\n    }),\n});\n\nexport const {\n  type: SALESFORCE_LEADS_LIST,\n  action: salesforceLeadsList,\n  reducer: salesforceLeadsListReducer,\n} = create<string, SObject[]>('SALESFORCE_LEADS_LIST', {\n  setup: (state, meta) => {\n    if (state.sequenceRecipientsAddState) {\n      return state;\n    }\n\n    return update(state, {\n      sequenceRecipientsAddState: {\n        $set: {\n          headers: createDefaultHeaders(state),\n          recipients: [],\n        },\n      },\n    });\n  },\n  start: (state, meta) =>\n    update(state, {\n      sequenceRecipientsAddState: {\n        headersToAdd: { $set: resourceLoading() },\n      },\n    }),\n  success: (state, meta, payload) => {\n    const recipients = state.sequenceRecipientsAddState &&\n      state.sequenceRecipientsAddState.recipients || [];\n    const sequence = state.selectedSequence;\n    let newRecipients: SequenceRecipientCreateRecipient[] = [];\n    let newHeaders: string[] = [];\n    let emailField: SObjectField | undefined;\n    let givenNameField: SObjectField | undefined;\n    let familyNameField: SObjectField | undefined;\n\n    if (sequence) {\n      let variables: any;\n      newRecipients = payload\n        .filter(s => s.fields.find(f => f.type === SObjectFieldType.Email))\n        .map((s) => {\n          variables = {};\n          emailField = s.fields.find(f => f.type === SObjectFieldType.Email);\n          s.fields.forEach((f) => {\n            if (f.displayName.toLowerCase() === 'first name' ||\n              f.displayName.toLowerCase() === 'firstname') {\n              givenNameField = f;\n            } else if (f.displayName.toLowerCase() === 'last name' ||\n              f.displayName.toLowerCase() === 'lastname') {\n              familyNameField = f;\n            }\n            variables[f.displayName.toLowerCase()] = f.displayValue || f.value || '';\n          });\n\n          return {\n            sequence,\n            email: emailField!.value,\n            variables,\n          };\n        });\n    }\n\n    if (newRecipients.length) {\n      newHeaders = Object.keys(newRecipients[0].variables!).map(h => h.toLowerCase());\n    }\n\n    return update(state, {\n      sequenceRecipientsAddState: {\n        $set: {\n          headers: state.sequenceRecipientsAddState!.headers,\n          recipients: newRecipients.map(r => resourceOk(r)).concat(recipients),\n          headersToAdd: resourceOk(newHeaders),\n          emailHeader: emailField ? emailField.displayName.toLowerCase() : undefined,\n          givenNameHeader: givenNameField ? givenNameField.displayName.toLowerCase() : undefined,\n          familyNameHeader: familyNameField ? familyNameField.displayName.toLowerCase() : undefined,\n        },\n      },\n    });\n  },\n\n  failure: (state, meta, error) =>\n    update(state, {\n      sequenceRecipientsAddState: {\n        $set: {\n          ...state.sequenceRecipientsAddState,\n          headersToAdd: undefined,\n        },\n      },\n    }),\n});\n\nexport const {\n  type: SALESFORCE_SUMMARY_FETCH,\n  action: salesforceSummaryFetch,\n  reducer: salesforceSummaryFetchReducer,\n} = create<string, SalesforceSummary>('SALESFORCE_SUMMARY_FETCH', {\n  start: (state, meta) => update(state, {\n    salesforce: {\n      summaries: {\n        [meta]: {\n          $set: resourceLoading(),\n        },\n      },\n    },\n  }),\n  success: (state, meta, payload) => update(state, {\n    salesforce: {\n      summaries: {\n        [meta]: {\n          $set: resourceOk(payload),\n        },\n      },\n    },\n  }),\n  failure: (state, meta, error) => update(state, {\n    salesforce: {\n      summaries: {\n        [meta]: {\n          $set: resourceFailed(error),\n        },\n      },\n    },\n  }),\n});\n\nexport const enum SalesforceSummaryMetaType {\n  Lead = 'lead',\n  Contact = 'contact',\n  Account = 'account',\n  Create = 'create',\n}\n\nexport interface SalesforceSummaryCreateMeta {\n  email: string;\n  type: SalesforceSummaryMetaType;\n  fields?: SObjectField[];\n}\n\n// Clears pending summary\nexport const {\n  type: SALESFORCE_PENDING_CLEAR,\n  action: salesforcePendingClear,\n  reducer: salesforcePendingClearReducer,\n} = create<SalesforceSummaryCreateMeta, null>('SALESFORCE_PENDING_CLEAR', {\n  start: (state, meta) => {\n    // Clear pending summaries and summaries if error recorded\n    if (state.salesforce.summaries[meta.email] && state.salesforce.summaries[meta.email].error) {\n      return update(state, {\n        salesforce: {\n          pendingSummaries: {\n            $unset: [meta.email],\n          },\n          summaries: {\n            $unset: [meta.email],\n          },\n        },\n      });\n    }\n\n    // Otherwise just clear pending\n    return update(state, {\n      salesforce: {\n        pendingSummaries: {\n          $unset: [meta.email],\n        },\n      },\n    });\n  },\n});\n\n// Clears pending update\nexport const {\n  type: SALESFORCE_PENDING_UPDATE,\n  action: salesforcePendingUpdate,\n  reducer: salesforcePendingUpdateReducer,\n} = create<SalesforceSummaryCreateMeta, null>('SALESFORCE_PENDING_UPDATE', {\n  start: (state, meta) => update(state, {\n    salesforce: {\n      pendingSummaries: {\n        [meta.email]: {\n          $set: meta,\n        },\n      },\n    },\n  }),\n});\n\nexport const {\n  type: SALESFORCE_SUMMARY_CREATE,\n  action: salesforceSummaryCreate,\n  reducer: salesforceSummaryCreateReducer,\n} = create<SalesforceSummaryCreateMeta, SalesforceSummary>('SALESFORCE_SUMMARY_CREATE', {\n  start: (state, meta) => update(state, {\n    salesforce: {\n      summaries: {\n        [meta.email]: {\n          $set: resourceLoading(),\n        },\n      },\n    },\n  }),\n  success: (state, meta, payload) => update(state, {\n    salesforce: {\n      summaries: {\n        [meta.email]: {\n          $set: resourceOk(payload),\n        },\n      },\n    },\n  }),\n  failure: (state, meta, error) => update(state, {\n    salesforce: {\n      summaries: {\n        [meta.email]: {\n          $set: resourceFailed(error),\n        },\n      },\n    },\n  }),\n});\n\nexport interface SalesforceSummaryUpdateMeta {\n  type: SalesforceSummaryMetaType;\n  id: string; // account id\n  email: string; // email address associated with lead or contact\n  name: string;\n  value: any;\n}\n\nexport const {\n  type: SALESFORCE_SUMMARY_UPDATE,\n  action: salesforceSummaryUpdate,\n  reducer: salesforceSummaryUpdateReducer,\n} = create<SalesforceSummaryUpdateMeta, SObject>('SALESFORCE_SUMMARY_UPDATE', {\n  success: (state, meta, payload) => {\n    // don't update state if have no SFDC data for email\n    const email = meta.email;\n    if (!state.salesforce.summaries[email] || !state.salesforce.summaries[email].data) {\n      return state;\n    }\n\n    return update(state, {\n      salesforce: {\n        summaries: {\n          [email]: {\n            data: {\n              [meta.type]: {\n                $set: payload,\n              },\n            },\n          },\n        },\n      },\n    });\n  },\n});\n\nexport const {\n  type: SALESFORCE_SCHEMA_GET,\n  action: salesforceSchemaGet,\n  reducer: salesforceSchemaGetReducer,\n} = create<SObjectType, SObjectSchema>('SALESFORCE_SCHEMA_GET', {\n  success: (state, meta, payload) => update(state, {\n    salesforce: {\n      schemas: {\n        [meta]: {\n          $set: payload,\n        },\n      },\n    },\n  }),\n});\n\nexport const {\n  type: SALESFORCE_LEAD_CONVERT,\n  action: salesforceLeadConvert,\n  reducer: salesforceLeadConvertReducer,\n} = create<string, SalesforceSummary>('SALESFORCE_LEAD_CONVERT', {\n  success: (state, meta, payload) => update(state, {\n    salesforce: {\n      summaries: {\n        [meta]: {\n          $set: resourceOk(payload),\n        },\n      },\n    },\n  }),\n});\n\nexport interface SalesforceTaskCreateMeta {\n  Email: string;\n\n  WhoId: string;\n  Subject: string;\n  Description?: string;\n  ActivityDate?: Date;\n  Status: SalesforceTaskStatus;\n}\n\nexport const {\n  type: SALESFORCE_TASK_CREATE,\n  action: salesforceTaskCreate,\n  reducer: salesforceTaskCreateReducer,\n} = create<SalesforceTaskCreateMeta, SObject>('SALESFORCE_TASK_CREATE', {\n  success: (state, meta, payload) => {\n    // don't update state if data for email is not on SF state\n    const email = meta.Email;\n    if (!state.salesforce.summaries[email] || !state.salesforce.summaries[email].data) {\n      return state;\n    }\n\n    // update state\n    const taskType = meta.Status === SalesforceTaskStatus.Completed ? 'activityHistory' : 'tasks';\n    return update(state, {\n      salesforce: {\n        summaries: {\n          [email]: {\n            data: {\n              [taskType]: {\n                $unshift: [payload],\n              },\n            },\n          },\n        },\n      },\n    });\n  },\n});\n\nexport const selectSalesforceTasks = createSelector<string, SObject[], SObject[]>(\n  [\n    (state, email) => {\n      const summary = state.salesforce.summaries[email];\n      if (summary && summary.data) {\n        return summary.data.tasks;\n      }\n      return [];\n    },\n  ],\n  (tasks: SObject[]) => tasks.sort((a, b) => {\n    let dueDateA = a.fields.filter(f => f.name === 'ActivityDate').map(f => f.value)[0];\n    let dueDateB = b.fields.filter(f => f.name === 'ActivityDate').map(f => f.value)[0];\n\n    let createdA = a.fields.filter(f => f.name === 'CreatedDate').map(f => f.value)[0];\n    let createdB = b.fields.filter(f => f.name === 'CreatedDate').map(f => f.value)[0];\n\n    if (dueDateA === '') {\n      dueDateA = undefined;\n    }\n    if (dueDateB === '') {\n      dueDateB = undefined;\n    }\n    if (createdA === '') {\n      createdA = undefined;\n    }\n    if (createdB === '') {\n      createdB = undefined;\n    }\n\n    if (!dueDateA && !dueDateB) {\n      return moment(createdA).isAfter(createdB) ? -1 : 1;\n    }\n    if (!dueDateB && dueDateA) {\n      return -1;\n    }\n    if (dueDateB && !dueDateA) {\n      return 1;\n    }\n\n    if (moment(dueDateA).isSame(dueDateB, 'day')) {\n      return moment(createdA).isAfter(createdB) ? 1 : -1;\n    }\n\n    return moment(dueDateA).isAfter(dueDateB) ? 1 : -1;\n  }),\n  undefined,\n  ['salesforce'],\n);\n\nexport default [\n  salesforceListViewReducer,\n  salesforceContactListReducer,\n  salesforceLeadsListReducer,\n  salesforceSummaryFetchReducer,\n  salesforceSummaryCreateReducer,\n  salesforceSummaryUpdateReducer,\n  salesforceLeadConvertReducer,\n  salesforceTaskCreateReducer,\n  salesforceSchemaGetReducer,\n  salesforcePendingUpdateReducer,\n  salesforcePendingClearReducer,\n];\n"]}]}