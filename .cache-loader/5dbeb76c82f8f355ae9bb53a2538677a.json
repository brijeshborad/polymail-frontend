{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/auth.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/auth.ts","mtime":1675280254054},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgewogICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHsKICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKQogICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfTsKICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9OwppbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7CmltcG9ydCB7IEFVVEhfVE9LRU5fTk9ORSwgZ2V0VG9rZW4sIHNldFRva2VuIH0gZnJvbSAnQHNyYy9hcGkvYmFzZSc7CmltcG9ydCB7IG1lRmV0Y2gsIG9uYm9hcmRpbmdGZXRjaCwgfSBmcm9tICdAc3JjL2R1Y2tzL21lJzsKaW1wb3J0IHsgdGVhbUZldGNoIH0gZnJvbSAnQHNyYy9kdWNrcy90ZWFtJzsKaW1wb3J0IHsgY29udGFjdEdyb3Vwc0xpc3QgfSBmcm9tICdAc3JjL2R1Y2tzL2NvbnRhY3RHcm91cHMnOwppbXBvcnQgeyBBY3Rpb25TdGF0dXMsIERldmljZVBsYXRmb3JtIH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCB7IFNUQVJULCBzdGFydCwgQVVUSF9MT0dJTiwgYXV0aExvZ2luLCBBVVRIX0xPR09VVCwgYXV0aExvZ291dCwgQVVUSF9QQVNTV09SRF9SRVNFVCwgYXV0aFBhc3N3b3JkUmVzZXQsIEFVVEhfTE9HT1VUX0FMTCwgYXV0aExvZ291dEFsbCwgQVVUSF9PQVVUSF9MT0dJTiwgYXV0aE9BdXRoTG9naW4sIGF1dGhUZmFDb2RlVmFsaWRhdGUsIEFVVEhfVEZBX0NPREVfU0VORCwgYXV0aFRmYUNvZGVTZW5kLCBBVVRIX1RGQV9DT0RFX1ZBTElEQVRFLCBhdXRoR2V0TWFnaWNMaW5rLCBBVVRIX0dFVF9NQUdJQ19MSU5LLCBBVVRIX0NMRUFSX1JFRElSRUNULCBhdXRoQ2xlYXJSZWRpcmVjdCwgQVVUSF9HRVRfTE9HSU5fVE9LRU4sIGF1dGhHZXRMb2dpblRva2VuLCB9IGZyb20gJ0BzcmMvZHVja3MvYXV0aCc7CmltcG9ydCB7IGxvZ2luIGFzIGxvZ2luUmVxdWVzdCwgbG9nb3V0IGFzIGxvZ291dFJlcXVlc3QsIGxvZ291dEFsbCBhcyBsb2dvdXRBbGxSZXF1ZXN0LCBwYXNzd29yZFJlc2V0LCBvQXV0aExvZ2luLCB1cGdyYWRlVGZhTG9naW4sIHNlbmRUZmFDb2RlLCBUb2tlblR5cGUsIGdldE1hZ2ljTGluaywgZ2V0TG9naW5Ub2tlbiwgfSBmcm9tICdAc3JjL2FwaS9hdXRoJzsKaW1wb3J0IHsgaW50ZWdyYXRpb25MaXN0IH0gZnJvbSAnQHNyYy9kdWNrcy9pbnRlZ3JhdGlvbnMnOwppbXBvcnQgeyByZWNvcmRFdmVudCwgVXNlckV2ZW50cyB9IGZyb20gJ0BzcmMvbGliL2FuYWx5dGljcyc7CmltcG9ydCB7IHNjaGVkdWxpbmdMaXN0IH0gZnJvbSAnQHNyYy9kdWNrcy9zY2hlZHVsaW5nJzsKaW1wb3J0IHsgdG9hc3RTZXQgfSBmcm9tICdAc3JjL2R1Y2tzL3RvYXN0cyc7CmltcG9ydCB7IGdldFVybCB9IGZyb20gJ0BzcmMvbGliL3V0aWxzJzsKaW1wb3J0IGJyb3dzZXJIaXN0b3J5IGZyb20gJ0BzcmMvbGliL2Jyb3dzZXJIaXN0b3J5JzsKaW1wb3J0IHsgc2V0QXV0aENvb2tpZSwgZGVsZXRlQXV0aENvb2tpZSwgZGVsZXRlVEZBTmVlZGVkQ29va2llLCBTVEFOREFSRF9DT09LSUVfQVRUUklCVVRFUyB9IGZyb20gJ0BzcmMvbGliL2Nvb2tpZXMnOwppbXBvcnQgeyBjbGVhckV2ZXJ5dGhpbmcsIGNsZWFyQXV0aERhdGEgfSBmcm9tICdAc3JjL2xpYi9hdXRoJzsKaW1wb3J0IHsgZmlsdGVyc0xpc3QgfSBmcm9tICdAc3JjL2R1Y2tzL2ZpbHRlcnMnOwppbXBvcnQgeyBpc0VsZWN0cm9uTWFjLCBpc0VsZWN0cm9uV2luZG93cywgaXNFbGVjdHJvbiB9IGZyb20gJ0BzcmMvbGliL2VsZWN0cm9uJzsKaW1wb3J0IENvb2tpZXMgZnJvbSAnanMtY29va2llJzsKaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnOwp2YXIgZ2V0TG9naW5Ub2tlbkVwaWMgPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUsIGRlcHMpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShBVVRIX0dFVF9MT0dJTl9UT0tFTikKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgLy8gQmFzZSB0b2tlbiByZXF1ZXN0CiAgICAgICAgdmFyIHRva2VuUmVxdWVzdCA9IGdldExvZ2luVG9rZW4oKTsKICAgICAgICAvLyBJZiByZXVzZSB0b2tlbiByZXVzZVRUTCBpcyBzdGlsbCB2YWxpZCB0aGVuIHVzZSBleGlzdGluZyB0b2tlbgogICAgICAgIHZhciBmb3VuZFRva2VuQ29va2llID0gQ29va2llcy5nZXQoJ3BtbHQnKTsKICAgICAgICB2YXIgZm91bmRUb2tlbiA9IGZvdW5kVG9rZW5Db29raWUgJiYgSlNPTi5wYXJzZShmb3VuZFRva2VuQ29va2llKTsKICAgICAgICBpZiAoKGZvdW5kVG9rZW4gPT09IG51bGwgfHwgZm91bmRUb2tlbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogZm91bmRUb2tlbi5yZXVzZURhdGUpICYmIG1vbWVudChkZXBzLm5vdygpKS5pc0JlZm9yZShtb21lbnQoZm91bmRUb2tlbi5yZXVzZURhdGUpKSkgewogICAgICAgICAgICB0b2tlblJlcXVlc3QgPSBPYnNlcnZhYmxlLm9mKGZvdW5kVG9rZW4pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG9rZW5SZXF1ZXN0CiAgICAgICAgICAgIC5kbyhmdW5jdGlvbiAodG9rZW4pIHsKICAgICAgICAgICAgaWYgKHRva2VuKSB7CiAgICAgICAgICAgICAgICAvLyBJZGVudGlmeSBwbGF0Zm9ybQogICAgICAgICAgICAgICAgdmFyIHBsYXRmb3JtID0gRGV2aWNlUGxhdGZvcm0uV2ViOwogICAgICAgICAgICAgICAgaWYgKGlzRWxlY3Ryb25NYWMpIHsKICAgICAgICAgICAgICAgICAgICBwbGF0Zm9ybSA9IERldmljZVBsYXRmb3JtLm1hY09TOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzRWxlY3Ryb25XaW5kb3dzKSB7CiAgICAgICAgICAgICAgICAgICAgcGxhdGZvcm0gPSBEZXZpY2VQbGF0Zm9ybS5XaW5kb3dzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIGVuY29kZWQgPSBlbmNvZGVVUklDb21wb25lbnQodG9rZW4ucHVibGljKTsKICAgICAgICAgICAgICAgIC8vIFRPRE8oU0hJTik6IFBhc3MgdHRsIGluIHVybCB3aXRoIHRva2VuCiAgICAgICAgICAgICAgICB3aW5kb3cub3BlbigiXG4gICAgICAgICAgICAgICIgKyB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgIi9sb2dpbj9yZWRpcmVjdF9wbGF0Zm9ybT0iICsgcGxhdGZvcm0gKyAiJnBtcHQ9IiArIGVuY29kZWQgKyAiJnR0bD0iICsgdG9rZW4udHRsKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uICh0b2tlbikgewogICAgICAgICAgICB2YXIgcmV1c2VEYXRlID0gdG9rZW4ucmV1c2VUdGwgJiYKICAgICAgICAgICAgICAgIG1vbWVudChkZXBzLm5vdygpKS5hZGQodG9rZW4ucmV1c2VUdGwsICdzZWNvbmRzJykudG9EYXRlKCkgfHwgdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgdXBkYXRlZCA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCB0b2tlbiksIHsgcmV1c2VEYXRlOiByZXVzZURhdGUgfSk7CiAgICAgICAgICAgIC8vIFJldHVybiBzdWNjZXNzIGNhc2UKICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZihhdXRoR2V0TG9naW5Ub2tlbihhY3Rpb24ubWV0YSwgdXBkYXRlZCkpKTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoYXV0aEdldExvZ2luVG9rZW4oYWN0aW9uLm1ldGEsIGUpKTsKICAgICAgICB9KTsKICAgIH0pOwp9Owp2YXIgZ2V0TWFnaWNMaW5rRXBpYyA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSkgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEFVVEhfR0VUX01BR0lDX0xJTkspCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWN0aW9uKSB7IHJldHVybiBhY3Rpb24uc3RhdHVzID09PSBBY3Rpb25TdGF0dXMuU3RhcnQ7IH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHZhciBfYTsKICAgICAgICByZXR1cm4gZ2V0TWFnaWNMaW5rKF9fYXNzaWduKF9fYXNzaWduKHt9LCBhY3Rpb24ubWV0YSksIHsgdG9rZW46IChfYSA9IEpTT04ucGFyc2UoQ29va2llcy5nZXQoJ3BtbHQnKSB8fCAne30nKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnB1YmxpYyB9KSkKICAgICAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKG1hZ2ljTGluaykgewogICAgICAgICAgICAvLyBIYW5kbGUgcmVkaXJlY3QgZm9yIG1hZ2ljIGxpbmsKICAgICAgICAgICAgaWYgKG1hZ2ljTGluayA9PT0gbnVsbCB8fCBtYWdpY0xpbmsgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1hZ2ljTGluay5jb2RlKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICJwb2x5bWFpbDovL2F1dGgvbWFnaWM/Y29kZT0iICsgZW5jb2RlVVJJQ29tcG9uZW50KG1hZ2ljTGluay5jb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBSZXR1cm4gc3VjY2VzcyBjYXNlCiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKE9ic2VydmFibGUub2YoYXV0aEdldE1hZ2ljTGluayhhY3Rpb24ubWV0YSwgbnVsbCkpKTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgLy8gSWYgcmVxdWVzdCBmYWlsZWQgcmVkaXJlY3QgYW55d2F5cyBzbyBiYWNrdXAgbWVjaGFuaXNtIGNhbiBiZSB1c2VkCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gInBvbHltYWlsOi8vYXV0aC9tYWdpYyI7CiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKE9ic2VydmFibGUub2YodG9hc3RTZXQobmV3IEVycm9yKCdXZSByYW4gaW50byBhbiBpc3N1ZSB0cnlpbmcgdG8gY3JlYXRlIGEgbWFnaWMgbGluayBmb3IgeW91ciBlbWFpbC4gJwogICAgICAgICAgICAgICAgKyAnUGxlYXNlIHRyeSBhZ2FpbiEnKSkpLCBPYnNlcnZhYmxlLm9mKGF1dGhHZXRNYWdpY0xpbmsoYWN0aW9uLm1ldGEsIGUpKSk7CiAgICAgICAgfSk7CiAgICB9KTsKfTsKdmFyIGNsZWFyUmVkaXJlY3RQbGF0Zm9ybUVwaWMgPSBmdW5jdGlvbiAoYWN0aW9uJCwgZGVwcywgc3RvcmUpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShBVVRIX0NMRUFSX1JFRElSRUNUKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5kbyhmdW5jdGlvbiAoKSB7CiAgICAgICAgYnJvd3Nlckhpc3RvcnkucmVwbGFjZSgnL3NldHRpbmdzJyk7CiAgICB9KQogICAgICAgIC5tYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBhdXRoQ2xlYXJSZWRpcmVjdChudWxsLCBudWxsKTsKICAgIH0pOwp9Owp2YXIgcGFzc3dvcmRSZXNldEVwaWMgPSBmdW5jdGlvbiAoYWN0aW9uJCkgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEFVVEhfUEFTU1dPUkRfUkVTRVQpCiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYWN0aW9uKSB7IHJldHVybiBhY3Rpb24uc3RhdHVzID09PSBBY3Rpb25TdGF0dXMuU3RhcnQ7IH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIHJldHVybiBwYXNzd29yZFJlc2V0KGFjdGlvbi5tZXRhKQogICAgICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKE9ic2VydmFibGUub2YoYXV0aFBhc3N3b3JkUmVzZXQoYWN0aW9uLm1ldGEsIG51bGwpKSwgT2JzZXJ2YWJsZS5vZih0b2FzdFNldChuZXcgRXJyb3IoIkFuIGVtYWlsIHRvIHJlc2V0IHlvdXIgcGFzc3dvcmQgaGFzIGJlZW4gc2VudCB0byAiICsgYWN0aW9uLm1ldGEgKyAiLiIgKwogICAgICAgICAgICAgICAgJ1RoZSBsaW5rIHdpbGwgYmUgdmFsaWQgZm9yIDEgaG91ci4nKSkpKTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZih0b2FzdFNldChuZXcgRXJyb3IoJ1dlIHJhbiBpbnRvIGFuIGlzc3VlIHRyeWluZyB0byBjcmVhdGUgYSByZXNldCBsaW5rIGZvciB5b3VyIGVtYWlsLiAnCiAgICAgICAgICAgICAgICArICdQbGVhc2UgdHJ5IGFnYWluIScpKSksIE9ic2VydmFibGUub2YoYXV0aFBhc3N3b3JkUmVzZXQoYWN0aW9uLm1ldGEsIGUpKSk7CiAgICAgICAgfSk7CiAgICB9KTsKfTsKdmFyIGxvZ2luID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoQVVUSF9MT0dJTikKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgdmFyIF9hOwogICAgICAgIHJldHVybiBsb2dpblJlcXVlc3QoX19hc3NpZ24oX19hc3NpZ24oe30sIGFjdGlvbi5tZXRhKSwgeyB0b2tlbjogISFhY3Rpb24ubWV0YS5tYWdpY0NvZGUgJiYgKChfYSA9IEpTT04ucGFyc2UoQ29va2llcy5nZXQoJ3BtbHQnKSB8fCAne30nKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnByaXZhdGUpIHx8IHVuZGVmaW5lZCB9KSkKICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAodG9rZW4pIHsKICAgICAgICAgICAgY2xlYXJBdXRoRGF0YSgpOwogICAgICAgICAgICBzZXRBdXRoQ29va2llKHRva2VuKTsKICAgICAgICAgICAgc2V0VG9rZW4odG9rZW4udG9rZW4pOwogICAgICAgICAgICAvLyBDbGVhciBsb2dpbiB0b2tlbgogICAgICAgICAgICBpZiAoaXNFbGVjdHJvbikgewogICAgICAgICAgICAgICAgQ29va2llcy5yZW1vdmUoJ3BtbHQnLCBTVEFOREFSRF9DT09LSUVfQVRUUklCVVRFUyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGF1dGhMb2dpbihhY3Rpb24ubWV0YSwgdG9rZW4pOwogICAgICAgIH0pCiAgICAgICAgICAgIC5kbyhmdW5jdGlvbiAoYSkgewogICAgICAgICAgICBpZiAoISFhLnBheWxvYWQgJiYgYS5wYXlsb2FkLnR5cGUgPT09IFRva2VuVHlwZS5CYXNpYykgewogICAgICAgICAgICAgICAgYnJvd3Nlckhpc3RvcnkucmVwbGFjZSgnL2xvZ2luL3RmYScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGEubWV0YS5tYWdpY0NvZGUpIHsKICAgICAgICAgICAgICAgIGJyb3dzZXJIaXN0b3J5LnJlcGxhY2UoJy8nKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgICAgIC5kbyhmdW5jdGlvbiAoKSB7IHJldHVybiByZWNvcmRFdmVudChVc2VyRXZlbnRzLkxvZ2dlZEluKTsgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKE9ic2VydmFibGUub2YodG9hc3RTZXQoZSkpLCBPYnNlcnZhYmxlLm9mKGF1dGhMb2dpbihhY3Rpb24ubWV0YSwgZSkpKTsgfSk7CiAgICB9KTsKfTsKdmFyIGxvZ2luU3VjY2Vzc1N0YXJ0dXAgPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShBVVRIX0xPR0lOLCBBVVRIX1RGQV9DT0RFX1ZBTElEQVRFKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN1Y2Nlc3MgJiYgIXN0b3JlLmdldFN0YXRlKCkudGZhTmVlZGVkOyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihzdGFydChudWxsKSk7CiAgICB9KTsKfTsKdmFyIHN0YXJ0dXAgPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShTVEFSVCkKICAgICAgICAuZmxhdE1hcChmdW5jdGlvbiAoYWN0aW9uKSB7CiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZihtZUZldGNoKCcnKSksIE9ic2VydmFibGUub2YodGVhbUZldGNoKCcnKSksIE9ic2VydmFibGUub2YoY29udGFjdEdyb3Vwc0xpc3QoJycpKSwgT2JzZXJ2YWJsZS5vZihpbnRlZ3JhdGlvbkxpc3QobnVsbCkpLCBPYnNlcnZhYmxlLm9mKG9uYm9hcmRpbmdGZXRjaChudWxsKSksIE9ic2VydmFibGUub2Yoc2NoZWR1bGluZ0xpc3QobnVsbCkpLCBPYnNlcnZhYmxlLm9mKGZpbHRlcnNMaXN0KG51bGwpKSk7CiAgICB9KTsKfTsKdmFyIGxvZ291dCA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSkgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEFVVEhfTE9HT1VUKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5kbyhmdW5jdGlvbiAoKSB7IHJldHVybiByZWNvcmRFdmVudChVc2VyRXZlbnRzLkxvZ2dlZE91dCk7IH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgewogICAgICAgIGlmIChnZXRUb2tlbigpID09PSBBVVRIX1RPS0VOX05PTkUpIHsKICAgICAgICAgICAgLy8gY2xlYXIgY29va2llcywganVzdCBpbiBjYXNlIHRoZXkgZXhpc3QKICAgICAgICAgICAgZGVsZXRlQXV0aENvb2tpZSgpOwogICAgICAgICAgICBkZWxldGVURkFOZWVkZWRDb29raWUoKTsKICAgICAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoYXV0aExvZ291dChudWxsLCBudWxsKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsb2dvdXRSZXF1ZXN0KCkKICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGRlbGV0ZUF1dGhDb29raWUoKTsKICAgICAgICAgICAgZGVsZXRlVEZBTmVlZGVkQ29va2llKCk7CiAgICAgICAgICAgIHNldFRva2VuKEFVVEhfVE9LRU5fTk9ORSk7CiAgICAgICAgICAgIHJldHVybiBhdXRoTG9nb3V0KG51bGwsIG51bGwpOwogICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5tZXJnZShPYnNlcnZhYmxlLm9mKHRvYXN0U2V0KGUpKSk7CiAgICAgICAgfSk7CiAgICB9KTsKfTsKdmFyIGxvZ291dEFsbCA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSkgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEFVVEhfTE9HT1VUX0FMTCkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChhY3Rpb24pIHsgcmV0dXJuIGFjdGlvbi5zdGF0dXMgPT09IEFjdGlvblN0YXR1cy5TdGFydDsgfSkKICAgICAgICAuZG8oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVjb3JkRXZlbnQoVXNlckV2ZW50cy5Mb2dnZWRPdXQpOyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICBpZiAoZ2V0VG9rZW4oKSA9PT0gQVVUSF9UT0tFTl9OT05FKSB7CiAgICAgICAgICAgIC8vIGNsZWFyIGNvb2tpZXMsIGp1c3QgaW4gY2FzZSB0aGV5IGV4aXN0CiAgICAgICAgICAgIGRlbGV0ZUF1dGhDb29raWUoKTsKICAgICAgICAgICAgZGVsZXRlVEZBTmVlZGVkQ29va2llKCk7CiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKGF1dGhMb2dvdXQobnVsbCwgbnVsbCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbG9nb3V0QWxsUmVxdWVzdCgpCiAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkZWxldGVBdXRoQ29va2llKCk7CiAgICAgICAgICAgIGRlbGV0ZVRGQU5lZWRlZENvb2tpZSgpOwogICAgICAgICAgICBzZXRUb2tlbihBVVRIX1RPS0VOX05PTkUpOwogICAgICAgICAgICByZXR1cm4gYXV0aExvZ291dEFsbChudWxsLCBudWxsKTsKICAgICAgICB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE9ic2VydmFibGUub2YodG9hc3RTZXQoZSkpOyB9KTsKICAgIH0pOwp9Owp2YXIgbG9nb3V0U3VjY2VzcyA9IGZ1bmN0aW9uIChhY3Rpb24kLCBzdG9yZSkgewogICAgcmV0dXJuIGFjdGlvbiQub2ZUeXBlKEFVVEhfTE9HT1VUKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN1Y2Nlc3M7IH0pCiAgICAgICAgLmZsYXRNYXAoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gY2xlYXJFdmVyeXRoaW5nKHN0b3JlKS5tYXAoZnVuY3Rpb24gKCkgeyByZXR1cm4gYWN0aW9uOyB9KTsgfSkKICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZhbHNlOyB9KTsKfTsKdmFyIGxvZ2luT0F1dGggPSBmdW5jdGlvbiAoYWN0aW9uJCwgc3RvcmUpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShBVVRIX09BVVRIX0xPR0lOKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICBjbGVhckF1dGhEYXRhKCk7CiAgICAgICAgdmFyIF9hID0gYWN0aW9uLm1ldGEsIHRlYW1JbnZpdGVOb25jZSA9IF9hLnRlYW1JbnZpdGVOb25jZSwgdGVhbUludml0ZVBheWxvYWQgPSBfYS50ZWFtSW52aXRlUGF5bG9hZDsKICAgICAgICB2YXIgbm90Rm91bmRVcmwgPSBnZXRVcmwoJy9sb2dpbi9jaG9vc2VQYXNzd29yZCcsIHRydWUpOwogICAgICAgIHZhciBsb2dpblN1Y2Nlc3NVcmwgPSBnZXRVcmwoJy9tYWlsJywgdHJ1ZSk7CiAgICAgICAgLy8gQWRkIFVuc3Vic2NyaWJlciBVUkwgZGlyZWN0aW9ucyBpZiBuZWVkZWQKICAgICAgICBpZiAoc3RvcmUuZ2V0U3RhdGUoKS51bnN1YnNjcmliZXJTaWdudXApIHsKICAgICAgICAgICAgbm90Rm91bmRVcmwgPSBnZXRVcmwoJy9sb2dpbi9jaG9vc2VQYXNzd29yZD91bnN1YnNjcmliZXI9MScpOwogICAgICAgICAgICBsb2dpblN1Y2Nlc3NVcmwgPSBnZXRVcmwoJy91bnN1YnNjcmliZXInKTsKICAgICAgICB9CiAgICAgICAgLy8gUmVkaXJlY3QgYmFjayBhZnRlciBsb2dnaW5nIGluCiAgICAgICAgaWYgKHRlYW1JbnZpdGVOb25jZSAmJiB0ZWFtSW52aXRlUGF5bG9hZCkgewogICAgICAgICAgICBsb2dpblN1Y2Nlc3NVcmwgPSBnZXRVcmwoIi90ZWFtSW52aXRlcy8iICsgZW5jb2RlVVJJQ29tcG9uZW50KHRlYW1JbnZpdGVOb25jZSkgKyAiLyIgKyBlbmNvZGVVUklDb21wb25lbnQodGVhbUludml0ZVBheWxvYWQpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9BdXRoTG9naW4oYWN0aW9uLm1ldGEsIGxvZ2luU3VjY2Vzc1VybCwgbm90Rm91bmRVcmwpCiAgICAgICAgICAgIC5kbyhmdW5jdGlvbiAodXJsKSB7IHJldHVybiB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHVybDsgfSkKICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAodXJsKSB7IHJldHVybiBhdXRoT0F1dGhMb2dpbihhY3Rpb24ubWV0YSwgdXJsKTsgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm9mKHRvYXN0U2V0KGUpKTsgfSk7CiAgICB9KTsKfTsKdmFyIHZhbGlkYXRlVGZhID0gZnVuY3Rpb24gKGFjdGlvbiQpIHsKICAgIHJldHVybiBhY3Rpb24kLm9mVHlwZShBVVRIX1RGQV9DT0RFX1ZBTElEQVRFKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gdXBncmFkZVRmYUxvZ2luKGFjdGlvbi5tZXRhKQogICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICBzZXRBdXRoQ29va2llKHJlc3BvbnNlKTsKICAgICAgICAgICAgc2V0VG9rZW4ocmVzcG9uc2UudG9rZW4pOwogICAgICAgICAgICByZXR1cm4gYXV0aFRmYUNvZGVWYWxpZGF0ZShhY3Rpb24ubWV0YSwgcmVzcG9uc2UpOwogICAgICAgIH0pCiAgICAgICAgICAgIC5kbyhmdW5jdGlvbiAoKSB7IHJldHVybiByZWNvcmRFdmVudChVc2VyRXZlbnRzLkxvZ2dlZEluKTsgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKE9ic2VydmFibGUub2YodG9hc3RTZXQoZSkpLCBPYnNlcnZhYmxlLm9mKGF1dGhUZmFDb2RlVmFsaWRhdGUoYWN0aW9uLm1ldGEsIGUpKSk7IH0pOwogICAgfSk7Cn07CnZhciBzZW5kVGZhID0gZnVuY3Rpb24gKGFjdGlvbiQsIHN0b3JlKSB7CiAgICByZXR1cm4gYWN0aW9uJC5vZlR5cGUoQVVUSF9URkFfQ09ERV9TRU5EKQogICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKGFjdGlvbikgeyByZXR1cm4gYWN0aW9uLnN0YXR1cyA9PT0gQWN0aW9uU3RhdHVzLlN0YXJ0OyB9KQogICAgICAgIC5mbGF0TWFwKGZ1bmN0aW9uIChhY3Rpb24pIHsKICAgICAgICByZXR1cm4gc2VuZFRmYUNvZGUoKQogICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChwYXlsb2FkKSB7IHJldHVybiBhdXRoVGZhQ29kZVNlbmQoYWN0aW9uLm1ldGEsIHBheWxvYWQpOyB9KQogICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoT2JzZXJ2YWJsZS5vZih0b2FzdFNldChlKSksIE9ic2VydmFibGUub2YoYXV0aFRmYUNvZGVTZW5kKGFjdGlvbi5tZXRhLCBlKSkpOyB9KTsKICAgIH0pOwp9OwpleHBvcnQgZGVmYXVsdCBbCiAgICBzdGFydHVwLAogICAgbG9naW4sCiAgICBsb2dpblN1Y2Nlc3NTdGFydHVwLAogICAgbG9nb3V0LAogICAgbG9nb3V0U3VjY2VzcywKICAgIGxvZ291dEFsbCwKICAgIHBhc3N3b3JkUmVzZXRFcGljLAogICAgbG9naW5PQXV0aCwKICAgIHZhbGlkYXRlVGZhLAogICAgc2VuZFRmYSwKICAgIGdldE1hZ2ljTGlua0VwaWMsCiAgICBjbGVhclJlZGlyZWN0UGxhdGZvcm1FcGljLAogICAgZ2V0TG9naW5Ub2tlbkVwaWMsCl07Cg=="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/auth.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/epics/auth.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable } from 'rxjs';\nimport { Epic } from 'redux-observable';\n\nimport { AUTH_TOKEN_NONE, getToken, setToken } from '@src/api/base';\n\nimport {\n  meFetch,\n  onboardingFetch,\n} from '@src/ducks/me';\nimport { teamFetch } from '@src/ducks/team';\n\nimport { contactGroupsList } from '@src/ducks/contactGroups';\n\nimport { StoreState, Action, ActionStatus, LoginToken, DevicePlatform } from '@src/types';\n\nimport {\n  START, start,\n  AUTH_LOGIN, AuthLoginMeta, authLogin,\n  AUTH_LOGOUT, authLogout,\n  AUTH_PASSWORD_RESET,\n  authPasswordReset,\n  AUTH_LOGOUT_ALL,\n  authLogoutAll,\n  AUTH_OAUTH_LOGIN,\n  authOAuthLogin,\n  AuthOAuthLoginMeta,\n  authTfaCodeValidate,\n  AUTH_TFA_CODE_SEND,\n  authTfaCodeSend,\n  AUTH_TFA_CODE_VALIDATE,\n  authGetMagicLink,\n  AUTH_GET_MAGIC_LINK,\n  MagicLinkMeta,\n  AUTH_CLEAR_REDIRECT,\n  authClearRedirect,\n  AUTH_GET_LOGIN_TOKEN,\n  authGetLoginToken,\n} from '@src/ducks/auth';\n\nimport {\n  login as loginRequest,\n  logout as logoutRequest,\n  logoutAll as logoutAllRequest,\n  passwordReset,\n  oAuthLogin,\n  upgradeTfaLogin,\n  sendTfaCode,\n  Token,\n  TokenType,\n  getMagicLink,\n  getLoginToken,\n} from '@src/api/auth';\nimport { integrationList } from '@src/ducks/integrations';\nimport { recordEvent, UserEvents } from '@src/lib/analytics';\nimport { schedulingList } from '@src/ducks/scheduling';\nimport { toastSet } from '@src/ducks/toasts';\nimport { getUrl } from '@src/lib/utils';\nimport browserHistory from '@src/lib/browserHistory';\nimport { setAuthCookie, deleteAuthCookie, deleteTFANeededCookie, STANDARD_COOKIE_ATTRIBUTES } from '@src/lib/cookies';\nimport { clearEverything, clearAuthData } from '@src/lib/auth';\nimport { filtersList } from '@src/ducks/filters';\nimport { isElectronMac, isElectronWindows, isElectron } from '@src/lib/electron';\nimport Cookies from 'js-cookie';\nimport moment from 'moment';\nimport { Deps } from '@src/lib/epic';\n\nconst getLoginTokenEpic: Epic<\n  Action<Error|null, LoginToken|null>, StoreState, Deps\n> = (action$, store, deps) =>\n  action$.ofType(AUTH_GET_LOGIN_TOKEN)\n    .filter(action => action.status === ActionStatus.Start)\n    .flatMap((action: Action<null, LoginToken>) => {\n\n      // Base token request\n      let tokenRequest = getLoginToken();\n\n      // If reuse token reuseTTL is still valid then use existing token\n      const foundTokenCookie = Cookies.get('pmlt');\n      const foundToken: LoginToken|undefined = foundTokenCookie && JSON.parse(foundTokenCookie);\n      if (foundToken?.reuseDate && moment(deps.now()).isBefore(moment(foundToken.reuseDate))) {\n        tokenRequest = Observable.of(foundToken);\n      }\n\n      return tokenRequest\n        .do((token) => {\n          if (token) {\n            // Identify platform\n            let platform = DevicePlatform.Web;\n            if (isElectronMac) {\n              platform = DevicePlatform.macOS;\n            }\n            if (isElectronWindows) {\n              platform = DevicePlatform.Windows;\n            }\n            const encoded = encodeURIComponent(token.public);\n\n            // TODO(SHIN): Pass ttl in url with token\n            window.open(`\n              ${window.location.origin}/login?redirect_platform=${platform}&pmpt=${encoded}&ttl=${token.ttl}`,\n            );\n          }\n        })\n        .flatMap((token) => {\n          const reuseDate = token.reuseTtl &&\n            moment(deps.now()).add(token.reuseTtl, 'seconds').toDate() || undefined;\n          const updated: LoginToken = {\n            ...token,\n            reuseDate,\n          };\n\n          // Return success case\n          return Observable.merge(\n            Observable.of(authGetLoginToken(action.meta, updated)),\n          );\n        })\n        .catch((e: Error) => {\n          return Observable.of(authGetLoginToken(action.meta, e));\n        });\n    });\n\nconst getMagicLinkEpic: Epic<\n  Action<MagicLinkMeta|Error|null, null>, StoreState\n> = (action$, store) =>\n  action$.ofType(AUTH_GET_MAGIC_LINK)\n    .filter(action => action.status === ActionStatus.Start)\n    .flatMap((action: Action<MagicLinkMeta, null>) =>\n      getMagicLink({\n        ...action.meta,\n        token: JSON.parse(Cookies.get('pmlt') || '{}')?.public,\n      })\n        .flatMap((magicLink) => {\n          // Handle redirect for magic link\n          if (magicLink?.code) {\n            window.location.href = `polymail://auth/magic?code=${encodeURIComponent(magicLink.code)}`;\n          }\n\n          // Return success case\n          return Observable.merge(\n            Observable.of(authGetMagicLink(action.meta, null)),\n          );\n\n        })\n        .catch((e: Error) => {\n          // If request failed redirect anyways so backup mechanism can be used\n          window.location.href = `polymail://auth/magic`;\n\n          return Observable.merge(\n            Observable.of(toastSet(new Error(\n              'We ran into an issue trying to create a magic link for your email. '\n              + 'Please try again!',\n            ))),\n            Observable.of(authGetMagicLink(action.meta, e)),\n          );\n        }),\n  );\n\nconst clearRedirectPlatformEpic: Epic<\n  Action<null, null>, StoreState\n> = (action$, deps, store) =>\n  action$.ofType(AUTH_CLEAR_REDIRECT)\n    .filter(action => action.status === ActionStatus.Start)\n    .do(() => {\n      browserHistory.replace('/settings');\n    })\n    .map((action: Action<null, null>) => {\n      return authClearRedirect(null, null);\n    },\n  );\n\nconst passwordResetEpic: Epic<Action<string|Error|null, null>, StoreState> = action$ =>\n  action$.ofType(AUTH_PASSWORD_RESET)\n    .filter(action => action.status === ActionStatus.Start)\n    .flatMap((action: Action<string, null>) =>\n      passwordReset(action.meta)\n        .flatMap(() =>\n          Observable.merge(\n            Observable.of(authPasswordReset(action.meta, null)),\n            Observable.of(toastSet(new Error(\n              `An email to reset your password has been sent to ${action.meta}.` +\n              'The link will be valid for 1 hour.',\n            ))),\n          ))\n        .catch((e: Error) => {\n          return Observable.merge(\n            Observable.of(toastSet(new Error(\n              'We ran into an issue trying to create a reset link for your email. '\n              + 'Please try again!',\n            ))),\n            Observable.of(authPasswordReset(action.meta, e)),\n          );\n        }),\n  );\n\nconst login: Epic<Action<AuthLoginMeta|Error|null, Token|null>, StoreState> = (action$, store) =>\n action$.ofType(AUTH_LOGIN)\n  .filter(action => action.status === ActionStatus.Start)\n  .flatMap((action: Action<AuthLoginMeta, Token>) =>\n      loginRequest({\n        ...action.meta,\n        token: !!action.meta.magicCode &&\n          JSON.parse(Cookies.get('pmlt') || '{}')?.private || undefined,\n      })\n        .map((token) => {\n          clearAuthData();\n          setAuthCookie(token);\n          setToken(token.token);\n\n          // Clear login token\n          if (isElectron) {\n            Cookies.remove(\n              'pmlt',\n              STANDARD_COOKIE_ATTRIBUTES,\n            );\n          }\n\n          return authLogin(action.meta, token);\n        })\n        .do((a: Action<AuthLoginMeta, Token|null>) => {\n          if (!!a.payload && a.payload.type === TokenType.Basic) {\n            browserHistory.replace('/login/tfa');\n          } else if (a.meta.magicCode) {\n            browserHistory.replace('/');\n          }\n        })\n        .do(() => recordEvent(UserEvents.LoggedIn))\n        .catch((e: Error) => Observable.merge(\n          Observable.of(toastSet(e)),\n          Observable.of(authLogin(action.meta, e)),\n        )),\n  );\n\nconst loginSuccessStartup: Epic<any, StoreState> = (action$, store) =>\n  action$.ofType(AUTH_LOGIN, AUTH_TFA_CODE_VALIDATE)\n    .filter(action => action.status === ActionStatus.Success && !store.getState().tfaNeeded)\n    .flatMap(action =>\n      Observable.of(start(null)),\n    );\n\nconst startup: Epic<Action<any, any>, StoreState> = (action$, store) =>\n  action$.ofType(START)\n    .flatMap(action =>\n      Observable.merge(\n        Observable.of(meFetch('')),\n        Observable.of(teamFetch('')),\n        Observable.of(contactGroupsList('')),\n        Observable.of(integrationList(null)),\n        Observable.of(onboardingFetch(null)),\n        Observable.of(schedulingList(null)),\n        Observable.of(filtersList(null)),\n        // TODO(SHIN): Turn on for 2021 year in review\n        // Observable.of(yearlySummaryFetch(2020)),\n      ),\n    );\n\nconst logout: Epic<Action<null|Error, null>, StoreState> = (action$, store) =>\n  action$.ofType(AUTH_LOGOUT)\n    .filter(action => action.status === ActionStatus.Start)\n    .do(() => recordEvent(UserEvents.LoggedOut))\n    .flatMap((action) => {\n      if (getToken() === AUTH_TOKEN_NONE) {\n        // clear cookies, just in case they exist\n        deleteAuthCookie();\n        deleteTFANeededCookie();\n        return Observable.of(authLogout(null, null));\n      }\n\n      return logoutRequest()\n        .map(() => {\n          deleteAuthCookie();\n          deleteTFANeededCookie();\n          setToken(AUTH_TOKEN_NONE);\n          return authLogout(null, null);\n        })\n        .catch(e =>\n          Observable.merge(\n            Observable.of(toastSet(e)),\n          ));\n    });\n\nconst logoutAll: Epic<Action<null|Error, null>, StoreState> = (action$, store) =>\n  action$.ofType(AUTH_LOGOUT_ALL)\n    .filter(action => action.status === ActionStatus.Start)\n    .do(() => recordEvent(UserEvents.LoggedOut))\n    .flatMap((action) => {\n      if (getToken() === AUTH_TOKEN_NONE) {\n        // clear cookies, just in case they exist\n        deleteAuthCookie();\n        deleteTFANeededCookie();\n        return Observable.of(authLogout(null, null));\n      }\n\n      return logoutAllRequest()\n        .map(() => {\n          deleteAuthCookie();\n          deleteTFANeededCookie();\n          setToken(AUTH_TOKEN_NONE);\n          return authLogoutAll(null, null);\n        })\n        .catch(e => Observable.of(toastSet(e)));\n    });\n\nconst logoutSuccess: Epic<Action<any, any>, StoreState> = (action$, store) =>\n  action$.ofType(AUTH_LOGOUT)\n    .filter(action => action.status === ActionStatus.Success)\n    .flatMap(action => clearEverything(store).map(() => action))\n    .filter(() => false);\n\nconst loginOAuth: Epic<Action<any, any>, StoreState> = (action$, store) =>\n  action$.ofType(AUTH_OAUTH_LOGIN)\n    .filter(action => action.status === ActionStatus.Start)\n    .flatMap((action: Action<AuthOAuthLoginMeta, string>) => {\n      clearAuthData();\n      const { teamInviteNonce, teamInvitePayload } = action.meta;\n\n      let notFoundUrl = getUrl('/login/choosePassword', true);\n      let loginSuccessUrl = getUrl('/mail', true);\n\n      // Add Unsubscriber URL directions if needed\n      if (store.getState().unsubscriberSignup) {\n        notFoundUrl = getUrl('/login/choosePassword?unsubscriber=1');\n        loginSuccessUrl = getUrl('/unsubscriber');\n      }\n\n      // Redirect back after logging in\n      if (teamInviteNonce && teamInvitePayload) {\n        loginSuccessUrl = getUrl(`/teamInvites/${encodeURIComponent(teamInviteNonce)}/${encodeURIComponent(teamInvitePayload)}`);\n      }\n\n      return oAuthLogin(action.meta, loginSuccessUrl, notFoundUrl)\n        .do(url => window.location.href = url)\n        .map(url => authOAuthLogin(action.meta, url))\n        .catch(e => Observable.of(toastSet(e)));\n    });\n\nconst validateTfa: Epic<Action<any, any>, StoreState> = action$ =>\n  action$.ofType(AUTH_TFA_CODE_VALIDATE)\n    .filter(action => action.status === ActionStatus.Start)\n    .flatMap((action: Action<string, string>) => {\n      return upgradeTfaLogin(action.meta)\n        .map((response: Token) => {\n          setAuthCookie(response);\n          setToken(response.token);\n          return authTfaCodeValidate(action.meta, response);\n        })\n        .do(() => recordEvent(UserEvents.LoggedIn))\n        .catch((e: Error) => Observable.merge(\n          Observable.of(toastSet(e)),\n          Observable.of(authTfaCodeValidate(action.meta, e)),\n        ));\n    });\n\nconst sendTfa: Epic<Action<any, any>, StoreState>\n  = (action$, store) =>\n    action$.ofType(AUTH_TFA_CODE_SEND)\n      .filter(action => action.status === ActionStatus.Start)\n      .flatMap(action =>\n        sendTfaCode()\n          .map(payload => authTfaCodeSend(action.meta, payload))\n          .catch((e: Error) => Observable.merge(\n            Observable.of(toastSet(e)),\n            Observable.of(authTfaCodeSend(action.meta, e)),\n          )),\n      );\n\nexport default [\n  startup,\n  login,\n  loginSuccessStartup,\n  logout,\n  logoutSuccess,\n  logoutAll,\n  passwordResetEpic,\n  loginOAuth,\n  validateTfa,\n  sendTfa,\n  getMagicLinkEpic,\n  clearRedirectPlatformEpic,\n  getLoginTokenEpic,\n];\n"]}]}