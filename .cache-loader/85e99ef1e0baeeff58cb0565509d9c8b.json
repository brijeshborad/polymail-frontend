{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Sequences/routes/SequenceDetail/UploadRecipient/UploadRecipient.tsx","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Sequences/routes/SequenceDetail/UploadRecipient/UploadRecipient.tsx","mtime":1675280254089},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewogICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewogICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAogICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKICAgIH07CiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwogICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQogICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKICAgIH07Cn0pKCk7CnZhciBfX2Fzc2lnbiA9ICh0aGlzICYmIHRoaXMuX19hc3NpZ24pIHx8IGZ1bmN0aW9uICgpIHsKICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7CiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07CiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkKICAgICAgICAgICAgICAgIHRbcF0gPSBzW3BdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdDsKICAgIH07CiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfTsKaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JzsKaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7CmltcG9ydCBSZWFjdERhdGFHcmlkLCB7IFJvdyBhcyBSb3dDb21wb25lbnQgfSBmcm9tICdyZWFjdC1kYXRhLWdyaWQnOwppbXBvcnQgeyBGaWxlRHJvcFpvbmUgfSBmcm9tICdAc3JjL2NvbXBvbmVudHMvQ29tcG9zZS9GaWxlRHJvcFpvbmUnOwppbXBvcnQgJy4vVXBsb2FkUmVjaXBpZW50LnNjc3MnOwppbXBvcnQgVXBsb2FkQnV0dG9uIGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL1VwbG9hZEJ1dHRvbic7CmltcG9ydCBDaGVja2JveCBmcm9tICdAc3JjL2NvbXBvbmVudHMvRm9ybS9DaGVja2JveC9DaGVja2JveCc7CmltcG9ydCB7IEtleUNvZGUsIFJlc291cmNlU3RhdHVzIH0gZnJvbSAnQHNyYy90eXBlcyc7Ci8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGgKaW1wb3J0IENvbnRhY3RUeXBlYWhlYWRQb3BvdmVyIGZyb20gJ0BzcmMvY29tcG9uZW50cy9Gb3JtL1JlY2lwaWVudHNFZGl0b3IvY29tcG9uZW50cy9Db250YWN0VHlwZWFoZWFkUG9wb3Zlcic7CmltcG9ydCBTYWxlc2ZvcmNlIGZyb20gJ0BzcmMvY29tcG9uZW50cy9JY29ucy9TYWxlc2ZvcmNlLnN2Zyc7CmltcG9ydCBDc3YgZnJvbSAnQHNyYy9jb21wb25lbnRzL0ljb25zL0Nzdi5zdmcnOwppbXBvcnQgUGx1cyBmcm9tICdAc3JjL2NvbXBvbmVudHMvSWNvbnMvUGx1cy5zdmcnOwppbXBvcnQgQ2xvc2UgZnJvbSAnQHNyYy9jb21wb25lbnRzL0ljb25zL0Nsb3NlLnN2Zyc7CmltcG9ydCBSZWNpcGllbnRSZW1vdmVDZWxsIGZyb20gJ0BzcmMvY29tcG9uZW50cy9DZWxscy9SZWNpcGllbnRSZW1vdmVDZWxsL1JlY2lwaWVudFJlbW92ZUNlbGwnOwppbXBvcnQgVXBsb2FkUmVjaXBpZW50U2FsZXNmb3JjZSBmcm9tICcuL1VwbG9hZFJlY2lwaWVudFNhbGVzZm9yY2UnOwppbXBvcnQgUmVjaXBpZW50RW1haWxDZWxsIGZyb20gJ0BzcmMvY29tcG9uZW50cy9DZWxscy9SZWNpcGllbnRFbWFpbENlbGwvUmVjaXBpZW50RW1haWxDZWxsJzsKaW1wb3J0IFBvcG92ZXIgZnJvbSAnQHNyYy9jb21wb25lbnRzL1BvcG92ZXIvUG9wb3Zlcic7CmltcG9ydCB7IGRlYm91bmNlLCBjYXBpdGFsaXplIH0gZnJvbSAnbG9kYXNoJzsKLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aAppbXBvcnQgUmVjaXBpZW50RWRpdGFibGVDZWxsIGZyb20gJ0BzcmMvY29tcG9uZW50cy9DZWxscy9SZWNpcGllbnRFZGl0YWJsZUNlbGwvUmVjaXBpZW50RWRpdGFibGVDZWxsJzsKaW1wb3J0IExvYWRlciBmcm9tICdAc3JjL2NvbXBvbmVudHMvTG9hZGVyL0xvYWRlcic7CmltcG9ydCBDb25maXJtIGZyb20gJ0BzcmMvY29tcG9uZW50cy9CYXNlL0NvbmZpcm0nOwppbXBvcnQgeyB1cGxvYWRFcnJvck1lc3NhZ2UgfSBmcm9tICdAc3JjL2xpYi9maWxlcyc7CmltcG9ydCB7IEFtcGxpdHVkZUV2ZW50cywgbG9nQW1wbGl0dWRlRXZlbnQgfSBmcm9tICdAc3JjL2xpYi9hbXBsaXR1ZGUtYW5hbHl0aWNzJzsKdmFyIENFTExfV0lEVEggPSAyNDA7CnZhciBXSU5ET1dfTUFSR0lOID0gNDA7CnZhciBVcGxvYWRSZWNpcGllbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CiAgICBfX2V4dGVuZHMoVXBsb2FkUmVjaXBpZW50LCBfc3VwZXIpOwogICAgZnVuY3Rpb24gVXBsb2FkUmVjaXBpZW50KHByb3BzKSB7CiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpczsKICAgICAgICBfdGhpcy5oYW5kbGVSZWNpcGllbnRJbnB1dENoYW5nZSA9IGZ1bmN0aW9uICh2YWx1ZSwgaGVhZGVyLCBpbmRleCwgdmFsaWRhdGUpIHsKICAgICAgICAgICAgdmFyIF9hLCBfYjsKICAgICAgICAgICAgdmFyIF9jID0gX3RoaXMucHJvcHMsIHJlY2lwaWVudHMgPSBfYy5yZWNpcGllbnRzLCB1cGRhdGVUZW1wU2VxdWVuY2VSZWNpcGllbnQgPSBfYy51cGRhdGVUZW1wU2VxdWVuY2VSZWNpcGllbnQ7CiAgICAgICAgICAgIHZhciBvbGRSZWNpcGllbnQgPSBpbmRleCA+PSAwID8gcmVjaXBpZW50cyAmJiByZWNpcGllbnRzW2luZGV4XSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgaWYgKG9sZFJlY2lwaWVudCAmJiBvbGRSZWNpcGllbnQuZGF0YSkgewogICAgICAgICAgICAgICAgdmFyIHJlY2lwaWVudCA9IF9fYXNzaWduKHt9LCBvbGRSZWNpcGllbnQuZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAoaGVhZGVyID09PSAnZW1haWwnKSB7CiAgICAgICAgICAgICAgICAgICAgcmVjaXBpZW50LmVtYWlsID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIGlmIChoZWFkZXIgPT09ICdsYXN0IG5hbWUnKSB7CiAgICAgICAgICAgICAgICAgICAgcmVjaXBpZW50LmZhbWlseU5hbWUgPSB2YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGhlYWRlciA9PT0gJ2ZpcnN0IG5hbWUnKSB7CiAgICAgICAgICAgICAgICAgICAgcmVjaXBpZW50LmdpdmVuTmFtZSA9IHZhbHVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVjaXBpZW50LnZhcmlhYmxlcyA9IHJlY2lwaWVudC52YXJpYWJsZXMgPyBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgcmVjaXBpZW50LnZhcmlhYmxlcyksIChfYSA9IHt9LCBfYVtoZWFkZXJdID0gdmFsdWUsIF9hKSkgOiAoX2IgPSB7fSwgX2JbaGVhZGVyXSA9IHZhbHVlLCBfYik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1cGRhdGVUZW1wU2VxdWVuY2VSZWNpcGllbnQoewogICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleCwKICAgICAgICAgICAgICAgICAgICByZWNpcGllbnQ6IHJlY2lwaWVudCwKICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZTogdmFsaWRhdGUsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuY3JlYXRlRW1wdHlSb3cgPSBmdW5jdGlvbiAoaGVhZGVycykgewogICAgICAgICAgICB2YXIgcm93ID0gewogICAgICAgICAgICAgICAgZW1haWxQcm9wczogewogICAgICAgICAgICAgICAgICAgIGVtYWlsOiAnJywKICAgICAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBvbklucHV0Q2hhbmdlOiBfdGhpcy5oYW5kbGVSZWNpcGllbnRJbnB1dENoYW5nZSwKICAgICAgICAgICAgICAgICAgICBvblRhYjogX3RoaXMuaGFuZGxlUmVjaXBpZW50VGFiLAogICAgICAgICAgICAgICAgICAgIG9uSW52YWxpZFJlYXNvbk1vdXNlRW50ZXI6IF90aGlzLmhhbmRsZUludmFsaWRSZWFzb25Nb3VzZUVudGVyLAogICAgICAgICAgICAgICAgICAgIG9uSW52YWxpZFJlYXNvbk1vdXNlTGVhdmU6IF90aGlzLmhhbmRsZUludmFsaWRSZWFzb25Nb3VzZUxlYXZlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHJlbW92ZUJ1dHRvblByb3BzOiB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IDAsCiAgICAgICAgICAgICAgICAgICAgb25SZW1vdmU6IF90aGlzLmhhbmRsZVJlbW92ZSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChoZWFkZXJzKSB7CiAgICAgICAgICAgICAgICBoZWFkZXJzLmZvckVhY2goZnVuY3Rpb24gKGgpIHsgcmV0dXJuIHJvd1toLnRvTG93ZXJDYXNlKCldID0gewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IGgudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgICAgICBvbklucHV0Q2hhbmdlOiBfdGhpcy5oYW5kbGVSZWNpcGllbnRJbnB1dENoYW5nZSwKICAgICAgICAgICAgICAgICAgICBvblRhYjogX3RoaXMuaGFuZGxlUmVjaXBpZW50VGFiLAogICAgICAgICAgICAgICAgfTsgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJvdzsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUludmFsaWRSZWFzb25Nb3VzZUVudGVyID0gZnVuY3Rpb24gKGUsIGludmFsaWRSZWFzb24pIHsKICAgICAgICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0OwogICAgICAgICAgICB2YXIgcmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaW52YWxpZFJlYXNvbjogaW52YWxpZFJlYXNvbiwKICAgICAgICAgICAgICAgIGludmFsaWRQb3BvdmVyUG9zaXRpb246IHsKICAgICAgICAgICAgICAgICAgICB0b3A6IHJlY3QudG9wICsgMjUsCiAgICAgICAgICAgICAgICAgICAgbGVmdDogcmVjdC5sZWZ0IC0gNSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIF90aGlzLmludmFsaWRQb3BvdmVyU2hvd0RlYm91bmNlKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlSW52YWxpZFJlYXNvbk1vdXNlTGVhdmUgPSBmdW5jdGlvbiAoZSwgaW52YWxpZFJlYXNvbikgewogICAgICAgICAgICBfdGhpcy5pbnZhbGlkUG9wb3ZlckhpZGVEZWJvdW5jZSgpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlRHJhZ0VudGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgICAgIGlmIChldmVudC5kYXRhVHJhbnNmZXIudHlwZXMuaW5kZXhPZignRmlsZXMnKSAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgZHJvcHpvbmVBY3RpdmU6IHRydWUgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZURyYWdMZWF2ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBkcm9wem9uZUFjdGl2ZTogZmFsc2UgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVJbnB1dENoYW5nZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHZhciBfYTsKICAgICAgICAgICAgdmFyIHRhcmdldCA9IGUuY3VycmVudFRhcmdldDsKICAgICAgICAgICAgdmFyIHRlbXBSb3cgPSBfdGhpcy5zdGF0ZS50ZW1wUm93OwogICAgICAgICAgICB2YXIgbmFtZSA9IHRhcmdldC5uYW1lOwogICAgICAgICAgICAvLyBDbG9uZSByb3dzIGFuZCB1cGRhdGUKICAgICAgICAgICAgaWYgKG5hbWUgJiYgdGVtcFJvdykgewogICAgICAgICAgICAgICAgaWYgKG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2VtYWlsJykgewogICAgICAgICAgICAgICAgICAgIF90aGlzLnNlYXJjaENvbnRhY3RUeXBlYWhlYWREZWJvdW5jZSh0YXJnZXQudmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyB0ZW1wUm93OiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgdGVtcFJvdyksIChfYSA9IHt9LCBfYVtuYW1lLnRvTG93ZXJDYXNlKCldID0gdGFyZ2V0LnZhbHVlLCBfYSkpIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVSZWNpcGllbnRUYWIgPSBmdW5jdGlvbiAoc2hpZnRLZXksIGhlYWRlciwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBfdGhpcy5wcm9wcy5oZWFkZXJzOwogICAgICAgICAgICB2YXIgaGVhZGVySW5kZXggPSBoZWFkZXJzICYmIGhlYWRlcnMuaW5kZXhPZihoZWFkZXIpOwogICAgICAgICAgICBpZiAoaGVhZGVycyAmJiBoZWFkZXJJbmRleCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICB2YXIgaW5wdXQgPSB2b2lkIDA7CiAgICAgICAgICAgICAgICBpZiAoc2hpZnRLZXkgJiYgaGVhZGVySW5kZXggIT09IDApIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImlucHV0W25hbWU9JyIgKyBoZWFkZXJzW2hlYWRlckluZGV4IC0gMV0gKyAiLSIgKyBpbmRleCArICInXSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoIXNoaWZ0S2V5ICYmIGhlYWRlckluZGV4ICE9PSBoZWFkZXJzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICBpbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImlucHV0W25hbWU9JyIgKyBoZWFkZXJzW2hlYWRlckluZGV4ICsgMV0gKyAiLSIgKyBpbmRleCArICInXSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuY3JlYXRlUm93ID0gZnVuY3Rpb24gKHJvdywgaW5kZXgsIGhlYWRlcnMpIHsKICAgICAgICAgICAgdmFyIG5ld1JvdyA9IHsKICAgICAgICAgICAgICAgIGlzU2VsZWN0ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgaWQ6IHJvdy5lbWFpbCArICItIiArIGluZGV4LAogICAgICAgICAgICAgICAgZW1haWxQcm9wczogewogICAgICAgICAgICAgICAgICAgIGVtYWlsOiByb3cuZW1haWwsCiAgICAgICAgICAgICAgICAgICAgaW52YWxpZFJlYXNvbjogcm93LmludmFsaWRSZWFzb24sCiAgICAgICAgICAgICAgICAgICAgbG9hZGluZzogcm93LmxvYWRpbmcsCiAgICAgICAgICAgICAgICAgICAgb25UYWI6IF90aGlzLmhhbmRsZVJlY2lwaWVudFRhYiwKICAgICAgICAgICAgICAgICAgICBvbklucHV0Q2hhbmdlOiBfdGhpcy5oYW5kbGVSZWNpcGllbnRJbnB1dENoYW5nZSwKICAgICAgICAgICAgICAgICAgICBvbkludmFsaWRSZWFzb25Nb3VzZUVudGVyOiBfdGhpcy5oYW5kbGVJbnZhbGlkUmVhc29uTW91c2VFbnRlciwKICAgICAgICAgICAgICAgICAgICBvbkludmFsaWRSZWFzb25Nb3VzZUxlYXZlOiBfdGhpcy5oYW5kbGVJbnZhbGlkUmVhc29uTW91c2VMZWF2ZSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZW1vdmVCdXR0b25Qcm9wczogewogICAgICAgICAgICAgICAgICAgIG9uUmVtb3ZlOiBfdGhpcy5oYW5kbGVSZW1vdmUsCiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGluZGV4LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKGhlYWRlcnMpIHsKICAgICAgICAgICAgICAgIGhlYWRlcnMuZm9yRWFjaChmdW5jdGlvbiAoaCkgewogICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHJvd1toLnRvTG93ZXJDYXNlKCldOwogICAgICAgICAgICAgICAgICAgIG5ld1Jvd1toLnRvTG93ZXJDYXNlKCldID0gewogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcjogaC50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBvblRhYjogX3RoaXMuaGFuZGxlUmVjaXBpZW50VGFiLAogICAgICAgICAgICAgICAgICAgICAgICBvbklucHV0Q2hhbmdlOiBfdGhpcy5oYW5kbGVSZWNpcGllbnRJbnB1dENoYW5nZSwKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG5ld1JvdzsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVJlbW92ZSA9IGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICAgICB2YXIgcmVtb3ZlVGVtcFNlcXVlbmNlUmVjaXBpZW50ID0gX3RoaXMucHJvcHMucmVtb3ZlVGVtcFNlcXVlbmNlUmVjaXBpZW50OwogICAgICAgICAgICByZW1vdmVUZW1wU2VxdWVuY2VSZWNpcGllbnQoaW5kZXggLSAxKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUFkZFJvdyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGFkZFRlbXBTZXF1ZW5jZVJlY2lwaWVudCA9IF90aGlzLnByb3BzLmFkZFRlbXBTZXF1ZW5jZVJlY2lwaWVudDsKICAgICAgICAgICAgdmFyIHRlbXBSb3cgPSBfdGhpcy5zdGF0ZS50ZW1wUm93OwogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICB0ZW1wUm93OiB7IGVtYWlsOiAnJywgJ2xhc3QgbmFtZSc6ICcnLCAnZmlyc3QgbmFtZSc6ICcnIH0sCiAgICAgICAgICAgICAgICBlZGl0OiBmYWxzZSwKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgYWRkVGVtcFNlcXVlbmNlUmVjaXBpZW50KHRlbXBSb3cpOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUNoZWNrYm94Q2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGFkZEFzUGF1c2VkOiAhX3RoaXMuc3RhdGUuYWRkQXNQYXVzZWQgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVBZGRSZWNpcGllbnRzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgb25BZGRSZWNpcGllbnRzID0gX3RoaXMucHJvcHMub25BZGRSZWNpcGllbnRzOwogICAgICAgICAgICB2YXIgYWRkQXNQYXVzZWQgPSBfdGhpcy5zdGF0ZS5hZGRBc1BhdXNlZDsKICAgICAgICAgICAgbG9nQW1wbGl0dWRlRXZlbnQoQW1wbGl0dWRlRXZlbnRzLkFkZFJlY2lwaWVudFRvU2VxdWVuY2UpOwogICAgICAgICAgICBvbkFkZFJlY2lwaWVudHMoYWRkQXNQYXVzZWQpOwogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IGxvYWRpbmc6IHRydWUgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVDb250YWN0U2VsZWN0ID0gZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICAgICAgdmFyIGNsZWFyQ29udGFjdFR5cGVhaGVhZCA9IF90aGlzLnByb3BzLmNsZWFyQ29udGFjdFR5cGVhaGVhZDsKICAgICAgICAgICAgdmFyIHRlbXBSb3cgPSBfdGhpcy5zdGF0ZS50ZW1wUm93OwogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICB0ZW1wUm93OiBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgdGVtcFJvdyksIHsgZW1haWw6IGNvbnRhY3QuZW1haWwsICdmaXJzdCBuYW1lJzogY29udGFjdC5naXZlbk5hbWUsICdsYXN0IG5hbWUnOiBjb250YWN0LmZhbWlseU5hbWUgfSksCiAgICAgICAgICAgIH0sIF90aGlzLmhhbmRsZUFkZFJvdyk7CiAgICAgICAgICAgIGNsZWFyQ29udGFjdFR5cGVhaGVhZCgpOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlUG9wb3ZlckNoYW5nZSA9IGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGVkUG9wb3ZlckluZGV4OiBpbmRleCB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZVBvcG92ZXJSZWYgPSBmdW5jdGlvbiAocmVmKSB7CiAgICAgICAgICAgIF90aGlzLnBvcG92ZXIgPSByZWY7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVJbnB1dEJsdXIgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0OwogICAgICAgICAgICB2YXIgaGVhZGVyID0gdGFyZ2V0LmRhdGFzZXQuaGVhZGVyOwogICAgICAgICAgICB2YXIgY2xlYXJDb250YWN0VHlwZWFoZWFkID0gX3RoaXMucHJvcHMuY2xlYXJDb250YWN0VHlwZWFoZWFkOwogICAgICAgICAgICB2YXIgcG9wb3ZlclNob3duID0gX3RoaXMuc3RhdGUucG9wb3ZlclNob3duOwogICAgICAgICAgICB2YXIgaXNFbWFpbEhlYWRlciA9IGhlYWRlciAmJiBoZWFkZXIudG9Mb3dlckNhc2UoKSA9PT0gJ2VtYWlsJzsKICAgICAgICAgICAgaWYgKGlzRW1haWxIZWFkZXIgJiYgIXBvcG92ZXJTaG93bikgewogICAgICAgICAgICAgICAgX3RoaXMuaGFuZGxlQWRkUm93KCk7CiAgICAgICAgICAgICAgICBjbGVhckNvbnRhY3RUeXBlYWhlYWQoKTsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUtleURvd24gPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgdHlwZWFoZWFkQ29udGFjdHMgPSBfYS50eXBlYWhlYWRDb250YWN0cywgY2xlYXJDb250YWN0VHlwZWFoZWFkID0gX2EuY2xlYXJDb250YWN0VHlwZWFoZWFkLCBoZWFkZXJzID0gX2EuaGVhZGVyczsKICAgICAgICAgICAgdmFyIF9iID0gX3RoaXMuc3RhdGUsIHBvcG92ZXJTaG93biA9IF9iLnBvcG92ZXJTaG93biwgc2VsZWN0ZWRQb3BvdmVySW5kZXggPSBfYi5zZWxlY3RlZFBvcG92ZXJJbmRleCwgdGVtcFJvdyA9IF9iLnRlbXBSb3c7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQ7CiAgICAgICAgICAgIHZhciBoZWFkZXIgPSB0YXJnZXQuZGF0YXNldC5oZWFkZXI7CiAgICAgICAgICAgIHZhciBpc0VtYWlsSGVhZGVyID0gaGVhZGVyICYmIGhlYWRlci50b0xvd2VyQ2FzZSgpID09PSAnZW1haWwnOwogICAgICAgICAgICB2YXIgaGFuZGxlZCA9IGZhbHNlOwogICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2RlLlRhYikgewogICAgICAgICAgICAgICAgdmFyIGhlYWRlckluZGV4ID0gaGVhZGVyICYmIGhlYWRlcnMgPyBoZWFkZXJzLmluZGV4T2YoaGVhZGVyKSA6IC0xOwogICAgICAgICAgICAgICAgdmFyIHByZXZGb2N1cyA9IGhlYWRlckluZGV4ICE9PSAtMSAmJiBoZWFkZXJzICYmCiAgICAgICAgICAgICAgICAgICAgaGVhZGVySW5kZXggPiAwICYmIGhlYWRlckluZGV4IDwgaGVhZGVycy5sZW5ndGggJiYKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzW2hlYWRlckluZGV4IC0gMV07CiAgICAgICAgICAgICAgICB2YXIgbmV4dEZvY3VzID0gaGVhZGVySW5kZXggIT09IC0xICYmIGhlYWRlcnMgJiYKICAgICAgICAgICAgICAgICAgICBoZWFkZXJJbmRleCA+PSAwICYmIGhlYWRlckluZGV4IDwgaGVhZGVycy5sZW5ndGggLSAxICYmCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1toZWFkZXJJbmRleCArIDFdOwogICAgICAgICAgICAgICAgaWYgKGUuc2hpZnRLZXkgJiYgcHJldkZvY3VzICYmIF90aGlzLmlucHV0UmVmc1twcmV2Rm9jdXNdKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW5wdXRSZWZzW3ByZXZGb2N1c10uZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFlLnNoaWZ0S2V5ICYmIG5leHRGb2N1cyAmJiBfdGhpcy5pbnB1dFJlZnNbbmV4dEZvY3VzXSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLmlucHV0UmVmc1tuZXh0Rm9jdXNdLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAocG9wb3ZlclNob3duICYmIGlzRW1haWxIZWFkZXIgJiYgZS5rZXlDb2RlID09PSBLZXlDb2RlLkRvd24pIHsKICAgICAgICAgICAgICAgIF90aGlzLnBvcG92ZXIub25Eb3duQXJyb3coKTsKICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHBvcG92ZXJTaG93biAmJiBpc0VtYWlsSGVhZGVyICYmIGUua2V5Q29kZSA9PT0gS2V5Q29kZS5VcCkgewogICAgICAgICAgICAgICAgX3RoaXMucG9wb3Zlci5vblVwQXJyb3coKTsKICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHBvcG92ZXJTaG93biAmJiBpc0VtYWlsSGVhZGVyICYmIGUua2V5Q29kZSA9PT0gS2V5Q29kZS5FbnRlciAmJiB0eXBlYWhlYWRDb250YWN0cykgewogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgIHRlbXBSb3c6IF9fYXNzaWduKF9fYXNzaWduKHt9LCB0ZW1wUm93KSwgeyBlbWFpbDogdHlwZWFoZWFkQ29udGFjdHNbc2VsZWN0ZWRQb3BvdmVySW5kZXhdLmVtYWlsLCAnZmlyc3QgbmFtZSc6IHR5cGVhaGVhZENvbnRhY3RzW3NlbGVjdGVkUG9wb3ZlckluZGV4XS5naXZlbk5hbWUsICdsYXN0IG5hbWUnOiB0eXBlYWhlYWRDb250YWN0c1tzZWxlY3RlZFBvcG92ZXJJbmRleF0uZmFtaWx5TmFtZSB9KSwKICAgICAgICAgICAgICAgIH0sIF90aGlzLmhhbmRsZUFkZFJvdyk7CiAgICAgICAgICAgICAgICBjbGVhckNvbnRhY3RUeXBlYWhlYWQoKTsKICAgICAgICAgICAgICAgIGhhbmRsZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGUua2V5Q29kZSA9PT0gS2V5Q29kZS5SaWdodCB8fCBlLmtleUNvZGUgPT09IEtleUNvZGUuTGVmdCkgewogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGFuZGxlZCkgewogICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlUG9wb3ZlclNob3cgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgcG9wb3ZlclNob3duOiB0cnVlIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlUG9wb3ZlckhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgcG9wb3ZlclNob3duOiBmYWxzZSB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmdldFJvd0F0ID0gZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgICAgICAgIHZhciByb3dzID0gX3RoaXMuc3RhdGUucm93czsKICAgICAgICAgICAgcmV0dXJuIHJvd3NbaW5kZXhdOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuZ2V0Q29sdW1ucyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBfdGhpcy5wcm9wcy5oZWFkZXJzOwogICAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICAgICAgICBrZXk6ICdyZW1vdmVCdXR0b25Qcm9wcycsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogJycsCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDQwLAogICAgICAgICAgICAgICAgICAgIHJlc2l6ZWFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBlZGl0YWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVyOiBSZWNpcGllbnRSZW1vdmVDZWxsLAogICAgICAgICAgICAgICAgfV0uY29uY2F0KGhlYWRlcnMgPwogICAgICAgICAgICAgICAgaGVhZGVycy5tYXAoZnVuY3Rpb24gKGgpIHsgcmV0dXJuICh7CiAgICAgICAgICAgICAgICAgICAga2V5OiBoID09PSAnZW1haWwnID8gJ2VtYWlsUHJvcHMnIDogaC50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgICAgICAgIG5hbWU6IGNhcGl0YWxpemUoaCksCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IENFTExfV0lEVEgsCiAgICAgICAgICAgICAgICAgICAgcmVzaXplYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZWRpdGFibGU6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVyOiBoID09PSAnZW1haWwnID8gUmVjaXBpZW50RW1haWxDZWxsIDogUmVjaXBpZW50RWRpdGFibGVDZWxsLAogICAgICAgICAgICAgICAgICAgIGdldFJvd01ldGFEYXRhOiBmdW5jdGlvbiAocm93KSB7IHJldHVybiByb3c7IH0sCiAgICAgICAgICAgICAgICB9KTsgfSkgOiBbXSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy50b2dnbGVFZGl0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBlZGl0OiAhX3RoaXMuc3RhdGUuZWRpdCwKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVBZGRSZWNpcGllbnQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2RlLkVudGVyICYmICFfdGhpcy5zdGF0ZS5wb3BvdmVyU2hvd24pIHsKICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVBZGRSb3coKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlU2hvd1NhbGVzZm9yY2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHNob3dTYWxlc2ZvcmNlOiB0cnVlLAogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZUhpZGVTYWxlc2ZvcmNlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBzaG93U2FsZXNmb3JjZTogZmFsc2UsCiAgICAgICAgICAgIH0pOwogICAgICAgIH07CiAgICAgICAgX3RoaXMuaGFuZGxlSW5wdXRSZWZzID0gZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICBpZiAocmVmKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5pbnB1dFJlZnNbcmVmLm5hbWVdID0gcmVmOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfdGhpcy5oYW5kbGVJbnZhbGlkUG9wb3ZlciA9IGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgaWYgKHJlZikgewogICAgICAgICAgICAgICAgX3RoaXMuaW52YWxpZFBvcG92ZXIgPSByZWY7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIF90aGlzLmhhbmRsZURpcmVjdG9yeURyb3BFcnJvciA9IGZ1bmN0aW9uIChiKSB7CiAgICAgICAgICAgIHZhciBjb25maXJtUHJvcHMgPSB7CiAgICAgICAgICAgICAgICB0aXRsZTogJ0Vycm9yIGF0dGFjaGluZyBmaWxlJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHVwbG9hZEVycm9yTWVzc2FnZShiKSwKICAgICAgICAgICAgICAgIGNvbmZpcm1Db3B5OiAnT2snLAogICAgICAgICAgICAgICAgb25Db25maXJtOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoeyBjb25maXJtUHJvcHM6IHVuZGVmaW5lZCB9KTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsgY29uZmlybVByb3BzOiBjb25maXJtUHJvcHMsIGRyb3B6b25lQWN0aXZlOiBmYWxzZSB9KTsKICAgICAgICB9OwogICAgICAgIF90aGlzLnJlbmRlclJvdyA9IGZ1bmN0aW9uIChwcm9wcykgewogICAgICAgICAgICB2YXIgX2EgPSBfdGhpcy5wcm9wcywgaGVhZGVycyA9IF9hLmhlYWRlcnMsIHR5cGVhaGVhZENvbnRhY3RzID0gX2EudHlwZWFoZWFkQ29udGFjdHM7CiAgICAgICAgICAgIHZhciBfYiA9IF90aGlzLnN0YXRlLCBlZGl0ID0gX2IuZWRpdCwgdGVtcFJvdyA9IF9iLnRlbXBSb3c7CiAgICAgICAgICAgIGlmIChwcm9wcy5pZHggIT09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudChSb3dDb21wb25lbnQsIF9fYXNzaWduKHsga2V5OiBwcm9wcy5yb3cuZW1haWwudmFsdWUgKyAiLSIgKyBwcm9wcy5pZHggfSwgcHJvcHMpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGVkaXQpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0ZW1wLXJvdyIsIG9uS2V5RG93bjogX3RoaXMuaGFuZGxlQWRkUmVjaXBpZW50LCBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogaGVhZGVycyA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1heCgoaGVhZGVycy5sZW5ndGggKiBDRUxMX1dJRFRIKSArIDQwLCB3aW5kb3cuaW5uZXJXaWR0aCAtIChXSU5ET1dfTUFSR0lOICogMikpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IDAsCiAgICAgICAgICAgICAgICAgICAgfSB9LAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsgY2xhc3NOYW1lOiAiY2xvc2UtY29udGFpbmVyIiwgb25DbGljazogX3RoaXMudG9nZ2xlRWRpdCB9LAogICAgICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KENsb3NlLCB7IGNsYXNzTmFtZTogImljb24iIH0pKSwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzICYmIGhlYWRlcnMubWFwKGZ1bmN0aW9uIChoLCBpKSB7IHJldHVybiAoUmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7IHR5cGU6ICJ0ZXh0Iiwga2V5OiBoLCBuYW1lOiBoLCByZWY6IF90aGlzLmhhbmRsZUlucHV0UmVmcywgImRhdGEtaGVhZGVyIjogaCwgImRhdGEtaW5kZXgiOiBpLCBvbkNoYW5nZTogX3RoaXMuaGFuZGxlSW5wdXRDaGFuZ2UsIG9uS2V5RG93bjogX3RoaXMuaGFuZGxlS2V5RG93biwgb25CbHVyOiBfdGhpcy5oYW5kbGVJbnB1dEJsdXIsIHZhbHVlOiB0ZW1wUm93W2hdLCBwbGFjZWhvbGRlcjogIkVudGVyICIgKyBoICsgIi4uLiIsIGF1dG9Gb2N1czogaSA9PT0gMCwgYXV0b0NvbXBsZXRlOiAib2ZmIiB9KSk7IH0pLAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ29udGFjdFR5cGVhaGVhZFBvcG92ZXIsIHsgY29udGFjdHM6IHR5cGVhaGVhZENvbnRhY3RzID8gdHlwZWFoZWFkQ29udGFjdHMuc2xpY2UoMCwgNSkgOiBbXSwgb25TZWxlY3Q6IF90aGlzLmhhbmRsZUNvbnRhY3RTZWxlY3QsIHJlZjogX3RoaXMuaGFuZGxlUG9wb3ZlclJlZiwgb25TaG93OiBfdGhpcy5oYW5kbGVQb3BvdmVyU2hvdywgb25IaWRlOiBfdGhpcy5oYW5kbGVQb3BvdmVySGlkZSwgb25DaGFuZ2U6IF90aGlzLmhhbmRsZVBvcG92ZXJDaGFuZ2UgfSkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsgY2xhc3NOYW1lOiAiZWRpdCIsIG9uQ2xpY2s6IF90aGlzLnRvZ2dsZUVkaXQsIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGhlYWRlcnMgPwogICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1heCgoaGVhZGVycy5sZW5ndGggKiBDRUxMX1dJRFRIKSArIDQwLCB3aW5kb3cuaW5uZXJXaWR0aCAtIChXSU5ET1dfTUFSR0lOICogMikpCiAgICAgICAgICAgICAgICAgICAgICAgIDogMCwKICAgICAgICAgICAgICAgIH0gfSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaWNvbi1jb250YWluZXIiIH0sCiAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChQbHVzLCB7IGNsYXNzTmFtZTogImljb24iIH0pKSwKICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAiQ2xpY2sgdG8gYWRkIGEgcmVjaXBpZW50Li4uIikpKTsKICAgICAgICB9OwogICAgICAgIF90aGlzLmlucHV0UmVmcyA9IHt9OwogICAgICAgIF90aGlzLnBvcG92ZXJTaG93RGVib3VuY2UgPSBkZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5wb3BvdmVyKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVySGlkZURlYm91bmNlLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgX3RoaXMucG9wb3Zlci5zaG93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAyMDApOwogICAgICAgIF90aGlzLnBvcG92ZXJIaWRlRGVib3VuY2UgPSBkZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5wb3BvdmVyKSB7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyU2hvd0RlYm91bmNlLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUG9wb3ZlckluZGV4OiAwLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfdGhpcy5wb3BvdmVyLmhpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIDIwMCk7CiAgICAgICAgX3RoaXMuaW52YWxpZFBvcG92ZXJTaG93RGVib3VuY2UgPSBkZWJvdW5jZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5pbnZhbGlkUG9wb3ZlcikgewogICAgICAgICAgICAgICAgX3RoaXMuaW52YWxpZFBvcG92ZXJIaWRlRGVib3VuY2UuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICBfdGhpcy5pbnZhbGlkUG9wb3Zlci5zaG93KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAyMDApOwogICAgICAgIF90aGlzLmludmFsaWRQb3BvdmVySGlkZURlYm91bmNlID0gZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBpZiAoX3RoaXMuaW52YWxpZFBvcG92ZXIpIHsKICAgICAgICAgICAgICAgIF90aGlzLmludmFsaWRQb3BvdmVyU2hvd0RlYm91bmNlLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgX3RoaXMuaW52YWxpZFBvcG92ZXIuaGlkZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgMjAwKTsKICAgICAgICBfdGhpcy5zZWFyY2hDb250YWN0VHlwZWFoZWFkRGVib3VuY2UgPSBkZWJvdW5jZShwcm9wcy5zZWFyY2hDb250YWN0VHlwZWFoZWFkLCAyMDApOwogICAgICAgIF90aGlzLnN0YXRlID0gewogICAgICAgICAgICBkcm9wem9uZUFjdGl2ZTogZmFsc2UsCiAgICAgICAgICAgIHJvd3M6IFtfdGhpcy5jcmVhdGVFbXB0eVJvdyhwcm9wcy5oZWFkZXJzKV0uY29uY2F0KChwcm9wcy5yZWNpcGllbnRzIHx8IFtdKQogICAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAocikgeyByZXR1cm4gISFyLmRhdGE7IH0pCiAgICAgICAgICAgICAgICAubWFwKGZ1bmN0aW9uIChyLCBpKSB7CiAgICAgICAgICAgICAgICB2YXIgbWV0YSA9IF9fYXNzaWduKF9fYXNzaWduKHsgJ2xhc3QgbmFtZSc6IHIuZGF0YS5mYW1pbHlOYW1lIHx8ICcnLCAnZmlyc3QgbmFtZSc6IHIuZGF0YS5naXZlbk5hbWUgfHwgJycgfSwgci5kYXRhLnZhcmlhYmxlcyksIHsgZW1haWw6IHIuZGF0YS5lbWFpbCwgaW52YWxpZFJlYXNvbjogci5kYXRhLmludmFsaWRSZWFzb24gfHwgJycsIGxvYWRpbmc6IHIuc3RhdHVzID09PSBSZXNvdXJjZVN0YXR1cy5SZWZyZXNoaW5nIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmNyZWF0ZVJvdyhtZXRhLCBpICsgMSwgcHJvcHMuaGVhZGVycyk7CiAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgYWRkQXNQYXVzZWQ6IGZhbHNlLAogICAgICAgICAgICBwb3BvdmVyU2hvd246IGZhbHNlLAogICAgICAgICAgICBzZWxlY3RlZFBvcG92ZXJJbmRleDogMCwKICAgICAgICAgICAgZWRpdDogZmFsc2UsCiAgICAgICAgICAgIHRlbXBSb3c6IHsgZW1haWw6ICcnIH0sCiAgICAgICAgICAgIHNob3dTYWxlc2ZvcmNlOiBmYWxzZSwKICAgICAgICAgICAgaW52YWxpZFBvcG92ZXJQb3NpdGlvbjogeyB0b3A6IDAsIGxlZnQ6IDAgfSwKICAgICAgICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gX3RoaXM7CiAgICB9CiAgICBVcGxvYWRSZWNpcGllbnQucHJvdG90eXBlLmNvbXBvbmVudERpZFVwZGF0ZSA9IGZ1bmN0aW9uIChvbGRQcm9wcywgb2xkU3RhdGUpIHsKICAgICAgICBpZiAob2xkU3RhdGUucm93cy5sZW5ndGggIT09IHRoaXMuc3RhdGUucm93cy5sZW5ndGgpIHsKICAgICAgICAgICAgLy8gU2Nyb2xsIHRvIGJvdHRvbSBvZiBjb250YWluZXIKICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5maWVsZHMnKTsKICAgICAgICAgICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IGNvbnRhaW5lci5zY3JvbGxIZWlnaHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgVXBsb2FkUmVjaXBpZW50LnByb3RvdHlwZS5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIChuZXh0UHJvcHMpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAgIGlmIChuZXh0UHJvcHMudHlwZWFoZWFkQ29udGFjdHMgIT09IHRoaXMucHJvcHMudHlwZWFoZWFkQ29udGFjdHMpIHsKICAgICAgICAgICAgaWYgKG5leHRQcm9wcy50eXBlYWhlYWRDb250YWN0cyAmJiBuZXh0UHJvcHMudHlwZWFoZWFkQ29udGFjdHMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJIaWRlRGVib3VuY2UuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICB0aGlzLnBvcG92ZXJTaG93RGVib3VuY2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlclNob3dEZWJvdW5jZS5jYW5jZWwoKTsKICAgICAgICAgICAgICAgIHRoaXMucG9wb3ZlckhpZGVEZWJvdW5jZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChuZXh0UHJvcHMucmVjaXBpZW50cyAhPT0gdGhpcy5wcm9wcy5yZWNpcGllbnRzKSB7CiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgcm93czogW3RoaXMuY3JlYXRlRW1wdHlSb3cobmV4dFByb3BzLmhlYWRlcnMpXS5jb25jYXQoKG5leHRQcm9wcy5yZWNpcGllbnRzIHx8IFtdKQogICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoZnVuY3Rpb24gKHIpIHsgcmV0dXJuICEhci5kYXRhOyB9KQogICAgICAgICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHIsIGkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbWV0YSA9IF9fYXNzaWduKF9fYXNzaWduKHt9LCByLmRhdGEudmFyaWFibGVzKSwgeyAnbGFzdCBuYW1lJzogci5kYXRhLmZhbWlseU5hbWUgfHwgJycsICdmaXJzdCBuYW1lJzogci5kYXRhLmdpdmVuTmFtZSB8fCAnJywgZW1haWw6IHIuZGF0YS5lbWFpbCwgaW52YWxpZFJlYXNvbjogci5kYXRhLmludmFsaWRSZWFzb24gfHwgJycsIGxvYWRpbmc6IHIuc3RhdHVzID09PSBSZXNvdXJjZVN0YXR1cy5SZWZyZXNoaW5nIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jcmVhdGVSb3cobWV0YSwgaSArIDEsIG5leHRQcm9wcy5oZWFkZXJzKTsKICAgICAgICAgICAgICAgIH0pKSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGlmIChuZXh0UHJvcHMuZXJyb3IgIT09IHRoaXMucHJvcHMuZXJyb3IgJiYgISFuZXh0UHJvcHMuZXJyb3IpIHsKICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKICAgIFVwbG9hZFJlY2lwaWVudC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfYSA9IHRoaXMucHJvcHMsIGhhbmRsZUZpbGVzID0gX2EuaGFuZGxlRmlsZXMsIHNlcXVlbmNlTmFtZSA9IF9hLnNlcXVlbmNlTmFtZSwgb25DbG9zZSA9IF9hLm9uQ2xvc2U7CiAgICAgICAgdmFyIF9iID0gdGhpcy5zdGF0ZSwgZHJvcHpvbmVBY3RpdmUgPSBfYi5kcm9wem9uZUFjdGl2ZSwgcm93cyA9IF9iLnJvd3MsIGFkZEFzUGF1c2VkID0gX2IuYWRkQXNQYXVzZWQsIHNob3dTYWxlc2ZvcmNlID0gX2Iuc2hvd1NhbGVzZm9yY2UsIGludmFsaWRSZWFzb24gPSBfYi5pbnZhbGlkUmVhc29uLCBpbnZhbGlkUG9wb3ZlclBvc2l0aW9uID0gX2IuaW52YWxpZFBvcG92ZXJQb3NpdGlvbiwgbG9hZGluZyA9IF9iLmxvYWRpbmcsIGNvbmZpcm1Qcm9wcyA9IF9iLmNvbmZpcm1Qcm9wczsKICAgICAgICByZXR1cm4gKFJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidXBsb2FkLXJlY2lwaWVudC1jc3YiLCBvbkRyYWdFbnRlcjogdGhpcy5oYW5kbGVEcmFnRW50ZXIsIG9uRHJhZ0V4aXQ6IHRoaXMuaGFuZGxlRHJhZ0xlYXZlIH0sCiAgICAgICAgICAgIGNvbmZpcm1Qcm9wcyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KENvbmZpcm0sIF9fYXNzaWduKHt9LCBjb25maXJtUHJvcHMpKSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0b3AtYmFyIiB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiaDEiLCBudWxsLAogICAgICAgICAgICAgICAgICAgICJBZGQgcmVjaXBpZW50cyB0byAiLAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogImJvbGQiIH0sIHNlcXVlbmNlTmFtZSkpLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJzYWxlc2ZvcmNlLWNvbnRhaW5lciIgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJidXR0b24iLCB7IGNsYXNzTmFtZTogInNhbGVzZm9yY2UiLCBvbkNsaWNrOiB0aGlzLmhhbmRsZVNob3dTYWxlc2ZvcmNlIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoU2FsZXNmb3JjZSwgeyBjbGFzc05hbWU6ICJpY29uIiB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsICJBZGQgZnJvbSBTYWxlc2ZvcmNlIikpLAogICAgICAgICAgICAgICAgICAgIHNob3dTYWxlc2ZvcmNlICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVXBsb2FkUmVjaXBpZW50U2FsZXNmb3JjZSwgeyBvbkNsaWNrT3V0c2lkZTogdGhpcy5oYW5kbGVIaWRlU2FsZXNmb3JjZSB9KSksCiAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFVwbG9hZEJ1dHRvbiwgeyB1cGxvYWQ6IGhhbmRsZUZpbGVzLCBjbGFzc05hbWU6ICJjc3YiLCBkZXNjcmlwdGlvbjogIkFkZCBmcm9tIENTViIsIGN1c3RvbUljb246IFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ3N2LCB7IGNsYXNzTmFtZTogImljb24iIH0pIH0pLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsICJvciBkcmFnIGEgQ1NWIGZpbGUgaGVyZSIpKSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJtYWluIiB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdERhdGFHcmlkLCB7IGNvbHVtbnM6IHRoaXMuZ2V0Q29sdW1ucygpLCByb3dHZXR0ZXI6IHRoaXMuZ2V0Um93QXQsIHJvd3NDb3VudDogcm93cy5sZW5ndGgsIHJvd0hlaWdodDogNDAsIG1pbkhlaWdodDogd2luZG93LmlubmVySGVpZ2h0IC0gMjE2LCByb3dTY3JvbGxUaW1lb3V0OiAyMDAsIGhlYWRlclJvd0hlaWdodDogMCwgZW5hYmxlQ2VsbFNlbGVjdDogdHJ1ZSwgcm93UmVuZGVyZXI6IHRoaXMucmVuZGVyUm93IH0pLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChQb3BvdmVyLCB7IHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogaW52YWxpZFBvcG92ZXJQb3NpdGlvbi50b3AsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IGludmFsaWRQb3BvdmVyUG9zaXRpb24ubGVmdCwKICAgICAgICAgICAgICAgICAgICB9LCByZWY6IHRoaXMuaGFuZGxlSW52YWxpZFBvcG92ZXIgfSwKICAgICAgICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgaW52YWxpZFJlYXNvbikpKSwKICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJhY3Rpb24tYmFyIiB9LAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJjYW5jZWwtY29udGFpbmVyIiB9LAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIsIHsgY2xhc3NOYW1lOiAiY2FuY2VsIiwgb25DbGljazogb25DbG9zZSB9LCAiQ2FuY2VsIikpLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgeyBjbGFzc05hbWU6ICJwYXVzZWQtb3B0aW9uIiwgb25DbGljazogdGhpcy5oYW5kbGVDaGVja2JveENoYW5nZSB9LAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQ2hlY2tib3gsIHsgb25DaGFuZ2U6IHRoaXMuaGFuZGxlQ2hlY2tib3hDaGFuZ2UsIGNoZWNrZWQ6IGFkZEFzUGF1c2VkIH0pLAogICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCAiQWRkIHJlY2lwaWVudHMgYXMgcGF1c2VkIikpLAogICAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgiYnV0dG9uIiwgeyBjbGFzc05hbWU6IGNsYXNzbmFtZXMoJ2FkZC1yZWNpcGllbnRzJywgewogICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZDogcm93cy5sZW5ndGggPD0gMSB8fCBsb2FkaW5nLAogICAgICAgICAgICAgICAgICAgIH0pLCBkaXNhYmxlZDogbG9hZGluZyB8fCByb3dzLmxlbmd0aCA8PSAxLCBvbkNsaWNrOiB0aGlzLmhhbmRsZUFkZFJlY2lwaWVudHMgfSwKICAgICAgICAgICAgICAgICAgICAhbG9hZGluZyAmJiBSZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgIkFkZCAiLAogICAgICAgICAgICAgICAgICAgICAgICAhIShyb3dzLmxlbmd0aCAtIDEpICYmIHJvd3MubGVuZ3RoIC0gMSArICIgIiwKICAgICAgICAgICAgICAgICAgICAgICAgIlJlY2lwaWVudHMiKSwKICAgICAgICAgICAgICAgICAgICBsb2FkaW5nICYmIFJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogImxvYWRpbmciIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoTG9hZGVyLCBudWxsKSwKICAgICAgICAgICAgICAgICAgICAgICAgIiBMb2FkaW5nIikpKSwKICAgICAgICAgICAgZHJvcHpvbmVBY3RpdmUgJiYgUmVhY3QuY3JlYXRlRWxlbWVudChGaWxlRHJvcFpvbmUsIHsgY2xhc3NOYW1lOiAidXBsb2FkLXJlY2lwaWVudC1maWxlLXpvbmUiLCBvbkRyb3A6IGhhbmRsZUZpbGVzLCBvbkxlYXZlOiB0aGlzLmhhbmRsZURyYWdMZWF2ZSwgdGl0bGU6ICJBZGQgcmVjaXBpZW50cyIsIGRlc2NyaXB0aW9uOiAiRHJhZyBhbmQgZHJvcCBhIC5jc3YgZmlsZSB0byB1cGxvYWQiLCBhbHRDb3B5OiAiIiwgb25EaXJlY3RvcnlEcm9wRXJyb3I6IHRoaXMuaGFuZGxlRGlyZWN0b3J5RHJvcEVycm9yIH0pKSk7CiAgICB9OwogICAgcmV0dXJuIFVwbG9hZFJlY2lwaWVudDsKfShSZWFjdC5QdXJlQ29tcG9uZW50KSk7CmV4cG9ydCBkZWZhdWx0IFVwbG9hZFJlY2lwaWVudDsK"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Sequences/routes/SequenceDetail/UploadRecipient/UploadRecipient.tsx","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/routes/Sequences/routes/SequenceDetail/UploadRecipient/UploadRecipient.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,KAAK,MAAM,OAAO,CAAC;AAC1B,OAAO,UAAU,MAAM,YAAY,CAAC;AACpC,OAAO,aAAa,EAAE,EAAE,GAAG,IAAI,YAAY,EAAE,MAAM,iBAAiB,CAAC;AACrE,OAAO,EAAE,YAAY,EAAE,MAAM,sCAAsC,CAAC;AAEpE,OAAO,wBAAwB,CAAC;AAChC,OAAO,YAAY,MAAM,mCAAmC,CAAC;AAC7D,OAAO,QAAQ,MAAM,wCAAwC,CAAC;AAC9D,OAAO,EAAW,OAAO,EAAY,cAAc,EAAE,MAAM,YAAY,CAAC;AACxE,2CAA2C;AAC3C,OAAO,uBAAuB,MAAM,0EAA0E,CAAC;AAC/G,OAAO,UAAU,MAAM,sCAAsC,CAAC;AAC9D,OAAO,GAAG,MAAM,+BAA+B,CAAC;AAChD,OAAO,IAAI,MAAM,gCAAgC,CAAC;AAClD,OAAO,KAAK,MAAM,iCAAiC,CAAC;AACpD,OAAO,mBAAmB,MAAM,+DAA+D,CAAC;AAChG,OAAO,yBAAyB,MAAM,6BAA6B,CAAC;AAMpE,OAAO,kBAAkB,MAAM,6DAA6D,CAAC;AAC7F,OAAO,OAAO,MAAM,iCAAiC,CAAC;AACtD,OAAO,EAAE,QAAQ,EAAE,UAAU,EAAE,MAAM,QAAQ,CAAC;AAC9C,2CAA2C;AAC3C,OAAO,qBAAqB,MAAM,mEAAmE,CAAC;AACtG,OAAO,MAAM,MAAM,+BAA+B,CAAC;AACnD,OAAO,OAAkC,MAAM,8BAA8B,CAAC;AAC9E,OAAO,EAAkB,kBAAkB,EAAE,MAAM,gBAAgB,CAAC;AACpE,OAAO,EAAE,eAAe,EAAE,iBAAiB,EAAE,MAAM,8BAA8B,CAAC;AAwElF,IAAM,UAAU,GAAG,GAAG,CAAC;AACvB,IAAM,aAAa,GAAG,EAAE,CAAC;AACzB;IAA8B,mCAA8D;IAU1F,yBAAY,KAAyC;QAArD,YACE,iBAAO,SA0ER;QAED,gCAA0B,GAAG,UAC3B,KAAa,EACb,MAAc,EACd,KAAa,EACb,QAAkB;;YAEZ,IAAA,gBAAwD,EAAtD,0BAAU,EAAE,4DAA0C,CAAC;YAC/D,IAAM,YAAY,GAAG,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,UAAU,IAAI,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;YAE9E,IAAI,YAAY,IAAI,YAAY,CAAC,IAAI,EAAE;gBACrC,IAAM,SAAS,gBAAQ,YAAY,CAAC,IAAI,CAAE,CAAC;gBAC3C,IAAI,MAAM,KAAK,OAAO,EAAE;oBACtB,SAAS,CAAC,KAAK,GAAG,KAAK,CAAC;iBACzB;qBAAM,IAAI,MAAM,KAAK,WAAW,EAAE;oBACjC,SAAS,CAAC,UAAU,GAAG,KAAK,CAAC;iBAC9B;qBAAM,IAAI,MAAM,KAAK,YAAY,EAAE;oBAClC,SAAS,CAAC,SAAS,GAAG,KAAK,CAAC;iBAC7B;qBAAM;oBACL,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC,CAAC,uBACpC,SAAS,CAAC,SAAS,gBAAG,MAAM,IAAG,KAAK,OAAG,CAAC,WAC3C,GAAC,MAAM,IAAG,KAAK,KAAE,CAAC;iBACvB;gBACD,2BAA2B,CAAC;oBAC1B,KAAK,OAAA;oBACL,SAAS,WAAA;oBACT,QAAQ,UAAA;iBACT,CAAC,CAAC;aACJ;QACH,CAAC,CAAA;QAED,oBAAc,GAAG,UAAC,OAAkB;YAClC,IAAM,GAAG,GAAQ;gBACf,UAAU,EAAE;oBACV,KAAK,EAAE,EAAE;oBACT,OAAO,EAAE,KAAK;oBACd,aAAa,EAAE,KAAI,CAAC,0BAA0B;oBAC9C,KAAK,EAAE,KAAI,CAAC,kBAAkB;oBAC9B,yBAAyB,EAAE,KAAI,CAAC,6BAA6B;oBAC7D,yBAAyB,EAAE,KAAI,CAAC,6BAA6B;iBAC9D;gBACD,iBAAiB,EAAE;oBACjB,KAAK,EAAE,CAAC;oBACR,QAAQ,EAAE,KAAI,CAAC,YAAY;iBAC5B;aACF,CAAC;YAEF,IAAI,OAAO,EAAE;gBACX,OAAO,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,GAAG,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,GAAG;oBAC1C,KAAK,EAAE,EAAE;oBACT,MAAM,EAAE,CAAC,CAAC,WAAW,EAAE;oBACvB,aAAa,EAAE,KAAI,CAAC,0BAA0B;oBAC9C,KAAK,EAAE,KAAI,CAAC,kBAAkB;iBAC/B,EALoB,CAKpB,CAAC,CAAC;aACJ;YAED,OAAO,GAAG,CAAC;QACb,CAAC,CAAA;QAsDD,mCAA6B,GAAG,UAAC,CAAmC,EAAE,aAAqB;YACzF,IAAM,MAAM,GAAG,CAAC,CAAC,MAAqB,CAAC;YACvC,IAAM,IAAI,GAAG,MAAM,CAAC,qBAAqB,EAAE,CAAC;YAC5C,KAAI,CAAC,QAAQ,CACX;gBACE,aAAa,eAAA;gBACb,sBAAsB,EAAE;oBACtB,GAAG,EAAE,IAAI,CAAC,GAAG,GAAG,EAAE;oBAClB,IAAI,EAAE,IAAI,CAAC,IAAI,GAAG,CAAC;iBACpB;aACF,EACD;gBACE,KAAI,CAAC,0BAA0B,EAAE,CAAC;YACpC,CAAC,CACF,CAAC;QACJ,CAAC,CAAA;QAED,mCAA6B,GAAG,UAAC,CAAmC,EAAE,aAAqB;YACzF,KAAI,CAAC,0BAA0B,EAAE,CAAC;QACpC,CAAC,CAAA;QAED,qBAAe,GAAG,UAAC,KAAsC;YACvD,IAAI,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE;gBACpD,KAAI,CAAC,QAAQ,CAAC,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC,CAAC;aACzC;QACH,CAAC,CAAA;QAED,qBAAe,GAAG;YAChB,KAAI,CAAC,QAAQ,CAAC,EAAE,cAAc,EAAE,KAAK,EAAE,CAAC,CAAC;QAC3C,CAAC,CAAA;QAED,uBAAiB,GAAG,UAAC,CAAoC;;YACvD,IAAM,MAAM,GAAG,CAAC,CAAC,aAAa,CAAC;YACvB,IAAA,6BAAO,CAAgB;YACvB,IAAA,kBAAI,CAAY;YAExB,wBAAwB;YACxB,IAAI,IAAI,IAAI,OAAO,EAAE;gBACnB,IAAI,IAAI,CAAC,WAAW,EAAE,KAAK,OAAO,EAAE;oBAClC,KAAI,CAAC,8BAA8B,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;iBACnD;gBACD,KAAI,CAAC,QAAQ,CAAC,EAAE,OAAO,wBAAO,OAAO,gBAAG,IAAI,CAAC,WAAW,EAAE,IAAG,MAAM,CAAC,KAAK,MAAE,EAAE,CAAC,CAAC;aAChF;QACH,CAAC,CAAA;QAED,wBAAkB,GAAG,UAAC,QAAiB,EAAE,MAAc,EAAE,KAAa;YAC5D,IAAA,6BAAO,CAAgB;YAC/B,IAAM,WAAW,GAAG,OAAO,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAEvD,IAAI,OAAO,IAAI,WAAW,KAAK,SAAS,EAAE;gBACxC,IAAI,KAAK,SAAA,CAAC;gBACV,IAAI,QAAQ,IAAI,WAAW,KAAK,CAAC,EAAE;oBACjC,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,iBAAe,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,SAAI,KAAK,OAAI,CAAC,CAAC;iBACtF;qBAAM,IAAI,CAAC,QAAQ,IAAI,WAAW,KAAK,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;oBAC1D,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,iBAAe,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,SAAI,KAAK,OAAI,CAAC,CAAC;iBACtF;gBAED,IAAI,KAAK,EAAE;oBACR,KAA0B,CAAC,KAAK,EAAE,CAAC;iBACrC;aACF;QACH,CAAC,CAAA;QAED,eAAS,GAAG,UACV,GAAkB,EAClB,KAAa,EACb,OAAkB;YAElB,IAAM,MAAM,GAAG;gBACb,UAAU,EAAE,KAAK;gBACjB,EAAE,EAAK,GAAG,CAAC,KAAK,SAAI,KAAO;gBAC3B,UAAU,EAAE;oBACV,KAAK,EAAE,GAAG,CAAC,KAAK;oBAChB,aAAa,EAAE,GAAG,CAAC,aAAa;oBAChC,OAAO,EAAE,GAAG,CAAC,OAAO;oBACpB,KAAK,EAAE,KAAI,CAAC,kBAAkB;oBAC9B,aAAa,EAAE,KAAI,CAAC,0BAA0B;oBAC9C,yBAAyB,EAAE,KAAI,CAAC,6BAA6B;oBAC7D,yBAAyB,EAAE,KAAI,CAAC,6BAA6B;iBAC9D;gBACD,iBAAiB,EAAE;oBACjB,QAAQ,EAAE,KAAI,CAAC,YAAY;oBAC3B,KAAK,OAAA;iBACN;aACF,CAAC;YAEF,IAAI,OAAO,EAAE;gBACX,OAAO,CAAC,OAAO,CAAC,UAAC,CAAC;oBAChB,IAAM,KAAK,GAAG,GAAG,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,CAAC;oBACnC,MAAM,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC,GAAG;wBACxB,KAAK,OAAA;wBACL,MAAM,EAAE,CAAC,CAAC,WAAW,EAAE;wBACvB,KAAK,EAAE,KAAI,CAAC,kBAAkB;wBAC9B,aAAa,EAAE,KAAI,CAAC,0BAA0B;qBAC/C,CAAC;gBACJ,CAAC,CAAC,CAAC;aACJ;YAED,OAAO,MAAM,CAAC;QAChB,CAAC,CAAA;QAED,kBAAY,GAAG,UAAC,KAAa;YACnB,IAAA,qEAA2B,CAAgB;YACnD,2BAA2B,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;QACzC,CAAC,CAAA;QAED,kBAAY,GAAG;YACL,IAAA,+DAAwB,CAAgB;YACxC,IAAA,6BAAO,CAAgB;YAE/B,KAAI,CAAC,QAAQ,CACX;gBACE,OAAO,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,WAAW,EAAE,EAAE,EAAE,YAAY,EAAE,EAAE,EAAE;gBACzD,IAAI,EAAE,KAAK;aACZ,EACD;gBACE,wBAAwB,CAAC,OAAO,CAAC,CAAC;YACpC,CAAC,CACF,CAAC;QACJ,CAAC,CAAA;QAED,0BAAoB,GAAG;YACrB,KAAI,CAAC,QAAQ,CAAC,EAAE,WAAW,EAAE,CAAC,KAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;QAC1D,CAAC,CAAA;QAED,yBAAmB,GAAG;YACZ,IAAA,6CAAe,CAAgB;YAC/B,IAAA,qCAAW,CAAgB;YAEnC,iBAAiB,CAAC,eAAe,CAAC,sBAAsB,CAAC,CAAC;YAC1D,eAAe,CAAC,WAAW,CAAC,CAAC;YAC7B,KAAI,CAAC,QAAQ,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;QACnC,CAAC,CAAA;QAED,yBAAmB,GAAG,UAAC,OAAgB;YAC7B,IAAA,yDAAqB,CAAgB;YACrC,IAAA,6BAAO,CAAgB;YAE/B,KAAI,CAAC,QAAQ,CACX;gBACE,OAAO,wBACF,OAAO,KACV,KAAK,EAAE,OAAO,CAAC,KAAK,EACpB,YAAY,EAAE,OAAO,CAAC,SAAS,EAC/B,WAAW,EAAE,OAAO,CAAC,UAAU,GAChC;aACF,EACD,KAAI,CAAC,YAAY,CAClB,CAAC;YACF,qBAAqB,EAAE,CAAC;QAC1B,CAAC,CAAA;QAED,yBAAmB,GAAG,UAAC,KAAa;YAClC,KAAI,CAAC,QAAQ,CAAC,EAAE,oBAAoB,EAAE,KAAK,EAAE,CAAC,CAAC;QACjD,CAAC,CAAA;QAED,sBAAgB,GAAG,UAAC,GAA4B;YAC9C,KAAI,CAAC,OAAO,GAAG,GAAG,CAAC;QACrB,CAAC,CAAA;QAED,qBAAe,GAAG,UAAC,CAAyC;YAC1D,IAAM,MAAM,GAAG,CAAC,CAAC,aAAa,CAAC;YACvB,IAAA,8BAAM,CAAoB;YAC1B,IAAA,yDAAqB,CAAgB;YACrC,IAAA,uCAAY,CAAgB;YACpC,IAAM,aAAa,GAAG,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,KAAK,OAAO,CAAC;YAEjE,IAAI,aAAa,IAAI,CAAC,YAAY,EAAE;gBAClC,KAAI,CAAC,YAAY,EAAE,CAAC;gBACpB,qBAAqB,EAAE,CAAC;gBACxB,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,CAAC,CAAC,eAAe,EAAE,CAAC;aACrB;QACH,CAAC,CAAA;QAED,mBAAa,GAAG,UAAC,CAAwC;YACjD,IAAA,gBAAkE,EAAhE,wCAAiB,EAAE,gDAAqB,EAAE,oBAAsB,CAAC;YACnE,IAAA,gBAA4D,EAA1D,8BAAY,EAAE,8CAAoB,EAAE,oBAAsB,CAAC;YACnE,IAAM,MAAM,GAAG,CAAC,CAAC,aAAa,CAAC;YACvB,IAAA,8BAAM,CAAoB;YAClC,IAAM,aAAa,GAAG,MAAM,IAAI,MAAM,CAAC,WAAW,EAAE,KAAK,OAAO,CAAC;YACjE,IAAI,OAAO,GAAG,KAAK,CAAC;YAEpB,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,GAAG,EAAE;gBAC7B,IAAM,WAAW,GAAG,MAAM,IAAI,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACrE,IAAM,SAAS,GAAG,WAAW,KAAK,CAAC,CAAC,IAAI,OAAO;oBAC7C,WAAW,GAAG,CAAC,IAAI,WAAW,GAAG,OAAO,CAAC,MAAM;oBAC/C,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;gBAC3B,IAAM,SAAS,GAAG,WAAW,KAAK,CAAC,CAAC,IAAI,OAAO;oBAC7C,WAAW,IAAI,CAAC,IAAI,WAAW,GAAG,OAAO,CAAC,MAAM,GAAG,CAAC;oBACpD,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;gBAC3B,IAAI,CAAC,CAAC,QAAQ,IAAI,SAAS,IAAI,KAAI,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE;oBACxD,KAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,KAAK,EAAE,CAAC;oBAClC,OAAO,GAAG,IAAI,CAAC;iBAChB;qBAAM,IAAI,CAAC,CAAC,CAAC,QAAQ,IAAI,SAAS,IAAI,KAAI,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE;oBAChE,KAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,KAAK,EAAE,CAAC;oBAClC,OAAO,GAAG,IAAI,CAAC;iBAChB;aACF;iBAAM,IAAI,YAAY,IAAI,aAAa,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,IAAI,EAAE;gBACtE,KAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;gBAC3B,OAAO,GAAG,IAAI,CAAC;aAChB;iBAAM,IAAI,YAAY,IAAI,aAAa,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,EAAE,EAAE;gBACpE,KAAI,CAAC,OAAO,CAAC,SAAS,EAAE,CAAC;gBACzB,OAAO,GAAG,IAAI,CAAC;aAChB;iBAAM,IAAI,YAAY,IAAI,aAAa,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,KAAK,IAAI,iBAAiB,EAAE;gBAC5F,KAAI,CAAC,QAAQ,CACX;oBACE,OAAO,wBACF,OAAO,KACV,KAAK,EAAE,iBAAiB,CAAC,oBAAoB,CAAC,CAAC,KAAK,EACpD,YAAY,EAAE,iBAAiB,CAAC,oBAAoB,CAAC,CAAC,SAAS,EAC/D,WAAW,EAAE,iBAAiB,CAAC,oBAAoB,CAAC,CAAC,UAAU,GAChE;iBACF,EACD,KAAI,CAAC,YAAY,CAClB,CAAC;gBACF,qBAAqB,EAAE,CAAC;gBACxB,OAAO,GAAG,IAAI,CAAC;aAChB;iBAAM,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,KAAK,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,IAAI,EAAE;gBACpE,CAAC,CAAC,eAAe,EAAE,CAAC;aACrB;YAED,IAAI,OAAO,EAAE;gBACX,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,CAAC,CAAC,eAAe,EAAE,CAAC;aACrB;QACH,CAAC,CAAA;QAED,uBAAiB,GAAG;YAClB,KAAI,CAAC,QAAQ,CAAC,EAAE,YAAY,EAAE,IAAI,EAAE,CAAC,CAAC;QACxC,CAAC,CAAA;QAED,uBAAiB,GAAG;YAClB,KAAI,CAAC,QAAQ,CAAC,EAAE,YAAY,EAAE,KAAK,EAAE,CAAC,CAAC;QACzC,CAAC,CAAA;QAED,cAAQ,GAAG,UAAC,KAAa;YACf,IAAA,uBAAI,CAAgB;YAE5B,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC;QACrB,CAAC,CAAA;QAED,gBAAU,GAAG;YACH,IAAA,6BAAO,CAAgB;YAE/B,OAAO,CAAC;oBACN,GAAG,EAAE,mBAAmB;oBACxB,IAAI,EAAE,EAAE;oBACR,KAAK,EAAE,EAAE;oBACT,UAAU,EAAE,KAAK;oBACjB,QAAQ,EAAE,KAAK;oBACf,QAAQ,EAAE,KAAK;oBACf,SAAS,EAAE,mBAAmB;iBACxB,CAAC,CAAC,MAAM,CACd,OAAO,CAAC,CAAC;gBACT,OAAO,CAAC,GAAG,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC;oBAChB,GAAG,EAAE,CAAC,KAAK,OAAO,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE;oBACnD,IAAI,EAAE,UAAU,CAAC,CAAC,CAAC;oBACnB,KAAK,EAAE,UAAU;oBACjB,UAAU,EAAE,KAAK;oBACjB,QAAQ,EAAE,KAAK;oBACf,SAAS,EAAE,KAAK;oBAChB,SAAS,EAAE,CAAC,KAAK,OAAO,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC,qBAAqB;oBACrE,cAAc,EAAE,UAAC,GAAQ,IAAK,OAAA,GAAG,EAAH,CAAG;iBAClC,CAAC,EATe,CASf,CAAC,CAAC,CAAC,CAAC,EAAE,CACT,CAAC;QACJ,CAAC,CAAA;QAED,gBAAU,GAAG;YACX,KAAI,CAAC,QAAQ,CAAC;gBACZ,IAAI,EAAE,CAAC,KAAI,CAAC,KAAK,CAAC,IAAI;aACvB,CAAC,CAAC;QACL,CAAC,CAAA;QAED,wBAAkB,GAAG,UAAC,CAAsC;YAC1D,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,KAAK,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,YAAY,EAAE;gBAC3D,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,CAAC,CAAC,eAAe,EAAE,CAAC;gBACpB,KAAI,CAAC,YAAY,EAAE,CAAC;aACrB;QACH,CAAC,CAAA;QAED,0BAAoB,GAAG;YACrB,KAAI,CAAC,QAAQ,CAAC;gBACZ,cAAc,EAAE,IAAI;aACrB,CAAC,CAAC;QACL,CAAC,CAAA;QAED,0BAAoB,GAAG;YACrB,KAAI,CAAC,QAAQ,CAAC;gBACZ,cAAc,EAAE,KAAK;aACtB,CAAC,CAAC;QACL,CAAC,CAAA;QAED,qBAAe,GAAG,UAAC,GAAqB;YACtC,IAAI,GAAG,EAAE;gBACP,KAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC;aAChC;QACH,CAAC,CAAA;QAED,0BAAoB,GAAG,UAAC,GAAY;YAClC,IAAI,GAAG,EAAE;gBACP,KAAI,CAAC,cAAc,GAAG,GAAG,CAAC;aAC3B;QACH,CAAC,CAAA;QAED,8BAAwB,GAAG,UAAC,CAAiB;YAC3C,IAAM,YAAY,GAAiB;gBACjC,KAAK,EAAE,sBAAsB;gBAC7B,OAAO,EAAE,kBAAkB,CAAC,CAAC,CAAC;gBAC9B,WAAW,EAAE,IAAI;gBACjB,SAAS,EAAE;oBACT,KAAI,CAAC,QAAQ,CAAC,EAAE,YAAY,EAAE,SAAS,EAAE,CAAC,CAAC;gBAC7C,CAAC;aACF,CAAC;YAEF,KAAI,CAAC,QAAQ,CAAC,EAAE,YAAY,cAAA,EAAE,cAAc,EAAE,KAAK,EAAE,CAAC,CAAC;QACzD,CAAC,CAAA;QAED,eAAS,GAAG,UAAC,KAAU;YACf,IAAA,gBAA2C,EAAzC,oBAAO,EAAE,wCAAgC,CAAC;YAC5C,IAAA,gBAA8B,EAA5B,cAAI,EAAE,oBAAsB,CAAC;YAErC,IAAI,KAAK,CAAC,GAAG,KAAK,CAAC,EAAE;gBACnB,OAAO,CACL,oBAAC,YAAY,aACX,GAAG,EAAK,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,SAAI,KAAK,CAAC,GAAK,IACxC,KAAK,EACT,CACH,CAAC;aACH;YAED,IAAI,IAAI,EAAE;gBACR,OAAO,CACL,6BACE,SAAS,EAAC,UAAU,EACpB,SAAS,EAAE,KAAI,CAAC,kBAAkB,EAClC,KAAK,EAAE;wBACL,KAAK,EAAE,OAAO,CAAC,CAAC;4BACd,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,GAAG,UAAU,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,UAAU,GAAG,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;4BACrF,CAAC,CAAC,CAAC;qBACN;oBAED,gCAAQ,SAAS,EAAC,iBAAiB,EAAC,OAAO,EAAE,KAAI,CAAC,UAAU;wBAC1D,oBAAC,KAAK,IAAC,SAAS,EAAC,MAAM,GAAG,CACnB;oBACR,OAAO,IAAI,OAAO,CAAC,GAAG,CAAC,UAAC,CAAC,EAAE,CAAC,IAAK,OAAA,CAChC,+BACE,IAAI,EAAC,MAAM,EACX,GAAG,EAAE,CAAC,EACN,IAAI,EAAE,CAAC,EACP,GAAG,EAAE,KAAI,CAAC,eAAe,iBACZ,CAAC,gBACF,CAAC,EACb,QAAQ,EAAE,KAAI,CAAC,iBAAiB,EAChC,SAAS,EAAE,KAAI,CAAC,aAAa,EAC7B,MAAM,EAAE,KAAI,CAAC,eAAe,EAC5B,KAAK,EAAE,OAAO,CAAC,CAAC,CAAC,EACjB,WAAW,EAAE,WAAS,CAAC,QAAK,EAC5B,SAAS,EAAE,CAAC,KAAK,CAAC,EAClB,YAAY,EAAC,KAAK,GAClB,CACH,EAhBiC,CAgBjC,CAAC;oBACF,oBAAC,uBAAuB,IACtB,QAAQ,EAAE,iBAAiB,CAAC,CAAC,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAChE,QAAQ,EAAE,KAAI,CAAC,mBAAmB,EAClC,GAAG,EAAE,KAAI,CAAC,gBAAgB,EAC1B,MAAM,EAAE,KAAI,CAAC,iBAAiB,EAC9B,MAAM,EAAE,KAAI,CAAC,iBAAiB,EAC9B,QAAQ,EAAE,KAAI,CAAC,mBAAmB,GAClC,CACE,CACP,CAAC;aACH;YAED,OAAO,CACL,gCACE,SAAS,EAAC,MAAM,EAChB,OAAO,EAAE,KAAI,CAAC,UAAU,EACxB,KAAK,EAAE;oBACL,KAAK,EAAE,OAAO,CAAC,CAAC;wBACd,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,GAAG,UAAU,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,UAAU,GAAG,CAAC,aAAa,GAAG,CAAC,CAAC,CAAC;wBACrF,CAAC,CAAC,CAAC;iBACN;gBAED,6BAAK,SAAS,EAAC,gBAAgB;oBAC7B,oBAAC,IAAI,IAAC,SAAS,EAAC,MAAM,GAAG,CACrB;gBACN,gEAAwC,CACjC,CACV,CAAC;QACJ,CAAC,CAAA;QA/jBC,KAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,KAAI,CAAC,mBAAmB,GAAG,QAAQ,CACjC;YACE,IAAI,KAAI,CAAC,OAAO,EAAE;gBAChB,KAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC;gBAClC,KAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;aACrB;QACH,CAAC,EACD,GAAG,CACJ,CAAC;QACF,KAAI,CAAC,mBAAmB,GAAG,QAAQ,CACjC;YACE,IAAI,KAAI,CAAC,OAAO,EAAE;gBAChB,KAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC;gBAClC,KAAI,CAAC,QAAQ,CAAC;oBACZ,oBAAoB,EAAE,CAAC;iBACxB,CAAC,CAAC;gBACH,KAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;aACrB;QACH,CAAC,EACD,GAAG,CACJ,CAAC;QACF,KAAI,CAAC,0BAA0B,GAAG,QAAQ,CACxC;YACE,IAAI,KAAI,CAAC,cAAc,EAAE;gBACvB,KAAI,CAAC,0BAA0B,CAAC,MAAM,EAAE,CAAC;gBACzC,KAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC;aAC5B;QACH,CAAC,EACD,GAAG,CACJ,CAAC;QACF,KAAI,CAAC,0BAA0B,GAAG,QAAQ,CACxC;YACE,IAAI,KAAI,CAAC,cAAc,EAAE;gBACvB,KAAI,CAAC,0BAA0B,CAAC,MAAM,EAAE,CAAC;gBACzC,KAAI,CAAC,cAAc,CAAC,IAAI,EAAE,CAAC;aAC5B;QACH,CAAC,EACD,GAAG,CACJ,CAAC;QACF,KAAI,CAAC,8BAA8B,GAAG,QAAQ,CAAC,KAAK,CAAC,sBAAsB,EAAE,GAAG,CAAC,CAAC;QAElF,KAAI,CAAC,KAAK,GAAG;YACX,cAAc,EAAE,KAAK;YACrB,IAAI,EAAE,CAAC,KAAI,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAC/C,CAAC,KAAK,CAAC,UAAU,IAAI,EAAE,CAAC;iBACrB,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,CAAC,CAAC,IAAI,EAAR,CAAQ,CAAC;iBACrB,GAAG,CAAC,UAAC,CAAC,EAAE,CAAC;gBACR,IAAM,IAAI,uBACR,WAAW,EAAE,CAAC,CAAC,IAAK,CAAC,UAAU,IAAI,EAAE,EACrC,YAAY,EAAE,CAAC,CAAC,IAAK,CAAC,SAAS,IAAI,EAAE,IAClC,CAAC,CAAC,IAAK,CAAC,SAAS,KACpB,KAAK,EAAE,CAAC,CAAC,IAAK,CAAC,KAAK,EACpB,aAAa,EAAE,CAAC,CAAC,IAAK,CAAC,aAAa,IAAI,EAAE,EAC1C,OAAO,EAAE,CAAC,CAAC,MAAM,KAAK,cAAc,CAAC,UAAU,GAChD,CAAC;gBACF,OAAO,KAAI,CAAC,SAAS,CACnB,IAAqB,EACrB,CAAC,GAAG,CAAC,EACL,KAAK,CAAC,OAAO,CACd,CAAC;YACJ,CAAC,CAAC,CACL;YACD,WAAW,EAAE,KAAK;YAClB,YAAY,EAAE,KAAK;YACnB,oBAAoB,EAAE,CAAC;YACvB,IAAI,EAAE,KAAK;YACX,OAAO,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE;YACtB,cAAc,EAAE,KAAK;YACrB,sBAAsB,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE;YAC3C,OAAO,EAAE,KAAK;SACf,CAAC;;IACJ,CAAC;IA4DD,4CAAkB,GAAlB,UAAmB,QAAe,EAAE,QAAe;QACjD,IAAI,QAAQ,CAAC,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE;YACnD,gCAAgC;YAChC,IAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;YACpD,IAAI,SAAS,EAAE;gBACb,SAAS,CAAC,SAAS,GAAG,SAAS,CAAC,YAAY,CAAC;aAC9C;SACF;IACH,CAAC;IAED,0DAAgC,GAAhC,UAAiC,SAA6C;QAA9E,iBAwCC;QAvCC,IAAI,SAAS,CAAC,iBAAiB,KAAK,IAAI,CAAC,KAAK,CAAC,iBAAiB,EAAE;YAChE,IAAI,SAAS,CAAC,iBAAiB,IAAI,SAAS,CAAC,iBAAiB,CAAC,MAAM,EAAE;gBACrE,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC;gBAClC,IAAI,CAAC,mBAAmB,EAAE,CAAC;aAC5B;iBAAM;gBACL,IAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,CAAC;gBAClC,IAAI,CAAC,mBAAmB,EAAE,CAAC;aAC5B;SACF;QAED,IAAI,SAAS,CAAC,UAAU,KAAK,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE;YAClD,IAAI,CAAC,QAAQ,CAAC;gBACZ,IAAI,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CACnD,CAAC,SAAS,CAAC,UAAU,IAAI,EAAE,CAAC;qBACzB,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,CAAC,CAAC,IAAI,EAAR,CAAQ,CAAC;qBACrB,GAAG,CAAC,UAAC,CAAC,EAAE,CAAC;oBACR,IAAM,IAAI,yBACL,CAAC,CAAC,IAAK,CAAC,SAAS,KACpB,WAAW,EAAE,CAAC,CAAC,IAAK,CAAC,UAAU,IAAI,EAAE,EACrC,YAAY,EAAE,CAAC,CAAC,IAAK,CAAC,SAAS,IAAI,EAAE,EACrC,KAAK,EAAE,CAAC,CAAC,IAAK,CAAC,KAAK,EACpB,aAAa,EAAE,CAAC,CAAC,IAAK,CAAC,aAAa,IAAI,EAAE,EAC1C,OAAO,EAAE,CAAC,CAAC,MAAM,KAAK,cAAc,CAAC,UAAU,GAChD,CAAC;oBACF,OAAO,KAAI,CAAC,SAAS,CACnB,IAAqB,EACrB,CAAC,GAAG,CAAC,EACL,SAAS,CAAC,OAAO,CAClB,CAAC;gBACJ,CAAC,CAAC,CACL;aACF,CAAC,CAAC;SACJ;QAED,IAAI,SAAS,CAAC,KAAK,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,CAAC,SAAS,CAAC,KAAK,EAAE;YAC7D,IAAI,CAAC,QAAQ,CAAC;gBACZ,OAAO,EAAE,KAAK;aACf,CAAC,CAAC;SACJ;IACH,CAAC;IA2YD,gCAAM,GAAN;QACQ,IAAA,eAAmD,EAAjD,4BAAW,EAAE,8BAAY,EAAE,oBAAsB,CAAC;QACpD,IAAA,eASQ,EARZ,kCAAc,EACd,cAAI,EACJ,4BAAW,EACX,kCAAc,EACd,gCAAa,EACb,kDAAsB,EACtB,oBAAO,EACP,8BACY,CAAC;QAEf,OAAO,CACL,6BACE,SAAS,EAAC,sBAAsB,EAChC,WAAW,EAAE,IAAI,CAAC,eAAe,EACjC,UAAU,EAAE,IAAI,CAAC,eAAe;YAE/B,YAAY,IAAI,oBAAC,OAAO,eAAK,YAAY,EAAI;YAC9C,6BAAK,SAAS,EAAC,SAAS;gBACtB;;oBAAsB,8BAAM,SAAS,EAAC,MAAM,IAAE,YAAY,CAAQ,CAAK;gBACvE,6BAAK,SAAS,EAAC,sBAAsB;oBACnC,gCAAQ,SAAS,EAAC,YAAY,EAAC,OAAO,EAAE,IAAI,CAAC,oBAAoB;wBAC/D,oBAAC,UAAU,IAAC,SAAS,EAAC,MAAM,GAAG;wBAC/B,wDAAgC,CACzB;oBACR,cAAc,IAAI,oBAAC,yBAAyB,IAC3C,cAAc,EAAE,IAAI,CAAC,oBAAoB,GACzC,CACE;gBACN,oBAAC,YAAY,IACX,MAAM,EAAE,WAAW,EACnB,SAAS,EAAC,KAAK,EACf,WAAW,EAAC,cAAc,EAC1B,UAAU,EAAE,oBAAC,GAAG,IAAC,SAAS,EAAC,MAAM,GAAG,GACpC;gBACF,4DAAoC,CAChC;YACN,6BAAK,SAAS,EAAC,MAAM;gBACnB,oBAAC,aAAa,IACZ,OAAO,EAAE,IAAI,CAAC,UAAU,EAAE,EAC1B,SAAS,EAAE,IAAI,CAAC,QAAQ,EACxB,SAAS,EAAE,IAAI,CAAC,MAAM,EACtB,SAAS,EAAE,EAAE,EACb,SAAS,EAAE,MAAM,CAAC,WAAW,GAAG,GAAG,EACnC,gBAAgB,EAAE,GAAG,EACrB,eAAe,EAAE,CAAC,EAClB,gBAAgB,EAAE,IAAI,EACtB,WAAW,EAAE,IAAI,CAAC,SAAS,GAC3B;gBACF,oBAAC,OAAO,IACN,KAAK,EAAE;wBACL,GAAG,EAAE,sBAAsB,CAAC,GAAG;wBAC/B,IAAI,EAAE,sBAAsB,CAAC,IAAI;qBAClC,EACD,GAAG,EAAE,IAAI,CAAC,oBAAoB;oBAE9B,kCAAO,aAAa,CAAQ,CACpB,CACN;YACN,6BAAK,SAAS,EAAC,YAAY;gBACzB,6BAAK,SAAS,EAAC,kBAAkB;oBAC/B,gCAAQ,SAAS,EAAC,QAAQ,EAAC,OAAO,EAAE,OAAO,aAElC,CACL;gBACN,gCAAQ,SAAS,EAAC,eAAe,EAAC,OAAO,EAAE,IAAI,CAAC,oBAAoB;oBAClE,oBAAC,QAAQ,IAAC,QAAQ,EAAE,IAAI,CAAC,oBAAoB,EAAE,OAAO,EAAE,WAAW,GAAI;oBACvE,6DAAqC,CAC9B;gBACT,gCACE,SAAS,EAAE,UAAU,CAAC,gBAAgB,EAAE;wBACtC,QAAQ,EAAE,IAAI,CAAC,MAAM,IAAI,CAAC,IAAI,OAAO;qBACtC,CAAC,EACF,QAAQ,EAAE,OAAO,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,EACrC,OAAO,EAAE,IAAI,CAAC,mBAAmB;oBAEhC,CAAC,OAAO,IAAI;;wBAAW,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,IAAO,IAAI,CAAC,MAAM,GAAG,CAAC,MAAG;qCAAkB;oBACrF,OAAO,IAAI,8BAAM,SAAS,EAAC,SAAS;wBAAC,oBAAC,MAAM,OAAG;mCAAe,CACxD,CACL;YACL,cAAc,IAAI,oBAAC,YAAY,IAC9B,SAAS,EAAC,4BAA4B,EACtC,MAAM,EAAE,WAAW,EACnB,OAAO,EAAE,IAAI,CAAC,eAAe,EAC7B,KAAK,EAAC,gBAAgB,EACtB,WAAW,EAAC,qCAAqC,EACjD,OAAO,EAAC,EAAE,EACV,oBAAoB,EAAE,IAAI,CAAC,wBAAwB,GACnD,CACE,CACP,CAAC;IACJ,CAAC;IACH,sBAAC;AAAD,CAAC,AA5qBD,CAA8B,KAAK,CAAC,aAAa,GA4qBhD;AAED,eAAe,eAAe,CAAC","sourcesContent":["import React from 'react';\nimport classnames from 'classnames';\nimport ReactDataGrid, { Row as RowComponent } from 'react-data-grid';\nimport { FileDropZone } from '@src/components/Compose/FileDropZone';\n\nimport './UploadRecipient.scss';\nimport UploadButton from '@src/components/Base/UploadButton';\nimport Checkbox from '@src/components/Form/Checkbox/Checkbox';\nimport { Contact, KeyCode, Resource, ResourceStatus } from '@src/types';\n// tslint:disable-next-line:max-line-length\nimport ContactTypeaheadPopover from '@src/components/Form/RecipientsEditor/components/ContactTypeaheadPopover';\nimport Salesforce from '@src/components/Icons/Salesforce.svg';\nimport Csv from '@src/components/Icons/Csv.svg';\nimport Plus from '@src/components/Icons/Plus.svg';\nimport Close from '@src/components/Icons/Close.svg';\nimport RecipientRemoveCell from '@src/components/Cells/RecipientRemoveCell/RecipientRemoveCell';\nimport UploadRecipientSalesforce from './UploadRecipientSalesforce';\nimport {\n  SequenceRecipientCreateRecipient,\n  SequenceRecipientTempAddMeta,\n  SequenceRecipientTempUpdateMeta,\n} from '@src/ducks/sequenceRecipients';\nimport RecipientEmailCell from '@src/components/Cells/RecipientEmailCell/RecipientEmailCell';\nimport Popover from '@src/components/Popover/Popover';\nimport { debounce, capitalize } from 'lodash';\n// tslint:disable-next-line:max-line-length\nimport RecipientEditableCell from '@src/components/Cells/RecipientEditableCell/RecipientEditableCell';\nimport Loader from '@src/components/Loader/Loader';\nimport Confirm, { Props as ConfirmProps } from '@src/components/Base/Confirm';\nimport { BlobDescriptor, uploadErrorMessage } from '@src/lib/files';\nimport { AmplitudeEvents, logAmplitudeEvent } from '@src/lib/amplitude-analytics';\n\nexport interface Props {\n  handleFiles: (files: File[]) => void;\n  sequenceName: string;\n  onClose: () => void;\n  onAddRecipients: (addAsPaused: boolean) => void;\n}\n\nexport interface StateProps {\n  typeaheadContacts?: Contact[];\n  recipients?: Array<Resource<SequenceRecipientCreateRecipient>>;\n  headers?: string[];\n  error?: Error;\n}\n\ninterface State {\n  dropzoneActive: boolean;\n  addAsPaused: boolean;\n  popoverShown: boolean;\n  selectedPopoverIndex: number;\n  edit: boolean;\n  rows: Row[];\n  tempRow: {\n    email: string,\n    [header: string]: string,\n  };\n  showSalesforce: boolean;\n  invalidReason?: string;\n  invalidPopoverPosition: { left: number, top: number };\n  loading: boolean;\n  confirmProps?: ConfirmProps;\n}\n\nexport interface DispatchProps {\n  searchContactTypeahead: (query: string) => void;\n  clearContactTypeahead: () => void;\n  addTempSequenceRecipient: (meta: SequenceRecipientTempAddMeta) => void;\n  removeTempSequenceRecipient: (index: number) => void;\n  updateTempSequenceRecipient: (meta: SequenceRecipientTempUpdateMeta) => void;\n}\n\nexport interface Row {\n  emailProps: {\n    email: string,\n    invalidReason?: string,\n    loading: boolean,\n    onInputChange:\n      (value: string, header: string, index: number) => void,\n    onTab: (shiftKey: boolean, header: string, index: number) => void,\n    onInvalidReasonMouseEnter: (e: React.MouseEvent<HTMLDivElement>, invalidReason: string) => void,\n    onInvalidReasonMouseLeave: (e: React.MouseEvent<HTMLDivElement>, invalidReason: string) => void,\n  };\n  removeButtonProps: {\n    index: number,\n    onRemove: (index: number) => void;\n  };\n  [header: string]: any;\n}\n\ninterface Headers {\n  [header: string]: string;\n}\n\ntype RowCreateMeta = Headers & {\n  loading: boolean,\n  email: string,\n  invalidReason: string,\n  'last name': string,\n  'first name': string,\n};\n\nconst CELL_WIDTH = 240;\nconst WINDOW_MARGIN = 40;\nclass UploadRecipient extends React.PureComponent<Props & StateProps & DispatchProps, State> {\n  private popover: ContactTypeaheadPopover;\n  private inputRefs: { [header: string]: HTMLInputElement };\n  private invalidPopover: Popover;\n  private popoverShowDebounce: any;\n  private popoverHideDebounce: any;\n  private invalidPopoverShowDebounce: any;\n  private invalidPopoverHideDebounce: any;\n  private searchContactTypeaheadDebounce: any;\n\n  constructor(props: Props & StateProps & DispatchProps) {\n    super();\n\n    this.inputRefs = {};\n    this.popoverShowDebounce = debounce(\n      () => {\n        if (this.popover) {\n          this.popoverHideDebounce.cancel();\n          this.popover.show();\n        }\n      },\n      200,\n    );\n    this.popoverHideDebounce = debounce(\n      () => {\n        if (this.popover) {\n          this.popoverShowDebounce.cancel();\n          this.setState({\n            selectedPopoverIndex: 0,\n          });\n          this.popover.hide();\n        }\n      },\n      200,\n    );\n    this.invalidPopoverShowDebounce = debounce(\n      () => {\n        if (this.invalidPopover) {\n          this.invalidPopoverHideDebounce.cancel();\n          this.invalidPopover.show();\n        }\n      },\n      200,\n    );\n    this.invalidPopoverHideDebounce = debounce(\n      () => {\n        if (this.invalidPopover) {\n          this.invalidPopoverShowDebounce.cancel();\n          this.invalidPopover.hide();\n        }\n      },\n      200,\n    );\n    this.searchContactTypeaheadDebounce = debounce(props.searchContactTypeahead, 200);\n\n    this.state = {\n      dropzoneActive: false,\n      rows: [this.createEmptyRow(props.headers)].concat(\n        (props.recipients || [])\n          .filter(r => !!r.data)\n          .map((r, i) => {\n            const meta = {\n              'last name': r.data!.familyName || '',\n              'first name': r.data!.givenName || '',\n              ...r.data!.variables,\n              email: r.data!.email,\n              invalidReason: r.data!.invalidReason || '',\n              loading: r.status === ResourceStatus.Refreshing,\n            };\n            return this.createRow(\n              meta as RowCreateMeta,\n              i + 1,\n              props.headers,\n            );\n          }),\n      ),\n      addAsPaused: false,\n      popoverShown: false,\n      selectedPopoverIndex: 0,\n      edit: false,\n      tempRow: { email: '' },\n      showSalesforce: false,\n      invalidPopoverPosition: { top: 0, left: 0 },\n      loading: false,\n    };\n  }\n\n  handleRecipientInputChange = (\n    value: string,\n    header: string,\n    index: number,\n    validate?: boolean,\n  ) => {\n    const { recipients, updateTempSequenceRecipient } = this.props;\n    const oldRecipient = index >= 0 ? recipients && recipients[index] : undefined;\n\n    if (oldRecipient && oldRecipient.data) {\n      const recipient = { ...oldRecipient.data };\n      if (header === 'email') {\n        recipient.email = value;\n      } else if (header === 'last name') {\n        recipient.familyName = value;\n      } else if (header === 'first name') {\n        recipient.givenName = value;\n      } else {\n        recipient.variables = recipient.variables ?\n          { ...recipient.variables, [header]: value } :\n          { [header]: value };\n      }\n      updateTempSequenceRecipient({\n        index,\n        recipient,\n        validate,\n      });\n    }\n  }\n\n  createEmptyRow = (headers?: string[]): Row => {\n    const row: Row = {\n      emailProps: {\n        email: '',\n        loading: false,\n        onInputChange: this.handleRecipientInputChange,\n        onTab: this.handleRecipientTab,\n        onInvalidReasonMouseEnter: this.handleInvalidReasonMouseEnter,\n        onInvalidReasonMouseLeave: this.handleInvalidReasonMouseLeave,\n      },\n      removeButtonProps: {\n        index: 0,\n        onRemove: this.handleRemove,\n      },\n    };\n\n    if (headers) {\n      headers.forEach(h => row[h.toLowerCase()] = {\n        value: '',\n        header: h.toLowerCase(),\n        onInputChange: this.handleRecipientInputChange,\n        onTab: this.handleRecipientTab,\n      });\n    }\n\n    return row;\n  }\n\n  componentDidUpdate(oldProps: Props, oldState: State) {\n    if (oldState.rows.length !== this.state.rows.length) {\n      // Scroll to bottom of container\n      const container = document.querySelector('.fields');\n      if (container) {\n        container.scrollTop = container.scrollHeight;\n      }\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: Props & DispatchProps & StateProps) {\n    if (nextProps.typeaheadContacts !== this.props.typeaheadContacts) {\n      if (nextProps.typeaheadContacts && nextProps.typeaheadContacts.length) {\n        this.popoverHideDebounce.cancel();\n        this.popoverShowDebounce();\n      } else {\n        this.popoverShowDebounce.cancel();\n        this.popoverHideDebounce();\n      }\n    }\n\n    if (nextProps.recipients !== this.props.recipients) {\n      this.setState({\n        rows: [this.createEmptyRow(nextProps.headers)].concat(\n          (nextProps.recipients || [])\n            .filter(r => !!r.data)\n            .map((r, i) => {\n              const meta = {\n                ...r.data!.variables,\n                'last name': r.data!.familyName || '',\n                'first name': r.data!.givenName || '',\n                email: r.data!.email,\n                invalidReason: r.data!.invalidReason || '',\n                loading: r.status === ResourceStatus.Refreshing,\n              };\n              return this.createRow(\n                meta as RowCreateMeta,\n                i + 1,\n                nextProps.headers,\n              );\n            }),\n        ),\n      });\n    }\n\n    if (nextProps.error !== this.props.error && !!nextProps.error) {\n      this.setState({\n        loading: false,\n      });\n    }\n  }\n\n  handleInvalidReasonMouseEnter = (e: React.MouseEvent<HTMLDivElement>, invalidReason: string) => {\n    const target = e.target as HTMLElement;\n    const rect = target.getBoundingClientRect();\n    this.setState(\n      {\n        invalidReason,\n        invalidPopoverPosition: {\n          top: rect.top + 25,\n          left: rect.left - 5,\n        },\n      },\n      () => {\n        this.invalidPopoverShowDebounce();\n      },\n    );\n  }\n\n  handleInvalidReasonMouseLeave = (e: React.MouseEvent<HTMLDivElement>, invalidReason: string) => {\n    this.invalidPopoverHideDebounce();\n  }\n\n  handleDragEnter = (event: React.DragEvent<HTMLDivElement>) => {\n    if (event.dataTransfer.types.indexOf('Files') !== -1) {\n      this.setState({ dropzoneActive: true });\n    }\n  }\n\n  handleDragLeave = () => {\n    this.setState({ dropzoneActive: false });\n  }\n\n  handleInputChange = (e: React.FormEvent<HTMLInputElement>) => {\n    const target = e.currentTarget;\n    const { tempRow } = this.state;\n    const { name } = target;\n\n    // Clone rows and update\n    if (name && tempRow) {\n      if (name.toLowerCase() === 'email') {\n        this.searchContactTypeaheadDebounce(target.value);\n      }\n      this.setState({ tempRow: { ...tempRow, [name.toLowerCase()]: target.value } });\n    }\n  }\n\n  handleRecipientTab = (shiftKey: boolean, header: string, index: number) => {\n    const { headers } = this.props;\n    const headerIndex = headers && headers.indexOf(header);\n\n    if (headers && headerIndex !== undefined) {\n      let input;\n      if (shiftKey && headerIndex !== 0) {\n        input = document.querySelector(`input[name='${headers[headerIndex - 1]}-${index}']`);\n      } else if (!shiftKey && headerIndex !== headers.length - 1) {\n        input = document.querySelector(`input[name='${headers[headerIndex + 1]}-${index}']`);\n      }\n\n      if (input) {\n        (input as HTMLInputElement).focus();\n      }\n    }\n  }\n\n  createRow = (\n    row: RowCreateMeta,\n    index: number,\n    headers?: string[],\n  ): Row => {\n    const newRow = {\n      isSelected: false,\n      id: `${row.email}-${index}`,\n      emailProps: {\n        email: row.email,\n        invalidReason: row.invalidReason,\n        loading: row.loading,\n        onTab: this.handleRecipientTab,\n        onInputChange: this.handleRecipientInputChange,\n        onInvalidReasonMouseEnter: this.handleInvalidReasonMouseEnter,\n        onInvalidReasonMouseLeave: this.handleInvalidReasonMouseLeave,\n      },\n      removeButtonProps: {\n        onRemove: this.handleRemove,\n        index,\n      },\n    };\n\n    if (headers) {\n      headers.forEach((h) => {\n        const value = row[h.toLowerCase()];\n        newRow[h.toLowerCase()] = {\n          value,\n          header: h.toLowerCase(),\n          onTab: this.handleRecipientTab,\n          onInputChange: this.handleRecipientInputChange,\n        };\n      });\n    }\n\n    return newRow;\n  }\n\n  handleRemove = (index: number) => {\n    const { removeTempSequenceRecipient } = this.props;\n    removeTempSequenceRecipient(index - 1);\n  }\n\n  handleAddRow = () => {\n    const { addTempSequenceRecipient } = this.props;\n    const { tempRow } = this.state;\n\n    this.setState(\n      {\n        tempRow: { email: '', 'last name': '', 'first name': '' },\n        edit: false,\n      },\n      () => {\n        addTempSequenceRecipient(tempRow);\n      },\n    );\n  }\n\n  handleCheckboxChange = () => {\n    this.setState({ addAsPaused: !this.state.addAsPaused });\n  }\n\n  handleAddRecipients = () => {\n    const { onAddRecipients } = this.props;\n    const { addAsPaused } = this.state;\n\n    logAmplitudeEvent(AmplitudeEvents.AddRecipientToSequence);\n    onAddRecipients(addAsPaused);\n    this.setState({ loading: true });\n  }\n\n  handleContactSelect = (contact: Contact) => {\n    const { clearContactTypeahead } = this.props;\n    const { tempRow } = this.state;\n\n    this.setState(\n      {\n        tempRow: {\n          ...tempRow,\n          email: contact.email,\n          'first name': contact.givenName,\n          'last name': contact.familyName,\n        },\n      },\n      this.handleAddRow,\n    );\n    clearContactTypeahead();\n  }\n\n  handlePopoverChange = (index: number) => {\n    this.setState({ selectedPopoverIndex: index });\n  }\n\n  handlePopoverRef = (ref: ContactTypeaheadPopover) => {\n    this.popover = ref;\n  }\n\n  handleInputBlur = (e: React.SyntheticEvent<HTMLInputElement>) => {\n    const target = e.currentTarget;\n    const { header } = target.dataset;\n    const { clearContactTypeahead } = this.props;\n    const { popoverShown } = this.state;\n    const isEmailHeader = header && header.toLowerCase() === 'email';\n\n    if (isEmailHeader && !popoverShown) {\n      this.handleAddRow();\n      clearContactTypeahead();\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    const { typeaheadContacts, clearContactTypeahead, headers } = this.props;\n    const { popoverShown, selectedPopoverIndex, tempRow } = this.state;\n    const target = e.currentTarget;\n    const { header } = target.dataset;\n    const isEmailHeader = header && header.toLowerCase() === 'email';\n    let handled = false;\n\n    if (e.keyCode === KeyCode.Tab) {\n      const headerIndex = header && headers ? headers.indexOf(header) : -1;\n      const prevFocus = headerIndex !== -1 && headers &&\n        headerIndex > 0 && headerIndex < headers.length &&\n        headers[headerIndex - 1];\n      const nextFocus = headerIndex !== -1 && headers &&\n        headerIndex >= 0 && headerIndex < headers.length - 1 &&\n        headers[headerIndex + 1];\n      if (e.shiftKey && prevFocus && this.inputRefs[prevFocus]) {\n        this.inputRefs[prevFocus].focus();\n        handled = true;\n      } else if (!e.shiftKey && nextFocus && this.inputRefs[nextFocus]) {\n        this.inputRefs[nextFocus].focus();\n        handled = true;\n      }\n    } else if (popoverShown && isEmailHeader && e.keyCode === KeyCode.Down) {\n      this.popover.onDownArrow();\n      handled = true;\n    } else if (popoverShown && isEmailHeader && e.keyCode === KeyCode.Up) {\n      this.popover.onUpArrow();\n      handled = true;\n    } else if (popoverShown && isEmailHeader && e.keyCode === KeyCode.Enter && typeaheadContacts) {\n      this.setState(\n        {\n          tempRow: {\n            ...tempRow,\n            email: typeaheadContacts[selectedPopoverIndex].email,\n            'first name': typeaheadContacts[selectedPopoverIndex].givenName,\n            'last name': typeaheadContacts[selectedPopoverIndex].familyName,\n          },\n        },\n        this.handleAddRow,\n      );\n      clearContactTypeahead();\n      handled = true;\n    } else if (e.keyCode === KeyCode.Right || e.keyCode === KeyCode.Left) {\n      e.stopPropagation();\n    }\n\n    if (handled) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  handlePopoverShow = () => {\n    this.setState({ popoverShown: true });\n  }\n\n  handlePopoverHide = () => {\n    this.setState({ popoverShown: false });\n  }\n\n  getRowAt = (index: number) => {\n    const { rows } = this.state;\n\n    return rows[index];\n  }\n\n  getColumns = () => {\n    const { headers } = this.props;\n\n    return [{\n      key: 'removeButtonProps',\n      name: '',\n      width: 40,\n      resizeable: false,\n      sortable: false,\n      editable: false,\n      formatter: RecipientRemoveCell,\n    } as any].concat(\n      headers ?\n      headers.map(h => ({\n        key: h === 'email' ? 'emailProps' : h.toLowerCase(),\n        name: capitalize(h),\n        width: CELL_WIDTH,\n        resizeable: false,\n        editable: false,\n        draggable: false,\n        formatter: h === 'email' ? RecipientEmailCell : RecipientEditableCell,\n        getRowMetaData: (row: Row) => row,\n      })) : [],\n    );\n  }\n\n  toggleEdit = () => {\n    this.setState({\n      edit: !this.state.edit,\n    });\n  }\n\n  handleAddRecipient = (e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (e.keyCode === KeyCode.Enter && !this.state.popoverShown) {\n      e.preventDefault();\n      e.stopPropagation();\n      this.handleAddRow();\n    }\n  }\n\n  handleShowSalesforce = () => {\n    this.setState({\n      showSalesforce: true,\n    });\n  }\n\n  handleHideSalesforce = () => {\n    this.setState({\n      showSalesforce: false,\n    });\n  }\n\n  handleInputRefs = (ref: HTMLInputElement) => {\n    if (ref) {\n      this.inputRefs[ref.name] = ref;\n    }\n  }\n\n  handleInvalidPopover = (ref: Popover) => {\n    if (ref) {\n      this.invalidPopover = ref;\n    }\n  }\n\n  handleDirectoryDropError = (b: BlobDescriptor) => {\n    const confirmProps: ConfirmProps = {\n      title: 'Error attaching file',\n      message: uploadErrorMessage(b),\n      confirmCopy: 'Ok',\n      onConfirm: () => {\n        this.setState({ confirmProps: undefined });\n      },\n    };\n\n    this.setState({ confirmProps, dropzoneActive: false });\n  }\n\n  renderRow = (props: any) => {\n    const { headers, typeaheadContacts } = this.props;\n    const { edit, tempRow } = this.state;\n\n    if (props.idx !== 0) {\n      return (\n        <RowComponent\n          key={`${props.row.email.value}-${props.idx}`}\n          {...props}\n        />\n      );\n    }\n\n    if (edit) {\n      return (\n        <div\n          className=\"temp-row\"\n          onKeyDown={this.handleAddRecipient}\n          style={{\n            width: headers ?\n              Math.max((headers.length * CELL_WIDTH) + 40, window.innerWidth - (WINDOW_MARGIN * 2))\n              : 0,\n          }}\n        >\n          <button className=\"close-container\" onClick={this.toggleEdit}>\n            <Close className=\"icon\" />\n          </button>\n          {headers && headers.map((h, i) => (\n            <input\n              type=\"text\"\n              key={h}\n              name={h}\n              ref={this.handleInputRefs}\n              data-header={h}\n              data-index={i}\n              onChange={this.handleInputChange}\n              onKeyDown={this.handleKeyDown}\n              onBlur={this.handleInputBlur}\n              value={tempRow[h]}\n              placeholder={`Enter ${h}...`}\n              autoFocus={i === 0}\n              autoComplete=\"off\"\n            />\n          ))}\n          <ContactTypeaheadPopover\n            contacts={typeaheadContacts ? typeaheadContacts.slice(0, 5) : []}\n            onSelect={this.handleContactSelect}\n            ref={this.handlePopoverRef}\n            onShow={this.handlePopoverShow}\n            onHide={this.handlePopoverHide}\n            onChange={this.handlePopoverChange}\n          />\n        </div>\n      );\n    }\n\n    return (\n      <button\n        className=\"edit\"\n        onClick={this.toggleEdit}\n        style={{\n          width: headers ?\n            Math.max((headers.length * CELL_WIDTH) + 40, window.innerWidth - (WINDOW_MARGIN * 2))\n            : 0,\n        }}\n      >\n        <div className=\"icon-container\">\n          <Plus className=\"icon\" />\n        </div>\n        <span>Click to add a recipient...</span>\n      </button>\n    );\n  }\n\n  render() {\n    const { handleFiles, sequenceName, onClose } = this.props;\n    const {\n      dropzoneActive,\n      rows,\n      addAsPaused,\n      showSalesforce,\n      invalidReason,\n      invalidPopoverPosition,\n      loading,\n      confirmProps,\n    } = this.state;\n\n    return (\n      <div\n        className=\"upload-recipient-csv\"\n        onDragEnter={this.handleDragEnter}\n        onDragExit={this.handleDragLeave}\n      >\n        {confirmProps && <Confirm {...confirmProps} />}\n        <div className=\"top-bar\">\n          <h1>Add recipients to <span className=\"bold\">{sequenceName}</span></h1>\n          <div className=\"salesforce-container\">\n            <button className=\"salesforce\" onClick={this.handleShowSalesforce}>\n              <Salesforce className=\"icon\" />\n              <span>Add from Salesforce</span>\n            </button>\n            {showSalesforce && <UploadRecipientSalesforce\n              onClickOutside={this.handleHideSalesforce}\n            />}\n          </div>\n          <UploadButton\n            upload={handleFiles}\n            className=\"csv\"\n            description=\"Add from CSV\"\n            customIcon={<Csv className=\"icon\" />}\n          />\n          <span>or drag a CSV file here</span>\n        </div>\n        <div className=\"main\">\n          <ReactDataGrid\n            columns={this.getColumns()}\n            rowGetter={this.getRowAt}\n            rowsCount={rows.length}\n            rowHeight={40}\n            minHeight={window.innerHeight - 216}\n            rowScrollTimeout={200}\n            headerRowHeight={0}\n            enableCellSelect={true}\n            rowRenderer={this.renderRow}\n          />\n          <Popover\n            style={{\n              top: invalidPopoverPosition.top,\n              left: invalidPopoverPosition.left,\n            }}\n            ref={this.handleInvalidPopover}\n          >\n            <span>{invalidReason}</span>\n          </Popover>\n        </div>\n        <div className=\"action-bar\">\n          <div className=\"cancel-container\">\n            <button className=\"cancel\" onClick={onClose}>\n              Cancel\n            </button>\n          </div>\n          <button className=\"paused-option\" onClick={this.handleCheckboxChange}>\n            <Checkbox onChange={this.handleCheckboxChange} checked={addAsPaused} />\n            <span>Add recipients as paused</span>\n          </button>\n          <button\n            className={classnames('add-recipients', {\n              disabled: rows.length <= 1 || loading,\n            })}\n            disabled={loading || rows.length <= 1}\n            onClick={this.handleAddRecipients}\n          >\n            {!loading && <span>Add {!!(rows.length - 1) && `${rows.length - 1} `}Recipients</span>}\n            {loading && <span className=\"loading\"><Loader /> Loading</span>}\n          </button>\n        </div>\n        {dropzoneActive && <FileDropZone\n          className=\"upload-recipient-file-zone\"\n          onDrop={handleFiles}\n          onLeave={this.handleDragLeave}\n          title=\"Add recipients\"\n          description=\"Drag and drop a .csv file to upload\"\n          altCopy=\"\"\n          onDirectoryDropError={this.handleDirectoryDropError}\n        />}\n      </div>\n    );\n  }\n}\n\nexport default UploadRecipient;\n"]}]}