{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/contact.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/contact.ts","mtime":1675280254062},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkgewogICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uKHQpIHsKICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTsKICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKQogICAgICAgICAgICAgICAgdFtwXSA9IHNbcF07CiAgICAgICAgfQogICAgICAgIHJldHVybiB0OwogICAgfTsKICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9Owp2YXIgX19zcHJlYWRBcnJheXMgPSAodGhpcyAmJiB0aGlzLl9fc3ByZWFkQXJyYXlzKSB8fCBmdW5jdGlvbiAoKSB7CiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDsKICAgIGZvciAodmFyIHIgPSBBcnJheShzKSwgayA9IDAsIGkgPSAwOyBpIDwgaWw7IGkrKykKICAgICAgICBmb3IgKHZhciBhID0gYXJndW1lbnRzW2ldLCBqID0gMCwgamwgPSBhLmxlbmd0aDsgaiA8IGpsOyBqKyssIGsrKykKICAgICAgICAgICAgcltrXSA9IGFbal07CiAgICByZXR1cm4gcjsKfTsKaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyB1bmlxIH0gZnJvbSAnbG9kYXNoJzsKaW1wb3J0IENhY2hlLCB7IHByZWZpeEtleVJhbmdlLCBTdG9yZXMgfSBmcm9tICcuL2RiJzsKaW1wb3J0IHsgZm52MWEzMiwgZm52MWE2NGhleCB9IGZyb20gJy4vY3J5cHQnOwppbXBvcnQgeyBQaG9uZVR5cGUsIENvbnRhY3RUeXBlLCBFdmVudFJlY2lwaWVudFR5cGUsIH0gZnJvbSAnQHNyYy90eXBlcyc7CmltcG9ydCB7IGV4dHJhY3REb21haW5Gcm9tRW1haWwgfSBmcm9tICdAc3JjL2xpYi9hZGRyZXNzJzsKdmFyIENPTE9SUyA9IFsKICAgICdhMTU1YTAnLAogICAgJzAwOWFkOScsCiAgICAnZmRhZjE2JywKICAgICc4ZGQ4ZjgnLAogICAgJ2YwNTc0OScsCiAgICAnNjNhZGEwJywKICAgICdmNTg2NGYnLAogICAgJ2IxZDM1ZScsCl07CmZ1bmN0aW9uIGF2YXRhckNvbG9yKGVtYWlsKSB7CiAgICB2YXIgaGFzaCA9IGZudjFhMzIoZW1haWwpOwogICAgdmFyIGkgPSBoYXNoICUgQ09MT1JTLmxlbmd0aDsKICAgIHJldHVybiBDT0xPUlNbaV07Cn0KZXhwb3J0IGZ1bmN0aW9uIGRlZmF1bHRDb250YWN0KGVtYWlsLCBnaXZlbk5hbWUsIGZhbWlseU5hbWUpIHsKICAgIGlmIChnaXZlbk5hbWUgPT09IHZvaWQgMCkgeyBnaXZlbk5hbWUgPSAnJzsgfQogICAgaWYgKGZhbWlseU5hbWUgPT09IHZvaWQgMCkgeyBmYW1pbHlOYW1lID0gJyc7IH0KICAgIHJldHVybiBhcHBseUNvbnRhY3REZWZhdWx0cyh7CiAgICAgICAgZW1haWw6IGVtYWlsLnRyaW0oKS50b0xvd2VyQ2FzZSgpLAogICAgICAgIGdpdmVuTmFtZTogZ2l2ZW5OYW1lLAogICAgICAgIGZhbWlseU5hbWU6IGZhbWlseU5hbWUsCiAgICB9KTsKfQpleHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVQaG90b1VybChlbWFpbCwgZmlyc3ROYW1lLCBsYXN0TmFtZSkgewogICAgaWYgKGZpcnN0TmFtZSA9PT0gdm9pZCAwKSB7IGZpcnN0TmFtZSA9ICcnOyB9CiAgICBpZiAobGFzdE5hbWUgPT09IHZvaWQgMCkgeyBsYXN0TmFtZSA9ICcnOyB9CiAgICAvLyBjbGVhbnVwIHZhcmlhYmxlcwogICAgdmFyIGxvd2VyRW1haWwgPSBlbWFpbC50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgIHZhciBmaXJzdE5hbWVDbGVhbiA9IGZpcnN0TmFtZS50cmltKCk7CiAgICB2YXIgbGFzdE5hbWVDbGVhbiA9IGxhc3ROYW1lLnRyaW0oKTsKICAgIC8vIG1ha2UgaW5pdGlhbHMKICAgIHZhciBpbml0aWFscyA9ICcnOwogICAgaWYgKGZpcnN0TmFtZUNsZWFuLmxlbmd0aCA+IDApIHsKICAgICAgICBpbml0aWFscyA9IGZpcnN0TmFtZUNsZWFuWzBdLnRvVXBwZXJDYXNlKCk7CiAgICB9CiAgICBpZiAobGFzdE5hbWVDbGVhbi5sZW5ndGggPiAwKSB7CiAgICAgICAgaW5pdGlhbHMgKz0gbGFzdE5hbWVDbGVhblswXS50b1VwcGVyQ2FzZSgpOwogICAgfQogICAgLy8gY2xlYW4gb3V0ICcjJyBhbmQgJz8nIGNoYXJhY3RlcnMKICAgIGluaXRpYWxzID0gaW5pdGlhbHMucmVwbGFjZSgvIy9nLCAnJyk7CiAgICBpbml0aWFscyA9IGluaXRpYWxzLnJlcGxhY2UoL1w/L2csICcnKTsKICAgIGlmIChpbml0aWFscy5sZW5ndGggPT09IDAgJiYgbG93ZXJFbWFpbC5sZW5ndGgpIHsKICAgICAgICBpbml0aWFscyA9IGxvd2VyRW1haWxbMF0udG9VcHBlckNhc2UoKTsKICAgIH0KICAgIHJldHVybiBwcm9jZXNzLmVudi5BUElfVVJMICsgIi92MS9hdmF0YXJzL2luaXRpYWxzLyIgKyBpbml0aWFscyArICIvIiArIGF2YXRhckNvbG9yKGxvd2VyRW1haWwpOwp9Ci8vIHNob3VsZCBub3QgYmUgZXhwb3J0ZWQsIGhlbHBlciB1c2VkIGJ5IGFwcGx5Q29udGFjdERlZmF1bHRzCmZ1bmN0aW9uIGNsZWFudXBDb250YWN0KGNvbnRhY3QpIHsKICAgIC8vIGNsZWFudXAgdmFyaWFibGVzCiAgICB2YXIgZnVsbE5hbWVDbGVhbiA9IGNvbnRhY3QuZnVsbE5hbWUudHJpbSgpOwogICAgdmFyIGxvd2VyRW1haWwgPSBjb250YWN0LmVtYWlsLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgdmFyIGdpdmVuTmFtZUNsZWFuID0gY29udGFjdC5naXZlbk5hbWUudHJpbSgpOwogICAgdmFyIGZhbWlseU5hbWVDbGVhbiA9IGNvbnRhY3QuZmFtaWx5TmFtZS50cmltKCk7CiAgICAvLyBtYWtlIGluaXRpYWxzCiAgICB2YXIgaW5pdGlhbHMgPSAnJzsKICAgIC8vIFN0YXJ0IHRyeWluZyBmcm9tIGZ1bGwgbmFtZQogICAgaWYgKGluaXRpYWxzLmxlbmd0aCA9PT0gMCAmJiBmdWxsTmFtZUNsZWFuLmxlbmd0aCkgewogICAgICAgIHZhciB3b3JkcyA9IGZ1bGxOYW1lQ2xlYW4uc3BsaXQoJyAnKTsKICAgICAgICAvLyBTdGFydCBJbml0aWFsCiAgICAgICAgaWYgKHdvcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIGZpcnN0V29yZCA9IHdvcmRzWzBdOwogICAgICAgICAgICBpZiAoZmlyc3RXb3JkLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGluaXRpYWxzID0gZmlyc3RXb3JkWzBdLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHdvcmRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgdmFyIGxhc3RXb3JkID0gd29yZHNbd29yZHMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIGlmIChsYXN0V29yZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBpbml0aWFscyArPSBsYXN0V29yZFswXS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgLy8gVXBkYXRlIGZyb20gcGFydHMgb2YgbmFtZSBpZiBjYW5ub3QgZGVyaXZlIGZyb20gZnVsbCBuYW1lCiAgICBpZiAoaW5pdGlhbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgaWYgKGdpdmVuTmFtZUNsZWFuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaW5pdGlhbHMgPSBnaXZlbk5hbWVDbGVhblswXS50b1VwcGVyQ2FzZSgpOwogICAgICAgIH0KICAgICAgICBpZiAoZmFtaWx5TmFtZUNsZWFuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaW5pdGlhbHMgKz0gZmFtaWx5TmFtZUNsZWFuWzBdLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgfQogICAgfQogICAgLy8gY2xlYW4gb3V0ICcjJyBhbmQgJz8nIGNoYXJhY3RlcnMKICAgIGluaXRpYWxzID0gaW5pdGlhbHMucmVwbGFjZSgvIy9nLCAnJyk7CiAgICBpbml0aWFscyA9IGluaXRpYWxzLnJlcGxhY2UoL1w/L2csICcnKTsKICAgIGlmIChpbml0aWFscy5sZW5ndGggPT09IDAgJiYgbG93ZXJFbWFpbC5sZW5ndGgpIHsKICAgICAgICBpbml0aWFscyA9IGxvd2VyRW1haWxbMF0udG9VcHBlckNhc2UoKTsKICAgIH0KICAgIHZhciBmdWxsTmFtZSA9IGNvbnRhY3QuZnVsbE5hbWU7CiAgICBpZiAoZnVsbE5hbWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgZnVsbE5hbWUgPSAoZ2l2ZW5OYW1lQ2xlYW4gKyAiICIgKyBmYW1pbHlOYW1lQ2xlYW4pLnRyaW0oKTsKICAgIH0KICAgIHZhciBwdW5jdHVhdGlvbldoaXRlU3BhY2UgPSAvW1xzOyxcLSgpXS87CiAgICB2YXIgZnVsbE5hbWVUb2tlbnMgPSBmdWxsTmFtZS5zcGxpdChwdW5jdHVhdGlvbldoaXRlU3BhY2UpLm1hcChmdW5jdGlvbiAodCkgeyByZXR1cm4gdC50b0xvd2VyQ2FzZSgpOyB9KTsKICAgIHZhciBzZWFyY2hJbmRleCA9IHVuaXEoX19zcHJlYWRBcnJheXMoWwogICAgICAgIGxvd2VyRW1haWwsCiAgICAgICAgZ2l2ZW5OYW1lQ2xlYW4sCiAgICAgICAgZmFtaWx5TmFtZUNsZWFuLAogICAgICAgIGZ1bGxOYW1lCiAgICBdLCBmdWxsTmFtZVRva2VucywgWwogICAgICAgIGV4dHJhY3REb21haW5Gcm9tRW1haWwobG93ZXJFbWFpbCkgfHwgJycsCiAgICBdKS5maWx0ZXIoZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAhPT0gJyc7IH0pLm1hcChmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCk7IH0pKTsKICAgIHZhciBwaG90b1VybCA9IGNvbnRhY3QucGhvdG9VcmwgfHwKICAgICAgICBwcm9jZXNzLmVudi5BUElfVVJMICsgIi92MS9hdmF0YXJzL2luaXRpYWxzLyIgKyBpbml0aWFscyArICIvIiArIGF2YXRhckNvbG9yKGxvd2VyRW1haWwpOwogICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKHt9LCBjb250YWN0KSwgeyBpZDogY29udGFjdC5pZCB8fCBmbnYxYTY0aGV4KGxvd2VyRW1haWwpLCBlbWFpbDogbG93ZXJFbWFpbCwgZ2l2ZW5OYW1lOiBnaXZlbk5hbWVDbGVhbiwgZmFtaWx5TmFtZTogZmFtaWx5TmFtZUNsZWFuLCBmdWxsTmFtZTogZnVsbE5hbWUsCiAgICAgICAgcGhvdG9Vcmw6IHBob3RvVXJsLAogICAgICAgIHNlYXJjaEluZGV4OiBzZWFyY2hJbmRleCB9KTsKfQpleHBvcnQgZnVuY3Rpb24gYXBwbHlDb250YWN0RGVmYXVsdHMoY29udGFjdCkgewogICAgLy8gbmVlZCB0byB0cnVuY2F0ZSB0aW1lIGZvciB0ZXN0aW5nCiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICBkYXRlID0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCksIGRhdGUuZ2V0RGF5KCkpOwogICAgdmFyIG5ld0NvbnRhY3QgPSBfX2Fzc2lnbih7IGNyZWF0ZWQ6IGRhdGUsIHVwZGF0ZWQ6IGRhdGUsIHR5cGU6IENvbnRhY3RUeXBlLkRlZmF1bHQsIGdlbmRlcjogJycsIGZpcnN0TWV0OiAnJywgYmlvOiAnJywgbG9jYXRpb246ICcnLCBvcmdhbml6YXRpb25UaXRsZTogJycsIG9yZ2FuaXphdGlvbjogJycsIHdlYnNpdGU6ICcnLCBhZGRyZXNzZXM6IFtdLCBwaG9uZU51bWJlcnM6IFtdLCBzb2NpYWxNZWRpYTogW10sIGdyb3VwczogW10sIHNhbHV0YXRpb246ICcnLCB1c2VyOiAnJywgZW1haWw6ICcnLCBnaXZlbk5hbWU6ICcnLCBmYW1pbHlOYW1lOiAnJywgZnVsbE5hbWU6ICcnLCBzZWFyY2hJbmRleDogW10sIHBob3RvVXJsOiAnJyB9LCBjb250YWN0KTsKICAgIGlmICghKG5ld0NvbnRhY3QuY3JlYXRlZCBpbnN0YW5jZW9mIERhdGUpICYmICh0eXBlb2YgbmV3Q29udGFjdC5jcmVhdGVkID09PSAnc3RyaW5nJykpIHsKICAgICAgICBuZXdDb250YWN0LmNyZWF0ZWQgPSBuZXcgRGF0ZShuZXdDb250YWN0LmNyZWF0ZWQpOwogICAgfQogICAgaWYgKCEobmV3Q29udGFjdC51cGRhdGVkIGluc3RhbmNlb2YgRGF0ZSkgJiYgKHR5cGVvZiBuZXdDb250YWN0LnVwZGF0ZWQgPT09ICdzdHJpbmcnKSkgewogICAgICAgIG5ld0NvbnRhY3QudXBkYXRlZCA9IG5ldyBEYXRlKG5ld0NvbnRhY3QudXBkYXRlZCk7CiAgICB9CiAgICBpZiAoIShuZXdDb250YWN0Lmxhc3RTZW50IGluc3RhbmNlb2YgRGF0ZSkgJiYgKHR5cGVvZiBuZXdDb250YWN0Lmxhc3RTZW50ID09PSAnc3RyaW5nJykpIHsKICAgICAgICBuZXdDb250YWN0Lmxhc3RTZW50ID0gbmV3IERhdGUobmV3Q29udGFjdC5sYXN0U2VudCk7CiAgICB9CiAgICBuZXdDb250YWN0LmFkZHJlc3NlcyA9IG5ld0NvbnRhY3QuYWRkcmVzc2VzLm1hcChmdW5jdGlvbiAoYWRkcmVzcykgeyByZXR1cm4gYXBwbHlQaHlzaWNhbEFkZHJlc3NEZWZhdWx0cyhhZGRyZXNzKTsgfSk7CiAgICBuZXdDb250YWN0LnBob25lTnVtYmVycyA9IG5ld0NvbnRhY3QucGhvbmVOdW1iZXJzLm1hcChmdW5jdGlvbiAocGhvbmUpIHsgcmV0dXJuIGFwcGx5UGhvbmVEZWZhdWx0cyhwaG9uZSk7IH0pOwogICAgbmV3Q29udGFjdC5zb2NpYWxNZWRpYSA9IG5ld0NvbnRhY3Quc29jaWFsTWVkaWEubWFwKGZ1bmN0aW9uIChzb2NpYWwpIHsgcmV0dXJuIGFwcGx5U29jaWFsRGVmYXVsdHMoc29jaWFsKTsgfSk7CiAgICBpZiAobmV3Q29udGFjdC5jb21wYW55KSB7CiAgICAgICAgbmV3Q29udGFjdC5jb21wYW55ID0gYXBwbHlDb21wYW55RGVmYXVsdHMobmV3Q29udGFjdC5jb21wYW55KTsKICAgICAgICBuZXdDb250YWN0LmNvbXBhbnkuc29jaWFsTWVkaWEgPSBuZXdDb250YWN0LmNvbXBhbnkuc29jaWFsTWVkaWEKICAgICAgICAgICAgLm1hcChmdW5jdGlvbiAoc29jaWFsKSB7IHJldHVybiBhcHBseVNvY2lhbERlZmF1bHRzKHNvY2lhbCk7IH0pOwogICAgfQogICAgcmV0dXJuIGNsZWFudXBDb250YWN0KG5ld0NvbnRhY3QpOwp9CmZ1bmN0aW9uIGFwcGx5UGh5c2ljYWxBZGRyZXNzRGVmYXVsdHMoYWRkcmVzcykgewogICAgcmV0dXJuIF9fYXNzaWduKHsgdHlwZTogJycsIHN0cmVldDogJycsIGNpdHk6ICcnLCByZWdpb246ICcnLCBwb3N0Y29kZTogJycsIGNvdW50cnk6ICcnIH0sIGFkZHJlc3MpOwp9CmZ1bmN0aW9uIGFwcGx5UGhvbmVEZWZhdWx0cyhwaG9uZSkgewogICAgcmV0dXJuIF9fYXNzaWduKHsgdHlwZTogUGhvbmVUeXBlLk1haW4sIG51bWJlcjogJycgfSwgcGhvbmUpOwp9CmZ1bmN0aW9uIGFwcGx5U29jaWFsRGVmYXVsdHMoc29jaWFsKSB7CiAgICByZXR1cm4gX19hc3NpZ24oeyB1c2VybmFtZTogJycsIHVybDogJycgfSwgc29jaWFsKTsKfQpmdW5jdGlvbiBhcHBseUNvbXBhbnlEZWZhdWx0cyhjb21wYW55KSB7CiAgICByZXR1cm4gX19hc3NpZ24oeyBuYW1lOiAnJywgd2Vic2l0ZTogJycsIGRlc2NyaXB0aW9uOiAnJywgc29jaWFsTWVkaWE6IFtdLCBlbXBsb3llZXM6IDAsIHJhaXNlZDogMCwgYW5udWFsUmV2ZW51ZTogMCwgbWFya2V0Q2FwOiAwIH0sIGNvbXBhbnkpOwp9CmV4cG9ydCBmdW5jdGlvbiBjb21wdXRlQ29udGFjdChjb250YWN0cykgewogICAgaWYgKGNvbnRhY3RzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChjb250YWN0cy5sZW5ndGggPT09IDEpIHsKICAgICAgICByZXR1cm4gX19hc3NpZ24oX19hc3NpZ24oe30sIGNvbnRhY3RzWzBdKSwgeyB0eXBlOiBDb250YWN0VHlwZS5DYWNoZSB9KTsKICAgIH0KICAgIGlmIChjb250YWN0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICB2YXIgdGVhbUNvbnRhY3QgPSBjb250YWN0cy5maWx0ZXIoZnVuY3Rpb24gKGNvbnRhY3QpIHsgcmV0dXJuIGNvbnRhY3QudGVhbTsgfSlbMF07CiAgICAgICAgdmFyIHBlcnNvbmFsQ29udGFjdCA9IGNvbnRhY3RzLmZpbHRlcihmdW5jdGlvbiAoY29udGFjdCkgeyByZXR1cm4gIWNvbnRhY3QudGVhbTsgfSlbMF07CiAgICAgICAgcmV0dXJuIF9fYXNzaWduKF9fYXNzaWduKF9fYXNzaWduKHt9LCBwZXJzb25hbENvbnRhY3QpLCB0ZWFtQ29udGFjdCksIHsgdHlwZTogQ29udGFjdFR5cGUuQ2FjaGUgfSk7CiAgICB9CiAgICByZXR1cm47Cn0KZXhwb3J0IGZ1bmN0aW9uIGFwcGx5Q29udGFjdEdyb3VwRGVmYXVsdHMoZ3JvdXApIHsKICAgIHZhciBuZXdHcm91cCA9IF9fYXNzaWduKHsgbmFtZTogJycgfSwgZ3JvdXApOwogICAgLy8gSGFuZGxlIHBhcnNpbmcgZGF0ZXMKICAgIGlmICghKG5ld0dyb3VwLmNyZWF0ZWQgaW5zdGFuY2VvZiBEYXRlKSAmJiAodHlwZW9mIG5ld0dyb3VwLmNyZWF0ZWQgPT09ICdzdHJpbmcnKSkgewogICAgICAgIG5ld0dyb3VwLmNyZWF0ZWQgPSBuZXcgRGF0ZShuZXdHcm91cC5jcmVhdGVkKTsKICAgIH0KICAgIGlmICghKG5ld0dyb3VwLnVwZGF0ZWQgaW5zdGFuY2VvZiBEYXRlKSAmJiAodHlwZW9mIG5ld0dyb3VwLnVwZGF0ZWQgPT09ICdzdHJpbmcnKSkgewogICAgICAgIG5ld0dyb3VwLnVwZGF0ZWQgPSBuZXcgRGF0ZShuZXdHcm91cC51cGRhdGVkKTsKICAgIH0KICAgIHJldHVybiBuZXdHcm91cDsKfQpleHBvcnQgZnVuY3Rpb24gc2VhcmNoQ29udGFjdHMocXVlcnksIGxpbWl0KSB7CiAgICB2YXIgcHJlZml4ID0gcXVlcnkudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgICAvLyBkb24ndCBydW4gcXVlcnkgZW1wdHksIHRoaXMgY2F1c2VzIGV2ZXJ5dGhpbmcgdG8gYmUgcmV0dXJuZWQKICAgIGlmIChwcmVmaXggPT09ICcnKSB7CiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoW10pOwogICAgfQogICAgdmFyIHJhbmdlID0gcHJlZml4S2V5UmFuZ2UocHJlZml4KTsKICAgIHJldHVybiBDYWNoZS5saXN0SW5kZXgoU3RvcmVzLkNvbnRhY3RzLCAnc2VhcmNoJywgcmFuZ2UsIGZhbHNlLCBsaW1pdCk7Cn0KZXhwb3J0IHZhciBzZWFyY2hDb250YWN0c0J5RG9tYWluID0gZnVuY3Rpb24gKGRvbWFpbikgewogICAgdmFyIGxvd2VyY2FzZWQgPSBkb21haW4udHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgICBpZiAobG93ZXJjYXNlZCA9PT0gJycpIHsKICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZihbXSk7CiAgICB9CiAgICByZXR1cm4gQ2FjaGUubGlzdEluZGV4KFN0b3Jlcy5Db250YWN0cywgJ2VtYWlsJywgdW5kZWZpbmVkLCBmYWxzZSwgdW5kZWZpbmVkLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gYy5lbWFpbC5pbmRleE9mKGRvbWFpbikgPiAtMTsgfSk7Cn07CmV4cG9ydCB2YXIgc2VhcmNoQ29udGFjdEdyb3VwcyA9IGZ1bmN0aW9uIChxdWVyeSkgewogICAgdmFyIGxvd2VyQ2FzZVF1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKTsKICAgIHJldHVybiBDYWNoZS5saXN0KFN0b3Jlcy5Db250YWN0R3JvdXBzLCBmdW5jdGlvbiAoY29udGFjdEdyb3VwKSB7CiAgICAgICAgaWYgKCFsb3dlckNhc2VRdWVyeSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChjb250YWN0R3JvdXAubmFtZSAmJiBjb250YWN0R3JvdXAubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvd2VyQ2FzZVF1ZXJ5KSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSk7Cn07CmV4cG9ydCB2YXIgZ2V0Q29udGFjdHNCeUNvbnRhY3RHcm91cCA9IGZ1bmN0aW9uIChjb250YWN0R3JvdXApIHsKICAgIHJldHVybiBDYWNoZS5saXN0KFN0b3Jlcy5Db250YWN0cywgZnVuY3Rpb24gKGNvbnRhY3QpIHsgcmV0dXJuIGNvbnRhY3QuZ3JvdXBzLmluZGV4T2YoY29udGFjdEdyb3VwKSAhPT0gLTE7IH0pOwp9OwpleHBvcnQgdmFyIGdldENvbnRhY3RzQnlSZWNpcGllbnRUeXBlID0gZnVuY3Rpb24gKHJlY2lwaWVudHMpIHsKICAgIHJldHVybiBDYWNoZS5saXN0KFN0b3Jlcy5Db250YWN0cywgZnVuY3Rpb24gKGNvbnRhY3QpIHsKICAgICAgICByZXR1cm4gcmVjaXBpZW50cwogICAgICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChyZWNpcGllbnQpIHsKICAgICAgICAgICAgaWYgKHJlY2lwaWVudC50eXBlID09PSBFdmVudFJlY2lwaWVudFR5cGUuQ29udGFjdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlY2lwaWVudC5pZGVudGlmaWVyID09PSBjb250YWN0LmVtYWlsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb250YWN0Lmdyb3Vwcy5pbmRleE9mKHJlY2lwaWVudC5pZGVudGlmaWVyKSAhPT0gLTE7CiAgICAgICAgfSkubGVuZ3RoID4gMDsKICAgIH0pOwp9OwpleHBvcnQgdmFyIG1lcmdlRW5yaWNoZWRDb250YWN0ID0gZnVuY3Rpb24gKGVucmljaGVkLCBleGlzdGluZykgewogICAgdmFyIGZpbmFsID0gX19hc3NpZ24oe30sIGVucmljaGVkKTsKICAgIHZhciByZXZlcnRlZE5hbWVzID0gZmFsc2U7CiAgICBpZiAoZmluYWwuZnVsbE5hbWUubGVuZ3RoID09PSAwICYmIGV4aXN0aW5nLmZ1bGxOYW1lLmxlbmd0aCA+IDApIHsKICAgICAgICBmaW5hbC5mdWxsTmFtZSA9IGV4aXN0aW5nLmZ1bGxOYW1lOwogICAgICAgIHJldmVydGVkTmFtZXMgPSB0cnVlOwogICAgfQogICAgaWYgKGZpbmFsLmdpdmVuTmFtZS5sZW5ndGggPT09IDAgJiYgZXhpc3RpbmcuZ2l2ZW5OYW1lLmxlbmd0aCA+IDApIHsKICAgICAgICBmaW5hbC5naXZlbk5hbWUgPSBleGlzdGluZy5naXZlbk5hbWU7CiAgICAgICAgcmV2ZXJ0ZWROYW1lcyA9IHRydWU7CiAgICB9CiAgICBpZiAoZmluYWwuZmFtaWx5TmFtZS5sZW5ndGggPT09IDAgJiYgZXhpc3RpbmcuZmFtaWx5TmFtZS5sZW5ndGggPiAwKSB7CiAgICAgICAgZmluYWwuZmFtaWx5TmFtZSA9IGV4aXN0aW5nLmZhbWlseU5hbWU7CiAgICAgICAgcmV2ZXJ0ZWROYW1lcyA9IHRydWU7CiAgICB9CiAgICAvLyBSZXBsYWNlIHBob3RvIHVybCBpZiB2YWx1ZXMgY2hhbmdlZCBmb3IgbmFtZSBhbmQgcGhvdG8gdXJsIGlzIG9mIGdlbmVyYXRlZCBraW5kCiAgICBpZiAocmV2ZXJ0ZWROYW1lcykgewogICAgICAgIHZhciBnZW5lcmF0ZWRQaG90b1VybCA9IGdlbmVyYXRlUGhvdG9VcmwoZW5yaWNoZWQuZW1haWwsIGVucmljaGVkLmdpdmVuTmFtZSwgZW5yaWNoZWQuZmFtaWx5TmFtZSk7CiAgICAgICAgaWYgKGdlbmVyYXRlZFBob3RvVXJsID09PSBlbnJpY2hlZC5waG90b1VybCkgewogICAgICAgICAgICBmaW5hbC5waG90b1VybCA9IGV4aXN0aW5nLnBob3RvVXJsOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBmaW5hbDsKfTsKZXhwb3J0IHZhciBsaXN0Q29udGFjdHNCeUVtYWlsID0gZnVuY3Rpb24gKGVtYWlsKSB7CiAgICB2YXIgZGVzY2VuZGluZyA9IHRydWU7CiAgICB2YXIgTUFYX0NPTlRBQ1RfU0laRSA9IDI7CiAgICByZXR1cm4gQ2FjaGUubGlzdEluZGV4KFN0b3Jlcy5Db250YWN0cywgJ2VtYWlsJywgSURCS2V5UmFuZ2Uub25seShlbWFpbCksIGRlc2NlbmRpbmcsIE1BWF9DT05UQUNUX1NJWkUpOwp9Owo="},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/contact.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/contact.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable } from 'rxjs';\nimport { uniq } from 'lodash';\n\nimport Cache, { prefixKeyRange, Stores } from './db';\nimport { fnv1a32, fnv1a64hex } from './crypt';\nimport {\n  Contact,\n  ContactGroup,\n  Company,\n  PhysicalAddress,\n  Phone,\n  PhoneType,\n  Social,\n  ContactType,\n  EventRecipient,\n  EventRecipientType,\n} from '@src/types';\nimport { extractDomainFromEmail } from '@src/lib/address';\n\nconst COLORS = [\n  'a155a0',\n  '009ad9',\n  'fdaf16',\n  '8dd8f8',\n  'f05749',\n  '63ada0',\n  'f5864f',\n  'b1d35e',\n];\n\nfunction avatarColor(email: string): string {\n  const hash = fnv1a32(email);\n  const i = hash % COLORS.length;\n  return COLORS[i];\n}\n\nexport function defaultContact(\n  email: string, givenName: string = '', familyName: string = '',\n): Contact {\n  return applyContactDefaults({\n    email: email.trim().toLowerCase(),\n    givenName,\n    familyName,\n  } as any);\n}\n\nexport function generatePhotoUrl(\n  email: string,\n  firstName: string = '',\n  lastName: string = '',\n): string {\n  // cleanup variables\n  const lowerEmail = email.trim().toLowerCase();\n  const firstNameClean = firstName.trim();\n  const lastNameClean = lastName.trim();\n\n  // make initials\n  let initials = '';\n  if (firstNameClean.length > 0) {\n    initials = firstNameClean[0].toUpperCase();\n  }\n  if (lastNameClean.length > 0) {\n    initials += lastNameClean[0].toUpperCase();\n  }\n  // clean out '#' and '?' characters\n  initials = initials.replace(/#/g, '');\n  initials = initials.replace(/\\?/g, '');\n\n  if (initials.length === 0 && lowerEmail.length) {\n    initials = lowerEmail[0].toUpperCase();\n  }\n\n  return `${process.env.API_URL}/v1/avatars/initials/${initials}/${avatarColor(lowerEmail)}`;\n}\n\n// should not be exported, helper used by applyContactDefaults\nfunction cleanupContact(contact: Contact): Contact {\n  // cleanup variables\n  const fullNameClean = contact.fullName.trim();\n  const lowerEmail = contact.email.trim().toLowerCase();\n  const givenNameClean = contact.givenName.trim();\n  const familyNameClean = contact.familyName.trim();\n\n  // make initials\n  let initials = '';\n\n  // Start trying from full name\n  if (initials.length === 0 && fullNameClean.length) {\n    const words = fullNameClean.split(' ');\n\n    // Start Initial\n    if (words.length > 0) {\n      const firstWord = words[0];\n      if (firstWord.length > 0) {\n        initials = firstWord[0].toUpperCase();\n      }\n    }\n\n    if (words.length > 1) {\n      const lastWord = words[words.length - 1];\n      if (lastWord.length > 0) {\n        initials += lastWord[0].toUpperCase();\n      }\n    }\n  }\n\n  // Update from parts of name if cannot derive from full name\n  if (initials.length === 0) {\n    if (givenNameClean.length > 0) {\n      initials = givenNameClean[0].toUpperCase();\n    }\n    if (familyNameClean.length > 0) {\n      initials += familyNameClean[0].toUpperCase();\n    }\n  }\n\n  // clean out '#' and '?' characters\n  initials = initials.replace(/#/g, '');\n  initials = initials.replace(/\\?/g, '');\n\n  if (initials.length === 0 && lowerEmail.length) {\n    initials = lowerEmail[0].toUpperCase();\n  }\n\n  let fullName = contact.fullName;\n  if (fullName.length === 0) {\n    fullName = `${givenNameClean} ${familyNameClean}`.trim();\n  }\n\n  const punctuationWhiteSpace = /[\\s;,\\-()]/;\n  const fullNameTokens = fullName.split(punctuationWhiteSpace).map(t => t.toLowerCase());\n\n  const searchIndex: string[] = uniq([\n    lowerEmail,\n    givenNameClean,\n    familyNameClean,\n    fullName,\n    ...fullNameTokens,\n    extractDomainFromEmail(lowerEmail) || '',\n  ].filter(value => value !== '').map(value => value.toLowerCase()));\n\n  const photoUrl = contact.photoUrl ||\n    `${process.env.API_URL}/v1/avatars/initials/${initials}/${avatarColor(lowerEmail)}`;\n\n  return {\n    ...contact,\n    id: contact.id || fnv1a64hex(lowerEmail),\n    email: lowerEmail,\n    givenName: givenNameClean,\n    familyName: familyNameClean,\n    fullName,\n    photoUrl,\n    searchIndex,\n  };\n}\n\nexport function applyContactDefaults(contact: Contact): Contact {\n  // need to truncate time for testing\n  let date = new Date();\n  date = new Date(date.getFullYear(), date.getMonth(), date.getDay());\n\n  const newContact = {\n    created: date,\n    updated: date,\n    type: ContactType.Default,\n    gender: '',\n    firstMet: '',\n    bio: '',\n    location: '',\n    organizationTitle: '',\n    organization: '',\n    website: '',\n    addresses: [],\n    phoneNumbers: [],\n    socialMedia: [],\n    groups: [],\n    salutation: '',\n    user: '',\n    email: '',\n    givenName: '',\n    familyName: '',\n    fullName: '',\n    searchIndex: [],\n    photoUrl: '',\n    ...contact,\n  };\n\n  if (!(newContact.created instanceof Date) && (typeof newContact.created === 'string')) {\n    newContact.created = new Date(newContact.created);\n  }\n  if (!(newContact.updated instanceof Date) && (typeof newContact.updated === 'string')) {\n    newContact.updated = new Date(newContact.updated);\n  }\n\n  if (!(newContact.lastSent instanceof Date) && (typeof newContact.lastSent === 'string')) {\n    newContact.lastSent = new Date(newContact.lastSent);\n  }\n\n  newContact.addresses = newContact.addresses.map(address => applyPhysicalAddressDefaults(address));\n  newContact.phoneNumbers = newContact.phoneNumbers.map(phone => applyPhoneDefaults(phone));\n  newContact.socialMedia = newContact.socialMedia.map(social => applySocialDefaults(social));\n\n  if (newContact.company) {\n    newContact.company = applyCompanyDefaults(newContact.company);\n    newContact.company.socialMedia = newContact.company.socialMedia\n      .map(social => applySocialDefaults(social));\n  }\n\n  return cleanupContact(newContact);\n}\n\nfunction applyPhysicalAddressDefaults(address: any): PhysicalAddress {\n  return {\n    type: '',\n    street: '',\n    city: '',\n    region: '',\n    postcode: '',\n    country: '',\n    ...address,\n  };\n}\n\nfunction applyPhoneDefaults(phone: Phone): Phone {\n  return {\n    type: PhoneType.Main,\n    number: '',\n    ...phone,\n  };\n}\n\nfunction applySocialDefaults(social: Social): Social {\n  return {\n    username: '',\n    url: '',\n    ...social,\n  };\n}\n\nfunction applyCompanyDefaults(company: Company): Company {\n  return {\n    name: '',\n    website: '',\n    description: '',\n    socialMedia: [],\n    employees: 0,\n    raised: 0,\n    annualRevenue: 0,\n    marketCap: 0,\n    ...company,\n  };\n}\n\nexport function computeContact(contacts: Contact[]) {\n  if (contacts.length === 0) {\n    return;\n  }\n\n  if (contacts.length === 1) {\n    return { ...contacts[0], type: ContactType.Cache };\n  }\n\n  if (contacts.length === 2) {\n    const teamContact = contacts.filter(contact => contact.team)[0];\n    const personalContact = contacts.filter(contact => !contact.team)[0];\n\n    return {\n      ...personalContact,\n      ...teamContact,\n      type: ContactType.Cache,\n    };\n  }\n\n  return;\n}\n\nexport function applyContactGroupDefaults(group: ContactGroup): ContactGroup {\n  const newGroup = {\n    name: '',\n    ...group,\n  };\n\n  // Handle parsing dates\n  if (!(newGroup.created instanceof Date) && (typeof newGroup.created === 'string')) {\n    newGroup.created = new Date(newGroup.created);\n  }\n  if (!(newGroup.updated instanceof Date) && (typeof newGroup.updated === 'string')) {\n    newGroup.updated = new Date(newGroup.updated);\n  }\n  return newGroup;\n}\n\nexport function searchContacts(query: string, limit?: number): Observable<Contact[]> {\n  const prefix = query.trim().toLowerCase();\n\n  // don't run query empty, this causes everything to be returned\n  if (prefix === '') {\n    return Observable.of([]);\n  }\n\n  const range = prefixKeyRange(prefix);\n  return Cache.listIndex(Stores.Contacts, 'search', range, false, limit);\n}\n\nexport const searchContactsByDomain = (domain: string): Observable<Contact[]> => {\n  const lowercased = domain.trim().toLowerCase();\n\n  if (lowercased === '') {\n    return Observable.of([]);\n  }\n\n  return Cache.listIndex(\n    Stores.Contacts,\n    'email',\n    undefined,\n    false,\n    undefined,\n    (c: Contact) => c.email.indexOf(domain) > -1,\n  );\n};\n\nexport const searchContactGroups = (query: string): Observable<ContactGroup[]> => {\n  const lowerCaseQuery = query.toLowerCase();\n  return Cache.list(\n    Stores.ContactGroups,\n    (contactGroup) => {\n      if (!lowerCaseQuery) {\n        return false;\n      }\n      if (\n        contactGroup.name && contactGroup.name.toLowerCase().includes(lowerCaseQuery)\n      ) {\n        return true;\n      }\n      return false;\n    },\n  );\n};\n\nexport const getContactsByContactGroup = (contactGroup: string): Observable<Contact[]>  => {\n  return Cache.list(\n    Stores.Contacts,\n    contact => contact.groups.indexOf(contactGroup) !== -1,\n  );\n};\n\nexport const getContactsByRecipientType = (recipients: EventRecipient[]) => {\n  return Cache.list(\n    Stores.Contacts,\n    (contact: Contact) =>\n      recipients\n        .filter((recipient) => {\n          if (recipient.type === EventRecipientType.Contact) {\n            return recipient.identifier === contact.email;\n          }\n\n          return contact.groups.indexOf(recipient.identifier) !== -1;\n        }).length > 0,\n  );\n};\n\nexport const mergeEnrichedContact = (enriched: Contact, existing: Contact): Contact => {\n  const final = { ...enriched };\n  let revertedNames = false;\n\n  if (final.fullName.length === 0 && existing.fullName.length > 0) {\n    final.fullName = existing.fullName;\n    revertedNames = true;\n  }\n\n  if (final.givenName.length === 0 && existing.givenName.length > 0) {\n    final.givenName = existing.givenName;\n    revertedNames = true;\n  }\n\n  if (final.familyName.length === 0 && existing.familyName.length > 0) {\n    final.familyName = existing.familyName;\n    revertedNames = true;\n  }\n\n  // Replace photo url if values changed for name and photo url is of generated kind\n  if (revertedNames) {\n    const generatedPhotoUrl = generatePhotoUrl(\n      enriched.email,\n      enriched.givenName,\n      enriched.familyName,\n    );\n    if (generatedPhotoUrl === enriched.photoUrl) {\n      final.photoUrl = existing.photoUrl;\n    }\n  }\n\n  return final;\n};\n\nexport const listContactsByEmail = (email: string): Observable<Contact[]> => {\n  const descending = true;\n  const MAX_CONTACT_SIZE = 2;\n\n  return Cache.listIndex<Contact>(\n    Stores.Contacts,\n    'email',\n    IDBKeyRange.only(email),\n    descending,\n    MAX_CONTACT_SIZE,\n  );\n};\n"]}]}