{"remainingRequest":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js??ref--6-1!/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/filesystem.ts","dependencies":[{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/filesystem.ts","mtime":1675280254064},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/cache-loader/dist/cjs.js","mtime":1675365393858},{"path":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/node_modules/ts-loader/index.js","mtime":1675365391714}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnOwppbXBvcnQgeyBpc0FycmF5LCBtYXBWYWx1ZXMgfSBmcm9tICdsb2Rhc2gnOwpmdW5jdGlvbiBlbmNvZGVEYXRlcyhkYXRhKSB7CiAgICBzd2l0Y2ggKHR5cGVvZiAoZGF0YSkpIHsKICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4geyBwbUZpbGVzeXN0ZW1FbmNvZGVkVHlwZTogJ2RhdGUnLCBkYXRhOiBkYXRhIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzQXJyYXkoZGF0YSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChmdW5jdGlvbiAobSkgeyByZXR1cm4gZW5jb2RlRGF0ZXMobSk7IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtYXBWYWx1ZXMoZGF0YSwgZnVuY3Rpb24gKG0pIHsgcmV0dXJuIGVuY29kZURhdGVzKG0pOyB9KTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgIH0KfQpmdW5jdGlvbiBkZWNvZGVEYXRlcyhkYXRhKSB7CiAgICBzd2l0Y2ggKHR5cGVvZiAoZGF0YSkpIHsKICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGEucG1GaWxlc3lzdGVtRW5jb2RlZFR5cGUgJiYgZGF0YS5wbUZpbGVzeXN0ZW1FbmNvZGVkVHlwZSA9PT0gJ2RhdGUnICYmIGRhdGEuZGF0YSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGEuZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGlzQXJyYXkoZGF0YSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhLm1hcChmdW5jdGlvbiAobSkgeyByZXR1cm4gZGVjb2RlRGF0ZXMobSk7IH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtYXBWYWx1ZXMoZGF0YSwgZnVuY3Rpb24gKG0pIHsgcmV0dXJuIGRlY29kZURhdGVzKG0pOyB9KTsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgIH0KfQpleHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplSlNPTihkYXRhKSB7CiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZW5jb2RlRGF0ZXMoZGF0YSkpOwp9CmV4cG9ydCBmdW5jdGlvbiB1bnNlcmlhbGl6ZUpTT04oZGF0YSkgewogICAgcmV0dXJuIGRlY29kZURhdGVzKEpTT04ucGFyc2UoZGF0YSkpOwp9CmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemVGaWxlKGZpbGVuYW1lLCBkYXRhKSB7CiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7CiAgICAgICAgaWYgKCF3ZWJraXRSZXF1ZXN0RmlsZVN5c3RlbSkgewogICAgICAgICAgICBvYnNlcnZlci5lcnJvcihuZXcgRXJyb3IoJ0ZpbGVzeXN0ZW0gbm90IHN1cHBvcnRlZC4nKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gV3JpdGVzIHNlcmlhbGl6ZWQgcmVzdG9yZSBmaWxlcyBmb3IgZnV0dXJlIHVzZQogICAgICAgIHdlYmtpdFJlcXVlc3RGaWxlU3lzdGVtKFBFUlNJU1RFTlQsIDEwMDAwMDAwMCwgZnVuY3Rpb24gKGZpbGVzeXN0ZW0pIHsKICAgICAgICAgICAgZmlsZXN5c3RlbS5yb290LmdldEZpbGUoZmlsZW5hbWUsIHsgY3JlYXRlOiB0cnVlIH0sIGZ1bmN0aW9uIChlbnRyeSkgewogICAgICAgICAgICAgICAgZW50cnkuY3JlYXRlV3JpdGVyKGZ1bmN0aW9uICh3cml0ZXIpIHsKICAgICAgICAgICAgICAgICAgICB3cml0ZXIub25lcnJvciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBvYnNlcnZlci5lcnJvcihlKTsgfTsKICAgICAgICAgICAgICAgICAgICB3cml0ZXIub253cml0ZWVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHdyaXRlci53cml0ZShuZXcgQmxvYihbc2VyaWFsaXplSlNPTihkYXRhKV0sIHsgdHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nIH0pKTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvYnNlcnZlci5lcnJvcihlKTsgfSk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvYnNlcnZlci5lcnJvcihlKTsgfSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9ic2VydmVyLmVycm9yKGUpOyB9KTsKICAgIH0pOwp9CmV4cG9ydCBmdW5jdGlvbiBkZWxldGVGaWxlKGZpbGVuYW1lKSB7CiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7CiAgICAgICAgaWYgKCF3ZWJraXRSZXF1ZXN0RmlsZVN5c3RlbSkgewogICAgICAgICAgICBvYnNlcnZlci5lcnJvcihuZXcgRXJyb3IoJ0ZpbGVzeXN0ZW0gbm90IHN1cHBvcnRlZC4nKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgd2Via2l0UmVxdWVzdEZpbGVTeXN0ZW0oUEVSU0lTVEVOVCwgMTAwMDAwMDAwLCBmdW5jdGlvbiAoZmlsZXN5c3RlbSkgewogICAgICAgICAgICBmaWxlc3lzdGVtLnJvb3QuZ2V0RmlsZShmaWxlbmFtZSwgeyBjcmVhdGU6IHRydWUgfSwgZnVuY3Rpb24gKGVudHJ5KSB7CiAgICAgICAgICAgICAgICBlbnRyeS5yZW1vdmUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTsKICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvYnNlcnZlci5lcnJvcihlKTsgfSk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvYnNlcnZlci5lcnJvcihlKTsgfSk7CiAgICAgICAgfSk7CiAgICB9KTsKfQpleHBvcnQgZnVuY3Rpb24gdW5zZXJpYWxpemVGaWxlKGZpbGVuYW1lKSB7CiAgICByZXR1cm4gT2JzZXJ2YWJsZS5jcmVhdGUoZnVuY3Rpb24gKG9ic2VydmVyKSB7CiAgICAgICAgaWYgKCF3ZWJraXRSZXF1ZXN0RmlsZVN5c3RlbSkgewogICAgICAgICAgICBvYnNlcnZlci5lcnJvcihuZXcgRXJyb3IoJ0ZpbGVzeXN0ZW0gbm90IHN1cHBvcnRlZC4nKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgd2Via2l0UmVxdWVzdEZpbGVTeXN0ZW0oUEVSU0lTVEVOVCwgMTAwMDAwMDAwLCBmdW5jdGlvbiAoZmlsZXN5c3RlbSkgewogICAgICAgICAgICBmaWxlc3lzdGVtLnJvb3QuZ2V0RmlsZShmaWxlbmFtZSwgdW5kZWZpbmVkLCBmdW5jdGlvbiAoZW50cnkpIHsKICAgICAgICAgICAgICAgIGVudHJ5LmZpbGUoZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICAgICAgICAgICAgICBmaWxlLnRleHQoKQogICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoc3RyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQodW5zZXJpYWxpemVKU09OKHN0cikpOwogICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpOwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gb2JzZXJ2ZXIuZXJyb3IoZSk7IH0pOwogICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9ic2VydmVyLmVycm9yKGUpOyB9KTsKICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9ic2VydmVyLmVycm9yKGUpOyB9KTsKICAgICAgICB9LCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gb2JzZXJ2ZXIuZXJyb3IoZSk7IH0pOwogICAgfSk7Cn0K"},{"version":3,"file":"/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/filesystem.ts","sourceRoot":"","sources":["/Users/andrewsamboy/Desktop/Git/polymail/webapp/src/lib/filesystem.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable, Observer } from 'rxjs';\nimport { isArray, mapValues } from 'lodash';\n\nfunction encodeDates(data: any): any {\n  switch (typeof(data)) {\n    case 'object':\n      if (data === null) {\n        return data;\n      }\n\n      if (data instanceof Date) {\n        return { pmFilesystemEncodedType: 'date', data };\n      }\n\n      if (isArray(data)) {\n        return data.map(m => encodeDates(m));\n      }\n\n      return mapValues(data, m => encodeDates(m));\n    default:\n      return data;\n  }\n}\n\nfunction decodeDates(data: any): any {\n  switch (typeof (data)) {\n    case 'object':\n      if (data === null) {\n        return data;\n      }\n\n      if (data.pmFilesystemEncodedType && data.pmFilesystemEncodedType === 'date' && data.data) {\n        return new Date(data.data);\n      }\n\n      if (isArray(data)) {\n        return data.map(m => decodeDates(m));\n      }\n\n      return mapValues(data, m => decodeDates(m));\n    default:\n      return data;\n  }\n}\n\nexport function serializeJSON<M>(data: M): string {\n  return JSON.stringify(encodeDates(data));\n}\n\nexport function unserializeJSON<M>(data: string): M {\n  return decodeDates(JSON.parse(data));\n}\n\nexport function serializeFile<M>(filename: string, data: M): Observable<null> {\n  return Observable.create((observer: Observer<null>) => {\n    if (!webkitRequestFileSystem) {\n      observer.error(new Error('Filesystem not supported.'));\n      return;\n    }\n\n    // Writes serialized restore files for future use\n    webkitRequestFileSystem(\n      PERSISTENT,\n      100000000,\n      (filesystem) => {\n        filesystem.root.getFile(\n          filename,\n          { create: true },\n          (entry) => {\n            entry.createWriter(\n              (writer) => {\n                writer.onerror = e => observer.error(e);\n                writer.onwriteend = () => {\n                  observer.next(null);\n                  observer.complete();\n                };\n                writer.write(new Blob([serializeJSON(data)], { type: 'application/json' }));\n              },\n              e => observer.error(e),\n            );\n          },\n          e => observer.error(e),\n        );\n      },\n      e => observer.error(e),\n    );\n  });\n}\n\nexport function deleteFile(filename: string): Observable<null> {\n  return Observable.create((observer: Observer<null>) => {\n    if (!webkitRequestFileSystem) {\n      observer.error(new Error('Filesystem not supported.'));\n      return;\n    }\n\n    webkitRequestFileSystem(\n      PERSISTENT,\n      100000000,\n      (filesystem) => {\n        filesystem.root.getFile(\n          filename,\n          { create: true },\n          (entry) => {\n            entry.remove(\n              () => {\n                observer.next(null);\n                observer.complete();\n              },\n              e => observer.error(e),\n            );\n          },\n          e => observer.error(e),\n        );\n      },\n    );\n  });\n}\n\nexport function unserializeFile<M>(filename: string): Observable<M> {\n  return Observable.create((observer: Observer<M>) => {\n    if (!webkitRequestFileSystem) {\n      observer.error(new Error('Filesystem not supported.'));\n      return;\n    }\n\n    webkitRequestFileSystem(\n      PERSISTENT,\n      100000000,\n      (filesystem) => {\n        filesystem.root.getFile(\n          filename,\n          undefined,\n          (entry) => {\n            entry.file(\n              (file) => {\n                file.text()\n                  .then((str) => {\n                    observer.next(unserializeJSON(str));\n                    observer.complete();\n                  })\n                  .catch(e => observer.error(e));\n              },\n              e => observer.error(e),\n            );\n          },\n          e => observer.error(e),\n        );\n      },\n      e => observer.error(e),\n    );\n  });\n}\n"]}]}